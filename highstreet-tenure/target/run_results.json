{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.11", "generated_at": "2025-09-19T15:36:05.228724Z", "invocation_id": "9dee0b56-2e1a-448a-a899-c4dfbe1d0d71", "invocation_started_at": "2025-09-19T15:36:00.678241Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:01.977002Z", "completed_at": "2025-09-19T15:36:01.985961Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.003639Z", "completed_at": "2025-09-19T15:36:02.175545Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.20463085174560547, "adapter_response": {"_message": "SELECT 45", "code": "SELECT", "rows_affected": 45}, "message": "SELECT 45", "failures": null, "unique_id": "model.highstreet_tenure.stg_filemap", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"highstreet\".\"public\".\"filename_mapping\"\n),\n\nextracted as (\n    select\n        id,\n        source_file,\n        loaded_at,\n        -- Extract fields from the JSON data column\n        data->>'file_name' as file_name,\n        data->>'table_name' as table_name,\n        data->>'valid_from' as valid_from,\n        data->>'valid_to' as valid_to\n    from source\n)\n\nselect * from extracted", "relation_name": "\"highstreet\".\"analytics_analytics\".\"stg_filemap\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:01.971656Z", "completed_at": "2025-09-19T15:36:01.979236Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:01.979640Z", "completed_at": "2025-09-19T15:36:02.181030Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.21236109733581543, "adapter_response": {"_message": "SELECT 432", "code": "SELECT", "rows_affected": 432}, "message": "SELECT 432", "failures": null, "unique_id": "model.highstreet_tenure.date_spine", "compiled": true, "compiled_code": "\n\nwith date_spine as (\n    select \n        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month\n    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026\n)\n\nselect \n    date_month,\n    to_char(date_month, 'YYYYMM') as year_month_key,\n    to_char(date_month, 'Mon-YYYY') as formatted_month_year,\n    extract(year from date_month) as year,\n    extract(month from date_month) as month,\n    to_char(date_month, 'Month') as month_name,\n    to_char(date_month, 'Mon') as month_abbr\nfrom date_spine\norder by date_month", "relation_name": "\"highstreet\".\"analytics_analytics\".\"date_spine\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.205790Z", "completed_at": "2025-09-19T15:36:02.209595Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.209864Z", "completed_at": "2025-09-19T15:36:02.419272Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.21619606018066406, "adapter_response": {"_message": "SELECT 1307", "code": "SELECT", "rows_affected": 1307}, "message": "SELECT 1307", "failures": null, "unique_id": "model.highstreet_tenure.stg_new_businesses", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"highstreet\".\"public\".\"new_businesses\"\n),\n\nfilemap as (\n    select file_name, valid_from, valid_to from \"highstreet\".\"analytics_analytics\".\"stg_filemap\"\n    where table_name = 'new_businesses'\n),\n\nextracted as (\n    select\n        source.id,\n        source_file,\n        loaded_at,\n        -- Extract fields from the JSON data column\n        data->>'current_analysis_code_description' as current_analysis_code_description,\n        data->>'primary_liable_party_name' as primary_liable_party_name,\n        data->>'full_property_address' as full_property_address,\n        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,\n        (data->>'current_rateable_value')::numeric as current_rateable_value,\n        data->>'property_reference_number' as property_reference_number,\n        filemap.valid_from as valid_from,\n        filemap.valid_to as valid_to\n    from source\n    left join filemap on source.source_file = filemap.file_name\n)\n\nselect * from extracted", "relation_name": "\"highstreet\".\"analytics_analytics\".\"stg_new_businesses\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.184869Z", "completed_at": "2025-09-19T15:36:02.192911Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.194068Z", "completed_at": "2025-09-19T15:36:02.445017Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.2636847496032715, "adapter_response": {"_message": "SELECT 2683", "code": "SELECT", "rows_affected": 2683}, "message": "SELECT 2683", "failures": null, "unique_id": "model.highstreet_tenure.stg_accounts_closed", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"highstreet\".\"public\".\"accounts_closed\"\n),\n\nfilemap as (\n    select file_name, valid_from, valid_to from \"highstreet\".\"analytics_analytics\".\"stg_filemap\"\n    where table_name = 'accounts_closed'\n),\n\nextracted as (\n    select\n        source.id,\n        source.source_file,\n        source.loaded_at,\n        -- Extract fields from the JSON data column\n        data->>'account_start_date' as account_start_date,\n        data->>'account_end_date' as account_end_date,\n        (data->>'outstanding_debt')::numeric as outstanding_debt,\n        data->>'full_property_address' as full_property_address,\n        data->>'primary_liable_party_name' as primary_liable_party_name,\n        data->>'property_reference_number' as property_reference_number,\n        filemap.valid_from as valid_from,\n        filemap.valid_to as valid_to\n    from source\n    left join filemap on source.source_file = filemap.file_name\n)\n\nselect * from extracted", "relation_name": "\"highstreet\".\"analytics_analytics\".\"stg_accounts_closed\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.187406Z", "completed_at": "2025-09-19T15:36:02.193671Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.197184Z", "completed_at": "2025-09-19T15:36:02.930664Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.7489879131317139, "adapter_response": {"_message": "SELECT 27009", "code": "SELECT", "rows_affected": 27009}, "message": "SELECT 27009", "failures": null, "unique_id": "model.highstreet_tenure.stg_accounts_no_relief", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"highstreet\".\"public\".\"accounts_no_relief\"\n),\n\nfilemap as (\n    select file_name, valid_from, valid_to from \"highstreet\".\"analytics_analytics\".\"stg_filemap\"\n    where table_name = 'accounts_no_relief'\n),\n\nextracted as (\n    select\n        source.id,\n        source_file,\n        loaded_at,\n        -- Extract fields from the JSON data column\n        data->>'billing_period' as billing_period,\n        data->>'full_property_address' as full_property_address,\n        (data->>'current_rateable_value')::numeric as current_rateable_value,\n        data->>'primary_liable_party_name' as primary_liable_party_name,\n        data->>'property_reference_number' as property_reference_number,\n        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,\n        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,\n        filemap.valid_from as valid_from,\n        filemap.valid_to as valid_to\n    from source\n    left join filemap on source.source_file = filemap.file_name\n)\n\nselect * from extracted", "relation_name": "\"highstreet\".\"analytics_analytics\".\"stg_accounts_no_relief\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.189766Z", "completed_at": "2025-09-19T15:36:02.196475Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.200815Z", "completed_at": "2025-09-19T15:36:02.947844Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.7660810947418213, "adapter_response": {"_message": "SELECT 28209", "code": "SELECT", "rows_affected": 28209}, "message": "SELECT 28209", "failures": null, "unique_id": "model.highstreet_tenure.stg_accounts_relief", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"highstreet\".\"public\".\"accounts_relief\"\n),\n\nfilemap as (\n    select file_name, valid_from, valid_to from \"highstreet\".\"analytics_analytics\".\"stg_filemap\"\n    where table_name = 'accounts_with_relief'\n),\n\nextracted as (\n    select\n        source.id,\n        source_file,\n        loaded_at,\n        -- Extract fields from the JSON data column\n        data->>'current_relief_type' as current_relief_type,\n        data->>'full_property_address' as full_property_address,\n        (data->>'current_rateable_value')::numeric as current_rateable_value,\n        data->>'primary_liable_party_name' as primary_liable_party_name,\n        data->>'property_reference_number' as property_reference_number,\n        data->>'current_relief_award_start_date' as current_relief_award_start_date,\n        data->>'current_relief_type_description' as current_relief_type_description,\n        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,\n        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,\n        filemap.valid_from as valid_from,\n        filemap.valid_to as valid_to\n    from source\n    left join filemap on source.source_file = filemap.file_name\n)\n\nselect * from extracted", "relation_name": "\"highstreet\".\"analytics_analytics\".\"stg_accounts_relief\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.959859Z", "completed_at": "2025-09-19T15:36:02.972434Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.975527Z", "completed_at": "2025-09-19T15:36:03.376261Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.42481088638305664, "adapter_response": {"_message": "SELECT 6223", "code": "SELECT", "rows_affected": 6223}, "message": "SELECT 6223", "failures": null, "unique_id": "model.highstreet_tenure.businesses", "compiled": true, "compiled_code": "\n\nwith businesses_new as (\n    select distinct primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_new_businesses\"\n\n),\n\nbusinesses_accounts_closed as (\n    select distinct primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_accounts_closed\"\n\n),\n\nbusinesses_accounts_no_relief as (\n    select distinct primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_accounts_no_relief\"\n\n),\n\nbusinesses_accounts_relief as (\n    select distinct primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_accounts_relief\"\n\n),\n\n\ncombined_businesses as (\n\n    select business_name from businesses_new\n    union \n    select business_name from businesses_accounts_closed\n    union \n    select business_name from businesses_accounts_no_relief\n    union \n    select business_name from businesses_accounts_relief\n\n)\n\nselect distinct business_name from combined_businesses", "relation_name": "\"highstreet\".\"analytics_analytics\".\"businesses\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.966845Z", "completed_at": "2025-09-19T15:36:02.978058Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.978849Z", "completed_at": "2025-09-19T15:36:03.462119Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.5105721950531006, "adapter_response": {"_message": "SELECT 9083", "code": "SELECT", "rows_affected": 9083}, "message": "SELECT 9083", "failures": null, "unique_id": "model.highstreet_tenure.properties", "compiled": true, "compiled_code": "\n\nwith properties_new as (\n    select distinct full_property_address as property_address, property_reference_number as property_id from \"highstreet\".\"analytics_analytics\".\"stg_new_businesses\"\n\n),\n\nproperties_accounts_no_relief as (\n    select distinct full_property_address as property_address, property_reference_number as property_id from \"highstreet\".\"analytics_analytics\".\"stg_accounts_no_relief\"\n\n),\n\nproperties_accounts_relief as (\n    select distinct full_property_address as property_address, property_reference_number as property_id from \"highstreet\".\"analytics_analytics\".\"stg_accounts_relief\"\n\n),\n\nproperties_accounts_closed as (\n    select distinct full_property_address as property_address, property_reference_number as property_id from \"highstreet\".\"analytics_analytics\".\"stg_accounts_closed\"\n\n),\n\ncombined_properties as (\n\n    select * from properties_new\n    union \n    select * from properties_accounts_no_relief\n    union \n    select * from properties_accounts_relief\n    union \n    select * from properties_accounts_closed\n)\n\nselect distinct property_id, property_address from combined_properties", "relation_name": "\"highstreet\".\"analytics_analytics\".\"properties\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.954298Z", "completed_at": "2025-09-19T15:36:02.969010Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.972786Z", "completed_at": "2025-09-19T15:36:03.494852Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.5431087017059326, "adapter_response": {"_message": "SELECT 11450", "code": "SELECT", "rows_affected": 11450}, "message": "SELECT 11450", "failures": null, "unique_id": "model.highstreet_tenure.business_addresses", "compiled": true, "compiled_code": "\n\nwith business_addresses_new as (\n    select distinct full_property_address as business_address, primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_new_businesses\"\n\n),\n\nbusiness_addresses_accounts_no_relief as (\n    select distinct full_property_address as business_address, primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_accounts_no_relief\"\n\n),\n\nbusiness_addresses_accounts_relief as (\n    select distinct full_property_address as business_address, primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_accounts_relief\"\n\n),\n\nbusiness_addresses_accounts_closed as (\n    select distinct full_property_address as business_address, primary_liable_party_name as business_name from \"highstreet\".\"analytics_analytics\".\"stg_accounts_closed\"\n\n),\n\ncombined_business_addresses as (\n\n    select * from business_addresses_new\n    union \n    select * from business_addresses_accounts_no_relief\n    union \n    select * from business_addresses_accounts_relief\n    union \n    select * from business_addresses_accounts_closed\n)\n\nselect distinct business_name, business_address from combined_business_addresses", "relation_name": "\"highstreet\".\"analytics_analytics\".\"business_addresses\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:03.469185Z", "completed_at": "2025-09-19T15:36:03.471336Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:03.471704Z", "completed_at": "2025-09-19T15:36:03.666122Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.19933176040649414, "adapter_response": {"_message": "SELECT 4945", "code": "SELECT", "rows_affected": 4945}, "message": "SELECT 4945", "failures": null, "unique_id": "model.highstreet_tenure.addresses", "compiled": true, "compiled_code": "\n\nwith properties as (\n    select * from \"highstreet\".\"analytics_analytics\".\"properties\"\n)\n\nselect distinct property_address from properties", "relation_name": "\"highstreet\".\"analytics_analytics\".\"addresses\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:02.956955Z", "completed_at": "2025-09-19T15:36:02.966557Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:02.969253Z", "completed_at": "2025-09-19T15:36:04.817632Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.8656902313232422, "adapter_response": {"_message": "SELECT 39661", "code": "SELECT", "rows_affected": 39661}, "message": "SELECT 39661", "failures": null, "unique_id": "model.highstreet_tenure.business_timeline", "compiled": true, "compiled_code": "\n\nwith account_ends as (\n    select distinct\n        primary_liable_party_name as business_name,\n        account_start_date,\n        account_end_date,\n        account_end_date as event_date,\n        'account_end' as event_type,\n        property_reference_number as property_id,\n        source_file as source_file_name\n    from \"highstreet\".\"analytics_analytics\".\"stg_accounts_closed\"\n),\n\naccounts_new as (\n    select distinct\n        primary_liable_party_name as business_name, \n        liable_responsibility_start_date as account_start_date,\n        NULL as account_end_date,\n        liable_responsibility_start_date as event_date,\n        'account_start' as event_type,\n        property_reference_number as property_id,\n        source_file as source_file_name\n    from \"highstreet\".\"analytics_analytics\".\"stg_new_businesses\"\n),\n\naccounts_no_relief_active as (\n    select distinct\n        primary_liable_party_name as business_name, \n        liable_responsibility_start_date as account_start_date,\n        NULL as account_end_date,\n        valid_to as event_date, -- Event date derived from file metadata (filename)\n        'account_active' as event_type,\n        property_reference_number as property_id,\n        source_file as source_file_name\n    from \"highstreet\".\"analytics_analytics\".\"stg_accounts_no_relief\"\n),\n\naccounts_relief_active as (\n    select distinct\n        primary_liable_party_name as business_name, \n        liable_responsibility_start_date as account_start_date,\n        NULL as account_end_date,\n        valid_to as event_date, \n        'account_active' as event_type,\n        property_reference_number as property_id,\n        source_file as source_file_name\n    from \"highstreet\".\"analytics_analytics\".\"stg_accounts_relief\"\n),\n\ncombined_accounts as (\n    select distinct business_name, event_date, event_type, source_file_name from account_ends\n    union \n    select distinct business_name, event_date, event_type, source_file_name from accounts_new\n    union all\n    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active\n    union all\n    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active\n)\n\nselect \n    business_name, event_date, event_type, source_file_name,\n    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,\n    to_char(event_date::date, 'YYYYMM')::int as year_month_key \nfrom combined_accounts order by business_name, event_date", "relation_name": "\"highstreet\".\"analytics_analytics\".\"business_timeline\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:04.823913Z", "completed_at": "2025-09-19T15:36:04.826582Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:04.826988Z", "completed_at": "2025-09-19T15:36:04.954396Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1335737705230713, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.highstreet_tenure.business_with_full_timeline", "compiled": true, "compiled_code": "with \n\nbusiness_timeline as (\n    select * from \"highstreet\".\"analytics_analytics\".\"business_timeline\"\n),\n\nnew_event_counts_by_business as (\n    select \n        business_name,\n        count(*) as new_event_count\n    from business_timeline\n    where event_type = 'account_start'\n    group by 1\n    having count(*) > 1\n),\n\nend_event_counts_by_business as (\n    select \n        business_name,\n        count(*) as end_event_count\n    from business_timeline\n    where event_type = 'account_end'\n    group by 1\n    having count(*) > 1\n)\n\nselect business_timeline.* \nfrom business_timeline\ninner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name\ninner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name\norder by business_timeline.business_name, business_timeline.event_date desc", "relation_name": "\"highstreet\".\"analytics_analytics\".\"business_with_full_timeline\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-19T15:36:04.821845Z", "completed_at": "2025-09-19T15:36:04.833164Z"}, {"name": "execute", "started_at": "2025-09-19T15:36:04.838580Z", "completed_at": "2025-09-19T15:36:05.171688Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.3512110710144043, "adapter_response": {"_message": "SELECT 6223", "code": "SELECT", "rows_affected": 6223}, "message": "SELECT 6223", "failures": null, "unique_id": "model.highstreet_tenure.business_tenures", "compiled": true, "compiled_code": "\n\nwith business_timeline as (\n    select * from \"highstreet\".\"analytics_analytics\".\"business_timeline\"\n),\n\nbusiness_tenures as (\n    select \n        business_name, \n        min(event_date) as tenure_start_date,\n        max(event_date) as tenure_end_date\n    from business_timeline\n    group by 1\n)\n\nselect * from business_tenures", "relation_name": "\"highstreet\".\"analytics_analytics\".\"business_tenures\"", "batch_results": null}], "elapsed_time": 4.051862001419067, "args": {"validate_macro_args": false, "printer_width": 80, "defer": false, "log_level": "info", "static_parser": true, "empty": false, "invocation_command": "dbt run", "indirect_selection": "eager", "require_generic_test_arguments_property": true, "state_modified_compare_more_unrendered_values": false, "version_check": true, "which": "run", "cache_selected_only": false, "require_resource_names_without_spaces": true, "log_file_max_bytes": 10485760, "send_anonymous_usage_stats": true, "quiet": false, "log_format_file": "debug", "show_resource_report": false, "partial_parse_file_diff": true, "populate_cache": true, "require_nested_cumulative_type_params": false, "print": true, "write_json": true, "strict_mode": false, "introspect": true, "macro_debugging": false, "upload_to_artifacts_ingest_api": false, "exclude": [], "show_all_deprecations": false, "require_batched_execution_for_custom_microbatch_strategy": false, "favor_state": false, "skip_nodes_if_on_run_start_fails": false, "source_freshness_run_project_hooks": true, "select": [], "profiles_dir": "/Users/samydoreau/data-j/highstreet-tenure", "vars": {}, "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "require_all_warnings_handled_by_warn_error": false, "use_fast_test_edges": false, "log_format": "default", "state_modified_compare_vars": false, "use_colors_file": true, "project_dir": "/Users/samydoreau/data-j/highstreet-tenure", "log_path": "/Users/samydoreau/data-j/highstreet-tenure/logs", "log_level_file": "debug", "partial_parse": true, "require_yaml_configuration_for_mf_time_spines": false}}