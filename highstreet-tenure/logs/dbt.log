[0m14:53:46.760683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105822890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bc0d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bc0610>]}


============================== 14:53:46.764336 | c6661091-3d40-420a-8c93-c1c3e10808f9 ==============================
[0m14:53:46.764336 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:53:46.764730 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'warn_error': 'None', 'log_format': 'default', 'profiles_dir': '..', 'log_cache_events': 'False', 'version_check': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'target_path': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'partial_parse': 'True', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt run -m stg_new_businesses --profiles-dir ..', 'empty': 'False', 'static_parser': 'True'}
[0m14:53:46.765062 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:53:46.765282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c6661091-3d40-420a-8c93-c1c3e10808f9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b0ab30>]}
[0m14:53:46.864120 [error] [MainThread]: Encountered an error:
Runtime Error
  at path []: Additional properties are not allowed ('defaults' was unexpected)

Error encountered in /Users/samydoreau/data-j/highstreet-tenure/dbt_project.yml
[0m14:53:46.864572 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:53:46.901546 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.19807409, "process_in_blocks": "0", "process_kernel_time": 0.128834, "process_mem_max_rss": "107380736", "process_out_blocks": "0", "process_user_time": 0.865503}
[0m14:53:46.902350 [debug] [MainThread]: Command `dbt run` failed at 14:53:46.902052 after 0.20 seconds
[0m14:53:46.902656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105822890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b7bf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cb2350>]}
[0m14:53:46.902914 [debug] [MainThread]: Flushing usage events
[0m14:53:47.329849 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:54:53.010739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10637e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e40be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e404c0>]}


============================== 14:54:53.014332 | 92512ea3-379e-4cea-8c80-57c7b8d666d5 ==============================
[0m14:54:53.014332 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:54:53.014848 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_format': 'default', 'fail_fast': 'False', 'empty': 'False', 'version_check': 'True', 'invocation_command': 'dbt run -m stg_new_businesses --profiles-dir ..', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '..', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'introspect': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'printer_width': '80'}
[0m14:54:53.015181 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:54:53.015390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d8ed10>]}
[0m14:54:53.201306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fd1f00>]}
[0m14:54:53.246733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f65270>]}
[0m14:54:53.247935 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:54:53.343695 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:54:53.344403 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:54:53.344686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10836e8f0>]}
[0m14:54:54.020772 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:54:54.026736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab3c130>]}
[0m14:54:54.068604 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:54:54.070340 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:54:54.087419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaec190>]}
[0m14:54:54.087784 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m14:54:54.087981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92512ea3-379e-4cea-8c80-57c7b8d666d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaec2e0>]}
[0m14:54:54.088723 [info ] [MainThread]: 
[0m14:54:54.088925 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:54:54.089083 [info ] [MainThread]: 
[0m14:54:54.089370 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:54:54.089922 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:54:54.136328 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:54:54.136636 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:54:54.136816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:54:54.189023 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
connection to server at "127.0.0.1", port 5432 failed: FATAL:  password authentication failed for user "postgres"

[0m14:54:54.203656 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:54:54.204001 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:54:54.204232 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:54:54.204405 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:54:54.204586 [debug] [ThreadPool]: On list_highstreet: No close available on handle
[0m14:54:54.205067 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:54:54.205293 [debug] [MainThread]: Connection 'list_highstreet' was properly closed.
[0m14:54:54.205489 [info ] [MainThread]: 
[0m14:54:54.205695 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m14:54:54.205999 [error] [MainThread]: Encountered an error:
Database Error
  connection to server at "127.0.0.1", port 5432 failed: FATAL:  password authentication failed for user "postgres"
  
[0m14:54:54.206301 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:54:54.208717 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.254028, "process_in_blocks": "0", "process_kernel_time": 0.266203, "process_mem_max_rss": "138706944", "process_out_blocks": "0", "process_user_time": 1.747322}
[0m14:54:54.209099 [debug] [MainThread]: Command `dbt run` failed at 14:54:54.209049 after 1.25 seconds
[0m14:54:54.209331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10637e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaec9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab82e00>]}
[0m14:54:54.209557 [debug] [MainThread]: Flushing usage events
[0m14:54:54.589833 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:55:16.403105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031768c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047f8be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047f84c0>]}


============================== 14:55:16.406094 | 37e70715-1057-4f27-9c81-4c9f99d78ce1 ==============================
[0m14:55:16.406094 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:55:16.406434 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'introspect': 'True', 'empty': 'False', 'warn_error': 'None', 'printer_width': '80', 'fail_fast': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'target_path': 'None', 'profiles_dir': '..', 'no_print': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run -m stg_new_businesses --profiles-dir ..', 'debug': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False'}
[0m14:55:16.406758 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:55:16.406971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104746770>]}
[0m14:55:16.539698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101f21c00>]}
[0m14:55:16.584880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10491c070>]}
[0m14:55:16.586018 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:55:16.655949 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:55:16.707873 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m14:55:16.708334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b56e90>]}
[0m14:55:17.391940 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:55:17.398936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10582df30>]}
[0m14:55:17.440763 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:55:17.442299 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:55:17.455593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581b8b0>]}
[0m14:55:17.455965 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m14:55:17.456171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581beb0>]}
[0m14:55:17.456995 [info ] [MainThread]: 
[0m14:55:17.457259 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:55:17.457437 [info ] [MainThread]: 
[0m14:55:17.457762 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:55:17.458282 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:55:17.487069 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:55:17.487433 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:55:17.487617 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:55:17.555936 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.068 seconds
[0m14:55:17.560349 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:55:17.563907 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now create_highstreet_analytics_analytics)
[0m14:55:17.564312 [debug] [ThreadPool]: Creating schema "database: "highstreet"
schema: "analytics_analytics"
"
[0m14:55:17.570860 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m14:55:17.571711 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: BEGIN
[0m14:55:17.571985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:55:17.587848 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m14:55:17.588207 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m14:55:17.588397 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "create_highstreet_analytics_analytics"} */
create schema if not exists "analytics_analytics"
[0m14:55:17.590783 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.002 seconds
[0m14:55:17.591460 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m14:55:17.591700 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m14:55:17.591879 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m14:55:17.594676 [debug] [ThreadPool]: SQL status: COMMIT in 0.003 seconds
[0m14:55:17.595033 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: Close
[0m14:55:17.595846 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_highstreet_analytics_analytics, now list_highstreet_analytics_analytics)
[0m14:55:17.600004 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:55:17.600305 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:55:17.600473 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:55:17.612740 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m14:55:17.613102 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:55:17.613311 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:55:17.621667 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.008 seconds
[0m14:55:17.622699 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:55:17.623814 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:55:17.667645 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:17.668016 [debug] [MainThread]: On master: BEGIN
[0m14:55:17.668261 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:55:17.680687 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:55:17.681036 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:17.681268 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:55:17.688512 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m14:55:17.689414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fd3d90>]}
[0m14:55:17.689755 [debug] [MainThread]: On master: ROLLBACK
[0m14:55:17.690799 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:17.691099 [debug] [MainThread]: On master: BEGIN
[0m14:55:17.692761 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:55:17.693025 [debug] [MainThread]: On master: COMMIT
[0m14:55:17.693194 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:17.693345 [debug] [MainThread]: On master: COMMIT
[0m14:55:17.694272 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:55:17.694451 [debug] [MainThread]: On master: Close
[0m14:55:17.698320 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:55:17.698848 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:55:17.699259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_new_businesses)
[0m14:55:17.699500 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:55:17.704938 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.705705 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:55:17.728984 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.729990 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.730222 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:55:17.730409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:55:17.748344 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m14:55:17.748720 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.748949 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:55:17.760757 [debug] [Thread-1 (]: SQL status: SELECT 1000 in 0.011 seconds
[0m14:55:17.766551 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.766875 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:55:17.768262 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:55:17.776188 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:55:17.776506 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.776705 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:55:17.779276 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m14:55:17.783932 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:55:17.786392 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:17.786623 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:55:17.788046 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m14:55:17.789938 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:55:17.791513 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37e70715-1057-4f27-9c81-4c9f99d78ce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101f21330>]}
[0m14:55:17.792135 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1000[0m in 0.09s]
[0m14:55:17.792674 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:55:17.793613 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:17.793835 [debug] [MainThread]: On master: BEGIN
[0m14:55:17.794007 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:55:17.807542 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m14:55:17.807931 [debug] [MainThread]: On master: COMMIT
[0m14:55:17.808131 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:17.808326 [debug] [MainThread]: On master: COMMIT
[0m14:55:17.809270 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:55:17.809529 [debug] [MainThread]: On master: Close
[0m14:55:17.809787 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:55:17.809947 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:55:17.810125 [info ] [MainThread]: 
[0m14:55:17.810303 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m14:55:17.810660 [debug] [MainThread]: Command end result
[0m14:55:17.823721 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:55:17.825146 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:55:17.828772 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:55:17.829007 [info ] [MainThread]: 
[0m14:55:17.829228 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:55:17.829392 [info ] [MainThread]: 
[0m14:55:17.829571 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m14:55:17.829854 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:55:17.832210 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4799068, "process_in_blocks": "0", "process_kernel_time": 0.24318, "process_mem_max_rss": "138002432", "process_out_blocks": "0", "process_user_time": 1.936673}
[0m14:55:17.832668 [debug] [MainThread]: Command `dbt run` succeeded at 14:55:17.832602 after 1.48 seconds
[0m14:55:17.833013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031768c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103482560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ca6500>]}
[0m14:55:17.833283 [debug] [MainThread]: Flushing usage events
[0m14:55:18.243429 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:39:43.183413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033fe860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a80be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a804c0>]}


============================== 15:39:43.187068 | 91536079-8238-4ed2-94f1-d4ed5b9afb42 ==============================
[0m15:39:43.187068 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:39:43.187464 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'introspect': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run -m stg_new_businesses --profiles-dir ..', 'partial_parse': 'True', 'debug': 'False', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'profiles_dir': '..', 'printer_width': '80', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'quiet': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:39:43.187770 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:39:43.188005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049ced10>]}
[0m15:39:43.366285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e11f00>]}
[0m15:39:43.413319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ba5270>]}
[0m15:39:43.414344 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:39:43.482887 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:39:43.560963 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:39:43.561267 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:39:43.564536 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:39:43.582746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105774130>]}
[0m15:39:43.631230 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:43.633375 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:43.685730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f77400>]}
[0m15:39:43.686152 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m15:39:43.686443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f779d0>]}
[0m15:39:43.687374 [info ] [MainThread]: 
[0m15:39:43.687614 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:39:43.687787 [info ] [MainThread]: 
[0m15:39:43.688083 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:39:43.688617 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:39:43.728585 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:39:43.728946 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:39:43.729131 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:43.790050 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.061 seconds
[0m15:39:43.790906 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:39:43.791917 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:39:43.795871 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:43.796166 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:39:43.796349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:39:43.809303 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m15:39:43.809676 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:43.809875 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:39:43.817551 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m15:39:43.818472 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:39:43.819484 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:39:43.822525 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:43.822888 [debug] [MainThread]: On master: BEGIN
[0m15:39:43.823213 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:39:43.837826 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m15:39:43.838134 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:43.838373 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:39:43.846194 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m15:39:43.847093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050057e0>]}
[0m15:39:43.847469 [debug] [MainThread]: On master: ROLLBACK
[0m15:39:43.848488 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:43.848832 [debug] [MainThread]: On master: BEGIN
[0m15:39:43.850528 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:39:43.850845 [debug] [MainThread]: On master: COMMIT
[0m15:39:43.851038 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:43.851209 [debug] [MainThread]: On master: COMMIT
[0m15:39:43.852107 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:43.852402 [debug] [MainThread]: On master: Close
[0m15:39:43.854358 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:39:43.854731 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:39:43.855038 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_new_businesses)
[0m15:39:43.855252 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:39:43.861248 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.862061 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:39:43.886422 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.887464 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.887788 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:39:43.888003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:39:43.900933 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m15:39:43.901292 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.901519 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m15:39:43.913541 [debug] [Thread-1 (]: SQL status: SELECT 1000 in 0.012 seconds
[0m15:39:43.920525 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.920880 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:39:43.922826 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:39:43.925054 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.925649 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:39:43.927558 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:39:43.936434 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:39:43.936772 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.936971 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:39:43.939666 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m15:39:43.944785 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:39:43.947107 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:39:43.947335 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:39:43.959174 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m15:39:43.961152 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:39:43.962539 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91536079-8238-4ed2-94f1-d4ed5b9afb42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c1af80>]}
[0m15:39:43.963089 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1000[0m in 0.11s]
[0m15:39:43.963504 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:39:43.964267 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:43.964532 [debug] [MainThread]: On master: BEGIN
[0m15:39:43.964726 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:39:43.978987 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m15:39:43.979312 [debug] [MainThread]: On master: COMMIT
[0m15:39:43.979488 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:43.979639 [debug] [MainThread]: On master: COMMIT
[0m15:39:43.980309 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:39:43.980532 [debug] [MainThread]: On master: Close
[0m15:39:43.980913 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:39:43.981231 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:39:43.981443 [info ] [MainThread]: 
[0m15:39:43.981640 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m15:39:43.982020 [debug] [MainThread]: Command end result
[0m15:39:43.995364 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:43.996540 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:44.000814 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:39:44.001082 [info ] [MainThread]: 
[0m15:39:44.001327 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:39:44.001505 [info ] [MainThread]: 
[0m15:39:44.001695 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:39:44.002002 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:39:44.004313 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.87926334, "process_in_blocks": "0", "process_kernel_time": 0.266774, "process_mem_max_rss": "128598016", "process_out_blocks": "0", "process_user_time": 1.349319}
[0m15:39:44.004737 [debug] [MainThread]: Command `dbt run` succeeded at 15:39:44.004685 after 0.88 seconds
[0m15:39:44.004976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033fe860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103710fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105be4df0>]}
[0m15:39:44.005211 [debug] [MainThread]: Flushing usage events
[0m15:39:44.437126 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:46:08.532604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c468f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072c4ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072c4580>]}


============================== 15:46:08.536202 | 0d0aa098-2bbe-4623-9fb4-3765620cdb3f ==============================
[0m15:46:08.536202 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:46:08.536612 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'introspect': 'True', 'no_print': 'None', 'profiles_dir': '..', 'printer_width': '80', 'empty': 'False', 'invocation_command': 'dbt run -m staging/ --profiles-dir ..', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'indirect_selection': 'eager', 'static_parser': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'version_check': 'True', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'fail_fast': 'False', 'warn_error': 'None'}
[0m15:46:08.536930 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:46:08.537209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0d0aa098-2bbe-4623-9fb4-3765620cdb3f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107213670>]}
[0m15:46:08.711215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d0aa098-2bbe-4623-9fb4-3765620cdb3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073b0df0>]}
[0m15:46:08.757865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d0aa098-2bbe-4623-9fb4-3765620cdb3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107393f40>]}
[0m15:46:08.758748 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:46:08.827767 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:46:08.900787 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
[0m15:46:08.901178 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m15:46:08.901379 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m15:46:08.901584 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m15:46:09.103570 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:46:09.111974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d0aa098-2bbe-4623-9fb4-3765620cdb3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080ebfa0>]}
[0m15:46:09.157998 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:46:09.159554 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:46:09.173097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d0aa098-2bbe-4623-9fb4-3765620cdb3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10807b880>]}
[0m15:46:09.173548 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m15:46:09.173755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d0aa098-2bbe-4623-9fb4-3765620cdb3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107246440>]}
[0m15:46:09.174189 [warn ] [MainThread]: The selection criterion 'staging/' does not match any enabled nodes
[0m15:46:09.174779 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m15:46:09.175062 [debug] [MainThread]: Command end result
[0m15:46:09.186966 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:46:09.187911 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:46:09.190088 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:46:09.190423 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:46:09.192690 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7158972, "process_in_blocks": "0", "process_kernel_time": 0.206705, "process_mem_max_rss": "122634240", "process_out_blocks": "0", "process_user_time": 1.302323}
[0m15:46:09.193136 [debug] [MainThread]: Command `dbt run` succeeded at 15:46:09.193082 after 0.72 seconds
[0m15:46:09.193378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c468f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073927a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108112830>]}
[0m15:46:09.193611 [debug] [MainThread]: Flushing usage events
[0m15:46:09.588699 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:46:23.127462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c2860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109748be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097484c0>]}


============================== 15:46:23.130657 | 5852deeb-f9a0-43be-b20e-5ee6160684c9 ==============================
[0m15:46:23.130657 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:46:23.131107 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'invocation_command': 'dbt run -m staging --profiles-dir ..', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'introspect': 'True', 'version_check': 'True', 'empty': 'False', 'profiles_dir': '..', 'use_colors': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'write_json': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'no_print': 'None', 'partial_parse': 'True'}
[0m15:46:23.131557 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:46:23.131793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109692d10>]}
[0m15:46:23.285598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad5f00>]}
[0m15:46:23.335439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109869270>]}
[0m15:46:23.336679 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:46:23.404164 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:46:23.475145 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:46:23.475417 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:46:23.478876 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:46:23.497927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a440130>]}
[0m15:46:23.542633 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:46:23.544303 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:46:23.587830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10528ebf0>]}
[0m15:46:23.588225 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m15:46:23.588424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10528f220>]}
[0m15:46:23.589238 [info ] [MainThread]: 
[0m15:46:23.589550 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:46:23.589743 [info ] [MainThread]: 
[0m15:46:23.590047 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:46:23.592417 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:46:23.626705 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:46:23.627018 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:46:23.627201 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:46:23.694503 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.067 seconds
[0m15:46:23.695470 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:46:23.696416 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:46:23.700706 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:46:23.700973 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:46:23.701149 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:46:23.718915 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m15:46:23.719281 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:46:23.719496 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:46:23.731573 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.012 seconds
[0m15:46:23.732422 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:46:23.733381 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:46:23.736540 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:23.736838 [debug] [MainThread]: On master: BEGIN
[0m15:46:23.737549 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:46:23.750320 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m15:46:23.750643 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:23.750892 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:46:23.758733 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m15:46:23.759485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071a5e10>]}
[0m15:46:23.759788 [debug] [MainThread]: On master: ROLLBACK
[0m15:46:23.760490 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:23.760666 [debug] [MainThread]: On master: BEGIN
[0m15:46:23.761742 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:46:23.761955 [debug] [MainThread]: On master: COMMIT
[0m15:46:23.762134 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:23.762296 [debug] [MainThread]: On master: COMMIT
[0m15:46:23.762949 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:46:23.763131 [debug] [MainThread]: On master: Close
[0m15:46:23.765620 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:46:23.765883 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:46:23.766167 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:46:23.766419 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:46:23.766656 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:46:23.766899 [info ] [Thread-2 (]: 2 of 4 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:46:23.767158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m15:46:23.767405 [info ] [Thread-3 (]: 3 of 4 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:46:23.767696 [info ] [Thread-4 (]: 4 of 4 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:46:23.768164 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:46:23.768514 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:46:23.768822 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:46:23.769113 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_new_businesses'
[0m15:46:23.769343 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:46:23.774581 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.774956 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:46:23.775229 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:46:23.777121 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.778986 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.780812 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.781213 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:46:23.781693 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:46:23.794623 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:46:23.803313 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.805375 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.805594 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:46:23.807844 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.810436 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.810829 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.811067 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.811403 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:46:23.811641 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.811880 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:46:23.812083 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.812283 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:46:23.812491 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:46:23.812681 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:46:23.812875 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:46:23.813141 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:46:23.813388 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:46:23.834089 [debug] [Thread-2 (]: SQL status: BEGIN in 0.021 seconds
[0m15:46:23.834614 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.834964 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m15:46:23.835330 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m15:46:23.835668 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.835926 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m15:46:23.840056 [debug] [Thread-4 (]: SQL status: BEGIN in 0.027 seconds
[0m15:46:23.840301 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.840545 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m15:46:23.840823 [debug] [Thread-3 (]: SQL status: BEGIN in 0.028 seconds
[0m15:46:23.841161 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.841422 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m15:46:23.859562 [debug] [Thread-4 (]: SQL status: SELECT 1000 in 0.018 seconds
[0m15:46:23.866280 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.866618 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:46:23.866898 [debug] [Thread-1 (]: SQL status: SELECT 2479 in 0.031 seconds
[0m15:46:23.868922 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.869179 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:46:23.869478 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m15:46:23.871756 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.872102 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:46:23.873093 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:46:23.873370 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:46:23.881700 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:46:23.883624 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:46:23.883867 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.884076 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.884278 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:46:23.884466 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:46:23.892297 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m15:46:23.892597 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m15:46:23.896494 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m15:46:23.898081 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:46:23.900428 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:46:23.900867 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:46:23.901078 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m15:46:23.901297 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:46:23.902600 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:46:23.904047 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:46:23.905367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10982ec50>]}
[0m15:46:23.905899 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2479[0m in 0.14s]
[0m15:46:23.906922 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:46:23.911984 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.010 seconds
[0m15:46:23.913074 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:46:23.913524 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a465390>]}
[0m15:46:23.913931 [info ] [Thread-4 (]: 4 of 4 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1000[0m in 0.14s]
[0m15:46:23.914260 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:46:23.961715 [debug] [Thread-2 (]: SQL status: SELECT 23211 in 0.126 seconds
[0m15:46:23.964089 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.964483 [debug] [Thread-3 (]: SQL status: SELECT 23445 in 0.123 seconds
[0m15:46:23.964777 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m15:46:23.966710 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.967052 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:46:23.968024 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:46:23.968289 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:46:23.969228 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:46:23.970091 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:46:23.970331 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.970573 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.970804 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:46:23.971002 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:46:23.984031 [debug] [Thread-3 (]: SQL status: COMMIT in 0.013 seconds
[0m15:46:23.984322 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m15:46:23.985972 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:46:23.988095 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m15:46:23.988653 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:46:23.989379 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:46:23.989712 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:46:23.989978 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m15:46:23.991111 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:46:23.991394 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:46:23.992246 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:46:23.993086 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:46:23.993836 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c6b00>]}
[0m15:46:23.994243 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5852deeb-f9a0-43be-b20e-5ee6160684c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9ac8b0>]}
[0m15:46:23.994684 [info ] [Thread-3 (]: 3 of 4 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 23445[0m in 0.22s]
[0m15:46:23.995040 [info ] [Thread-2 (]: 2 of 4 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 23211[0m in 0.23s]
[0m15:46:23.995378 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:46:23.995661 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:46:23.996570 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:23.996775 [debug] [MainThread]: On master: BEGIN
[0m15:46:23.996933 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:46:24.009530 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m15:46:24.009869 [debug] [MainThread]: On master: COMMIT
[0m15:46:24.010056 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:24.010218 [debug] [MainThread]: On master: COMMIT
[0m15:46:24.011021 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:46:24.011292 [debug] [MainThread]: On master: Close
[0m15:46:24.011570 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:46:24.011742 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:46:24.011893 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m15:46:24.012036 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:46:24.012182 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:46:24.012430 [info ] [MainThread]: 
[0m15:46:24.012620 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m15:46:24.013184 [debug] [MainThread]: Command end result
[0m15:46:24.026617 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:46:24.027981 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:46:24.031874 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:46:24.032123 [info ] [MainThread]: 
[0m15:46:24.032345 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:46:24.032516 [info ] [MainThread]: 
[0m15:46:24.032700 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:46:24.033007 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:46:24.035429 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.95882136, "process_in_blocks": "0", "process_kernel_time": 0.216149, "process_mem_max_rss": "131710976", "process_out_blocks": "0", "process_user_time": 1.34432}
[0m15:46:24.035754 [debug] [MainThread]: Command `dbt run` succeeded at 15:46:24.035711 after 0.96 seconds
[0m15:46:24.035975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c2860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e8b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083d4fa0>]}
[0m15:46:24.036179 [debug] [MainThread]: Flushing usage events
[0m15:46:24.389276 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:52:09.986900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e40be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e404c0>]}


============================== 17:52:09.990150 | 18a62040-0c0c-425a-806b-50422b9075ea ==============================
[0m17:52:09.990150 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:52:09.990517 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '..', 'write_json': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'printer_width': '80', 'debug': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run -m staging --profiles-dir ..', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'introspect': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'partial_parse': 'True', 'empty': 'False', 'target_path': 'None'}
[0m17:52:09.990821 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:52:09.991035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119d8faf0>]}
[0m17:52:10.165718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b35c00>]}
[0m17:52:10.208090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f64070>]}
[0m17:52:10.208916 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:52:10.308046 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:52:10.381291 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:52:10.381563 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:52:10.384845 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:52:10.404072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d014130>]}
[0m17:52:10.449941 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:52:10.451776 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:52:10.495153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ba69b0>]}
[0m17:52:10.495515 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m17:52:10.495723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd73d0>]}
[0m17:52:10.496535 [info ] [MainThread]: 
[0m17:52:10.496738 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:52:10.496903 [info ] [MainThread]: 
[0m17:52:10.497180 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:52:10.499525 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:52:10.545127 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:52:10.545530 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:52:10.545742 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:52:10.603380 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.058 seconds
[0m17:52:10.604472 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:52:10.605502 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:52:10.609385 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:52:10.609660 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:52:10.609839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:52:10.627014 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m17:52:10.627335 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:52:10.627555 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:52:10.640825 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.013 seconds
[0m17:52:10.641750 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:52:10.642567 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:52:10.646776 [debug] [MainThread]: Using postgres connection "master"
[0m17:52:10.647077 [debug] [MainThread]: On master: BEGIN
[0m17:52:10.647316 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:52:10.660067 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m17:52:10.660373 [debug] [MainThread]: Using postgres connection "master"
[0m17:52:10.660644 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:52:10.670710 [debug] [MainThread]: SQL status: SELECT 0 in 0.010 seconds
[0m17:52:10.671531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf317b0>]}
[0m17:52:10.671889 [debug] [MainThread]: On master: ROLLBACK
[0m17:52:10.675426 [debug] [MainThread]: Using postgres connection "master"
[0m17:52:10.675655 [debug] [MainThread]: On master: BEGIN
[0m17:52:10.677016 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:52:10.677257 [debug] [MainThread]: On master: COMMIT
[0m17:52:10.677489 [debug] [MainThread]: Using postgres connection "master"
[0m17:52:10.677706 [debug] [MainThread]: On master: COMMIT
[0m17:52:10.678582 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:52:10.678815 [debug] [MainThread]: On master: Close
[0m17:52:10.681033 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:52:10.681345 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:52:10.681650 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:52:10.681873 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:52:10.682181 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m17:52:10.682561 [info ] [Thread-2 (]: 2 of 4 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m17:52:10.682887 [info ] [Thread-3 (]: 3 of 4 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m17:52:10.683199 [info ] [Thread-4 (]: 4 of 4 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m17:52:10.683708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m17:52:10.684062 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:52:10.684382 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m17:52:10.684681 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_new_businesses'
[0m17:52:10.684916 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:52:10.685145 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:52:10.685376 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:52:10.685595 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:52:10.691307 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.693129 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.695752 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.698147 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.699310 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:52:10.699572 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:52:10.699804 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:52:10.711940 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:52:10.722508 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.724686 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.726653 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.728538 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.729476 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.729787 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.730089 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.730314 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m17:52:10.730548 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m17:52:10.730749 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m17:52:10.730975 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.731209 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:52:10.731411 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:52:10.731612 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:52:10.731803 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m17:52:10.732282 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:52:10.747528 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m17:52:10.748038 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.748313 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m17:52:10.748546 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m17:52:10.748785 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.749179 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m17:52:10.749629 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m17:52:10.749902 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.750156 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m17:52:10.751880 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m17:52:10.752116 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.752346 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m17:52:10.768111 [debug] [Thread-4 (]: SQL status: SELECT 1000 in 0.015 seconds
[0m17:52:10.774549 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.774846 [debug] [Thread-1 (]: SQL status: SELECT 2479 in 0.025 seconds
[0m17:52:10.775205 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m17:52:10.777341 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.777683 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m17:52:10.778978 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:52:10.781576 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.781803 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:52:10.782041 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m17:52:10.783709 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.784355 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m17:52:10.785227 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:52:10.791920 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m17:52:10.794724 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:52:10.795755 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:52:10.795992 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.796193 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.796390 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:52:10.796574 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:52:10.810151 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m17:52:10.810449 [debug] [Thread-4 (]: SQL status: COMMIT in 0.014 seconds
[0m17:52:10.814380 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m17:52:10.816023 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m17:52:10.818838 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:52:10.819370 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:52:10.819608 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m17:52:10.819936 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m17:52:10.839519 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.019 seconds
[0m17:52:10.839970 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.020 seconds
[0m17:52:10.841789 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m17:52:10.842788 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m17:52:10.844831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cfe6890>]}
[0m17:52:10.845178 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf317b0>]}
[0m17:52:10.845627 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2479[0m in 0.16s]
[0m17:52:10.846016 [info ] [Thread-4 (]: 4 of 4 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1000[0m in 0.16s]
[0m17:52:10.846347 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:52:10.846630 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:52:10.861315 [debug] [Thread-2 (]: SQL status: SELECT 23211 in 0.112 seconds
[0m17:52:10.863852 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.864149 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m17:52:10.866078 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:52:10.868246 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.868483 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m17:52:10.870007 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:52:10.871124 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:52:10.871424 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.871637 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:52:10.887921 [debug] [Thread-2 (]: SQL status: COMMIT in 0.016 seconds
[0m17:52:10.890591 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m17:52:10.891144 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:52:10.891373 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m17:52:10.895876 [debug] [Thread-3 (]: SQL status: SELECT 23445 in 0.145 seconds
[0m17:52:10.898182 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.898437 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m17:52:10.899859 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:52:10.901901 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.902173 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m17:52:10.902425 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:52:10.903337 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m17:52:10.903827 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf835b0>]}
[0m17:52:10.904102 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:52:10.904584 [info ] [Thread-2 (]: 2 of 4 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 23211[0m in 0.22s]
[0m17:52:10.905591 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:52:10.905972 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:52:10.906246 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.906595 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:52:10.908186 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m17:52:10.909837 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m17:52:10.910390 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:52:10.910615 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m17:52:10.920392 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m17:52:10.921364 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m17:52:10.921771 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a62040-0c0c-425a-806b-50422b9075ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f0e5c0>]}
[0m17:52:10.922168 [info ] [Thread-3 (]: 3 of 4 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 23445[0m in 0.24s]
[0m17:52:10.922488 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:52:10.923368 [debug] [MainThread]: Using postgres connection "master"
[0m17:52:10.923560 [debug] [MainThread]: On master: BEGIN
[0m17:52:10.923725 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:52:10.936149 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m17:52:10.936471 [debug] [MainThread]: On master: COMMIT
[0m17:52:10.936650 [debug] [MainThread]: Using postgres connection "master"
[0m17:52:10.936812 [debug] [MainThread]: On master: COMMIT
[0m17:52:10.937740 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:52:10.938049 [debug] [MainThread]: On master: Close
[0m17:52:10.938318 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:52:10.938481 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m17:52:10.938632 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m17:52:10.938777 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m17:52:10.938914 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m17:52:10.939129 [info ] [MainThread]: 
[0m17:52:10.939310 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m17:52:10.939841 [debug] [MainThread]: Command end result
[0m17:52:10.952428 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:52:10.953470 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:52:10.957428 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:52:10.957756 [info ] [MainThread]: 
[0m17:52:10.958038 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:52:10.958230 [info ] [MainThread]: 
[0m17:52:10.958439 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m17:52:10.958865 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:52:10.985951 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0561984, "process_in_blocks": "0", "process_kernel_time": 0.266663, "process_mem_max_rss": "129548288", "process_out_blocks": "0", "process_user_time": 1.356848}
[0m17:52:10.986396 [debug] [MainThread]: Command `dbt run` succeeded at 17:52:10.986345 after 1.06 seconds
[0m17:52:10.986629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ac1f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1181b6560>]}
[0m17:52:10.986859 [debug] [MainThread]: Flushing usage events
[0m17:52:11.363016 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:37:22.642604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f6860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108978c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089784f0>]}


============================== 14:37:22.645740 | ef9e4835-806a-49af-9f0d-7dcef6c977ab ==============================
[0m14:37:22.645740 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:37:22.646087 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir ..', 'version_check': 'True', 'no_print': 'None', 'log_format': 'default', 'partial_parse': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '..', 'use_colors': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'write_json': 'True', 'introspect': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:37:22.646378 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:37:22.646592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088c14e0>]}
[0m14:37:22.803554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076ce8c0>]}
[0m14:37:22.845253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a9e1d0>]}
[0m14:37:22.846019 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:37:22.912161 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:37:22.984552 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:37:22.984832 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:37:22.988185 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:37:23.006867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109674100>]}
[0m14:37:23.052217 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:37:23.053748 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:37:23.096032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106073bb0>]}
[0m14:37:23.096370 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m14:37:23.096572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10608d690>]}
[0m14:37:23.097340 [info ] [MainThread]: 
[0m14:37:23.097559 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:37:23.097721 [info ] [MainThread]: 
[0m14:37:23.097995 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:37:23.100266 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:37:23.144250 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:37:23.144560 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:37:23.144729 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:37:23.203338 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.059 seconds
[0m14:37:23.204269 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:37:23.205273 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:37:23.209452 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:37:23.209708 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:37:23.209880 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:23.220780 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m14:37:23.221071 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:37:23.221282 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:37:23.227437 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m14:37:23.228286 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:37:23.229055 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:37:23.232681 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:23.232964 [debug] [MainThread]: On master: BEGIN
[0m14:37:23.233146 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:37:23.244462 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m14:37:23.244710 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:23.244954 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:37:23.251762 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m14:37:23.252501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6ae00>]}
[0m14:37:23.252818 [debug] [MainThread]: On master: ROLLBACK
[0m14:37:23.253570 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:23.253765 [debug] [MainThread]: On master: BEGIN
[0m14:37:23.254968 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:37:23.255163 [debug] [MainThread]: On master: COMMIT
[0m14:37:23.255342 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:23.255515 [debug] [MainThread]: On master: COMMIT
[0m14:37:23.256223 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:37:23.256469 [debug] [MainThread]: On master: Close
[0m14:37:23.259157 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:37:23.259445 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:37:23.259965 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:37:23.260247 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:37:23.259762 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:37:23.260563 [info ] [Thread-2 (]: 2 of 4 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:37:23.261095 [info ] [Thread-3 (]: 3 of 4 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:37:23.261445 [info ] [Thread-4 (]: 4 of 4 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:37:23.261855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:37:23.262162 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:37:23.262444 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:37:23.262711 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_new_businesses'
[0m14:37:23.262936 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:37:23.263149 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:37:23.263349 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:37:23.263537 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:37:23.268814 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.270614 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.272272 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.273875 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.274653 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:37:23.274934 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:37:23.281299 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:37:23.303000 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.304526 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.304824 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:37:23.307064 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.309269 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.309606 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.309917 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.310179 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:37:23.310496 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.310743 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:37:23.310976 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.311178 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:37:23.311383 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:37:23.311588 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:37:23.311775 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:37:23.312045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:37:23.312312 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:37:23.329360 [debug] [Thread-2 (]: SQL status: BEGIN in 0.018 seconds
[0m14:37:23.329756 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.330032 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m14:37:23.331105 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m14:37:23.331416 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.331698 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:37:23.331947 [debug] [Thread-3 (]: SQL status: BEGIN in 0.020 seconds
[0m14:37:23.332166 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.332395 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m14:37:23.338209 [debug] [Thread-1 (]: SQL status: BEGIN in 0.026 seconds
[0m14:37:23.338548 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.338789 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:37:23.344933 [debug] [Thread-4 (]: SQL status: SELECT 1307 in 0.013 seconds
[0m14:37:23.351103 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.351429 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:37:23.352865 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:23.354761 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.355014 [debug] [Thread-1 (]: SQL status: SELECT 2683 in 0.016 seconds
[0m14:37:23.355309 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:37:23.357908 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.358223 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:37:23.359137 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:23.359411 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:23.368583 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:37:23.370726 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.371029 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.371352 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:37:23.371639 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:37:23.380570 [debug] [Thread-4 (]: SQL status: COMMIT in 0.009 seconds
[0m14:37:23.380908 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.009 seconds
[0m14:37:23.384778 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:37:23.385818 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:37:23.388178 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:37:23.388422 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.388645 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:37:23.388846 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:37:23.392757 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m14:37:23.394377 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:37:23.394602 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m14:37:23.395050 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:37:23.396484 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:37:23.396811 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:37:23.398254 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10969ba00>]}
[0m14:37:23.398690 [info ] [Thread-4 (]: 4 of 4 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.13s]
[0m14:37:23.399024 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:37:23.406710 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m14:37:23.407833 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:37:23.408247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a9d660>]}
[0m14:37:23.408654 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.15s]
[0m14:37:23.408985 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:37:23.425719 [debug] [Thread-2 (]: SQL status: SELECT 27009 in 0.095 seconds
[0m14:37:23.428132 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.428392 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:37:23.429804 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:23.431925 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.432160 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:37:23.433300 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:23.433605 [debug] [Thread-3 (]: SQL status: SELECT 28209 in 0.101 seconds
[0m14:37:23.434800 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:37:23.437596 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.437838 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.438052 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:37:23.438250 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:37:23.439590 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:23.441600 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.441879 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:37:23.445568 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m14:37:23.445825 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:37:23.447310 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:37:23.448218 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:37:23.448705 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:37:23.448933 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.449144 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:37:23.449343 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:37:23.450489 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m14:37:23.452116 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:37:23.452654 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:37:23.452869 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:37:23.457089 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.008 seconds
[0m14:37:23.457993 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:37:23.458393 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b0eda0>]}
[0m14:37:23.458767 [info ] [Thread-2 (]: 2 of 4 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.20s]
[0m14:37:23.459135 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:37:23.462476 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m14:37:23.463272 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:37:23.463615 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef9e4835-806a-49af-9f0d-7dcef6c977ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b1a080>]}
[0m14:37:23.463967 [info ] [Thread-3 (]: 3 of 4 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.20s]
[0m14:37:23.464347 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:37:23.465302 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:23.465551 [debug] [MainThread]: On master: BEGIN
[0m14:37:23.465732 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:37:23.484630 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m14:37:23.485339 [debug] [MainThread]: On master: COMMIT
[0m14:37:23.486831 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:23.487376 [debug] [MainThread]: On master: COMMIT
[0m14:37:23.544587 [debug] [MainThread]: SQL status: COMMIT in 0.056 seconds
[0m14:37:23.548774 [debug] [MainThread]: On master: Close
[0m14:37:23.551528 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:37:23.552878 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m14:37:23.553352 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:37:23.554157 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:37:23.555343 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:37:23.561113 [info ] [MainThread]: 
[0m14:37:23.565589 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m14:37:23.566478 [debug] [MainThread]: Command end result
[0m14:37:23.590585 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:37:23.591892 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:37:23.596204 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:37:23.596492 [info ] [MainThread]: 
[0m14:37:23.596773 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:37:23.596983 [info ] [MainThread]: 
[0m14:37:23.597183 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m14:37:23.597519 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:37:23.599941 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0108584, "process_in_blocks": "0", "process_kernel_time": 0.235171, "process_mem_max_rss": "129679360", "process_out_blocks": "0", "process_user_time": 1.321368}
[0m14:37:23.600309 [debug] [MainThread]: Command `dbt run` succeeded at 14:37:23.600261 after 1.01 seconds
[0m14:37:23.600533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f6860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10760fbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108efc5b0>]}
[0m14:37:23.600860 [debug] [MainThread]: Flushing usage events
[0m14:37:24.071065 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:47:23.343867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051027d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106784af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067843d0>]}


============================== 14:47:23.346964 | 0df63e87-a5a8-4027-b43b-3502dc24958b ==============================
[0m14:47:23.346964 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:47:23.347299 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'log_format': 'default', 'empty': 'False', 'debug': 'False', 'warn_error': 'None', 'target_path': 'None', 'use_experimental_parser': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'introspect': 'True', 'write_json': 'True', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run -m staging --profiles-dir ..', 'cache_selected_only': 'False', 'no_print': 'None', 'static_parser': 'True', 'fail_fast': 'False', 'profiles_dir': '..', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'printer_width': '80'}
[0m14:47:23.347597 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:47:23.347801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0df63e87-a5a8-4027-b43b-3502dc24958b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d3b50>]}
[0m14:47:23.350292 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'highstreet_local'
[0m14:47:23.350622 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:47:23.352251 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.05866704, "process_in_blocks": "0", "process_kernel_time": 0.120586, "process_mem_max_rss": "102596608", "process_out_blocks": "0", "process_user_time": 0.760474}
[0m14:47:23.352647 [debug] [MainThread]: Command `dbt run` failed at 14:47:23.352593 after 0.06 seconds
[0m14:47:23.352873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051027d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d2470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067872b0>]}
[0m14:47:23.353080 [debug] [MainThread]: Flushing usage events
[0m14:47:23.803825 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:47:32.967270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10347e830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105540bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105540490>]}


============================== 14:47:32.970412 | 8c79bbb9-abcb-452d-ab2e-570b50262213 ==============================
[0m14:47:32.970412 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:47:32.970836 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_colors': 'True', 'use_experimental_parser': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'version_check': 'True', 'partial_parse': 'True', 'target_path': 'None', 'log_cache_events': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'profiles_dir': '.', 'warn_error': 'None', 'no_print': 'None', 'empty': 'False', 'fail_fast': 'False', 'write_json': 'True', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'log_format': 'default'}
[0m14:47:32.971190 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:47:32.971420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10548d5d0>]}
[0m14:47:33.133274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a807f0>]}
[0m14:47:33.177288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fd35e0>]}
[0m14:47:33.178177 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:47:33.245188 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:47:33.316648 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:47:33.316930 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:47:33.320186 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:47:33.338736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10660c100>]}
[0m14:47:33.385780 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:47:33.387310 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:47:33.429350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031a1c30>]}
[0m14:47:33.429723 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m14:47:33.429926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1021644f0>]}
[0m14:47:33.430751 [info ] [MainThread]: 
[0m14:47:33.430955 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:47:33.431118 [info ] [MainThread]: 
[0m14:47:33.431397 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:47:33.433779 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:47:33.467780 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:47:33.468097 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:47:33.468273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:47:33.521423 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.053 seconds
[0m14:47:33.522289 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:47:33.523099 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:47:33.526733 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:47:33.526965 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:47:33.527145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:47:33.539383 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m14:47:33.539698 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:47:33.539913 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:47:33.546939 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:47:33.547741 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:47:33.548426 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:47:33.551993 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:33.552249 [debug] [MainThread]: On master: BEGIN
[0m14:47:33.552433 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:47:33.565678 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m14:47:33.565986 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:33.566246 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:47:33.574549 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m14:47:33.575456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613b190>]}
[0m14:47:33.575806 [debug] [MainThread]: On master: ROLLBACK
[0m14:47:33.576587 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:33.576841 [debug] [MainThread]: On master: BEGIN
[0m14:47:33.578085 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:47:33.578298 [debug] [MainThread]: On master: COMMIT
[0m14:47:33.578487 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:33.578676 [debug] [MainThread]: On master: COMMIT
[0m14:47:33.579368 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:47:33.579589 [debug] [MainThread]: On master: Close
[0m14:47:33.581540 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:47:33.581939 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:47:33.582248 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:47:33.582510 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:47:33.582762 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:47:33.582980 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:47:33.583360 [info ] [Thread-2 (]: 2 of 4 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:47:33.583640 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:47:33.583950 [info ] [Thread-3 (]: 3 of 4 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:47:33.584380 [info ] [Thread-4 (]: 4 of 4 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:47:33.584816 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:47:33.590108 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.590504 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:47:33.590797 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_new_businesses'
[0m14:47:33.591028 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:47:33.591565 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:47:33.591956 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:47:33.594160 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.594460 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:47:33.596495 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.598656 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.620391 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.620840 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:47:33.621139 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:47:33.621389 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:47:33.623570 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.625656 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.625943 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.627988 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.628330 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:47:33.628699 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.628905 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.629097 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:47:33.629311 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:47:33.629521 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.629735 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:47:33.630025 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:47:33.630224 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:47:33.630420 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:47:33.630867 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:47:33.644846 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m14:47:33.645145 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.645372 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:47:33.649197 [debug] [Thread-4 (]: SQL status: BEGIN in 0.019 seconds
[0m14:47:33.649577 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m14:47:33.649892 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.650118 [debug] [Thread-2 (]: SQL status: BEGIN in 0.020 seconds
[0m14:47:33.650361 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.650677 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:47:33.650971 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.651249 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m14:47:33.651793 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m14:47:33.664686 [debug] [Thread-4 (]: SQL status: SELECT 1307 in 0.013 seconds
[0m14:47:33.670858 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.671178 [debug] [Thread-1 (]: SQL status: SELECT 2683 in 0.026 seconds
[0m14:47:33.671443 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:47:33.673511 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.673867 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:47:33.675011 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.677732 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.678097 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:47:33.678354 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:47:33.680292 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.680651 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:47:33.681488 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.681814 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.691426 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:47:33.692389 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:47:33.692620 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.692971 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.693270 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:47:33.693487 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:47:33.704084 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m14:47:33.708451 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:47:33.708726 [debug] [Thread-1 (]: SQL status: COMMIT in 0.015 seconds
[0m14:47:33.711554 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:47:33.713117 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:47:33.713373 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:47:33.713868 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:47:33.714203 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:47:33.725943 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:47:33.727677 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:47:33.728031 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:47:33.729895 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:47:33.730425 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10647ada0>]}
[0m14:47:33.730686 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106654430>]}
[0m14:47:33.731189 [info ] [Thread-4 (]: 4 of 4 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.14s]
[0m14:47:33.731841 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.15s]
[0m14:47:33.732299 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:47:33.732607 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:47:33.746455 [debug] [Thread-2 (]: SQL status: SELECT 27009 in 0.094 seconds
[0m14:47:33.748894 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.749184 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:47:33.750570 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.752457 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.752682 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:47:33.753865 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.754897 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:47:33.755131 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.755323 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:47:33.762812 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m14:47:33.765184 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:47:33.765626 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:47:33.765827 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:47:33.771867 [debug] [Thread-3 (]: SQL status: SELECT 28209 in 0.120 seconds
[0m14:47:33.774281 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.774558 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:47:33.775915 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.777971 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.778204 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:47:33.779255 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:47:33.780274 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:47:33.780515 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.780725 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:47:33.783184 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m14:47:33.784887 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:47:33.785132 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.019 seconds
[0m14:47:33.785676 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:47:33.786437 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:47:33.786709 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:47:33.787178 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613b190>]}
[0m14:47:33.787582 [info ] [Thread-2 (]: 2 of 4 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.20s]
[0m14:47:33.787916 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:47:33.797482 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.010 seconds
[0m14:47:33.798510 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:47:33.798925 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c79bbb9-abcb-452d-ab2e-570b50262213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d54100>]}
[0m14:47:33.799329 [info ] [Thread-3 (]: 3 of 4 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.21s]
[0m14:47:33.799874 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:47:33.800781 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:33.801016 [debug] [MainThread]: On master: BEGIN
[0m14:47:33.801180 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:47:33.813644 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:47:33.814031 [debug] [MainThread]: On master: COMMIT
[0m14:47:33.814245 [debug] [MainThread]: Using postgres connection "master"
[0m14:47:33.814419 [debug] [MainThread]: On master: COMMIT
[0m14:47:33.815328 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:47:33.815670 [debug] [MainThread]: On master: Close
[0m14:47:33.816023 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:47:33.816232 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m14:47:33.816399 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:47:33.816547 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:47:33.816692 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:47:33.816909 [info ] [MainThread]: 
[0m14:47:33.817102 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.39 seconds (0.39s).
[0m14:47:33.817649 [debug] [MainThread]: Command end result
[0m14:47:33.831116 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:47:33.832558 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:47:33.836470 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:47:33.836737 [info ] [MainThread]: 
[0m14:47:33.837017 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:47:33.837252 [info ] [MainThread]: 
[0m14:47:33.837452 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m14:47:33.837759 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:47:33.839987 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.921169, "process_in_blocks": "0", "process_kernel_time": 0.20178, "process_mem_max_rss": "131252224", "process_out_blocks": "0", "process_user_time": 1.320476}
[0m14:47:33.840362 [debug] [MainThread]: Command `dbt run` succeeded at 14:47:33.840314 after 0.92 seconds
[0m14:47:33.840606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10347e830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a81060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061386a0>]}
[0m14:47:33.840838 [debug] [MainThread]: Flushing usage events
[0m14:47:34.296760 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:50:36.149724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10758a890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c0cb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c0c460>]}


============================== 14:50:36.152864 | f81356db-0a12-40f3-8430-5224d69d03d5 ==============================
[0m14:50:36.152864 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:50:36.153234 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'log_cache_events': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_format': 'default', 'target_path': 'None', 'warn_error': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'empty': 'False', 'use_colors': 'True', 'quiet': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'version_check': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'introspect': 'True'}
[0m14:50:36.153544 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:50:36.153757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b57010>]}
[0m14:50:36.324742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cfa980>]}
[0m14:50:36.370130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d31270>]}
[0m14:50:36.370929 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:50:36.439763 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:50:36.519581 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m14:50:36.519988 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/staging/stg_filemap.sql
[0m14:50:36.520399 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/sources.yml
[0m14:50:36.792511 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:50:36.798269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fedcf0>]}
[0m14:50:36.839757 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:50:36.841398 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:50:36.853442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092f6f50>]}
[0m14:50:36.853765 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m14:50:36.853980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092f7040>]}
[0m14:50:36.854821 [info ] [MainThread]: 
[0m14:50:36.855028 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:50:36.855193 [info ] [MainThread]: 
[0m14:50:36.855480 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:50:36.857825 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:50:36.893669 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:50:36.894004 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:50:36.894181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:36.959814 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.066 seconds
[0m14:50:36.960782 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:50:36.961803 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:50:36.965522 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:50:36.965890 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:50:36.966106 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:50:36.979433 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m14:50:36.979721 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:50:36.979906 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:50:36.988534 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m14:50:36.989424 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:50:36.990300 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:50:36.994021 [debug] [MainThread]: Using postgres connection "master"
[0m14:50:36.994323 [debug] [MainThread]: On master: BEGIN
[0m14:50:36.994526 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:50:37.008935 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m14:50:37.009261 [debug] [MainThread]: Using postgres connection "master"
[0m14:50:37.009541 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:50:37.022163 [debug] [MainThread]: SQL status: SELECT 0 in 0.012 seconds
[0m14:50:37.023079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10949df60>]}
[0m14:50:37.023456 [debug] [MainThread]: On master: ROLLBACK
[0m14:50:37.024547 [debug] [MainThread]: Using postgres connection "master"
[0m14:50:37.024793 [debug] [MainThread]: On master: BEGIN
[0m14:50:37.026595 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m14:50:37.026930 [debug] [MainThread]: On master: COMMIT
[0m14:50:37.027180 [debug] [MainThread]: Using postgres connection "master"
[0m14:50:37.027404 [debug] [MainThread]: On master: COMMIT
[0m14:50:37.028285 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:50:37.028548 [debug] [MainThread]: On master: Close
[0m14:50:37.030538 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:50:37.030822 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:50:37.031085 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:50:37.031333 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:50:37.031654 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:50:37.032004 [info ] [Thread-2 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:50:37.032422 [info ] [Thread-3 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:50:37.032895 [info ] [Thread-4 (]: 4 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m14:50:37.033364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:50:37.033715 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:50:37.034147 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:50:37.034545 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:50:37.034807 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:50:37.035033 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:50:37.035257 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:50:37.035468 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:50:37.040883 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.042813 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.044575 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.047039 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:50:37.048082 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:50:37.048486 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:50:37.054379 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:50:37.054677 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:50:37.069939 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.072096 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:50:37.074018 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.075939 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.076571 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.076939 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:50:37.077223 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.077495 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:50:37.077754 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.077941 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:50:37.078131 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:50:37.078318 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:50:37.078531 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:50:37.078739 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:50:37.078951 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:50:37.079212 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:50:37.099060 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m14:50:37.099556 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.099981 [debug] [Thread-4 (]: SQL status: BEGIN in 0.021 seconds
[0m14:50:37.100281 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:50:37.100637 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:50:37.101041 [debug] [Thread-2 (]: SQL status: BEGIN in 0.023 seconds
[0m14:50:37.101353 [debug] [Thread-3 (]: SQL status: BEGIN in 0.022 seconds
[0m14:50:37.101657 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:50:37.101910 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.102129 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.102448 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m14:50:37.102770 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m14:50:37.112735 [debug] [Thread-4 (]: SQL status: SELECT 45 in 0.010 seconds
[0m14:50:37.119039 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:50:37.119335 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:50:37.120651 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.128409 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:50:37.128709 [debug] [Thread-1 (]: SQL status: SELECT 2683 in 0.028 seconds
[0m14:50:37.129027 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:50:37.131194 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.131432 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:50:37.131643 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:50:37.133749 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:50:37.135629 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.135869 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:50:37.137218 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.139719 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:50:37.139981 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.140185 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:50:37.143137 [debug] [Thread-4 (]: SQL status: COMMIT in 0.011 seconds
[0m14:50:37.147634 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:50:37.147997 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m14:50:37.150898 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:50:37.152770 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:50:37.153066 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:50:37.153610 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:50:37.153943 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:50:37.155053 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.001 seconds
[0m14:50:37.156637 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:50:37.158102 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108003670>]}
[0m14:50:37.158610 [info ] [Thread-4 (]: 4 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.12s]
[0m14:50:37.158961 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:50:37.159209 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:50:37.159559 [info ] [Thread-4 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:50:37.159838 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m14:50:37.160060 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:50:37.162153 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.162661 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:50:37.168766 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.169385 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.169624 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:50:37.169837 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:50:37.173773 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.020 seconds
[0m14:50:37.174750 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:50:37.175250 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fefcd0>]}
[0m14:50:37.175692 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.14s]
[0m14:50:37.176044 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:50:37.184440 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m14:50:37.184804 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.185045 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:50:37.202714 [debug] [Thread-4 (]: SQL status: SELECT 1307 in 0.017 seconds
[0m14:50:37.205077 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.205343 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:50:37.206825 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.208847 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.209090 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:50:37.210468 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.211619 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:50:37.211848 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.212032 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:50:37.225414 [debug] [Thread-4 (]: SQL status: COMMIT in 0.013 seconds
[0m14:50:37.227229 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:50:37.227872 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:50:37.228147 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:50:37.236332 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.008 seconds
[0m14:50:37.237430 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:50:37.237850 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108003670>]}
[0m14:50:37.238261 [info ] [Thread-4 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.08s]
[0m14:50:37.238603 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:50:37.254228 [debug] [Thread-2 (]: SQL status: SELECT 27009 in 0.151 seconds
[0m14:50:37.256736 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.257073 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:50:37.258681 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.260661 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.260920 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:50:37.261151 [debug] [Thread-3 (]: SQL status: SELECT 28209 in 0.158 seconds
[0m14:50:37.263182 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.263448 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:50:37.263692 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:50:37.264626 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:50:37.264948 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.265183 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:50:37.265924 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.268468 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.268697 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:50:37.269998 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:50:37.270885 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:50:37.271097 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.271289 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:50:37.275774 [debug] [Thread-2 (]: SQL status: COMMIT in 0.010 seconds
[0m14:50:37.276060 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m14:50:37.277630 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:50:37.278937 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:50:37.279544 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:50:37.280084 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:50:37.280369 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:50:37.280637 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:50:37.294810 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:50:37.295777 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:50:37.296221 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba01a50>]}
[0m14:50:37.296831 [info ] [Thread-2 (]: 2 of 5 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.26s]
[0m14:50:37.297194 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:50:37.298007 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.017 seconds
[0m14:50:37.298754 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:50:37.299167 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f81356db-0a12-40f3-8430-5224d69d03d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae48a30>]}
[0m14:50:37.299718 [info ] [Thread-3 (]: 3 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.27s]
[0m14:50:37.300051 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:50:37.300790 [debug] [MainThread]: Using postgres connection "master"
[0m14:50:37.301043 [debug] [MainThread]: On master: BEGIN
[0m14:50:37.301210 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:50:37.313184 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:50:37.313494 [debug] [MainThread]: On master: COMMIT
[0m14:50:37.313844 [debug] [MainThread]: Using postgres connection "master"
[0m14:50:37.314033 [debug] [MainThread]: On master: COMMIT
[0m14:50:37.314817 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:50:37.315076 [debug] [MainThread]: On master: Close
[0m14:50:37.315375 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:50:37.315575 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m14:50:37.315725 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:50:37.315865 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:50:37.316000 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:50:37.316208 [info ] [MainThread]: 
[0m14:50:37.316392 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m14:50:37.317087 [debug] [MainThread]: Command end result
[0m14:50:37.368653 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:50:37.369687 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:50:37.373302 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:50:37.373500 [info ] [MainThread]: 
[0m14:50:37.373715 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:50:37.373885 [info ] [MainThread]: 
[0m14:50:37.374068 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m14:50:37.374376 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:50:37.376367 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.2802169, "process_in_blocks": "0", "process_kernel_time": 0.227032, "process_mem_max_rss": "140492800", "process_out_blocks": "0", "process_user_time": 1.59405}
[0m14:50:37.376690 [debug] [MainThread]: Command `dbt run` succeeded at 14:50:37.376643 after 1.28 seconds
[0m14:50:37.376909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10758a890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10789c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bba45b0>]}
[0m14:50:37.377119 [debug] [MainThread]: Flushing usage events
[0m14:50:38.012908 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:52:23.933018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bde8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ec0c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ec04f0>]}


============================== 14:52:23.935948 | 0294a2ae-34f6-4229-b68d-958e4d27c56c ==============================
[0m14:52:23.935948 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:52:23.936301 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'quiet': 'False', 'debug': 'False', 'no_print': 'None', 'static_parser': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'fail_fast': 'False', 'version_check': 'True', 'empty': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'use_colors': 'True', 'log_format': 'default', 'partial_parse': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'printer_width': '80', 'profiles_dir': '.', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'cache_selected_only': 'False'}
[0m14:52:23.936593 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:52:23.936795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e0ed40>]}
[0m14:52:24.105495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107faeaa0>]}
[0m14:52:24.146870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fe4880>]}
[0m14:52:24.147606 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:52:24.213352 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:52:24.286135 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:52:24.286422 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:52:24.289728 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:52:24.308051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d74520>]}
[0m14:52:24.383401 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:52:24.384789 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:52:24.396443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d91570>]}
[0m14:52:24.396750 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m14:52:24.396952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d902e0>]}
[0m14:52:24.397729 [info ] [MainThread]: 
[0m14:52:24.397923 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:52:24.398083 [info ] [MainThread]: 
[0m14:52:24.398353 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:52:24.400671 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:52:24.434612 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:52:24.434936 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:52:24.435108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:52:24.493744 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.059 seconds
[0m14:52:24.494649 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:52:24.495615 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:52:24.499193 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:52:24.499451 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:52:24.499773 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:52:24.513972 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m14:52:24.514346 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:52:24.514584 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:52:24.524198 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.009 seconds
[0m14:52:24.525188 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:52:24.526221 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:52:24.529651 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:24.529926 [debug] [MainThread]: On master: BEGIN
[0m14:52:24.530110 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:52:24.542521 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:52:24.542844 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:24.543208 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:52:24.552896 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m14:52:24.553762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d92230>]}
[0m14:52:24.554081 [debug] [MainThread]: On master: ROLLBACK
[0m14:52:24.555182 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:24.555374 [debug] [MainThread]: On master: BEGIN
[0m14:52:24.556531 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:52:24.556750 [debug] [MainThread]: On master: COMMIT
[0m14:52:24.556948 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:24.557122 [debug] [MainThread]: On master: COMMIT
[0m14:52:24.557805 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:52:24.558018 [debug] [MainThread]: On master: Close
[0m14:52:24.559780 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:52:24.560020 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:52:24.560254 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:52:24.560503 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:52:24.561012 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:52:24.561471 [info ] [Thread-2 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:52:24.561921 [info ] [Thread-3 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:52:24.562323 [info ] [Thread-4 (]: 4 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m14:52:24.562681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:52:24.563048 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:52:24.563356 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:52:24.563629 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:52:24.563860 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:52:24.564156 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:52:24.564419 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:52:24.564650 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:52:24.570504 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.572422 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.575402 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.577251 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:52:24.578030 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:52:24.578417 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:52:24.578779 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:52:24.600094 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.600437 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:52:24.602919 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.605145 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.607989 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:52:24.608400 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.608764 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.609038 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:52:24.609248 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.609446 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:52:24.609655 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:52:24.609879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:52:24.610103 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:52:24.610319 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:52:24.610518 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:52:24.610809 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:52:24.611009 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:52:24.625893 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m14:52:24.626258 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:52:24.626539 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m14:52:24.626904 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:52:24.627251 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.627741 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m14:52:24.629046 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m14:52:24.629338 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.629662 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m14:52:24.629957 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m14:52:24.630277 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.630646 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:52:24.641233 [debug] [Thread-4 (]: SQL status: SELECT 45 in 0.014 seconds
[0m14:52:24.647390 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:52:24.647698 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:52:24.649220 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.651471 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:52:24.651748 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:52:24.653191 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.662356 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:52:24.662654 [debug] [Thread-1 (]: SQL status: SELECT 2683 in 0.032 seconds
[0m14:52:24.662918 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:52:24.665075 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.665329 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:52:24.665537 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:52:24.667373 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.670299 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.670721 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:52:24.672222 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.673326 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:52:24.673566 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.673770 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:52:24.678045 [debug] [Thread-4 (]: SQL status: COMMIT in 0.012 seconds
[0m14:52:24.682863 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:52:24.683216 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m14:52:24.686316 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:52:24.688575 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:52:24.688884 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:52:24.689329 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:52:24.689606 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:52:24.701857 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:52:24.703632 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:52:24.703939 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:52:24.705331 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:52:24.706509 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d93970>]}
[0m14:52:24.706760 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d93d60>]}
[0m14:52:24.707197 [info ] [Thread-4 (]: 4 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.14s]
[0m14:52:24.707637 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.14s]
[0m14:52:24.708049 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:52:24.708375 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:52:24.708648 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:52:24.709033 [info ] [Thread-4 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:52:24.709418 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m14:52:24.709741 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:52:24.711694 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.712161 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:52:24.715648 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.716212 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.716427 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:52:24.716618 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:52:24.732313 [debug] [Thread-4 (]: SQL status: BEGIN in 0.016 seconds
[0m14:52:24.732699 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.732947 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:52:24.748290 [debug] [Thread-4 (]: SQL status: SELECT 1307 in 0.015 seconds
[0m14:52:24.750589 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.750837 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:52:24.752396 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.754650 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.754941 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:52:24.756370 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.757418 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:52:24.757643 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.757838 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:52:24.768044 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m14:52:24.768401 [debug] [Thread-3 (]: SQL status: SELECT 28209 in 0.138 seconds
[0m14:52:24.770087 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:52:24.772047 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.772509 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:52:24.772729 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:52:24.772956 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:52:24.774387 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.777137 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.777398 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:52:24.778449 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m14:52:24.778719 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.778933 [debug] [Thread-2 (]: SQL status: SELECT 27009 in 0.151 seconds
[0m14:52:24.779719 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:52:24.780647 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:52:24.782632 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.782985 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.783330 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111247a30>]}
[0m14:52:24.783631 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:52:24.783908 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:52:24.784329 [info ] [Thread-4 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.07s]
[0m14:52:24.784830 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:52:24.786047 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m14:52:24.787556 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:52:24.787798 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:52:24.788265 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:52:24.790050 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.790303 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:52:24.790522 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:52:24.791800 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:52:24.793050 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:52:24.793467 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.793734 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:52:24.794980 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m14:52:24.796721 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:52:24.797207 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:52:24.797544 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:52:24.809975 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.019 seconds
[0m14:52:24.811041 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:52:24.811473 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110de51b0>]}
[0m14:52:24.811887 [info ] [Thread-3 (]: 3 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.25s]
[0m14:52:24.812246 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:52:24.814678 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.017 seconds
[0m14:52:24.815470 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:52:24.815819 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0294a2ae-34f6-4229-b68d-958e4d27c56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d92920>]}
[0m14:52:24.816171 [info ] [Thread-2 (]: 2 of 5 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.25s]
[0m14:52:24.816489 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:52:24.817263 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:24.817537 [debug] [MainThread]: On master: BEGIN
[0m14:52:24.817709 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:52:24.830209 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:52:24.830538 [debug] [MainThread]: On master: COMMIT
[0m14:52:24.830724 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:24.830886 [debug] [MainThread]: On master: COMMIT
[0m14:52:24.831912 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:52:24.832243 [debug] [MainThread]: On master: Close
[0m14:52:24.832549 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:52:24.832719 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m14:52:24.832872 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:52:24.833022 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:52:24.833166 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:52:24.833378 [info ] [MainThread]: 
[0m14:52:24.833567 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m14:52:24.834186 [debug] [MainThread]: Command end result
[0m14:52:24.847968 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:52:24.849218 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:52:24.853769 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:52:24.854019 [info ] [MainThread]: 
[0m14:52:24.854252 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:52:24.854440 [info ] [MainThread]: 
[0m14:52:24.854627 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m14:52:24.854940 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:52:24.857529 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.97295517, "process_in_blocks": "0", "process_kernel_time": 0.226374, "process_mem_max_rss": "131809280", "process_out_blocks": "0", "process_user_time": 1.325895}
[0m14:52:24.857981 [debug] [MainThread]: Command `dbt run` succeeded at 14:52:24.857926 after 0.97 seconds
[0m14:52:24.858232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bde8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ca6470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055031f0>]}
[0m14:52:24.858468 [debug] [MainThread]: Flushing usage events
[0m14:52:25.451885 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:53:28.384203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10479ea70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10673cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10673c670>]}


============================== 14:53:28.387008 | f2addb46-c961-4076-96b1-f93cdfe998e1 ==============================
[0m14:53:28.387008 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:53:28.387381 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'profiles_dir': '.', 'introspect': 'True', 'debug': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_cache_events': 'False', 'empty': 'False', 'write_json': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error': 'None', 'quiet': 'False', 'version_check': 'True', 'log_format': 'default'}
[0m14:53:28.387685 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:53:28.387902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106686ce0>]}
[0m14:53:28.532673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066fbd90>]}
[0m14:53:28.573817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10682c910>]}
[0m14:53:28.574558 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:53:28.641025 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:53:28.717459 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:53:28.717785 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:53:28.721267 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:53:28.739653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107773dc0>]}
[0m14:53:28.814045 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:53:28.815294 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:53:28.826809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10778d9f0>]}
[0m14:53:28.827121 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m14:53:28.827328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10764a830>]}
[0m14:53:28.828106 [info ] [MainThread]: 
[0m14:53:28.828311 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:53:28.828480 [info ] [MainThread]: 
[0m14:53:28.828762 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:53:28.831094 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:53:28.864724 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:53:28.865045 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:53:28.865222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:28.902695 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.037 seconds
[0m14:53:28.903624 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:53:28.904645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:53:28.908616 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:53:28.908920 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:53:28.909188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:53:28.920645 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m14:53:28.920912 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:53:28.921117 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:53:28.928343 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.007 seconds
[0m14:53:28.929366 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:53:28.930413 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:53:28.934042 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:28.934315 [debug] [MainThread]: On master: BEGIN
[0m14:53:28.934504 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:53:28.946292 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:53:28.946632 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:28.946896 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:53:28.954739 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m14:53:28.955537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076b7880>]}
[0m14:53:28.955871 [debug] [MainThread]: On master: ROLLBACK
[0m14:53:28.956624 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:28.956833 [debug] [MainThread]: On master: BEGIN
[0m14:53:28.958145 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:53:28.958355 [debug] [MainThread]: On master: COMMIT
[0m14:53:28.958546 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:28.958838 [debug] [MainThread]: On master: COMMIT
[0m14:53:28.959588 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:53:28.959799 [debug] [MainThread]: On master: Close
[0m14:53:28.962515 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:53:28.962813 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:53:28.963091 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:53:28.963344 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:53:28.963767 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:53:28.964119 [info ] [Thread-2 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:53:28.964614 [info ] [Thread-3 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:53:28.964963 [info ] [Thread-4 (]: 4 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m14:53:28.965351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:53:28.965685 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:53:28.965970 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:53:28.966238 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:53:28.966472 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:53:28.966691 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:53:28.966900 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:53:28.967105 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:53:28.972271 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:28.974120 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:28.976535 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:28.978198 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:53:28.979102 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:53:28.979428 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:53:28.985252 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:53:28.985502 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:53:29.000415 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.002716 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:53:29.004708 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.007157 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.007747 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.007974 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:53:29.008183 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:53:29.008562 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:53:29.008947 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.009303 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:53:29.009582 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.009860 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:53:29.010142 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:53:29.010399 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:53:29.010635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:53:29.010931 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:53:29.028955 [debug] [Thread-2 (]: SQL status: BEGIN in 0.021 seconds
[0m14:53:29.029351 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.029751 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
    from source
)

select * from extracted
  );
  
[0m14:53:29.030745 [debug] [Thread-3 (]: SQL status: BEGIN in 0.020 seconds
[0m14:53:29.031075 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.031344 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m14:53:29.031616 [debug] [Thread-4 (]: SQL status: BEGIN in 0.021 seconds
[0m14:53:29.031861 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded
    from source
)

select * from extracted
  );
  
[0m14:53:29.032129 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.032349 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:53:29.032635 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:53:29.032954 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:53:29.041875 [debug] [Thread-4 (]: SQL status: SELECT 45 in 0.009 seconds
[0m14:53:29.048039 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:53:29.048340 [debug] [Thread-1 (]: SQL status: SELECT 2683 in 0.015 seconds
[0m14:53:29.048659 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:53:29.050863 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.051241 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:53:29.052226 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.052515 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.054382 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:53:29.056129 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.056377 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:53:29.056657 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:53:29.057932 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.058164 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.071485 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:53:29.071870 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:53:29.072230 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.072534 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:53:29.072873 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:53:29.073129 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:53:29.081568 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m14:53:29.081850 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m14:53:29.086025 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:53:29.088304 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:53:29.090920 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:53:29.091412 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:53:29.091640 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:53:29.091857 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:53:29.099288 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.007 seconds
[0m14:53:29.100938 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:53:29.102161 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m14:53:29.102953 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:53:29.103443 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028aa170>]}
[0m14:53:29.103856 [info ] [Thread-4 (]: 4 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.14s]
[0m14:53:29.104214 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:53:29.104413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107747cd0>]}
[0m14:53:29.104696 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:53:29.105100 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.14s]
[0m14:53:29.105418 [info ] [Thread-4 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:53:29.105771 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:53:29.106035 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m14:53:29.106316 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:53:29.108236 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.108854 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:53:29.111254 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.111813 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.112139 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:53:29.112418 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:53:29.113465 [debug] [Thread-2 (]: SQL status: SELECT 27009 in 0.083 seconds
[0m14:53:29.115671 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.115936 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:53:29.116878 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.118850 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.119102 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:53:29.120139 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.120455 [debug] [Thread-3 (]: SQL status: SELECT 28209 in 0.088 seconds
[0m14:53:29.121380 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:53:29.123145 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.123363 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.123567 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:53:29.123854 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:53:29.125106 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.126981 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.127265 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m14:53:29.127645 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:53:29.127889 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.128312 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number
    from source
)

select * from extracted
  );
  
[0m14:53:29.129638 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:53:29.130762 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:53:29.131033 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m14:53:29.131253 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.133751 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:53:29.134064 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:53:29.134647 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:53:29.134982 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:53:29.135976 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m14:53:29.137538 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:53:29.138034 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:53:29.138274 [debug] [Thread-4 (]: SQL status: SELECT 1307 in 0.010 seconds
[0m14:53:29.138577 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:53:29.140762 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.141121 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:53:29.142239 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.144173 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.144461 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m14:53:29.144746 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:53:29.145578 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:53:29.146080 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10778d840>]}
[0m14:53:29.146777 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:53:29.146510 [info ] [Thread-2 (]: 2 of 5 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.18s]
[0m14:53:29.147927 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:53:29.148204 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m14:53:29.148577 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:53:29.148811 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.149546 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:53:29.149841 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:53:29.150257 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c79ff0>]}
[0m14:53:29.150659 [info ] [Thread-3 (]: 3 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.18s]
[0m14:53:29.151073 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m14:53:29.151431 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:53:29.153114 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:53:29.153799 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:53:29.154072 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:53:29.158057 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m14:53:29.158924 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:53:29.159396 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2addb46-c961-4076-96b1-f93cdfe998e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f03fd0>]}
[0m14:53:29.159857 [info ] [Thread-4 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.05s]
[0m14:53:29.160203 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:53:29.160970 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:29.161238 [debug] [MainThread]: On master: BEGIN
[0m14:53:29.161411 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:53:29.172586 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m14:53:29.172944 [debug] [MainThread]: On master: COMMIT
[0m14:53:29.173126 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:29.173299 [debug] [MainThread]: On master: COMMIT
[0m14:53:29.174020 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:53:29.174335 [debug] [MainThread]: On master: Close
[0m14:53:29.174610 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:53:29.174786 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m14:53:29.174944 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:53:29.175099 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:53:29.175254 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:53:29.175493 [info ] [MainThread]: 
[0m14:53:29.175753 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m14:53:29.176490 [debug] [MainThread]: Command end result
[0m14:53:29.189450 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:53:29.190795 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:53:29.195063 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:53:29.195320 [info ] [MainThread]: 
[0m14:53:29.195564 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:53:29.195752 [info ] [MainThread]: 
[0m14:53:29.195955 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m14:53:29.196319 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:53:29.198769 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.86408603, "process_in_blocks": "0", "process_kernel_time": 0.190837, "process_mem_max_rss": "130580480", "process_out_blocks": "0", "process_user_time": 1.309298}
[0m14:53:29.199175 [debug] [MainThread]: Command `dbt run` succeeded at 14:53:29.199125 after 0.86 seconds
[0m14:53:29.199423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10479ea70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10778f100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10778e7d0>]}
[0m14:53:29.199674 [debug] [MainThread]: Flushing usage events
[0m14:53:29.760110 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:55:49.061642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c26aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072a4e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072a4700>]}


============================== 14:55:49.064811 | 7b3d084f-8748-4869-bb9c-eb2b9927adc6 ==============================
[0m14:55:49.064811 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:55:49.065227 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'fail_fast': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'no_print': 'None', 'use_colors': 'True', 'debug': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'empty': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'introspect': 'True', 'write_json': 'True', 'partial_parse': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'profiles_dir': '.'}
[0m14:55:49.065545 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:55:49.065769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071f2380>]}
[0m14:55:49.211809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073cf820>]}
[0m14:55:49.254668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107377490>]}
[0m14:55:49.255516 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:55:49.323451 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:55:49.395851 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m14:55:49.396233 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m14:55:49.396463 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_new_businesses.sql
[0m14:55:49.396679 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m14:55:49.396900 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m14:55:49.591055 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:55:49.599226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081356c0>]}
[0m14:55:49.643443 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:55:49.644855 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:55:49.656267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108045390>]}
[0m14:55:49.656592 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m14:55:49.656802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ca72e0>]}
[0m14:55:49.657720 [info ] [MainThread]: 
[0m14:55:49.657946 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:55:49.658128 [info ] [MainThread]: 
[0m14:55:49.658425 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:55:49.660783 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:55:49.694445 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:55:49.694775 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:55:49.694956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:55:49.800315 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.105 seconds
[0m14:55:49.801241 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:55:49.802290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:55:49.806240 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:55:49.806545 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:55:49.806733 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:55:49.818585 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m14:55:49.818861 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:55:49.819084 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:55:49.825411 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.006 seconds
[0m14:55:49.826405 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:55:49.827278 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:55:49.831004 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:49.831311 [debug] [MainThread]: On master: BEGIN
[0m14:55:49.831504 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:55:49.843882 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:55:49.844153 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:49.844382 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:55:49.850991 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m14:55:49.851818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081342b0>]}
[0m14:55:49.852145 [debug] [MainThread]: On master: ROLLBACK
[0m14:55:49.853052 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:49.853254 [debug] [MainThread]: On master: BEGIN
[0m14:55:49.854597 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:55:49.854870 [debug] [MainThread]: On master: COMMIT
[0m14:55:49.855070 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:49.855251 [debug] [MainThread]: On master: COMMIT
[0m14:55:49.856029 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:55:49.856268 [debug] [MainThread]: On master: Close
[0m14:55:49.858241 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:55:49.858521 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:55:49.858745 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:55:49.858948 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:55:49.859384 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:55:49.859770 [info ] [Thread-2 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:55:49.860266 [info ] [Thread-3 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:55:49.860683 [info ] [Thread-4 (]: 4 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m14:55:49.861088 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:55:49.861503 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:55:49.861836 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:55:49.862102 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:55:49.862335 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:55:49.862543 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:55:49.862748 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:55:49.862954 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:55:49.868424 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:55:49.871131 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:55:49.873018 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:55:49.874687 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:55:49.875550 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:55:49.875865 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:55:49.876087 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:55:49.876293 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:55:49.897903 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:55:49.900239 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:55:49.902319 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:55:49.904884 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:55:49.905446 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:55:49.905670 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:55:49.905921 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:55:49.906141 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:55:49.906415 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:55:49.906599 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:55:49.906832 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:55:49.907039 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:55:49.907239 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:55:49.907422 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:55:49.907604 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:55:49.907898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:55:49.929250 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m14:55:49.929590 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:55:49.929899 [debug] [Thread-3 (]: SQL status: BEGIN in 0.022 seconds
[0m14:55:49.930172 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m14:55:49.930429 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

with filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:55:49.930664 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m14:55:49.930904 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:55:49.931178 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:55:49.931536 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:55:49.931857 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

with filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'accounts_relief'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:55:49.932153 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

with filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:55:49.932446 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near "with"
LINE 18: with filemap as (
         ^

[0m14:55:49.932784 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:55:49.933153 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: ROLLBACK
[0m14:55:49.933940 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:55:49.934178 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "with"
LINE 18: with filemap as (
         ^

[0m14:55:49.934382 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "with"
LINE 18: with filemap as (
         ^

[0m14:55:49.934813 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: ROLLBACK
[0m14:55:49.935122 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: ROLLBACK
[0m14:55:49.935906 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:55:49.939460 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:55:49.940067 [debug] [Thread-1 (]: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:55:49.940574 [debug] [Thread-2 (]: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:55:49.940810 [debug] [Thread-4 (]: SQL status: SELECT 45 in 0.007 seconds
[0m14:55:49.942481 [debug] [Thread-3 (]: Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:55:49.948467 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:55:49.948735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10867bb50>]}
[0m14:55:49.948972 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077d5d20>]}
[0m14:55:49.949240 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086cc280>]}
[0m14:55:49.949473 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:55:49.949894 [error] [Thread-1 (]: 1 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_closed .. [[31mERROR[0m in 0.08s]
[0m14:55:49.950272 [error] [Thread-2 (]: 2 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_no_relief  [[31mERROR[0m in 0.08s]
[0m14:55:49.950623 [error] [Thread-3 (]: 3 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_relief .. [[31mERROR[0m in 0.09s]
[0m14:55:49.950997 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:55:49.951395 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:55:49.951761 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:55:49.951973 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:55:49.952220 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:55:49.952481 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_closed' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql.
[0m14:55:49.954449 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:55:49.955374 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_no_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql.
[0m14:55:49.954744 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:55:49.955758 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:55:49.956095 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql.
[0m14:55:49.956466 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.stg_new_businesses)
[0m14:55:49.956950 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:55:49.959700 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:55:49.960079 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:55:49.969121 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:55:49.969445 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:55:49.969660 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:55:49.969924 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:55:49.972255 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:55:49.972547 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m14:55:49.977027 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:55:49.979872 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:55:49.980180 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:49.980516 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:55:49.980778 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:55:49.981051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:55:49.986254 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m14:55:49.988888 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:55:49.989395 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049f2140>]}
[0m14:55:49.990177 [info ] [Thread-4 (]: 4 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.13s]
[0m14:55:49.990554 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:55:49.996934 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m14:55:49.997319 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:55:49.997575 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

with filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'new_businesses'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:55:49.999096 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "with"
LINE 18: with filemap as (
         ^

[0m14:55:49.999362 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: ROLLBACK
[0m14:55:50.000266 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:55:50.001065 [debug] [Thread-1 (]: Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:55:50.001507 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b3d084f-8748-4869-bb9c-eb2b9927adc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c80d450>]}
[0m14:55:50.001950 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model analytics_analytics.stg_new_businesses ... [[31mERROR[0m in 0.05s]
[0m14:55:50.002284 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:55:50.002664 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_new_businesses' to be skipped because of status 'error'.  Reason: Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql.
[0m14:55:50.003697 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:50.003917 [debug] [MainThread]: On master: BEGIN
[0m14:55:50.004091 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:55:50.016225 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:55:50.016579 [debug] [MainThread]: On master: COMMIT
[0m14:55:50.016774 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:50.016947 [debug] [MainThread]: On master: COMMIT
[0m14:55:50.017644 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:55:50.017884 [debug] [MainThread]: On master: Close
[0m14:55:50.018173 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:55:50.018405 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:55:50.018568 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:55:50.018719 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:55:50.018874 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_filemap' was properly closed.
[0m14:55:50.019225 [info ] [MainThread]: 
[0m14:55:50.019503 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.36 seconds (0.36s).
[0m14:55:50.020146 [debug] [MainThread]: Command end result
[0m14:55:50.033470 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:55:50.034685 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:55:50.038744 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:55:50.039013 [info ] [MainThread]: 
[0m14:55:50.039233 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m14:55:50.039413 [info ] [MainThread]: 
[0m14:55:50.039624 [error] [MainThread]: [31mFailure in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)[0m
[0m14:55:50.039835 [error] [MainThread]:   Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:55:50.040006 [info ] [MainThread]: 
[0m14:55:50.040201 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:55:50.040363 [info ] [MainThread]: 
[0m14:55:50.040549 [error] [MainThread]: [31mFailure in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)[0m
[0m14:55:50.040740 [error] [MainThread]:   Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:55:50.040896 [info ] [MainThread]: 
[0m14:55:50.041076 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:55:50.041235 [info ] [MainThread]: 
[0m14:55:50.041424 [error] [MainThread]: [31mFailure in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)[0m
[0m14:55:50.041613 [error] [MainThread]:   Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:55:50.041766 [info ] [MainThread]: 
[0m14:55:50.041945 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:55:50.042098 [info ] [MainThread]: 
[0m14:55:50.042280 [error] [MainThread]: [31mFailure in model stg_new_businesses (models/staging/stg_new_businesses.sql)[0m
[0m14:55:50.042471 [error] [MainThread]:   Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  syntax error at or near "with"
  LINE 18: with filemap as (
           ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:55:50.042634 [info ] [MainThread]: 
[0m14:55:50.042825 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:55:50.042984 [info ] [MainThread]: 
[0m14:55:50.043163 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=0 NO-OP=0 TOTAL=5
[0m14:55:50.043452 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:55:50.046098 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.0343089, "process_in_blocks": "0", "process_kernel_time": 0.22096, "process_mem_max_rss": "137773056", "process_out_blocks": "0", "process_user_time": 1.496933}
[0m14:55:50.046502 [debug] [MainThread]: Command `dbt run` failed at 14:55:50.046448 after 1.03 seconds
[0m14:55:50.046773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c26aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073cf820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081346d0>]}
[0m14:55:50.047019 [debug] [MainThread]: Flushing usage events
[0m14:55:50.678450 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:56:21.820767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10617e830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103c0bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103c0490>]}


============================== 14:56:21.823718 | ad6d2f1b-a4d6-4310-b782-52d7d19f5330 ==============================
[0m14:56:21.823718 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:56:21.824119 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'no_print': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'warn_error': 'None', 'write_json': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'version_check': 'True', 'static_parser': 'True', 'printer_width': '80', 'partial_parse': 'True', 'fail_fast': 'False', 'quiet': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'use_colors': 'True', 'target_path': 'None', 'log_format': 'default', 'log_cache_events': 'False'}
[0m14:56:21.824442 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:56:21.824670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103095d0>]}
[0m14:56:21.961542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109807f0>]}
[0m14:56:22.003791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cd35e0>]}
[0m14:56:22.004952 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:56:22.075309 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:56:22.146223 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m14:56:22.146659 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m14:56:22.146884 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_new_businesses.sql
[0m14:56:22.147088 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m14:56:22.147287 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m14:56:22.337846 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:56:22.346190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11131c250>]}
[0m14:56:22.390119 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:56:22.392607 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:56:22.404433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111dca60>]}
[0m14:56:22.404743 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m14:56:22.404947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11124cb20>]}
[0m14:56:22.405796 [info ] [MainThread]: 
[0m14:56:22.406002 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:56:22.406172 [info ] [MainThread]: 
[0m14:56:22.406474 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:56:22.408739 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:56:22.441673 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:56:22.442068 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:56:22.442259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:22.505567 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.063 seconds
[0m14:56:22.506390 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:56:22.507408 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:56:22.511003 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:56:22.511249 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:56:22.511410 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:56:22.523908 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m14:56:22.524195 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:56:22.524404 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:56:22.532301 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.008 seconds
[0m14:56:22.533181 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:56:22.534115 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:56:22.537314 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:22.537548 [debug] [MainThread]: On master: BEGIN
[0m14:56:22.537713 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:56:22.550589 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m14:56:22.550895 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:22.551170 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:56:22.565133 [debug] [MainThread]: SQL status: SELECT 0 in 0.014 seconds
[0m14:56:22.565861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111488220>]}
[0m14:56:22.566180 [debug] [MainThread]: On master: ROLLBACK
[0m14:56:22.566900 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:22.567095 [debug] [MainThread]: On master: BEGIN
[0m14:56:22.568352 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:56:22.568606 [debug] [MainThread]: On master: COMMIT
[0m14:56:22.568814 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:22.569006 [debug] [MainThread]: On master: COMMIT
[0m14:56:22.569699 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:56:22.569902 [debug] [MainThread]: On master: Close
[0m14:56:22.572459 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:56:22.572854 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:56:22.573151 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:56:22.573407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_accounts_closed)
[0m14:56:22.573712 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:56:22.573969 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:56:22.574249 [info ] [Thread-2 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:56:22.574515 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:56:22.574851 [info ] [Thread-3 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:56:22.575233 [info ] [Thread-4 (]: 4 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m14:56:22.575619 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:56:22.581389 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:56:22.581933 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:56:22.582285 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:56:22.582516 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:56:22.582827 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:56:22.583084 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:56:22.586201 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:56:22.588406 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:56:22.588692 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:56:22.590747 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:56:22.611809 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:56:22.612210 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:56:22.612459 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:56:22.612849 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:56:22.615048 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:56:22.615297 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:56:22.617224 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:56:22.619953 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:56:22.620372 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:56:22.620762 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:56:22.621039 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:22.621266 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:56:22.621470 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:56:22.621682 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:56:22.621994 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:56:22.622204 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:56:22.622471 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:56:22.622757 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:56:22.623026 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:56:22.634395 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m14:56:22.634693 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:56:22.634931 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:56:22.636056 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 35:         filemap.valid_from as valid_from,
                 ^

[0m14:56:22.636293 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: ROLLBACK
[0m14:56:22.637254 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:56:22.641802 [debug] [Thread-1 (]: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:56:22.642108 [debug] [Thread-2 (]: SQL status: BEGIN in 0.019 seconds
[0m14:56:22.642394 [debug] [Thread-3 (]: SQL status: BEGIN in 0.020 seconds
[0m14:56:22.643583 [debug] [Thread-4 (]: SQL status: BEGIN in 0.021 seconds
[0m14:56:22.643846 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:56:22.644153 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:56:22.644410 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:56:22.644638 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056a14b0>]}
[0m14:56:22.644989 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:56:22.645293 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'accounts_relief'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:56:22.645572 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:56:22.646040 [error] [Thread-1 (]: 1 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_closed .. [[31mERROR[0m in 0.07s]
[0m14:56:22.646525 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:56:22.646776 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:56:22.647077 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_closed' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql.
[0m14:56:22.647373 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 36:         filemap.valid_from as valid_from,
                 ^

[0m14:56:22.647678 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:56:22.648313 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "table_name" does not exist
LINE 20:     where table_name = 'accounts_relief'
                   ^

[0m14:56:22.648542 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: ROLLBACK
[0m14:56:22.648801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.stg_new_businesses)
[0m14:56:22.649013 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: ROLLBACK
[0m14:56:22.649240 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:56:22.651476 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:56:22.651829 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:56:22.652128 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:56:22.652865 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:56:22.655552 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:56:22.655927 [debug] [Thread-4 (]: SQL status: SELECT 45 in 0.009 seconds
[0m14:56:22.656437 [debug] [Thread-2 (]: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:56:22.657075 [debug] [Thread-3 (]: Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  column "table_name" does not exist
  LINE 20:     where table_name = 'accounts_relief'
                     ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:56:22.662771 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:56:22.663214 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:56:22.663611 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a08820>]}
[0m14:56:22.663982 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119b4820>]}
[0m14:56:22.664271 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:56:22.664513 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:56:22.664930 [error] [Thread-2 (]: 2 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_no_relief  [[31mERROR[0m in 0.09s]
[0m14:56:22.665348 [error] [Thread-3 (]: 3 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_relief .. [[31mERROR[0m in 0.08s]
[0m14:56:22.665665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:22.666057 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:56:22.666417 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:56:22.666839 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:56:22.667137 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_no_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql.
[0m14:56:22.669036 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:56:22.669341 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  column "table_name" does not exist
  LINE 20:     where table_name = 'accounts_relief'
                     ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql.
[0m14:56:22.669624 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:56:22.670910 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:56:22.679887 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:56:22.680377 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:56:22.680717 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:56:22.682002 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m14:56:22.682299 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:56:22.682561 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select * from "highstreet"."public"."filename_mapping"
    where table_name = 'new_businesses'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:56:22.682829 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m14:56:22.687106 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:56:22.687427 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "table_name" does not exist
LINE 20:     where table_name = 'new_businesses'
                   ^

[0m14:56:22.690084 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:56:22.690415 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: ROLLBACK
[0m14:56:22.690674 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:56:22.691616 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:56:22.692414 [debug] [Thread-1 (]: Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  column "table_name" does not exist
  LINE 20:     where table_name = 'new_businesses'
                     ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:56:22.692805 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10444f8e0>]}
[0m14:56:22.693203 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model analytics_analytics.stg_new_businesses ... [[31mERROR[0m in 0.04s]
[0m14:56:22.693535 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:56:22.693820 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_new_businesses' to be skipped because of status 'error'.  Reason: Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  column "table_name" does not exist
  LINE 20:     where table_name = 'new_businesses'
                     ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql.
[0m14:56:22.695869 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m14:56:22.697501 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:56:22.697902 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad6d2f1b-a4d6-4310-b782-52d7d19f5330', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10448e230>]}
[0m14:56:22.698282 [info ] [Thread-4 (]: 4 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.12s]
[0m14:56:22.698666 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:56:22.699405 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:22.699646 [debug] [MainThread]: On master: BEGIN
[0m14:56:22.699818 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:56:22.712408 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m14:56:22.712754 [debug] [MainThread]: On master: COMMIT
[0m14:56:22.712935 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:22.713098 [debug] [MainThread]: On master: COMMIT
[0m14:56:22.713743 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:56:22.713941 [debug] [MainThread]: On master: Close
[0m14:56:22.714208 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:56:22.714396 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:56:22.714548 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:56:22.714697 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:56:22.714841 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_filemap' was properly closed.
[0m14:56:22.715079 [info ] [MainThread]: 
[0m14:56:22.715279 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m14:56:22.716102 [debug] [MainThread]: Command end result
[0m14:56:22.727943 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:56:22.729253 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:56:22.733260 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:56:22.733499 [info ] [MainThread]: 
[0m14:56:22.733717 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m14:56:22.734028 [info ] [MainThread]: 
[0m14:56:22.734314 [error] [MainThread]: [31mFailure in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)[0m
[0m14:56:22.734547 [error] [MainThread]:   Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:56:22.734776 [info ] [MainThread]: 
[0m14:56:22.735012 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:56:22.735202 [info ] [MainThread]: 
[0m14:56:22.735416 [error] [MainThread]: [31mFailure in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)[0m
[0m14:56:22.735777 [error] [MainThread]:   Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:56:22.735975 [info ] [MainThread]: 
[0m14:56:22.736173 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:56:22.736338 [info ] [MainThread]: 
[0m14:56:22.736530 [error] [MainThread]: [31mFailure in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)[0m
[0m14:56:22.736728 [error] [MainThread]:   Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  column "table_name" does not exist
  LINE 20:     where table_name = 'accounts_relief'
                     ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:56:22.736885 [info ] [MainThread]: 
[0m14:56:22.737066 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:56:22.737222 [info ] [MainThread]: 
[0m14:56:22.737408 [error] [MainThread]: [31mFailure in model stg_new_businesses (models/staging/stg_new_businesses.sql)[0m
[0m14:56:22.737601 [error] [MainThread]:   Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  column "table_name" does not exist
  LINE 20:     where table_name = 'new_businesses'
                     ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:56:22.737758 [info ] [MainThread]: 
[0m14:56:22.737938 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:56:22.738089 [info ] [MainThread]: 
[0m14:56:22.738260 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=0 NO-OP=0 TOTAL=5
[0m14:56:22.738573 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:56:22.740782 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9734131, "process_in_blocks": "0", "process_kernel_time": 0.215887, "process_mem_max_rss": "136380416", "process_out_blocks": "0", "process_user_time": 1.456139}
[0m14:56:22.741102 [debug] [MainThread]: Command `dbt run` failed at 14:56:22.741057 after 0.97 seconds
[0m14:56:22.741337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10617e830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cd35e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119809a0>]}
[0m14:56:22.741551 [debug] [MainThread]: Flushing usage events
[0m14:56:23.273955 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:57:12.820239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103336830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b8bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b8490>]}


============================== 14:57:12.825232 | 4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928 ==============================
[0m14:57:12.825232 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:57:12.825690 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'target_path': 'None', 'debug': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'log_format': 'default', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'version_check': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'partial_parse': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'quiet': 'False', 'fail_fast': 'False', 'write_json': 'True'}
[0m14:57:12.826054 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m14:57:12.826340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049015d0>]}
[0m14:57:13.037788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ddc7f0>]}
[0m14:57:13.084722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d4b5e0>]}
[0m14:57:13.085702 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:57:13.152189 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:57:13.231956 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m14:57:13.232453 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m14:57:13.232691 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m14:57:13.232908 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_new_businesses.sql
[0m14:57:13.233116 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m14:57:13.430026 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m14:57:13.438829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058457b0>]}
[0m14:57:13.486770 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:57:13.488591 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:57:13.502676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ee7190>]}
[0m14:57:13.503141 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m14:57:13.503474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105645540>]}
[0m14:57:13.504404 [info ] [MainThread]: 
[0m14:57:13.504638 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:57:13.504822 [info ] [MainThread]: 
[0m14:57:13.505112 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:57:13.507603 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:57:13.541610 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:57:13.541963 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:57:13.542251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:57:13.619639 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.077 seconds
[0m14:57:13.620556 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:57:13.621452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:57:13.625143 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:57:13.625544 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:57:13.625761 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:57:13.638720 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m14:57:13.639188 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:57:13.639414 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:57:13.653438 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.014 seconds
[0m14:57:13.654520 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:57:13.655607 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:57:13.659289 [debug] [MainThread]: Using postgres connection "master"
[0m14:57:13.659535 [debug] [MainThread]: On master: BEGIN
[0m14:57:13.659714 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:57:13.672653 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m14:57:13.673018 [debug] [MainThread]: Using postgres connection "master"
[0m14:57:13.673355 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:57:13.685558 [debug] [MainThread]: SQL status: SELECT 0 in 0.012 seconds
[0m14:57:13.686446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10318df90>]}
[0m14:57:13.686781 [debug] [MainThread]: On master: ROLLBACK
[0m14:57:13.687671 [debug] [MainThread]: Using postgres connection "master"
[0m14:57:13.687976 [debug] [MainThread]: On master: BEGIN
[0m14:57:13.689214 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:57:13.689493 [debug] [MainThread]: On master: COMMIT
[0m14:57:13.689709 [debug] [MainThread]: Using postgres connection "master"
[0m14:57:13.689901 [debug] [MainThread]: On master: COMMIT
[0m14:57:13.690569 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:57:13.690797 [debug] [MainThread]: On master: Close
[0m14:57:13.692811 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:57:13.693206 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m14:57:13.693552 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m14:57:13.693805 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:57:13.700410 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:57:13.701562 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:57:13.724081 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:57:13.724754 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:57:13.725008 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:57:13.725207 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:57:13.738079 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m14:57:13.738461 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:57:13.738747 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:57:13.753737 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.015 seconds
[0m14:57:13.759533 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:57:13.759802 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:57:13.761247 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:57:13.763077 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:57:13.763301 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:57:13.764243 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:57:13.773001 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:57:13.773278 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:57:13.773485 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:57:13.774855 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m14:57:13.778363 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:57:13.780708 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:57:13.780937 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:57:13.786010 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m14:57:13.787487 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:57:13.788700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cd9840>]}
[0m14:57:13.789093 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.09s]
[0m14:57:13.789416 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:57:13.789935 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:57:13.790191 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:57:13.790390 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:57:13.790577 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:57:13.790841 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m14:57:13.791142 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m14:57:13.791563 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m14:57:13.791966 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m14:57:13.792332 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m14:57:13.792618 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:57:13.792875 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m14:57:13.793074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m14:57:13.793295 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:57:13.793485 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:57:13.793668 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:57:13.793856 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:57:13.796104 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:57:13.798548 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:57:13.800346 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:57:13.801972 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:57:13.802642 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:57:13.803035 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:57:13.805328 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:57:13.805647 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:57:13.808156 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:57:13.808410 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:57:13.810562 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:57:13.813317 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:57:13.813608 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:57:13.813894 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:57:13.814175 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:57:13.814431 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:57:13.814636 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:57:13.814842 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:57:13.815052 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:57:13.815263 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:57:13.815454 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:57:13.815644 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:57:13.815915 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:57:13.816170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:57:13.835890 [debug] [Thread-2 (]: SQL status: BEGIN in 0.020 seconds
[0m14:57:13.836369 [debug] [Thread-3 (]: SQL status: BEGIN in 0.021 seconds
[0m14:57:13.836613 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:57:13.836824 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:57:13.837074 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select * from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_relief'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:57:13.837351 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select * from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:57:13.838596 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 35:         filemap.valid_from as valid_from,
                 ^

[0m14:57:13.838904 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: ROLLBACK
[0m14:57:13.839735 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:57:13.840325 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m14:57:13.840636 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:57:13.840954 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select * from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:57:13.841307 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column reference "id" is ambiguous
LINE 25:         id,
                 ^

[0m14:57:13.841609 [debug] [Thread-4 (]: SQL status: BEGIN in 0.026 seconds
[0m14:57:13.841935 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: ROLLBACK
[0m14:57:13.842152 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:57:13.842492 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select * from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:57:13.842977 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:57:13.844308 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 36:         filemap.valid_from as valid_from,
                 ^

[0m14:57:13.844601 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column reference "id" is ambiguous
LINE 25:         id,
                 ^

[0m14:57:13.844980 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: ROLLBACK
[0m14:57:13.845209 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: ROLLBACK
[0m14:57:13.845937 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:57:13.846188 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:57:13.848969 [debug] [Thread-3 (]: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:57:13.849418 [debug] [Thread-4 (]: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:57:13.849831 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e31390>]}
[0m14:57:13.850294 [debug] [Thread-2 (]: Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  column reference "id" is ambiguous
  LINE 25:         id,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:57:13.850606 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ef5b0>]}
[0m14:57:13.851023 [debug] [Thread-1 (]: Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  column reference "id" is ambiguous
  LINE 25:         id,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:57:13.851794 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e1a050>]}
[0m14:57:13.851449 [error] [Thread-3 (]: 2 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_closed .. [[31mERROR[0m in 0.06s]
[0m14:57:13.852301 [error] [Thread-4 (]: 3 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_no_relief  [[31mERROR[0m in 0.06s]
[0m14:57:13.852621 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4aad8752-f8f0-43fb-aaaf-3a2bd8e8b928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e2c700>]}
[0m14:57:13.852968 [error] [Thread-2 (]: 4 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_relief .. [[31mERROR[0m in 0.06s]
[0m14:57:13.853283 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:57:13.853573 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:57:13.853875 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model analytics_analytics.stg_new_businesses ... [[31mERROR[0m in 0.06s]
[0m14:57:13.854182 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:57:13.854485 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_closed' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql.
[0m14:57:13.854851 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:57:13.855526 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_no_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql.
[0m14:57:13.855860 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  column reference "id" is ambiguous
  LINE 25:         id,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql.
[0m14:57:13.856129 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_new_businesses' to be skipped because of status 'error'.  Reason: Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  column reference "id" is ambiguous
  LINE 25:         id,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql.
[0m14:57:13.856757 [debug] [MainThread]: Using postgres connection "master"
[0m14:57:13.856937 [debug] [MainThread]: On master: BEGIN
[0m14:57:13.857092 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:57:13.869232 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m14:57:13.869568 [debug] [MainThread]: On master: COMMIT
[0m14:57:13.869752 [debug] [MainThread]: Using postgres connection "master"
[0m14:57:13.869919 [debug] [MainThread]: On master: COMMIT
[0m14:57:13.870583 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:57:13.870797 [debug] [MainThread]: On master: Close
[0m14:57:13.871065 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:57:13.871227 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m14:57:13.871374 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m14:57:13.871515 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m14:57:13.871655 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m14:57:13.871865 [info ] [MainThread]: 
[0m14:57:13.872051 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.37 seconds (0.37s).
[0m14:57:13.872650 [debug] [MainThread]: Command end result
[0m14:57:13.884984 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:57:13.886036 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:57:13.890402 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:57:13.890709 [info ] [MainThread]: 
[0m14:57:13.891003 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m14:57:13.891184 [info ] [MainThread]: 
[0m14:57:13.891387 [error] [MainThread]: [31mFailure in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)[0m
[0m14:57:13.891587 [error] [MainThread]:   Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:57:13.891744 [info ] [MainThread]: 
[0m14:57:13.891929 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m14:57:13.892082 [info ] [MainThread]: 
[0m14:57:13.892268 [error] [MainThread]: [31mFailure in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)[0m
[0m14:57:13.892459 [error] [MainThread]:   Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:57:13.892614 [info ] [MainThread]: 
[0m14:57:13.892794 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m14:57:13.892942 [info ] [MainThread]: 
[0m14:57:13.893122 [error] [MainThread]: [31mFailure in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)[0m
[0m14:57:13.893307 [error] [MainThread]:   Database Error in model stg_accounts_relief (models/staging/stg_accounts_relief.sql)
  column reference "id" is ambiguous
  LINE 25:         id,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:57:13.893454 [info ] [MainThread]: 
[0m14:57:13.893627 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_relief.sql
[0m14:57:13.893777 [info ] [MainThread]: 
[0m14:57:13.893973 [error] [MainThread]: [31mFailure in model stg_new_businesses (models/staging/stg_new_businesses.sql)[0m
[0m14:57:13.894165 [error] [MainThread]:   Database Error in model stg_new_businesses (models/staging/stg_new_businesses.sql)
  column reference "id" is ambiguous
  LINE 25:         id,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:57:13.894363 [info ] [MainThread]: 
[0m14:57:13.894546 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_new_businesses.sql
[0m14:57:13.894710 [info ] [MainThread]: 
[0m14:57:13.894897 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=0 NO-OP=0 TOTAL=5
[0m14:57:13.895205 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m14:57:13.897395 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.1306329, "process_in_blocks": "0", "process_kernel_time": 0.250301, "process_mem_max_rss": "135593984", "process_out_blocks": "0", "process_user_time": 1.545571}
[0m14:57:13.897689 [debug] [MainThread]: Command `dbt run` failed at 14:57:13.897646 after 1.13 seconds
[0m14:57:13.897903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103336830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ee4910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105de8670>]}
[0m14:57:13.898111 [debug] [MainThread]: Flushing usage events
[0m14:57:14.691544 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:00:48.267150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10707e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111140b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111140460>]}


============================== 15:00:48.270461 | 4e485388-0a67-4e97-8d2e-1e87883ecf75 ==============================
[0m15:00:48.270461 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:00:48.270849 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'quiet': 'False', 'target_path': 'None', 'static_parser': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'version_check': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'no_print': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'log_format': 'default', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '.', 'write_json': 'True', 'debug': 'False'}
[0m15:00:48.271178 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:00:48.271398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111089a20>]}
[0m15:00:48.505818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111226980>]}
[0m15:00:48.547965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111265270>]}
[0m15:00:48.548800 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:00:48.646095 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:00:48.723488 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m15:00:48.723965 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m15:00:48.724212 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m15:00:48.724431 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_new_businesses.sql
[0m15:00:48.724637 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m15:00:48.930694 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:00:48.939301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ba1030>]}
[0m15:00:48.984982 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:00:48.986391 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:00:48.998130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ba3c70>]}
[0m15:00:48.998456 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m15:00:48.998678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ba1660>]}
[0m15:00:48.999517 [info ] [MainThread]: 
[0m15:00:48.999731 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:00:48.999902 [info ] [MainThread]: 
[0m15:00:49.000190 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:00:49.002519 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:00:49.035613 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:00:49.035929 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:00:49.036106 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:49.177673 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.141 seconds
[0m15:00:49.178849 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:00:49.180243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:00:49.185134 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:00:49.185466 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:00:49.185691 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:49.201536 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m15:00:49.201896 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:00:49.202126 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:00:49.209601 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.007 seconds
[0m15:00:49.210522 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:00:49.211427 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:00:49.214811 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:49.215099 [debug] [MainThread]: On master: BEGIN
[0m15:00:49.215290 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:00:49.230897 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m15:00:49.231242 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:49.231513 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:00:49.247468 [debug] [MainThread]: SQL status: SELECT 0 in 0.016 seconds
[0m15:00:49.248494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ba04f0>]}
[0m15:00:49.248811 [debug] [MainThread]: On master: ROLLBACK
[0m15:00:49.249719 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:49.249900 [debug] [MainThread]: On master: BEGIN
[0m15:00:49.251027 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:00:49.251324 [debug] [MainThread]: On master: COMMIT
[0m15:00:49.251520 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:49.251687 [debug] [MainThread]: On master: COMMIT
[0m15:00:49.252392 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:00:49.252784 [debug] [MainThread]: On master: Close
[0m15:00:49.254896 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:00:49.255367 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m15:00:49.255719 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m15:00:49.255979 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:00:49.261665 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:00:49.262339 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:00:49.284971 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:00:49.285644 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:49.285958 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:00:49.286161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:49.298974 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m15:00:49.299320 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:49.299552 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:00:49.312109 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.012 seconds
[0m15:00:49.318370 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:49.318720 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m15:00:49.320057 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:00:49.321841 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:49.322102 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:00:49.323389 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:00:49.332475 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:00:49.332809 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:49.333028 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:00:49.334656 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m15:00:49.338265 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:00:49.340885 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:49.341148 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:00:49.349448 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m15:00:49.351128 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:00:49.352585 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130261d0>]}
[0m15:00:49.353112 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.10s]
[0m15:00:49.353475 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:00:49.354003 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:00:49.354270 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:00:49.354523 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:00:49.354719 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:00:49.355042 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:00:49.355451 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:00:49.355789 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:00:49.356174 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:00:49.356561 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:00:49.356866 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:00:49.357161 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:00:49.357390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m15:00:49.357620 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:00:49.357831 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:00:49.358031 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:00:49.358218 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:00:49.360419 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:00:49.363109 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:00:49.364882 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.366551 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.367123 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:00:49.367327 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:00:49.369987 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:00:49.372297 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:00:49.372553 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:00:49.373018 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:00:49.375217 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.375527 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:00:49.378146 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.378495 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:00:49.378743 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:00:49.379029 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.379249 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:00:49.379467 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:00:49.379744 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:00:49.379948 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.380155 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:00:49.380462 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:49.380657 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:00:49.381298 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:00:49.398614 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m15:00:49.399073 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:00:49.399350 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:00:49.402868 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m15:00:49.403215 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 35:         filemap.valid_from as valid_from,
                 ^

[0m15:00:49.403428 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m15:00:49.403714 [debug] [Thread-2 (]: SQL status: BEGIN in 0.023 seconds
[0m15:00:49.403994 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:00:49.404276 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: ROLLBACK
[0m15:00:49.404521 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.404728 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.404962 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:00:49.405327 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:00:49.405756 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:00:49.406174 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:00:49.407316 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 36:         filemap.valid_from as valid_from,
                 ^

[0m15:00:49.407616 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: ROLLBACK
[0m15:00:49.411094 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:00:49.411690 [debug] [Thread-3 (]: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:00:49.412322 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112aee260>]}
[0m15:00:49.412861 [error] [Thread-3 (]: 2 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_closed .. [[31mERROR[0m in 0.06s]
[0m15:00:49.413294 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:00:49.413777 [debug] [Thread-4 (]: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:00:49.414332 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131717e0>]}
[0m15:00:49.414643 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_closed' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql.
[0m15:00:49.415066 [error] [Thread-4 (]: 3 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_no_relief  [[31mERROR[0m in 0.06s]
[0m15:00:49.415792 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:00:49.416110 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_no_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql.
[0m15:00:49.416879 [debug] [Thread-2 (]: SQL status: SELECT 0 in 0.010 seconds
[0m15:00:49.419415 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.419701 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m15:00:49.421544 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:00:49.423982 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.424275 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:00:49.424842 [debug] [Thread-1 (]: SQL status: SELECT 1000 in 0.018 seconds
[0m15:00:49.426719 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.426938 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:00:49.427206 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:00:49.428445 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:00:49.428751 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:00:49.429058 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.431384 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.431687 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:00:49.432093 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:00:49.434774 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:00:49.435836 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:00:49.436067 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.436282 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m15:00:49.436484 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:00:49.438024 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:00:49.438522 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:00:49.438853 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:00:49.439197 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m15:00:49.440669 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:00:49.441122 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:00:49.441316 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:00:49.448990 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m15:00:49.449976 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:00:49.450407 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130e5e70>]}
[0m15:00:49.450820 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1000[0m in 0.09s]
[0m15:00:49.451261 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:00:49.457088 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.018 seconds
[0m15:00:49.458181 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:00:49.458592 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e485388-0a67-4e97-8d2e-1e87883ecf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131a9db0>]}
[0m15:00:49.459066 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 0[0m in 0.10s]
[0m15:00:49.459578 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:00:49.460385 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:49.460646 [debug] [MainThread]: On master: BEGIN
[0m15:00:49.460815 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:00:49.473119 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m15:00:49.473537 [debug] [MainThread]: On master: COMMIT
[0m15:00:49.473712 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:49.473887 [debug] [MainThread]: On master: COMMIT
[0m15:00:49.474811 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:00:49.475151 [debug] [MainThread]: On master: Close
[0m15:00:49.475428 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:49.475598 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:00:49.475753 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:00:49.475893 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m15:00:49.476033 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:00:49.476246 [info ] [MainThread]: 
[0m15:00:49.476429 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.48 seconds (0.48s).
[0m15:00:49.477071 [debug] [MainThread]: Command end result
[0m15:00:49.490129 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:00:49.491164 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:00:49.495031 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:00:49.495350 [info ] [MainThread]: 
[0m15:00:49.495630 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:00:49.495828 [info ] [MainThread]: 
[0m15:00:49.496046 [error] [MainThread]: [31mFailure in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)[0m
[0m15:00:49.496273 [error] [MainThread]:   Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:00:49.496446 [info ] [MainThread]: 
[0m15:00:49.496636 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:00:49.496802 [info ] [MainThread]: 
[0m15:00:49.496999 [error] [MainThread]: [31mFailure in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)[0m
[0m15:00:49.497197 [error] [MainThread]:   Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:00:49.497355 [info ] [MainThread]: 
[0m15:00:49.497577 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:00:49.497859 [info ] [MainThread]: 
[0m15:00:49.498065 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=5
[0m15:00:49.498384 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:00:49.500799 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2873546, "process_in_blocks": "0", "process_kernel_time": 0.256374, "process_mem_max_rss": "134873088", "process_out_blocks": "0", "process_user_time": 1.555769}
[0m15:00:49.501207 [debug] [MainThread]: Command `dbt run` failed at 15:00:49.501146 after 1.29 seconds
[0m15:00:49.501539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10707e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10566acb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116d97b0>]}
[0m15:00:49.501788 [debug] [MainThread]: Flushing usage events
[0m15:00:50.141666 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:28.223699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107816890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e9cbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e9c4c0>]}


============================== 15:02:28.226512 | f9cf6c10-7dee-43cf-8dff-6b77a690bfcb ==============================
[0m15:02:28.226512 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:02:28.226853 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'write_json': 'True', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'quiet': 'False', 'partial_parse': 'True', 'printer_width': '80', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'empty': 'False', 'warn_error': 'None', 'debug': 'False', 'log_format': 'default', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'indirect_selection': 'eager', 'log_cache_events': 'False'}
[0m15:02:28.227148 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:02:28.227376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de1510>]}
[0m15:02:28.397367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e54ee0>]}
[0m15:02:28.439426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbe1d0>]}
[0m15:02:28.440221 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:02:28.510551 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:02:28.590549 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m15:02:28.590965 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m15:02:28.591191 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m15:02:28.591394 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m15:02:28.591595 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_new_businesses.sql
[0m15:02:28.795474 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:02:28.803464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ea5000>]}
[0m15:02:28.848957 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:02:28.850401 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:02:28.862631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ea5a20>]}
[0m15:02:28.862987 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m15:02:28.863199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ea5840>]}
[0m15:02:28.864031 [info ] [MainThread]: 
[0m15:02:28.864234 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:02:28.864398 [info ] [MainThread]: 
[0m15:02:28.864697 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:02:28.867073 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:02:28.900994 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:02:28.901308 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:02:28.901480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:28.957083 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.056 seconds
[0m15:02:28.957973 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:02:28.958798 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:02:28.962472 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:02:28.962752 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:02:28.962928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:28.974035 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m15:02:28.974326 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:02:28.974539 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:02:28.983781 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.009 seconds
[0m15:02:28.984683 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:02:28.985582 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:02:28.989051 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:28.989355 [debug] [MainThread]: On master: BEGIN
[0m15:02:28.989537 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:29.001432 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m15:02:29.001706 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:29.001954 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:02:29.012881 [debug] [MainThread]: SQL status: SELECT 0 in 0.011 seconds
[0m15:02:29.013717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072a2da0>]}
[0m15:02:29.014041 [debug] [MainThread]: On master: ROLLBACK
[0m15:02:29.014834 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:29.015042 [debug] [MainThread]: On master: BEGIN
[0m15:02:29.016320 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:02:29.016520 [debug] [MainThread]: On master: COMMIT
[0m15:02:29.016710 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:29.016889 [debug] [MainThread]: On master: COMMIT
[0m15:02:29.017733 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:02:29.017934 [debug] [MainThread]: On master: Close
[0m15:02:29.019697 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:02:29.020043 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m15:02:29.020337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m15:02:29.020566 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:02:29.026112 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:02:29.026671 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:02:29.049178 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:02:29.049787 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:29.050121 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:02:29.050329 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:29.061671 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m15:02:29.061965 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:29.062251 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:02:29.072790 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.010 seconds
[0m15:02:29.078951 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:29.079252 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m15:02:29.080741 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:29.082727 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:29.082958 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:02:29.083981 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:29.092768 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:02:29.093037 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:29.093240 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:02:29.094604 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m15:02:29.097907 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:02:29.100131 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:29.100353 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:02:29.105163 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m15:02:29.106684 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:02:29.107932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3261d0>]}
[0m15:02:29.108330 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.09s]
[0m15:02:29.108657 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:02:29.109118 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:02:29.109342 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:29.109596 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:02:29.109797 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:02:29.110054 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:02:29.110355 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:02:29.110683 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:02:29.110961 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:02:29.111270 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:02:29.111528 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:02:29.111805 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:02:29.112112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m15:02:29.112385 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:02:29.112600 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:29.112785 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:02:29.112967 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:02:29.114925 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:29.117788 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:29.119686 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.121343 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.121937 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:02:29.122222 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:29.122703 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:02:29.122964 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:02:29.125276 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:29.127773 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:29.129800 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.132725 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.133349 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:29.133591 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:29.133805 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.134093 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:02:29.134385 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:02:29.134617 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.134837 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:02:29.135037 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:02:29.135233 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:02:29.135429 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:02:29.135626 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:02:29.135997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:29.154486 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m15:02:29.154935 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:29.155268 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:29.156219 [debug] [Thread-2 (]: SQL status: BEGIN in 0.021 seconds
[0m15:02:29.156576 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.156842 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:29.157159 [debug] [Thread-4 (]: SQL status: BEGIN in 0.022 seconds
[0m15:02:29.157481 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 35:         filemap.valid_from as valid_from,
                 ^

[0m15:02:29.157734 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m15:02:29.157970 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:29.158184 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: ROLLBACK
[0m15:02:29.158383 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.158614 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:29.158989 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:29.161146 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:02:29.161404 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 36:         filemap.valid_from as valid_from,
                 ^

[0m15:02:29.161910 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: ROLLBACK
[0m15:02:29.162811 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:02:29.167142 [debug] [Thread-3 (]: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:02:29.167706 [debug] [Thread-4 (]: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:02:29.168160 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e65c30>]}
[0m15:02:29.168486 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4718d0>]}
[0m15:02:29.168982 [error] [Thread-3 (]: 2 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_closed .. [[31mERROR[0m in 0.06s]
[0m15:02:29.169468 [error] [Thread-4 (]: 3 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_no_relief  [[31mERROR[0m in 0.06s]
[0m15:02:29.169877 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:02:29.170274 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:29.170613 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_closed' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql.
[0m15:02:29.171294 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_no_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql.
[0m15:02:29.176101 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.017 seconds
[0m15:02:29.178855 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.179150 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:02:29.180558 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:29.182657 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.182908 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:02:29.184938 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:29.185994 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:02:29.186221 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.186408 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:02:29.189901 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:29.191726 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:02:29.192225 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:29.192431 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:02:29.198296 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m15:02:29.199222 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:02:29.199624 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3e68f0>]}
[0m15:02:29.200010 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.09s]
[0m15:02:29.200336 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:02:29.280505 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.123 seconds
[0m15:02:29.283293 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.283676 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m15:02:29.285004 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:29.286912 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.287150 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:02:29.288079 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:29.288999 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:02:29.289217 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.289398 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:02:29.291842 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m15:02:29.293476 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:02:29.293918 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:29.294115 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:02:29.297030 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.003 seconds
[0m15:02:29.297927 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:02:29.298307 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9cf6c10-7dee-43cf-8dff-6b77a690bfcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3e6f50>]}
[0m15:02:29.298712 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.19s]
[0m15:02:29.299054 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:02:29.299768 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:29.299957 [debug] [MainThread]: On master: BEGIN
[0m15:02:29.300118 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:29.311666 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m15:02:29.312013 [debug] [MainThread]: On master: COMMIT
[0m15:02:29.312211 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:29.312389 [debug] [MainThread]: On master: COMMIT
[0m15:02:29.313104 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:02:29.313341 [debug] [MainThread]: On master: Close
[0m15:02:29.313622 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:29.313799 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:02:29.314106 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:02:29.314332 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m15:02:29.314486 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:02:29.314728 [info ] [MainThread]: 
[0m15:02:29.314914 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.45 seconds (0.45s).
[0m15:02:29.315542 [debug] [MainThread]: Command end result
[0m15:02:29.329333 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:02:29.330438 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:02:29.335215 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:02:29.335481 [info ] [MainThread]: 
[0m15:02:29.335705 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:02:29.335892 [info ] [MainThread]: 
[0m15:02:29.336110 [error] [MainThread]: [31mFailure in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)[0m
[0m15:02:29.336323 [error] [MainThread]:   Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:02:29.336487 [info ] [MainThread]: 
[0m15:02:29.336680 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:02:29.336844 [info ] [MainThread]: 
[0m15:02:29.337037 [error] [MainThread]: [31mFailure in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)[0m
[0m15:02:29.337251 [error] [MainThread]:   Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:02:29.337417 [info ] [MainThread]: 
[0m15:02:29.337604 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:02:29.337764 [info ] [MainThread]: 
[0m15:02:29.337954 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=5
[0m15:02:29.338272 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:02:29.340964 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.1659591, "process_in_blocks": "0", "process_kernel_time": 0.223497, "process_mem_max_rss": "136232960", "process_out_blocks": "0", "process_user_time": 1.474022}
[0m15:02:29.341425 [debug] [MainThread]: Command `dbt run` failed at 15:02:29.341369 after 1.17 seconds
[0m15:02:29.341679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107816890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ad2650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a756320>]}
[0m15:02:29.341908 [debug] [MainThread]: Flushing usage events
[0m15:02:29.964941 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:03:57.346086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10522e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068b0c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068b04f0>]}


============================== 15:03:57.349134 | e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df ==============================
[0m15:03:57.349134 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:03:57.349498 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'fail_fast': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'version_check': 'True', 'log_format': 'default', 'printer_width': '80', 'partial_parse': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'cache_selected_only': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'quiet': 'False', 'use_colors': 'True', 'target_path': 'None', 'debug': 'False', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'no_print': 'None'}
[0m15:03:57.349799 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:03:57.350018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067fad40>]}
[0m15:03:57.516687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106996aa0>]}
[0m15:03:57.559203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069d4880>]}
[0m15:03:57.560036 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:03:57.627545 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:03:57.704183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:03:57.704600 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m15:03:57.893524 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:03:57.901430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210b1cc0>]}
[0m15:03:57.948070 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:03:57.949566 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:03:57.961253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10461eb30>]}
[0m15:03:57.961658 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m15:03:57.961870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d0a8f0>]}
[0m15:03:57.962720 [info ] [MainThread]: 
[0m15:03:57.962925 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:03:57.963081 [info ] [MainThread]: 
[0m15:03:57.963346 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:03:57.965707 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:03:57.999194 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:03:57.999521 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:03:57.999700 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:58.051039 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.051 seconds
[0m15:03:58.051968 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:03:58.052868 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:03:58.056707 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:03:58.056976 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:03:58.057151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:03:58.068575 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m15:03:58.068879 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:03:58.069110 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:03:58.078960 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.010 seconds
[0m15:03:58.079756 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:03:58.080559 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:03:58.083972 [debug] [MainThread]: Using postgres connection "master"
[0m15:03:58.084233 [debug] [MainThread]: On master: BEGIN
[0m15:03:58.084409 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:03:58.096674 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m15:03:58.096998 [debug] [MainThread]: Using postgres connection "master"
[0m15:03:58.097275 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:03:58.105943 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m15:03:58.106809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210b1ff0>]}
[0m15:03:58.107159 [debug] [MainThread]: On master: ROLLBACK
[0m15:03:58.107919 [debug] [MainThread]: Using postgres connection "master"
[0m15:03:58.108122 [debug] [MainThread]: On master: BEGIN
[0m15:03:58.109383 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:03:58.109626 [debug] [MainThread]: On master: COMMIT
[0m15:03:58.109828 [debug] [MainThread]: Using postgres connection "master"
[0m15:03:58.110012 [debug] [MainThread]: On master: COMMIT
[0m15:03:58.110696 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:03:58.110904 [debug] [MainThread]: On master: Close
[0m15:03:58.113427 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:03:58.113775 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m15:03:58.114068 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m15:03:58.114299 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:03:58.119811 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:03:58.120532 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:03:58.142367 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:03:58.143071 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:03:58.143337 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:03:58.143530 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:58.154920 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m15:03:58.155196 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:03:58.155423 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:03:58.163704 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.008 seconds
[0m15:03:58.169776 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:03:58.170087 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m15:03:58.171217 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:03:58.173151 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:03:58.173401 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:03:58.174278 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:03:58.182980 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:03:58.183278 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:03:58.183483 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:03:58.184888 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m15:03:58.188424 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:03:58.190724 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:03:58.190982 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:03:58.195950 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m15:03:58.197462 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:03:58.198727 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121541b40>]}
[0m15:03:58.199129 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.08s]
[0m15:03:58.199521 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:03:58.200018 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:03:58.200244 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:03:58.200484 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:03:58.200699 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:03:58.200956 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:03:58.201287 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:03:58.201673 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:03:58.202079 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:03:58.202439 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:03:58.202724 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:03:58.203012 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:03:58.203281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m15:03:58.203524 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:03:58.203736 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:03:58.203933 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:03:58.204127 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:03:58.206233 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:03:58.208809 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:03:58.210557 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.212198 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.213078 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:03:58.213387 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:03:58.215506 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:03:58.215768 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:03:58.218124 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.218367 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:03:58.220547 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:03:58.223334 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.223585 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:03:58.223978 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.224296 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:03:58.224513 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:03:58.224778 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.224978 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:03:58.225189 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:03:58.225409 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:03:58.225622 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:03:58.225821 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:03:58.226022 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:03:58.226299 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:58.242067 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m15:03:58.242409 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:03:58.242793 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:03:58.244566 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 35:         filemap.valid_from as valid_from,
                 ^

[0m15:03:58.244912 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: ROLLBACK
[0m15:03:58.245197 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m15:03:58.245628 [debug] [Thread-2 (]: SQL status: BEGIN in 0.020 seconds
[0m15:03:58.245947 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:03:58.246209 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m15:03:58.246499 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:03:58.246687 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.246979 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:03:58.247267 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.247765 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:03:58.248226 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:03:58.248968 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "filemap"
LINE 36:         filemap.valid_from as valid_from,
                 ^

[0m15:03:58.249431 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: ROLLBACK
[0m15:03:58.250272 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:03:58.254908 [debug] [Thread-4 (]: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:03:58.255372 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121107d60>]}
[0m15:03:58.255820 [debug] [Thread-3 (]: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:03:58.256261 [error] [Thread-4 (]: 3 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_no_relief  [[31mERROR[0m in 0.05s]
[0m15:03:58.256688 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1216a2440>]}
[0m15:03:58.257114 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:03:58.257496 [error] [Thread-3 (]: 2 of 5 ERROR creating sql table model analytics_analytics.stg_accounts_closed .. [[31mERROR[0m in 0.05s]
[0m15:03:58.257956 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_no_relief' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql.
[0m15:03:58.258358 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:03:58.259072 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_accounts_closed' to be skipped because of status 'error'.  Reason: Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql.
[0m15:03:58.266012 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.017 seconds
[0m15:03:58.268528 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.268778 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:03:58.270424 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:03:58.272334 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.272566 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:03:58.273731 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:03:58.274726 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:03:58.274944 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.275241 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:03:58.281316 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m15:03:58.282959 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:03:58.283423 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:03:58.283626 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:03:58.289202 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m15:03:58.290207 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:03:58.290788 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121107a60>]}
[0m15:03:58.291201 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.09s]
[0m15:03:58.291535 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:03:58.356369 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.107 seconds
[0m15:03:58.358553 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.358775 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m15:03:58.359953 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:03:58.361633 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.361877 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:03:58.363134 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:03:58.364177 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:03:58.364408 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.364626 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:03:58.375563 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m15:03:58.377241 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:03:58.377711 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:03:58.377990 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:03:58.387583 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m15:03:58.388593 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:03:58.388995 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0d2df85-f10b-4bdf-9ecd-5d7e1d9ec7df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121690340>]}
[0m15:03:58.389396 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.19s]
[0m15:03:58.389724 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:03:58.390503 [debug] [MainThread]: Using postgres connection "master"
[0m15:03:58.390691 [debug] [MainThread]: On master: BEGIN
[0m15:03:58.390845 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:03:58.403141 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m15:03:58.403497 [debug] [MainThread]: On master: COMMIT
[0m15:03:58.403683 [debug] [MainThread]: Using postgres connection "master"
[0m15:03:58.403908 [debug] [MainThread]: On master: COMMIT
[0m15:03:58.404752 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:03:58.404935 [debug] [MainThread]: On master: Close
[0m15:03:58.405193 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:03:58.405356 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:03:58.405502 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:03:58.405638 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m15:03:58.405779 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:03:58.405991 [info ] [MainThread]: 
[0m15:03:58.406173 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m15:03:58.406780 [debug] [MainThread]: Command end result
[0m15:03:58.420218 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:03:58.421367 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:03:58.425265 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:03:58.425475 [info ] [MainThread]: 
[0m15:03:58.425702 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:03:58.425902 [info ] [MainThread]: 
[0m15:03:58.426123 [error] [MainThread]: [31mFailure in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)[0m
[0m15:03:58.426339 [error] [MainThread]:   Database Error in model stg_accounts_no_relief (models/staging/stg_accounts_no_relief.sql)
  syntax error at or near "filemap"
  LINE 36:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:03:58.426505 [info ] [MainThread]: 
[0m15:03:58.426698 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_no_relief.sql
[0m15:03:58.426866 [info ] [MainThread]: 
[0m15:03:58.427067 [error] [MainThread]: [31mFailure in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)[0m
[0m15:03:58.427270 [error] [MainThread]:   Database Error in model stg_accounts_closed (models/staging/stg_accounts_closed.sql)
  syntax error at or near "filemap"
  LINE 35:         filemap.valid_from as valid_from,
                   ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:03:58.427432 [info ] [MainThread]: 
[0m15:03:58.427621 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_accounts_closed.sql
[0m15:03:58.427782 [info ] [MainThread]: 
[0m15:03:58.427958 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=5
[0m15:03:58.428263 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:03:58.430437 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.1361108, "process_in_blocks": "0", "process_kernel_time": 0.226222, "process_mem_max_rss": "136445952", "process_out_blocks": "0", "process_user_time": 1.462267}
[0m15:03:58.430858 [debug] [MainThread]: Command `dbt run` failed at 15:03:58.430798 after 1.14 seconds
[0m15:03:58.431137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10522e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120b5a9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553e560>]}
[0m15:03:58.431426 [debug] [MainThread]: Flushing usage events
[0m15:03:58.955988 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:04:39.049813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10767e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3c0b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3c0460>]}


============================== 15:04:39.052727 | 2a8a7f5c-637c-4325-8c01-2e1e15f7e585 ==============================
[0m15:04:39.052727 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:04:39.053084 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'empty': 'False', 'introspect': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'partial_parse': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'profiles_dir': '.', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'warn_error': 'None', 'quiet': 'False', 'write_json': 'True', 'printer_width': '80', 'debug': 'False'}
[0m15:04:39.053373 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:04:39.053596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a30d660>]}
[0m15:04:39.223836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a4ae980>]}
[0m15:04:39.267843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a4e5270>]}
[0m15:04:39.268743 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:04:39.335735 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:04:39.408301 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:04:39.408708 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m15:04:39.408936 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m15:04:39.605055 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:04:39.613089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bca5c60>]}
[0m15:04:39.657084 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:04:39.658820 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:04:39.670525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bca4700>]}
[0m15:04:39.670856 [info ] [MainThread]: Found 5 models, 5 sources, 434 macros
[0m15:04:39.671064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067b6440>]}
[0m15:04:39.671886 [info ] [MainThread]: 
[0m15:04:39.672097 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:04:39.672267 [info ] [MainThread]: 
[0m15:04:39.672553 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:04:39.674894 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:04:39.709795 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:04:39.710124 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:04:39.710294 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:39.759825 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.049 seconds
[0m15:04:39.760806 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:04:39.761674 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:04:39.765449 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:04:39.765752 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:04:39.765925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:04:39.777421 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m15:04:39.777726 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:04:39.777939 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:04:39.785465 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.007 seconds
[0m15:04:39.786353 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:04:39.787227 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:04:39.790525 [debug] [MainThread]: Using postgres connection "master"
[0m15:04:39.790804 [debug] [MainThread]: On master: BEGIN
[0m15:04:39.790989 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:04:39.803550 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m15:04:39.803854 [debug] [MainThread]: Using postgres connection "master"
[0m15:04:39.804115 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:04:39.813201 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m15:04:39.813979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bca4700>]}
[0m15:04:39.814309 [debug] [MainThread]: On master: ROLLBACK
[0m15:04:39.815310 [debug] [MainThread]: Using postgres connection "master"
[0m15:04:39.815576 [debug] [MainThread]: On master: BEGIN
[0m15:04:39.816953 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:04:39.817170 [debug] [MainThread]: On master: COMMIT
[0m15:04:39.817363 [debug] [MainThread]: Using postgres connection "master"
[0m15:04:39.817549 [debug] [MainThread]: On master: COMMIT
[0m15:04:39.818291 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:04:39.818495 [debug] [MainThread]: On master: Close
[0m15:04:39.820475 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:04:39.820866 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m15:04:39.821182 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m15:04:39.821431 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:04:39.827094 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:04:39.827951 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:04:39.850350 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:04:39.850941 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:04:39.851159 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:04:39.851344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:04:39.862847 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m15:04:39.863192 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:04:39.863428 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:04:39.872538 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.009 seconds
[0m15:04:39.878143 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:04:39.878412 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m15:04:39.879870 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:39.881539 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:04:39.881762 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:04:39.882727 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:39.891682 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:04:39.892044 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:04:39.892260 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:04:39.893557 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m15:04:39.897163 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:04:39.899495 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:04:39.899728 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:04:39.903441 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m15:04:39.904919 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:04:39.906178 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ca31b40>]}
[0m15:04:39.906628 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.08s]
[0m15:04:39.907063 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:04:39.907552 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:04:39.907821 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:04:39.908033 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:04:39.908267 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:04:39.908571 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:04:39.908877 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:04:39.909250 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:04:39.909542 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:04:39.909899 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:04:39.910169 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:04:39.910443 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:04:39.910667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m15:04:39.910885 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:04:39.911091 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:04:39.911311 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:04:39.911531 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:04:39.914552 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.917031 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:39.918949 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:39.920656 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.921252 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:04:39.921644 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:04:39.924203 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.924521 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:04:39.924705 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:04:39.926783 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:39.928946 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:39.931989 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.932378 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.932815 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:39.933128 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:39.933356 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:04:39.933579 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.933809 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:04:39.934027 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:04:39.934239 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:04:39.934436 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:04:39.934622 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:04:39.934818 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:04:39.935091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:04:39.951975 [debug] [Thread-4 (]: SQL status: BEGIN in 0.017 seconds
[0m15:04:39.952359 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:39.952876 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:04:39.953193 [debug] [Thread-2 (]: SQL status: BEGIN in 0.018 seconds
[0m15:04:39.953566 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:39.953920 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:04:39.954259 [debug] [Thread-3 (]: SQL status: BEGIN in 0.020 seconds
[0m15:04:39.954485 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.954857 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:04:39.955119 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m15:04:39.955417 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.955665 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:04:39.972109 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.016 seconds
[0m15:04:39.974484 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.974729 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.019 seconds
[0m15:04:39.974956 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:04:39.976828 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.977187 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m15:04:39.978133 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:39.978330 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:39.980055 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.981879 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.982153 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:04:39.982413 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m15:04:39.983666 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:39.983962 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:39.984902 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:04:39.985985 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:04:39.986276 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:39.986505 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:04:39.986771 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:04:39.987004 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:04:39.996841 [debug] [Thread-3 (]: SQL status: COMMIT in 0.010 seconds
[0m15:04:39.997128 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m15:04:39.998804 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m15:04:40.001258 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:04:40.001898 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:04:40.002477 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:04:40.002750 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m15:04:40.002981 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:04:40.009978 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m15:04:40.010938 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:04:40.011346 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11caf7010>]}
[0m15:04:40.011652 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.008 seconds
[0m15:04:40.012112 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m15:04:40.013005 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:04:40.013378 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:04:40.013827 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cbf4700>]}
[0m15:04:40.014232 [info ] [Thread-3 (]: 2 of 5 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.10s]
[0m15:04:40.014542 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:04:40.070359 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.116 seconds
[0m15:04:40.072656 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:40.072945 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m15:04:40.079970 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m15:04:40.082074 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:40.082312 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.129 seconds
[0m15:04:40.082600 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:04:40.084560 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:40.084917 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m15:04:40.085832 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:40.086811 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:04:40.087041 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:04:40.087261 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:40.088896 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:40.089126 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:04:40.089342 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m15:04:40.090261 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:04:40.091076 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:04:40.091283 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:40.091462 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:04:40.093927 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m15:04:40.094228 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m15:04:40.095744 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:04:40.097100 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m15:04:40.097561 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:04:40.097969 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:04:40.098179 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:04:40.098394 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m15:04:40.104724 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m15:04:40.105652 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:04:40.106119 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb429b0>]}
[0m15:04:40.106583 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.20s]
[0m15:04:40.106921 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:04:40.110094 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m15:04:40.110902 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:04:40.111243 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a8a7f5c-637c-4325-8c01-2e1e15f7e585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb919c0>]}
[0m15:04:40.111595 [info ] [Thread-4 (]: 3 of 5 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.20s]
[0m15:04:40.111955 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:04:40.112864 [debug] [MainThread]: Using postgres connection "master"
[0m15:04:40.113121 [debug] [MainThread]: On master: BEGIN
[0m15:04:40.113300 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:04:40.125946 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m15:04:40.126254 [debug] [MainThread]: On master: COMMIT
[0m15:04:40.126428 [debug] [MainThread]: Using postgres connection "master"
[0m15:04:40.126585 [debug] [MainThread]: On master: COMMIT
[0m15:04:40.127265 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:04:40.127574 [debug] [MainThread]: On master: Close
[0m15:04:40.127852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:04:40.128024 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:04:40.128175 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:04:40.128319 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m15:04:40.128458 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:04:40.128669 [info ] [MainThread]: 
[0m15:04:40.128851 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m15:04:40.129458 [debug] [MainThread]: Command end result
[0m15:04:40.142344 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:04:40.143489 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:04:40.147758 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:04:40.148079 [info ] [MainThread]: 
[0m15:04:40.148326 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:04:40.148512 [info ] [MainThread]: 
[0m15:04:40.148702 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m15:04:40.149105 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:04:40.151555 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1504455, "process_in_blocks": "0", "process_kernel_time": 0.221344, "process_mem_max_rss": "136855552", "process_out_blocks": "0", "process_user_time": 1.473321}
[0m15:04:40.151935 [debug] [MainThread]: Command `dbt run` succeeded at 15:04:40.151882 after 1.15 seconds
[0m15:04:40.152176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10767e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bbb3580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11baec490>]}
[0m15:04:40.152476 [debug] [MainThread]: Flushing usage events
[0m15:04:40.722198 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:49:50.502399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030fa8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10477cd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10477c610>]}


============================== 16:49:50.505448 | ba648db3-5eb1-4186-ba2c-c26178716902 ==============================
[0m16:49:50.505448 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:49:50.505977 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'fail_fast': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'static_parser': 'True', 'printer_width': '80', 'version_check': 'True', 'profiles_dir': '.', 'no_print': 'None', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'introspect': 'True', 'quiet': 'False', 'write_json': 'True', 'debug': 'False', 'warn_error': 'None', 'log_cache_events': 'False'}
[0m16:49:50.506355 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:49:50.506588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046c6740>]}
[0m16:49:50.677039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104860910>]}
[0m16:49:50.719214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104750b80>]}
[0m16:49:50.719991 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:49:50.786256 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:49:50.859872 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m16:49:50.860227 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/properties.sql
[0m16:49:50.860429 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/businesses.sql
[0m16:49:51.049611 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:49:51.058089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063b2830>]}
[0m16:49:51.104884 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:49:51.106597 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:49:51.120156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10636a440>]}
[0m16:49:51.120530 [info ] [MainThread]: Found 7 models, 5 sources, 434 macros
[0m16:49:51.120738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10636a590>]}
[0m16:49:51.121673 [info ] [MainThread]: 
[0m16:49:51.121884 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:49:51.122060 [info ] [MainThread]: 
[0m16:49:51.122340 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:49:51.124973 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:49:51.158730 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:49:51.159064 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:49:51.159238 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:49:51.217392 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.058 seconds
[0m16:49:51.218350 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:49:51.219439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:49:51.223336 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:49:51.223579 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:49:51.223759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:49:51.234553 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m16:49:51.234885 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:49:51.235101 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:49:51.244114 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.009 seconds
[0m16:49:51.245262 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:49:51.246150 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:49:51.249885 [debug] [MainThread]: Using postgres connection "master"
[0m16:49:51.250169 [debug] [MainThread]: On master: BEGIN
[0m16:49:51.250347 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:49:51.262509 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m16:49:51.262831 [debug] [MainThread]: Using postgres connection "master"
[0m16:49:51.263094 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:49:51.271594 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m16:49:51.272425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065095d0>]}
[0m16:49:51.272763 [debug] [MainThread]: On master: ROLLBACK
[0m16:49:51.273590 [debug] [MainThread]: Using postgres connection "master"
[0m16:49:51.273797 [debug] [MainThread]: On master: BEGIN
[0m16:49:51.275139 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:49:51.275347 [debug] [MainThread]: On master: COMMIT
[0m16:49:51.275538 [debug] [MainThread]: Using postgres connection "master"
[0m16:49:51.275723 [debug] [MainThread]: On master: COMMIT
[0m16:49:51.276490 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:49:51.276687 [debug] [MainThread]: On master: Close
[0m16:49:51.279227 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:49:51.279601 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:49:51.279915 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:49:51.280155 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:49:51.285707 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:49:51.286516 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:49:51.309324 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:49:51.309983 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:49:51.310200 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:49:51.310385 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:49:51.321623 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m16:49:51.321979 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:49:51.322228 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:49:51.335814 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.013 seconds
[0m16:49:51.342132 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:49:51.342409 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:49:51.344022 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.346081 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:49:51.346318 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:49:51.347341 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.356792 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:49:51.357112 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:49:51.357423 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:49:51.359379 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:49:51.362916 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:49:51.365170 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:49:51.365404 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:49:51.371225 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:49:51.372949 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:49:51.374223 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107131ba0>]}
[0m16:49:51.374638 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.09s]
[0m16:49:51.375100 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:49:51.375674 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:49:51.376023 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:49:51.376293 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:49:51.376507 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:49:51.376715 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:49:51.377082 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:49:51.377501 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:49:51.377896 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:49:51.378216 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:49:51.378459 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:49:51.378763 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:49:51.379110 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:49:51.379348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:49:51.382344 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.382590 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:49:51.382849 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:49:51.383102 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:49:51.385245 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.387433 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.389506 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.389819 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:49:51.392334 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.392623 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:49:51.394962 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.395185 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:49:51.395376 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:49:51.395671 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.398518 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.400942 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.401227 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.401509 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:49:51.401843 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:49:51.402133 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:49:51.402366 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.402628 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.402823 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:49:51.403136 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:49:51.403347 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:49:51.403693 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:49:51.404005 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:49:51.416380 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m16:49:51.416714 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.416937 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m16:49:51.417210 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:49:51.417465 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.417836 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:49:51.419574 [debug] [Thread-4 (]: SQL status: BEGIN in 0.017 seconds
[0m16:49:51.419882 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.420189 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:49:51.420499 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m16:49:51.420755 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.420996 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:49:51.444975 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.027 seconds
[0m16:49:51.447335 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.447660 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.026 seconds
[0m16:49:51.447971 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:49:51.450411 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.450800 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:49:51.451955 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.452268 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.454229 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.456050 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.456302 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:49:51.456548 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:49:51.458089 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.458365 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:49:51.459722 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:49:51.460663 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:49:51.460910 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.461126 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.461330 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:49:51.461526 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:49:51.474856 [debug] [Thread-3 (]: SQL status: COMMIT in 0.013 seconds
[0m16:49:51.475190 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m16:49:51.477042 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:49:51.480031 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:49:51.480675 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:49:51.481168 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:49:51.481397 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:49:51.481648 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:49:51.492481 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m16:49:51.493481 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:49:51.493895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072fa830>]}
[0m16:49:51.494311 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.11s]
[0m16:49:51.494643 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:49:51.495080 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.013 seconds
[0m16:49:51.495822 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:49:51.496162 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107131ea0>]}
[0m16:49:51.496520 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.12s]
[0m16:49:51.496840 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:49:51.564689 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.147 seconds
[0m16:49:51.565042 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.144 seconds
[0m16:49:51.567199 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.568991 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.569221 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:49:51.569454 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:49:51.570687 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.572466 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.572688 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:49:51.572888 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:49:51.574464 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.574734 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:49:51.575512 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:49:51.576416 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:49:51.576626 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.576807 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:49:51.577021 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:49:51.577954 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:49:51.578176 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.578370 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:49:51.605187 [debug] [Thread-2 (]: SQL status: COMMIT in 0.028 seconds
[0m16:49:51.605562 [debug] [Thread-4 (]: SQL status: COMMIT in 0.027 seconds
[0m16:49:51.607415 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:49:51.609120 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:49:51.609749 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:49:51.610251 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:49:51.610475 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:49:51.610716 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:49:51.624357 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.013 seconds
[0m16:49:51.624704 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:49:51.625694 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:49:51.626375 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:49:51.626855 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107254e50>]}
[0m16:49:51.627330 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071f8820>]}
[0m16:49:51.627809 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.25s]
[0m16:49:51.628332 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.25s]
[0m16:49:51.628770 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:49:51.629089 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:49:51.629683 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.businesses
[0m16:49:51.629902 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m16:49:51.630246 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:49:51.630633 [info ] [Thread-3 (]: 7 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:49:51.631126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.businesses)
[0m16:49:51.631445 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.properties)
[0m16:49:51.631752 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:49:51.632053 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m16:49:51.635772 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:49:51.637847 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:49:51.638594 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m16:49:51.641146 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:49:51.641464 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.businesses
[0m16:49:51.643720 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:49:51.644371 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:49:51.644716 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:49:51.644942 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:49:51.645163 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:49:51.645369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:49:51.645557 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:49:51.659003 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m16:49:51.659356 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:49:51.659595 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address from "highstreet"."analytics_analytics"."stg_accounts_closed"

)

select distinct property_id, property_address from (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)
  );
  
[0m16:49:51.660127 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m16:49:51.660370 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:49:51.660613 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

)

select distinct business_name from (

    select * from businesses_new
    union 
    select * from businesses_accounts_closed
    union 
    select * from businesses_accounts_no_relief
    union 
    select * from businesses_accounts_relief

)
  );
  
[0m16:49:51.660945 [debug] [Thread-3 (]: Postgres adapter: Postgres error: subquery in FROM must have an alias
LINE 34: select distinct property_id, property_address from (
                                                            ^
HINT:  For example, FROM (SELECT ...) [AS] foo.

[0m16:49:51.661298 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: ROLLBACK
[0m16:49:51.661740 [debug] [Thread-1 (]: Postgres adapter: Postgres error: subquery in FROM must have an alias
LINE 34: select distinct business_name from (
                                            ^
HINT:  For example, FROM (SELECT ...) [AS] foo.

[0m16:49:51.661992 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: ROLLBACK
[0m16:49:51.662431 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: Close
[0m16:49:51.662991 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: Close
[0m16:49:51.667673 [debug] [Thread-1 (]: Database Error in model businesses (models/int/businesses.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct business_name from (
                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/businesses.sql
[0m16:49:51.668168 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107076890>]}
[0m16:49:51.669038 [debug] [Thread-3 (]: Database Error in model properties (models/int/properties.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct property_id, property_address from (
                                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:49:51.668603 [error] [Thread-1 (]: 6 of 7 ERROR creating sql table model analytics_analytics.businesses ........... [[31mERROR[0m in 0.04s]
[0m16:49:51.669425 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba648db3-5eb1-4186-ba2c-c26178716902', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107535810>]}
[0m16:49:51.669751 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.businesses
[0m16:49:51.670087 [error] [Thread-3 (]: 7 of 7 ERROR creating sql table model analytics_analytics.properties ........... [[31mERROR[0m in 0.04s]
[0m16:49:51.670456 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.businesses' to be skipped because of status 'error'.  Reason: Database Error in model businesses (models/int/businesses.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct business_name from (
                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/businesses.sql.
[0m16:49:51.670779 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m16:49:51.671445 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.properties' to be skipped because of status 'error'.  Reason: Database Error in model properties (models/int/properties.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct property_id, property_address from (
                                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/properties.sql.
[0m16:49:51.672238 [debug] [MainThread]: Using postgres connection "master"
[0m16:49:51.672494 [debug] [MainThread]: On master: BEGIN
[0m16:49:51.672659 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:49:51.684283 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m16:49:51.684610 [debug] [MainThread]: On master: COMMIT
[0m16:49:51.684804 [debug] [MainThread]: Using postgres connection "master"
[0m16:49:51.684972 [debug] [MainThread]: On master: COMMIT
[0m16:49:51.686045 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:49:51.686220 [debug] [MainThread]: On master: Close
[0m16:49:51.686475 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:49:51.686640 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:49:51.686786 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:49:51.686922 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:49:51.687060 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:49:51.687276 [info ] [MainThread]: 
[0m16:49:51.687460 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m16:49:51.688182 [debug] [MainThread]: Command end result
[0m16:49:51.701490 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:49:51.702709 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:49:51.707101 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:49:51.707421 [info ] [MainThread]: 
[0m16:49:51.707660 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:49:51.707853 [info ] [MainThread]: 
[0m16:49:51.708099 [error] [MainThread]: [31mFailure in model businesses (models/int/businesses.sql)[0m
[0m16:49:51.708460 [error] [MainThread]:   Database Error in model businesses (models/int/businesses.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct business_name from (
                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/businesses.sql
[0m16:49:51.708669 [info ] [MainThread]: 
[0m16:49:51.708872 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/businesses.sql
[0m16:49:51.709043 [info ] [MainThread]: 
[0m16:49:51.709238 [error] [MainThread]: [31mFailure in model properties (models/int/properties.sql)[0m
[0m16:49:51.709436 [error] [MainThread]:   Database Error in model properties (models/int/properties.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct property_id, property_address from (
                                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:49:51.709598 [info ] [MainThread]: 
[0m16:49:51.709776 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/properties.sql
[0m16:49:51.709932 [info ] [MainThread]: 
[0m16:49:51.710102 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=7
[0m16:49:51.710408 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:49:51.712474 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.263528, "process_in_blocks": "0", "process_kernel_time": 0.227882, "process_mem_max_rss": "138002432", "process_out_blocks": "0", "process_user_time": 1.487585}
[0m16:49:51.712865 [debug] [MainThread]: Command `dbt run` failed at 16:49:51.712812 after 1.26 seconds
[0m16:49:51.713193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030fa8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10638a020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033e71c0>]}
[0m16:49:51.713449 [debug] [MainThread]: Flushing usage events
[0m16:49:52.276902 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:50:38.131221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11847e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a544c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a5444f0>]}


============================== 16:50:38.134225 | 8439e911-882d-4ffb-b3dd-da265f0c0643 ==============================
[0m16:50:38.134225 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:50:38.134616 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'empty': 'False', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'cache_selected_only': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'quiet': 'False', 'fail_fast': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'no_print': 'None', 'warn_error': 'None', 'partial_parse': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True'}
[0m16:50:38.135143 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:50:38.135385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a48ad40>]}
[0m16:50:38.309995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a62eaa0>]}
[0m16:50:38.354681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a664880>]}
[0m16:50:38.355488 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:50:38.422330 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:50:38.495873 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:50:38.496264 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/businesses.sql
[0m16:50:38.688461 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:50:38.696343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b5ae830>]}
[0m16:50:38.741643 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:50:38.743094 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:50:38.754877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b59ee00>]}
[0m16:50:38.755191 [info ] [MainThread]: Found 7 models, 5 sources, 434 macros
[0m16:50:38.755391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b59efe0>]}
[0m16:50:38.756318 [info ] [MainThread]: 
[0m16:50:38.756524 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:50:38.756684 [info ] [MainThread]: 
[0m16:50:38.756971 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:50:38.759331 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:50:38.793777 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:50:38.794101 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:50:38.794277 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:50:38.863499 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.069 seconds
[0m16:50:38.864462 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:50:38.865684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:50:38.869548 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:50:38.869819 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:50:38.869996 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:50:38.882119 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m16:50:38.882448 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:50:38.882695 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:50:38.890093 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.007 seconds
[0m16:50:38.891236 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:50:38.892225 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:50:38.895887 [debug] [MainThread]: Using postgres connection "master"
[0m16:50:38.896147 [debug] [MainThread]: On master: BEGIN
[0m16:50:38.896369 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:50:38.908864 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m16:50:38.909206 [debug] [MainThread]: Using postgres connection "master"
[0m16:50:38.909466 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:50:38.918197 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m16:50:38.919132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c00d600>]}
[0m16:50:38.919510 [debug] [MainThread]: On master: ROLLBACK
[0m16:50:38.920587 [debug] [MainThread]: Using postgres connection "master"
[0m16:50:38.920819 [debug] [MainThread]: On master: BEGIN
[0m16:50:38.922421 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:50:38.922731 [debug] [MainThread]: On master: COMMIT
[0m16:50:38.922935 [debug] [MainThread]: Using postgres connection "master"
[0m16:50:38.923118 [debug] [MainThread]: On master: COMMIT
[0m16:50:38.923915 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:50:38.924129 [debug] [MainThread]: On master: Close
[0m16:50:38.926824 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:50:38.927227 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:50:38.927526 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:50:38.927746 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:50:38.933150 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:50:38.933668 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:50:38.953978 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:50:38.954517 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:50:38.954741 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:50:38.954947 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:50:38.966612 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m16:50:38.966952 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:50:38.967184 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:50:38.976303 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.009 seconds
[0m16:50:38.982044 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:50:38.982334 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:50:38.983709 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:38.985553 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:50:38.985782 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:50:38.986650 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:38.995842 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:50:38.996130 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:50:38.996336 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:50:38.998304 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:50:39.001738 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:50:39.003972 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:50:39.004198 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:50:39.008464 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m16:50:39.009983 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:50:39.011239 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c439bd0>]}
[0m16:50:39.011666 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.08s]
[0m16:50:39.012112 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:50:39.012600 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:50:39.012815 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:50:39.013039 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:50:39.013242 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:50:39.013487 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:50:39.013801 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:50:39.014099 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:50:39.014392 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:50:39.014717 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:50:39.014992 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:50:39.015265 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:50:39.015479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:50:39.015679 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:50:39.016006 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:50:39.016281 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:50:39.016510 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:50:39.019322 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.021380 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.023153 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.024790 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.025825 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:50:39.026166 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:50:39.026378 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:50:39.028795 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.029047 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:50:39.031369 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.033772 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.036669 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.037137 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.037437 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.037699 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.037916 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:50:39.038129 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.038346 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:50:39.038554 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:50:39.038757 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:50:39.038950 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:50:39.039129 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:50:39.039314 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:50:39.039582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:50:39.057764 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:50:39.058208 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.058526 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:50:39.058903 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m16:50:39.059280 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.059595 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:50:39.059875 [debug] [Thread-2 (]: SQL status: BEGIN in 0.021 seconds
[0m16:50:39.060190 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.060440 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:50:39.065735 [debug] [Thread-3 (]: SQL status: BEGIN in 0.027 seconds
[0m16:50:39.066035 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.066423 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:50:39.073970 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.015 seconds
[0m16:50:39.076310 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.076584 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:50:39.077816 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.079629 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.079962 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:50:39.081252 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.082289 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:50:39.082513 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.082697 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:50:39.087531 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.021 seconds
[0m16:50:39.089673 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.089935 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:50:39.091936 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:50:39.093946 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.094205 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:50:39.095728 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.096903 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:50:39.097231 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.097430 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:50:39.105703 [debug] [Thread-1 (]: SQL status: COMMIT in 0.023 seconds
[0m16:50:39.107535 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:50:39.108175 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:50:39.108464 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:50:39.113171 [debug] [Thread-3 (]: SQL status: COMMIT in 0.015 seconds
[0m16:50:39.115629 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:50:39.116160 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:50:39.116501 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:50:39.117609 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m16:50:39.118480 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:50:39.118889 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4fd7e0>]}
[0m16:50:39.119278 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m16:50:39.119613 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:50:39.124209 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m16:50:39.125102 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:50:39.125484 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c57df30>]}
[0m16:50:39.125856 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.11s]
[0m16:50:39.126171 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:50:39.191937 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.132 seconds
[0m16:50:39.192261 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.132 seconds
[0m16:50:39.194324 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.196041 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.196270 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:50:39.196482 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:50:39.197725 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.197954 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.199831 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.201609 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.201848 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:50:39.202064 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:50:39.203207 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.203490 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:50:39.204428 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:50:39.205352 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:50:39.205579 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.205782 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.205978 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:50:39.206164 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:50:39.213921 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m16:50:39.215486 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:50:39.215716 [debug] [Thread-4 (]: SQL status: COMMIT in 0.009 seconds
[0m16:50:39.216154 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:50:39.217484 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:50:39.217711 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:50:39.218127 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:50:39.218435 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:50:39.226973 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.008 seconds
[0m16:50:39.227907 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:50:39.228121 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.010 seconds
[0m16:50:39.228886 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:50:39.229263 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5a0040>]}
[0m16:50:39.229678 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5c00a0>]}
[0m16:50:39.230169 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.21s]
[0m16:50:39.230679 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.21s]
[0m16:50:39.231075 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:50:39.231408 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:50:39.231989 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.businesses
[0m16:50:39.232295 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m16:50:39.232593 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:50:39.233095 [info ] [Thread-3 (]: 7 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:50:39.233499 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.businesses)
[0m16:50:39.233871 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.properties)
[0m16:50:39.234151 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:50:39.234480 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m16:50:39.237966 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:50:39.240207 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:50:39.240815 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.businesses
[0m16:50:39.243296 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:50:39.243571 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m16:50:39.245959 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:50:39.246439 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:50:39.246714 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:50:39.246984 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:50:39.247224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:50:39.247526 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:50:39.247858 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:50:39.259916 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m16:50:39.260231 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m16:50:39.260552 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:50:39.260753 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:50:39.260981 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address from "highstreet"."analytics_analytics"."stg_accounts_closed"

)

select distinct property_id, property_address from (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)
  );
  
[0m16:50:39.261249 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

)

select distinct business_name from (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)
  );
  
[0m16:50:39.262558 [debug] [Thread-3 (]: Postgres adapter: Postgres error: subquery in FROM must have an alias
LINE 34: select distinct property_id, property_address from (
                                                            ^
HINT:  For example, FROM (SELECT ...) [AS] foo.

[0m16:50:39.262804 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: ROLLBACK
[0m16:50:39.263052 [debug] [Thread-1 (]: Postgres adapter: Postgres error: subquery in FROM must have an alias
LINE 34: select distinct business_name from (
                                            ^
HINT:  For example, FROM (SELECT ...) [AS] foo.

[0m16:50:39.263266 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: ROLLBACK
[0m16:50:39.263555 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: Close
[0m16:50:39.264041 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: Close
[0m16:50:39.268473 [debug] [Thread-3 (]: Database Error in model properties (models/int/properties.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct property_id, property_address from (
                                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:50:39.268963 [debug] [Thread-1 (]: Database Error in model businesses (models/int/businesses.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct business_name from (
                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/businesses.sql
[0m16:50:39.269306 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c584700>]}
[0m16:50:39.269560 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8439e911-882d-4ffb-b3dd-da265f0c0643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5c00a0>]}
[0m16:50:39.269961 [error] [Thread-3 (]: 7 of 7 ERROR creating sql table model analytics_analytics.properties ........... [[31mERROR[0m in 0.04s]
[0m16:50:39.270345 [error] [Thread-1 (]: 6 of 7 ERROR creating sql table model analytics_analytics.businesses ........... [[31mERROR[0m in 0.04s]
[0m16:50:39.270670 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m16:50:39.270962 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.businesses
[0m16:50:39.271286 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.properties' to be skipped because of status 'error'.  Reason: Database Error in model properties (models/int/properties.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct property_id, property_address from (
                                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/properties.sql.
[0m16:50:39.271921 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.businesses' to be skipped because of status 'error'.  Reason: Database Error in model businesses (models/int/businesses.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct business_name from (
                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/businesses.sql.
[0m16:50:39.272569 [debug] [MainThread]: Using postgres connection "master"
[0m16:50:39.272749 [debug] [MainThread]: On master: BEGIN
[0m16:50:39.272905 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:50:39.284554 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m16:50:39.284886 [debug] [MainThread]: On master: COMMIT
[0m16:50:39.285063 [debug] [MainThread]: Using postgres connection "master"
[0m16:50:39.285217 [debug] [MainThread]: On master: COMMIT
[0m16:50:39.285927 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:50:39.286139 [debug] [MainThread]: On master: Close
[0m16:50:39.286409 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:50:39.286582 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:50:39.286742 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:50:39.286900 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:50:39.287047 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:50:39.287284 [info ] [MainThread]: 
[0m16:50:39.287504 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m16:50:39.288365 [debug] [MainThread]: Command end result
[0m16:50:39.301303 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:50:39.302330 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:50:39.306550 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:50:39.306846 [info ] [MainThread]: 
[0m16:50:39.307081 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:50:39.307270 [info ] [MainThread]: 
[0m16:50:39.307495 [error] [MainThread]: [31mFailure in model properties (models/int/properties.sql)[0m
[0m16:50:39.307747 [error] [MainThread]:   Database Error in model properties (models/int/properties.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct property_id, property_address from (
                                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:50:39.307967 [info ] [MainThread]: 
[0m16:50:39.308272 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/properties.sql
[0m16:50:39.308479 [info ] [MainThread]: 
[0m16:50:39.308696 [error] [MainThread]: [31mFailure in model businesses (models/int/businesses.sql)[0m
[0m16:50:39.308909 [error] [MainThread]:   Database Error in model businesses (models/int/businesses.sql)
  subquery in FROM must have an alias
  LINE 34: select distinct business_name from (
                                              ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled code at target/run/highstreet_tenure/models/int/businesses.sql
[0m16:50:39.309075 [info ] [MainThread]: 
[0m16:50:39.309252 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/businesses.sql
[0m16:50:39.309408 [info ] [MainThread]: 
[0m16:50:39.309579 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=7
[0m16:50:39.309877 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:50:39.312234 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2300352, "process_in_blocks": "0", "process_kernel_time": 0.225445, "process_mem_max_rss": "135970816", "process_out_blocks": "0", "process_user_time": 1.484796}
[0m16:50:39.312654 [debug] [MainThread]: Command `dbt run` failed at 16:50:39.312599 after 1.23 seconds
[0m16:50:39.313108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11847e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11aa292d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11878e350>]}
[0m16:50:39.313430 [debug] [MainThread]: Flushing usage events
[0m16:50:39.845726 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:51:20.989112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10377e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e00c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e004f0>]}


============================== 16:51:20.992130 | 6168186f-30cf-4636-a54e-7c12c2d2f075 ==============================
[0m16:51:20.992130 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:51:20.992481 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'partial_parse': 'True', 'debug': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'static_parser': 'True', 'empty': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'warn_error': 'None', 'use_colors': 'True', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'profiles_dir': '.', 'introspect': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m16:51:20.992790 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:51:20.993002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d4ed40>]}
[0m16:51:21.164681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051aeaa0>]}
[0m16:51:21.208457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051e4880>]}
[0m16:51:21.209290 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:51:21.276835 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:51:21.356162 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m16:51:21.356542 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/businesses.sql
[0m16:51:21.356773 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/properties.sql
[0m16:51:21.549797 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:51:21.557965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f62830>]}
[0m16:51:21.604271 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:51:21.605959 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:51:21.619037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f1a410>]}
[0m16:51:21.619392 [info ] [MainThread]: Found 7 models, 5 sources, 434 macros
[0m16:51:21.619609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f18af0>]}
[0m16:51:21.620629 [info ] [MainThread]: 
[0m16:51:21.620871 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:51:21.621045 [info ] [MainThread]: 
[0m16:51:21.621341 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:51:21.623809 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:51:21.658272 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:51:21.658611 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:51:21.658782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:51:21.710466 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.052 seconds
[0m16:51:21.711325 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:51:21.712275 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:51:21.715914 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:51:21.716178 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:51:21.716345 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:51:21.726968 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m16:51:21.727294 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:51:21.727519 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:51:21.734492 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.007 seconds
[0m16:51:21.735354 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:51:21.736126 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:51:21.739469 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:21.739708 [debug] [MainThread]: On master: BEGIN
[0m16:51:21.739884 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:51:21.752026 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m16:51:21.752281 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:21.752524 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:51:21.759948 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m16:51:21.760732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bb9c60>]}
[0m16:51:21.761086 [debug] [MainThread]: On master: ROLLBACK
[0m16:51:21.761934 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:21.762228 [debug] [MainThread]: On master: BEGIN
[0m16:51:21.763598 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:51:21.763905 [debug] [MainThread]: On master: COMMIT
[0m16:51:21.764171 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:21.764379 [debug] [MainThread]: On master: COMMIT
[0m16:51:21.765070 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:51:21.765283 [debug] [MainThread]: On master: Close
[0m16:51:21.767868 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:51:21.768270 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:51:21.768585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:51:21.768803 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:51:21.774188 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:51:21.775155 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:51:21.824198 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:51:21.824917 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:21.825141 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:51:21.825330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:51:21.838447 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m16:51:21.838811 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:21.839022 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:51:21.845832 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.007 seconds
[0m16:51:21.851728 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:21.852019 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:51:21.853206 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:21.854918 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:21.855134 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:51:21.856191 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:21.864801 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:51:21.865057 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:21.865255 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:51:21.866663 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:51:21.869979 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:51:21.872246 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:21.872470 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:51:21.875818 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:51:21.877276 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:51:21.878540 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063e1b70>]}
[0m16:51:21.878979 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.11s]
[0m16:51:21.879317 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:51:21.879783 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:51:21.880007 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:21.880246 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:51:21.880444 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:51:21.880701 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:51:21.880990 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:51:21.881274 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:51:21.881718 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:51:21.882135 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:51:21.882413 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:51:21.882701 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:51:21.882921 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:51:21.883134 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:51:21.883335 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:21.883527 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:51:21.883717 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:51:21.886393 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.888370 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:21.890860 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:21.892773 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.893601 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:51:21.893868 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:51:21.896281 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.896656 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:51:21.896900 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:21.899089 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.902317 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:21.904714 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:21.905144 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.905533 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.905805 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:51:21.906071 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:21.906332 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:51:21.906572 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:21.906799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:51:21.907034 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:51:21.907242 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:51:21.907451 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:51:21.907733 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:51:21.908119 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:51:21.928223 [debug] [Thread-2 (]: SQL status: BEGIN in 0.020 seconds
[0m16:51:21.928598 [debug] [Thread-3 (]: SQL status: BEGIN in 0.021 seconds
[0m16:51:21.928961 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:21.929268 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m16:51:21.929526 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.929758 [debug] [Thread-4 (]: SQL status: BEGIN in 0.022 seconds
[0m16:51:21.930055 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:21.930327 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.930568 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:21.930882 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:21.931270 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:21.931752 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:21.946561 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.014 seconds
[0m16:51:21.948949 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.949189 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:51:21.950436 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:21.952189 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.952413 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:51:21.952813 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.021 seconds
[0m16:51:21.955019 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.955256 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:51:21.955514 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:51:21.956553 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:51:21.956914 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.957162 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:51:21.957764 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:21.959489 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.959696 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:51:21.963999 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m16:51:21.964288 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:51:21.965935 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:51:21.966938 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:51:21.967407 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:21.967706 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.967968 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:51:21.968167 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:51:21.971355 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m16:51:21.973697 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:51:21.973990 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:51:21.974512 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:21.975331 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:51:21.975553 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:51:21.975929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10667de70>]}
[0m16:51:21.976313 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.09s]
[0m16:51:21.976691 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:51:21.981781 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:51:21.982834 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:51:21.983278 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10667f520>]}
[0m16:51:21.983674 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.10s]
[0m16:51:21.984002 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:51:22.024721 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.092 seconds
[0m16:51:22.026945 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:22.027186 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:51:22.028452 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:22.030405 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:22.030701 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:51:22.031834 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:22.032905 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:51:22.033195 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:22.033421 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.102 seconds
[0m16:51:22.033680 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:51:22.035608 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:22.035898 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:51:22.037044 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:22.038903 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:22.039159 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:51:22.040343 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:22.041641 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:51:22.041918 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:22.042107 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:51:22.044334 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m16:51:22.044670 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m16:51:22.046262 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:51:22.047845 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:51:22.048404 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:22.048919 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:22.049140 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:51:22.049391 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:51:22.055963 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:51:22.056992 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:51:22.057316 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.008 seconds
[0m16:51:22.058086 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066adf30>]}
[0m16:51:22.059614 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:51:22.060160 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.18s]
[0m16:51:22.060676 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:51:22.061135 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106655630>]}
[0m16:51:22.062152 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.18s]
[0m16:51:22.062664 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:22.063222 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.businesses
[0m16:51:22.063470 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m16:51:22.063837 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:51:22.064615 [info ] [Thread-3 (]: 7 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:51:22.065391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.businesses)
[0m16:51:22.065870 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.properties)
[0m16:51:22.066237 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:51:22.066505 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m16:51:22.071278 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:51:22.073637 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:51:22.074233 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m16:51:22.074505 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.businesses
[0m16:51:22.077186 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:51:22.079701 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:51:22.080500 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:51:22.080806 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:22.081034 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:51:22.081280 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:51:22.081511 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:51:22.081798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:51:22.095870 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m16:51:22.096238 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:51:22.096486 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address from "highstreet"."analytics_analytics"."stg_accounts_closed"

)

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:51:22.096805 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m16:51:22.097160 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:22.097449 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:51:22.098160 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "combined_properties"
LINE 34: combined_properties as (
         ^

[0m16:51:22.098391 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: ROLLBACK
[0m16:51:22.099249 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: Close
[0m16:51:22.103429 [debug] [Thread-3 (]: Database Error in model properties (models/int/properties.sql)
  syntax error at or near "combined_properties"
  LINE 34: combined_properties as (
           ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:51:22.103963 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a82f9d0>]}
[0m16:51:22.104520 [error] [Thread-3 (]: 7 of 7 ERROR creating sql table model analytics_analytics.properties ........... [[31mERROR[0m in 0.04s]
[0m16:51:22.105162 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m16:51:22.105562 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.properties' to be skipped because of status 'error'.  Reason: Database Error in model properties (models/int/properties.sql)
  syntax error at or near "combined_properties"
  LINE 34: combined_properties as (
           ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql.
[0m16:51:22.149626 [debug] [Thread-1 (]: SQL status: SELECT 6223 in 0.052 seconds
[0m16:51:22.152250 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:22.152558 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:51:22.154197 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:22.155259 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:51:22.155502 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:22.155693 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:51:22.157766 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:51:22.159411 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:51:22.159982 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:22.160206 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:51:22.161096 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:51:22.162017 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: Close
[0m16:51:22.162401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6168186f-30cf-4636-a54e-7c12c2d2f075', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fbadd0>]}
[0m16:51:22.162787 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.businesses ............... [[32mSELECT 6223[0m in 0.10s]
[0m16:51:22.163108 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.businesses
[0m16:51:22.163898 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:22.164132 [debug] [MainThread]: On master: BEGIN
[0m16:51:22.164288 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:51:22.176895 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m16:51:22.177225 [debug] [MainThread]: On master: COMMIT
[0m16:51:22.177405 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:22.177566 [debug] [MainThread]: On master: COMMIT
[0m16:51:22.178334 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:51:22.178577 [debug] [MainThread]: On master: Close
[0m16:51:22.178900 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:51:22.179071 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:51:22.179225 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:51:22.179382 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:51:22.179533 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:51:22.179766 [info ] [MainThread]: 
[0m16:51:22.179960 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m16:51:22.180964 [debug] [MainThread]: Command end result
[0m16:51:22.195530 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:51:22.196911 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:51:22.201704 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:51:22.201966 [info ] [MainThread]: 
[0m16:51:22.202182 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:51:22.202361 [info ] [MainThread]: 
[0m16:51:22.202571 [error] [MainThread]: [31mFailure in model properties (models/int/properties.sql)[0m
[0m16:51:22.202770 [error] [MainThread]:   Database Error in model properties (models/int/properties.sql)
  syntax error at or near "combined_properties"
  LINE 34: combined_properties as (
           ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:51:22.202931 [info ] [MainThread]: 
[0m16:51:22.203117 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/properties.sql
[0m16:51:22.203276 [info ] [MainThread]: 
[0m16:51:22.203449 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=7
[0m16:51:22.203756 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:51:22.205888 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2671602, "process_in_blocks": "0", "process_kernel_time": 0.230431, "process_mem_max_rss": "137641984", "process_out_blocks": "0", "process_user_time": 1.540968}
[0m16:51:22.206304 [debug] [MainThread]: Command `dbt run` failed at 16:51:22.206250 after 1.27 seconds
[0m16:51:22.206555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10377e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051e4880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a8e350>]}
[0m16:51:22.206925 [debug] [MainThread]: Flushing usage events
[0m16:51:22.931655 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:51:37.263041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10467e830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106840bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106840490>]}


============================== 16:51:37.265986 | 297ccada-7a32-4283-b9cd-51a359a55d4f ==============================
[0m16:51:37.265986 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:51:37.266331 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'no_print': 'None', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'use_colors': 'True', 'debug': 'False', 'warn_error': 'None', 'target_path': 'None', 'version_check': 'True', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'introspect': 'True', 'fail_fast': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'log_format': 'default'}
[0m16:51:37.266613 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:51:37.266828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067895d0>]}
[0m16:51:37.398700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d807f0>]}
[0m16:51:37.441016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ad35e0>]}
[0m16:51:37.441972 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:51:37.511422 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:51:37.580883 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:51:37.581280 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/properties.sql
[0m16:51:37.772173 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:51:37.780365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10780a7d0>]}
[0m16:51:37.825211 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:51:37.826492 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:51:37.838145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c8c10>]}
[0m16:51:37.838525 [info ] [MainThread]: Found 7 models, 5 sources, 434 macros
[0m16:51:37.838805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c9360>]}
[0m16:51:37.839975 [info ] [MainThread]: 
[0m16:51:37.840285 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:51:37.840538 [info ] [MainThread]: 
[0m16:51:37.840875 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:51:37.843236 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:51:37.877047 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:51:37.877392 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:51:37.877626 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:51:37.943895 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.066 seconds
[0m16:51:37.944899 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:51:37.946154 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:51:37.950139 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:51:37.950425 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:51:37.950610 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:51:37.964038 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m16:51:37.964319 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:51:37.964522 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:51:37.972266 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m16:51:37.973195 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:51:37.973996 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:51:37.977699 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:37.977997 [debug] [MainThread]: On master: BEGIN
[0m16:51:37.978193 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:51:37.990668 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m16:51:37.990946 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:37.991212 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:51:37.999523 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m16:51:38.000298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786c3d0>]}
[0m16:51:38.000623 [debug] [MainThread]: On master: ROLLBACK
[0m16:51:38.001352 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:38.001569 [debug] [MainThread]: On master: BEGIN
[0m16:51:38.002772 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:51:38.003090 [debug] [MainThread]: On master: COMMIT
[0m16:51:38.003311 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:38.003505 [debug] [MainThread]: On master: COMMIT
[0m16:51:38.004209 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:51:38.004476 [debug] [MainThread]: On master: Close
[0m16:51:38.006956 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:51:38.007348 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:51:38.007724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:51:38.008005 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:51:38.013688 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:51:38.014277 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:51:38.036704 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:51:38.037574 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:38.037868 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:51:38.038068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:51:38.049323 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m16:51:38.049629 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:38.049855 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:51:38.056880 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.007 seconds
[0m16:51:38.062739 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:38.063009 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:51:38.064283 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.066017 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:38.066242 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:51:38.067148 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.075996 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:51:38.076322 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:38.076546 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:51:38.077849 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:51:38.081389 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:51:38.083697 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:51:38.083938 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:51:38.088059 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m16:51:38.089516 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:51:38.090770 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e31cf0>]}
[0m16:51:38.091217 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.08s]
[0m16:51:38.091563 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:51:38.092043 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:51:38.092290 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:38.092495 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:51:38.092732 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:51:38.093005 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:51:38.093299 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:51:38.093587 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:51:38.093915 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:51:38.094278 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:51:38.094575 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:51:38.094826 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:51:38.095041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:51:38.095256 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:51:38.095469 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:38.095734 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:51:38.095990 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:51:38.098971 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.100905 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.103146 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.105270 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.106036 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:51:38.106343 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:51:38.108629 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.108852 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:38.109044 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:51:38.111057 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.113313 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.116176 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.116575 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.116982 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.117254 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.117471 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:51:38.117721 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:51:38.117933 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.118141 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:51:38.118333 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:51:38.118519 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:51:38.118703 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:51:38.118886 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:51:38.119259 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:51:38.134977 [debug] [Thread-3 (]: SQL status: BEGIN in 0.017 seconds
[0m16:51:38.135307 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.135549 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:38.140952 [debug] [Thread-4 (]: SQL status: BEGIN in 0.022 seconds
[0m16:51:38.141247 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.141731 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:38.142189 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m16:51:38.142397 [debug] [Thread-2 (]: SQL status: BEGIN in 0.024 seconds
[0m16:51:38.142693 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.142935 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.143248 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:38.143692 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:51:38.156019 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.020 seconds
[0m16:51:38.158475 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.158739 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:51:38.160312 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.162445 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.162872 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:51:38.164158 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.165285 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:51:38.165520 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.165714 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:51:38.170497 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.026 seconds
[0m16:51:38.170754 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m16:51:38.173051 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.174499 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:51:38.174794 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:51:38.175319 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:51:38.175583 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:51:38.177467 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:51:38.179573 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.179861 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:51:38.181354 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.182302 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:51:38.182522 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.182713 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:51:38.186101 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:51:38.186482 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.011 seconds
[0m16:51:38.189358 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:51:38.190260 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:51:38.190735 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:51:38.190986 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:51:38.191345 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f79ff0>]}
[0m16:51:38.191791 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.10s]
[0m16:51:38.192124 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:51:38.202193 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m16:51:38.203292 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:51:38.203728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110210b80>]}
[0m16:51:38.204196 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.11s]
[0m16:51:38.204704 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:51:38.255224 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.113 seconds
[0m16:51:38.257563 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.257814 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:51:38.259161 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.260991 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.261610 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.118 seconds
[0m16:51:38.262913 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:51:38.265145 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.265470 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:51:38.266275 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.266507 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.267809 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:51:38.272631 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.272873 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.273083 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:51:38.273281 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:51:38.286033 [debug] [Thread-4 (]: SQL status: COMMIT in 0.012 seconds
[0m16:51:38.286317 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.013 seconds
[0m16:51:38.287996 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:51:38.288945 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:51:38.289484 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:51:38.289751 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.289970 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:51:38.290180 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:51:38.291210 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m16:51:38.292812 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:51:38.293288 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:51:38.293508 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:51:38.297958 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.008 seconds
[0m16:51:38.298799 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:51:38.299178 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f55780>]}
[0m16:51:38.299554 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.20s]
[0m16:51:38.299873 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:51:38.300073 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:51:38.300857 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:51:38.301161 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f9c130>]}
[0m16:51:38.301493 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.21s]
[0m16:51:38.301795 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:51:38.302192 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m16:51:38.302399 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.properties
[0m16:51:38.302709 [info ] [Thread-3 (]: 6 of 7 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:51:38.303130 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:51:38.303474 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.businesses)
[0m16:51:38.303728 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.properties)
[0m16:51:38.304169 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:51:38.304428 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.properties
[0m16:51:38.306872 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:51:38.310210 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:51:38.310849 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m16:51:38.311136 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.properties
[0m16:51:38.313572 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:51:38.315766 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:51:38.316354 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:38.316655 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:51:38.316919 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:51:38.317225 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:51:38.317449 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:51:38.317639 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:51:38.333529 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:51:38.333842 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m16:51:38.334085 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:51:38.334278 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:38.334499 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:51:38.334756 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:51:38.336974 [debug] [Thread-1 (]: Postgres adapter: Postgres error: each UNION query must have the same number of columns
LINE 42:     select * from properties_accounts_closed
                    ^

[0m16:51:38.337204 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: ROLLBACK
[0m16:51:38.337953 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: Close
[0m16:51:38.342103 [debug] [Thread-1 (]: Database Error in model properties (models/int/properties.sql)
  each UNION query must have the same number of columns
  LINE 42:     select * from properties_accounts_closed
                      ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:51:38.342515 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786e650>]}
[0m16:51:38.342927 [error] [Thread-1 (]: 7 of 7 ERROR creating sql table model analytics_analytics.properties ........... [[31mERROR[0m in 0.04s]
[0m16:51:38.343262 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.properties
[0m16:51:38.343578 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.properties' to be skipped because of status 'error'.  Reason: Database Error in model properties (models/int/properties.sql)
  each UNION query must have the same number of columns
  LINE 42:     select * from properties_accounts_closed
                      ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql.
[0m16:51:38.378599 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.043 seconds
[0m16:51:38.381141 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:38.381448 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m16:51:38.382693 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.384575 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:38.384808 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:51:38.385636 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:51:38.386590 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:51:38.386798 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:38.386997 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:51:38.389077 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m16:51:38.390495 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:51:38.390935 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:51:38.391126 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:51:38.394123 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:51:38.394935 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m16:51:38.395318 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '297ccada-7a32-4283-b9cd-51a359a55d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f9c130>]}
[0m16:51:38.395783 [info ] [Thread-3 (]: 6 of 7 OK created sql table model analytics_analytics.businesses ............... [[32mSELECT 6223[0m in 0.09s]
[0m16:51:38.396124 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m16:51:38.396857 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:38.397097 [debug] [MainThread]: On master: BEGIN
[0m16:51:38.397261 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:51:38.408217 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m16:51:38.408500 [debug] [MainThread]: On master: COMMIT
[0m16:51:38.408670 [debug] [MainThread]: Using postgres connection "master"
[0m16:51:38.408821 [debug] [MainThread]: On master: COMMIT
[0m16:51:38.409610 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:51:38.409798 [debug] [MainThread]: On master: Close
[0m16:51:38.410044 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:51:38.410202 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:51:38.410348 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:51:38.410488 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:51:38.410625 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:51:38.410842 [info ] [MainThread]: 
[0m16:51:38.411021 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m16:51:38.411816 [debug] [MainThread]: Command end result
[0m16:51:38.424424 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:51:38.425379 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:51:38.429281 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:51:38.429565 [info ] [MainThread]: 
[0m16:51:38.429790 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:51:38.429974 [info ] [MainThread]: 
[0m16:51:38.430194 [error] [MainThread]: [31mFailure in model properties (models/int/properties.sql)[0m
[0m16:51:38.430410 [error] [MainThread]:   Database Error in model properties (models/int/properties.sql)
  each UNION query must have the same number of columns
  LINE 42:     select * from properties_accounts_closed
                      ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:51:38.430574 [info ] [MainThread]: 
[0m16:51:38.430763 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/properties.sql
[0m16:51:38.430927 [info ] [MainThread]: 
[0m16:51:38.431110 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=7
[0m16:51:38.431417 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:51:38.437447 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2230674, "process_in_blocks": "0", "process_kernel_time": 0.214988, "process_mem_max_rss": "135970816", "process_out_blocks": "0", "process_user_time": 1.525881}
[0m16:51:38.437961 [debug] [MainThread]: Command `dbt run` failed at 16:51:38.437897 after 1.22 seconds
[0m16:51:38.438227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10467e830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110210d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d807f0>]}
[0m16:51:38.438464 [debug] [MainThread]: Flushing usage events
[0m16:51:38.981957 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:52:04.190974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d40c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d404f0>]}


============================== 16:52:04.195787 | d1b42e3a-d908-454d-ad19-17ebf58f5b7e ==============================
[0m16:52:04.195787 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:52:04.196330 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'empty': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'use_colors': 'True', 'introspect': 'True', 'no_print': 'None', 'static_parser': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'profiles_dir': '.', 'partial_parse': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m16:52:04.196665 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:52:04.196882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c8ad40>]}
[0m16:52:04.332399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa6aa0>]}
[0m16:52:04.376611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fe4880>]}
[0m16:52:04.377771 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:52:04.444349 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:52:04.515328 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:52:04.515705 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/properties.sql
[0m16:52:04.698092 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:52:04.706038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eaa830>]}
[0m16:52:04.750850 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:52:04.752582 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:52:04.763519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ea9300>]}
[0m16:52:04.763832 [info ] [MainThread]: Found 7 models, 5 sources, 434 macros
[0m16:52:04.764034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b9c60>]}
[0m16:52:04.764951 [info ] [MainThread]: 
[0m16:52:04.765159 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:52:04.765327 [info ] [MainThread]: 
[0m16:52:04.765617 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:52:04.767952 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:52:04.802578 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:52:04.802907 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:52:04.803082 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:52:04.858866 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.056 seconds
[0m16:52:04.859717 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:52:04.860683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:52:04.864478 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:52:04.864748 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:52:04.864925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:52:04.877374 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m16:52:04.877670 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:52:04.877880 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:52:04.887401 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m16:52:04.888377 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:52:04.889215 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:52:04.892863 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:04.893139 [debug] [MainThread]: On master: BEGIN
[0m16:52:04.893323 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:52:04.907600 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m16:52:04.907917 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:04.908187 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:52:04.920439 [debug] [MainThread]: SQL status: SELECT 0 in 0.012 seconds
[0m16:52:04.921196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cd1a50>]}
[0m16:52:04.921520 [debug] [MainThread]: On master: ROLLBACK
[0m16:52:04.922329 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:04.922527 [debug] [MainThread]: On master: BEGIN
[0m16:52:04.923820 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:52:04.924153 [debug] [MainThread]: On master: COMMIT
[0m16:52:04.924366 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:04.924558 [debug] [MainThread]: On master: COMMIT
[0m16:52:04.925311 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:52:04.925606 [debug] [MainThread]: On master: Close
[0m16:52:04.928171 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:52:04.928542 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:52:04.928844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:52:04.929077 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:52:04.934602 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:52:04.935181 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:52:04.958323 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:52:04.959207 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:04.959472 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:52:04.959744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:52:04.974917 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m16:52:04.975237 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:04.975453 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:52:04.981986 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.006 seconds
[0m16:52:04.987461 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:04.987721 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:52:04.988924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:04.990832 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:04.991059 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:52:04.992074 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.001191 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:52:05.001518 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:05.001753 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:52:05.004157 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:52:05.007722 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:52:05.010038 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:05.010298 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:52:05.016494 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:52:05.018131 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:52:05.019459 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d39d80>]}
[0m16:52:05.019890 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.09s]
[0m16:52:05.020300 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:52:05.020836 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:52:05.021083 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:05.021278 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:52:05.021520 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:52:05.021799 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:52:05.022137 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:52:05.022452 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:52:05.022875 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:52:05.023324 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:52:05.023639 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:52:05.024009 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:52:05.024341 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:52:05.024627 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:52:05.024874 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:05.025080 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:52:05.025327 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:52:05.028538 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.030875 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.032921 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.034934 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.035808 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:52:05.036116 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:05.036307 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:52:05.038625 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.038876 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:52:05.041238 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.043244 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.046113 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.046521 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.047005 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:52:05.047246 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.047467 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:52:05.047737 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.047938 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:52:05.048127 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.048451 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:52:05.048656 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:52:05.048905 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:52:05.049237 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:52:05.049637 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:52:05.068969 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m16:52:05.069378 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.069664 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:05.069985 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m16:52:05.070430 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.070787 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:05.071668 [debug] [Thread-3 (]: SQL status: BEGIN in 0.022 seconds
[0m16:52:05.071934 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m16:52:05.072175 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.072378 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.072613 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:05.072874 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:05.084270 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.014 seconds
[0m16:52:05.086606 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.086853 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:52:05.088098 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.089833 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.090064 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:52:05.091061 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.092023 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:52:05.092240 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.019 seconds
[0m16:52:05.092482 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.094389 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.094753 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:52:05.095083 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:52:05.096222 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.098177 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.098485 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:52:05.099472 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.100562 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:52:05.100790 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.100976 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:52:05.104686 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m16:52:05.106544 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:52:05.107076 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:05.107306 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:52:05.112160 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m16:52:05.114848 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:52:05.115380 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:05.115610 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:52:05.116927 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m16:52:05.117869 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:52:05.118297 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd39d0>]}
[0m16:52:05.118703 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.09s]
[0m16:52:05.119036 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:52:05.128680 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.013 seconds
[0m16:52:05.129835 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:52:05.130265 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11480aaa0>]}
[0m16:52:05.130665 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.11s]
[0m16:52:05.130989 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:52:05.173818 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.101 seconds
[0m16:52:05.176217 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.176487 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:52:05.178102 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.179940 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.180196 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:52:05.181503 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.182453 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:52:05.182670 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.182856 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:52:05.190997 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m16:52:05.192787 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:52:05.193027 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.122 seconds
[0m16:52:05.193529 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:05.195516 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.195755 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:52:05.195963 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:52:05.197378 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.200573 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.203454 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:52:05.204361 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.008 seconds
[0m16:52:05.204568 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.205312 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:52:05.209198 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:52:05.209597 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ea01c0>]}
[0m16:52:05.213586 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.214073 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.19s]
[0m16:52:05.215634 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:52:05.215990 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:05.219703 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m16:52:05.221695 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:52:05.222379 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:05.222649 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:52:05.230198 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.007 seconds
[0m16:52:05.231133 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:52:05.231517 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e55840>]}
[0m16:52:05.231915 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.21s]
[0m16:52:05.232354 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:52:05.232872 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.businesses
[0m16:52:05.233107 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m16:52:05.233417 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:52:05.233709 [info ] [Thread-3 (]: 7 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:52:05.233986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.businesses)
[0m16:52:05.234231 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.properties)
[0m16:52:05.234446 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:52:05.234653 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m16:52:05.236994 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:52:05.240021 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:52:05.240558 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.businesses
[0m16:52:05.242715 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:52:05.243221 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m16:52:05.245624 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:52:05.246035 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:05.246340 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:52:05.246566 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:52:05.246786 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:05.247111 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:52:05.247304 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:52:05.262634 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:52:05.262970 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m16:52:05.263294 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:05.263495 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:05.263731 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:52:05.263992 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:52:05.266482 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "property_address" does not exist
LINE 45: select distinct property_id, property_address from combined_...
                                      ^

[0m16:52:05.266756 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: ROLLBACK
[0m16:52:05.267574 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: Close
[0m16:52:05.271564 [debug] [Thread-3 (]: Database Error in model properties (models/int/properties.sql)
  column "property_address" does not exist
  LINE 45: select distinct property_id, property_address from combined_...
                                        ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:52:05.271975 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e28df0>]}
[0m16:52:05.272379 [error] [Thread-3 (]: 7 of 7 ERROR creating sql table model analytics_analytics.properties ........... [[31mERROR[0m in 0.04s]
[0m16:52:05.272708 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m16:52:05.273028 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.properties' to be skipped because of status 'error'.  Reason: Database Error in model properties (models/int/properties.sql)
  column "property_address" does not exist
  LINE 45: select distinct property_id, property_address from combined_...
                                        ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql.
[0m16:52:05.307130 [debug] [Thread-1 (]: SQL status: SELECT 6223 in 0.043 seconds
[0m16:52:05.309422 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:05.309648 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m16:52:05.310877 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.312835 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:05.313128 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:52:05.314092 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:05.315079 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:52:05.315324 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:05.315505 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:52:05.317124 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:52:05.318655 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:52:05.319079 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:05.319289 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:52:05.322343 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:52:05.323083 [debug] [Thread-1 (]: On model.highstreet_tenure.businesses: Close
[0m16:52:05.323447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b42e3a-d908-454d-ad19-17ebf58f5b7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd3ac0>]}
[0m16:52:05.323835 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.businesses ............... [[32mSELECT 6223[0m in 0.09s]
[0m16:52:05.324166 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.businesses
[0m16:52:05.324893 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:05.325101 [debug] [MainThread]: On master: BEGIN
[0m16:52:05.325253 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:52:05.336713 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m16:52:05.336993 [debug] [MainThread]: On master: COMMIT
[0m16:52:05.337161 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:05.337312 [debug] [MainThread]: On master: COMMIT
[0m16:52:05.338030 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:52:05.338308 [debug] [MainThread]: On master: Close
[0m16:52:05.338560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:52:05.338722 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:52:05.338921 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:52:05.339086 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:52:05.339224 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:52:05.339433 [info ] [MainThread]: 
[0m16:52:05.339629 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m16:52:05.340315 [debug] [MainThread]: Command end result
[0m16:52:05.353171 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:52:05.354245 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:52:05.357941 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:52:05.358227 [info ] [MainThread]: 
[0m16:52:05.358459 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:52:05.358643 [info ] [MainThread]: 
[0m16:52:05.358857 [error] [MainThread]: [31mFailure in model properties (models/int/properties.sql)[0m
[0m16:52:05.359066 [error] [MainThread]:   Database Error in model properties (models/int/properties.sql)
  column "property_address" does not exist
  LINE 45: select distinct property_id, property_address from combined_...
                                        ^
  compiled code at target/run/highstreet_tenure/models/int/properties.sql
[0m16:52:05.359234 [info ] [MainThread]: 
[0m16:52:05.359423 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/properties.sql
[0m16:52:05.359585 [info ] [MainThread]: 
[0m16:52:05.359764 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=7
[0m16:52:05.360070 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:52:05.362514 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2255224, "process_in_blocks": "0", "process_kernel_time": 0.220868, "process_mem_max_rss": "137527296", "process_out_blocks": "0", "process_user_time": 1.501887}
[0m16:52:05.362944 [debug] [MainThread]: Command `dbt run` failed at 16:52:05.362881 after 1.23 seconds
[0m16:52:05.363217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063b4c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f8e350>]}
[0m16:52:05.363463 [debug] [MainThread]: Flushing usage events
[0m16:52:05.827856 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:52:52.871679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d82920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121fc1000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121fc08e0>]}


============================== 16:52:52.874712 | bca8a0d3-e8ab-43b6-9a39-831c87959ccc ==============================
[0m16:52:52.874712 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:52:52.875067 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'debug': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'log_format': 'default', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'target_path': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'use_colors': 'True', 'static_parser': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error': 'None'}
[0m16:52:52.875372 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:52:52.875585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210fd0f0>]}
[0m16:52:53.043863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122410f70>]}
[0m16:52:53.085498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220e46a0>]}
[0m16:52:53.086282 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:52:53.153330 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:52:53.227886 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:52:53.228282 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/properties.sql
[0m16:52:53.412387 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:52:53.420299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122fae8c0>]}
[0m16:52:53.465287 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:52:53.467248 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:52:53.479010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12251e500>]}
[0m16:52:53.479330 [info ] [MainThread]: Found 7 models, 5 sources, 434 macros
[0m16:52:53.479529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122412260>]}
[0m16:52:53.480444 [info ] [MainThread]: 
[0m16:52:53.480644 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:52:53.480810 [info ] [MainThread]: 
[0m16:52:53.481078 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:52:53.483550 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:52:53.516484 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:52:53.516817 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:52:53.516984 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:52:53.580071 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.063 seconds
[0m16:52:53.581027 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:52:53.582093 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:52:53.585732 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:52:53.585965 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:52:53.586141 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:52:53.599271 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m16:52:53.599536 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:52:53.599743 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:52:53.607245 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.007 seconds
[0m16:52:53.608172 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:52:53.609034 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:52:53.612963 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:53.613263 [debug] [MainThread]: On master: BEGIN
[0m16:52:53.613456 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:52:53.626314 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m16:52:53.626641 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:53.626917 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:52:53.635076 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m16:52:53.635758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12320f100>]}
[0m16:52:53.636035 [debug] [MainThread]: On master: ROLLBACK
[0m16:52:53.636756 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:53.636959 [debug] [MainThread]: On master: BEGIN
[0m16:52:53.638189 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:52:53.638365 [debug] [MainThread]: On master: COMMIT
[0m16:52:53.638521 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:53.638669 [debug] [MainThread]: On master: COMMIT
[0m16:52:53.639354 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:52:53.639522 [debug] [MainThread]: On master: Close
[0m16:52:53.641480 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:52:53.641803 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:52:53.642070 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:52:53.642265 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:52:53.647064 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:52:53.647869 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:52:53.669394 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:52:53.669986 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:53.670189 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:52:53.670368 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:52:53.681692 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m16:52:53.682058 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:53.682292 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:52:53.688815 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.006 seconds
[0m16:52:53.694479 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:53.694739 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:52:53.695964 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.697560 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:53.697769 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:52:53.698871 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.707115 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:52:53.707354 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:53.707583 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:52:53.708953 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:52:53.712319 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:52:53.714642 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:52:53.714868 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:52:53.719302 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m16:52:53.720692 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:52:53.721944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125139de0>]}
[0m16:52:53.722349 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.08s]
[0m16:52:53.722675 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:52:53.723158 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:52:53.723368 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:53.723562 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:52:53.723838 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:52:53.724135 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:52:53.724470 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:52:53.724885 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:52:53.725280 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:52:53.725588 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:52:53.725876 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:52:53.726125 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:52:53.726336 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:52:53.726556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:52:53.726756 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:53.726952 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:52:53.729897 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.730165 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:52:53.731953 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.733639 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.735753 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.736140 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:52:53.736594 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:53.739014 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.741337 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.741590 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:52:53.741840 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:52:53.744283 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.747054 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.747364 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.747594 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.747891 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:52:53.748139 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:52:53.748339 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.748542 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.748753 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:52:53.748949 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:52:53.749132 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:52:53.749343 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:52:53.749696 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:52:53.749897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:52:53.765772 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m16:52:53.766089 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.766339 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:53.770162 [debug] [Thread-3 (]: SQL status: BEGIN in 0.021 seconds
[0m16:52:53.770499 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.770759 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:53.771086 [debug] [Thread-4 (]: SQL status: BEGIN in 0.022 seconds
[0m16:52:53.771420 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.771689 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:53.771955 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m16:52:53.772199 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.772428 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:52:53.790521 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.018 seconds
[0m16:52:53.792890 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.793126 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.022 seconds
[0m16:52:53.793370 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:52:53.795232 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.795527 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:52:53.796622 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.796834 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.798577 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.800594 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.800865 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:52:53.801093 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:52:53.802334 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.802667 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.803597 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:52:53.804433 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:52:53.804705 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.804952 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.805160 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:52:53.805383 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:52:53.814412 [debug] [Thread-3 (]: SQL status: COMMIT in 0.009 seconds
[0m16:52:53.814718 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m16:52:53.816477 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:52:53.818561 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:52:53.819003 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:52:53.819400 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:52:53.819599 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:52:53.819799 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:52:53.827395 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m16:52:53.828329 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:52:53.828721 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12527a080>]}
[0m16:52:53.829016 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m16:52:53.829503 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.10s]
[0m16:52:53.830443 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:52:53.830817 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:52:53.831228 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1252b2590>]}
[0m16:52:53.831722 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m16:52:53.832080 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:52:53.875599 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.109 seconds
[0m16:52:53.875917 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.104 seconds
[0m16:52:53.878065 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.879799 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.880021 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:52:53.880228 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:52:53.881445 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.881695 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.883373 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.884954 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.885166 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:52:53.885371 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:52:53.886346 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.886672 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.887607 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:52:53.888580 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:52:53.888831 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.889103 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.889390 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:52:53.889647 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:52:53.900769 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m16:52:53.901039 [debug] [Thread-4 (]: SQL status: COMMIT in 0.011 seconds
[0m16:52:53.902731 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:52:53.904305 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:52:53.904791 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:52:53.905196 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:52:53.905400 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:52:53.905604 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:52:53.911964 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:52:53.912236 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m16:52:53.913081 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:52:53.913766 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:52:53.914158 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1252a0160>]}
[0m16:52:53.914463 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1251fe3e0>]}
[0m16:52:53.914859 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.19s]
[0m16:52:53.915215 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.19s]
[0m16:52:53.915588 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:52:53.915899 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:52:53.916363 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m16:52:53.916564 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.properties
[0m16:52:53.916852 [info ] [Thread-3 (]: 6 of 7 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:52:53.917075 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:52:53.917397 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.businesses)
[0m16:52:53.917646 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.properties)
[0m16:52:53.917855 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:52:53.918053 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.properties
[0m16:52:53.921401 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:52:53.923722 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:52:53.924533 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m16:52:53.924798 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.properties
[0m16:52:53.927269 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:52:53.929505 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:52:53.930012 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:53.930240 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:52:53.930545 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:53.930870 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:52:53.931130 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:52:53.931505 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:52:53.942660 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m16:52:53.942932 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m16:52:53.943197 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:53.943417 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:53.943669 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:52:53.943954 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:52:53.987872 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.044 seconds
[0m16:52:53.990023 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:53.990243 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m16:52:53.991418 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.993152 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:53.993365 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:52:53.993968 [debug] [Thread-1 (]: SQL status: SELECT 9083 in 0.050 seconds
[0m16:52:53.995686 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:53.995933 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m16:52:53.996138 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:52:53.996986 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:52:53.997190 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:53.997374 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:52:53.997569 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:52:53.998277 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:52:53.998464 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:53.998635 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:52:54.000834 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m16:52:54.001045 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:52:54.003122 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:52:54.004407 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m16:52:54.004841 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:52:54.005285 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:52:54.005488 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:52:54.005684 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m16:52:54.006672 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:52:54.007587 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: Close
[0m16:52:54.008017 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125365f60>]}
[0m16:52:54.008404 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics_analytics.properties ............... [[32mSELECT 9083[0m in 0.09s]
[0m16:52:54.008726 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.properties
[0m16:52:54.010021 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m16:52:54.010866 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m16:52:54.011240 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bca8a0d3-e8ab-43b6-9a39-831c87959ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123574280>]}
[0m16:52:54.011628 [info ] [Thread-3 (]: 6 of 7 OK created sql table model analytics_analytics.businesses ............... [[32mSELECT 6223[0m in 0.09s]
[0m16:52:54.011953 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m16:52:54.012719 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:54.012910 [debug] [MainThread]: On master: BEGIN
[0m16:52:54.013065 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:52:54.024198 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m16:52:54.024620 [debug] [MainThread]: On master: COMMIT
[0m16:52:54.024862 [debug] [MainThread]: Using postgres connection "master"
[0m16:52:54.025029 [debug] [MainThread]: On master: COMMIT
[0m16:52:54.025809 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:52:54.026072 [debug] [MainThread]: On master: Close
[0m16:52:54.026347 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:52:54.026517 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:52:54.026668 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:52:54.026822 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:52:54.026966 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:52:54.027198 [info ] [MainThread]: 
[0m16:52:54.027456 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.55 seconds (0.55s).
[0m16:52:54.028172 [debug] [MainThread]: Command end result
[0m16:52:54.041536 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:52:54.042982 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:52:54.047391 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:52:54.047634 [info ] [MainThread]: 
[0m16:52:54.047868 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:52:54.048060 [info ] [MainThread]: 
[0m16:52:54.048267 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m16:52:54.048630 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:52:54.050879 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.2279322, "process_in_blocks": "0", "process_kernel_time": 0.227586, "process_mem_max_rss": "136380416", "process_out_blocks": "0", "process_user_time": 1.493958}
[0m16:52:54.051324 [debug] [MainThread]: Command `dbt run` succeeded at 16:52:54.051269 after 1.23 seconds
[0m16:52:54.051597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d82920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122f6b970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12251e500>]}
[0m16:52:54.051844 [debug] [MainThread]: Flushing usage events
[0m16:52:54.558799 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:13:40.033166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062428f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101c0d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101c0610>]}


============================== 17:13:40.036374 | 1c93e2af-6366-4c5a-8b28-50fd41b81bb1 ==============================
[0m17:13:40.036374 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:13:40.036865 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run -m +int --profiles-dir .', 'no_print': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'introspect': 'True', 'empty': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'quiet': 'False', 'profiles_dir': '.', 'indirect_selection': 'eager', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None'}
[0m17:13:40.037190 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:13:40.037445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11010e740>]}
[0m17:13:40.405182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102ac250>]}
[0m17:13:40.446990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11019c100>]}
[0m17:13:40.447755 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:13:40.516639 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:13:40.590831 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m17:13:40.591180 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/business_timeline.sql
[0m17:13:40.773126 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:13:40.781058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112a8130>]}
[0m17:13:40.824811 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:13:40.826104 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:13:40.838363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112a9d80>]}
[0m17:13:40.838715 [info ] [MainThread]: Found 8 models, 5 sources, 434 macros
[0m17:13:40.838972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112ab8e0>]}
[0m17:13:40.839944 [info ] [MainThread]: 
[0m17:13:40.840156 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:13:40.840324 [info ] [MainThread]: 
[0m17:13:40.840602 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:13:40.843175 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:13:40.876896 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:13:40.877207 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:13:40.877378 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:41.038612 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.161 seconds
[0m17:13:41.039836 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:13:41.041315 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:13:41.046527 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:13:41.046857 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:13:41.047078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:13:41.061747 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m17:13:41.062135 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:13:41.062410 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:13:41.075697 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.013 seconds
[0m17:13:41.076903 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:13:41.078701 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:13:41.083659 [debug] [MainThread]: Using postgres connection "master"
[0m17:13:41.083998 [debug] [MainThread]: On master: BEGIN
[0m17:13:41.084202 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:13:41.096710 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m17:13:41.097076 [debug] [MainThread]: Using postgres connection "master"
[0m17:13:41.097339 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:13:41.113055 [debug] [MainThread]: SQL status: SELECT 0 in 0.015 seconds
[0m17:13:41.113950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105df8520>]}
[0m17:13:41.114637 [debug] [MainThread]: On master: ROLLBACK
[0m17:13:41.116341 [debug] [MainThread]: Using postgres connection "master"
[0m17:13:41.116615 [debug] [MainThread]: On master: BEGIN
[0m17:13:41.118407 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m17:13:41.118639 [debug] [MainThread]: On master: COMMIT
[0m17:13:41.118819 [debug] [MainThread]: Using postgres connection "master"
[0m17:13:41.118985 [debug] [MainThread]: On master: COMMIT
[0m17:13:41.119746 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:13:41.119936 [debug] [MainThread]: On master: Close
[0m17:13:41.122352 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m17:13:41.122767 [info ] [Thread-1 (]: 1 of 8 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m17:13:41.123082 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m17:13:41.123302 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m17:13:41.128993 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m17:13:41.129825 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m17:13:41.154501 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m17:13:41.155147 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:13:41.155368 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m17:13:41.155759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:13:41.167713 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m17:13:41.168106 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:13:41.168458 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m17:13:41.180493 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.012 seconds
[0m17:13:41.186382 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:13:41.186671 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m17:13:41.188718 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:13:41.190841 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:13:41.191092 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m17:13:41.192234 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.201764 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:13:41.202094 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:13:41.202289 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:13:41.204040 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m17:13:41.207743 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m17:13:41.210078 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:13:41.210316 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m17:13:41.217644 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:13:41.219369 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m17:13:41.220669 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111741de0>]}
[0m17:13:41.221211 [info ] [Thread-1 (]: 1 of 8 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.10s]
[0m17:13:41.221577 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m17:13:41.222161 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:13:41.222410 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:13:41.222631 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:13:41.222841 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:13:41.223089 [info ] [Thread-3 (]: 2 of 8 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m17:13:41.223388 [info ] [Thread-4 (]: 3 of 8 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m17:13:41.223674 [info ] [Thread-2 (]: 4 of 8 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m17:13:41.224025 [info ] [Thread-1 (]: 5 of 8 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m17:13:41.224362 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m17:13:41.224651 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:13:41.224920 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m17:13:41.225145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m17:13:41.225355 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:13:41.225559 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:13:41.225750 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:13:41.225941 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:13:41.229040 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.230980 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.233168 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.234955 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.235829 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:13:41.238202 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.238522 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:13:41.238783 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:13:41.239104 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:13:41.241431 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.243580 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.246326 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.246631 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.247129 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m17:13:41.247408 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.247688 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:13:41.247916 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.248164 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m17:13:41.248364 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.248674 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m17:13:41.248897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:13:41.249174 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m17:13:41.249470 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:13:41.249861 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:13:41.263353 [debug] [Thread-4 (]: SQL status: BEGIN in 0.016 seconds
[0m17:13:41.263690 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.263940 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:13:41.264320 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m17:13:41.264510 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.264736 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:13:41.266746 [debug] [Thread-3 (]: SQL status: BEGIN in 0.017 seconds
[0m17:13:41.267123 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.267363 [debug] [Thread-2 (]: SQL status: BEGIN in 0.018 seconds
[0m17:13:41.267631 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:13:41.267883 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.268168 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:13:41.284523 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.019 seconds
[0m17:13:41.286933 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.287190 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m17:13:41.288557 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.290326 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.290547 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m17:13:41.291641 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.292574 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:13:41.292796 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.292998 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:13:41.294057 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.026 seconds
[0m17:13:41.296534 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.296791 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m17:13:41.299022 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:13:41.301298 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.301587 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m17:13:41.301863 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m17:13:41.303320 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m17:13:41.303603 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:13:41.304182 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:13:41.305257 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:13:41.305571 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m17:13:41.305852 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.306146 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:13:41.312889 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m17:13:41.315502 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m17:13:41.316034 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:13:41.316262 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m17:13:41.320262 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m17:13:41.321304 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m17:13:41.321761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118a07c0>]}
[0m17:13:41.322176 [info ] [Thread-1 (]: 5 of 8 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m17:13:41.322508 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:13:41.330852 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.014 seconds
[0m17:13:41.331892 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m17:13:41.332303 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111911b10>]}
[0m17:13:41.332708 [info ] [Thread-3 (]: 2 of 8 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.11s]
[0m17:13:41.333044 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:13:41.413228 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.149 seconds
[0m17:13:41.415761 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.416049 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m17:13:41.417494 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.419221 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.419435 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m17:13:41.420512 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.421343 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:13:41.421542 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.421724 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:13:41.430892 [debug] [Thread-4 (]: SQL status: COMMIT in 0.009 seconds
[0m17:13:41.432808 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m17:13:41.433347 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:13:41.433576 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m17:13:41.435390 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.167 seconds
[0m17:13:41.437645 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.437907 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m17:13:41.439255 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.441356 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.441638 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m17:13:41.442843 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.443826 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:13:41.444058 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.444251 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:13:41.445030 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:13:41.445838 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m17:13:41.446085 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m17:13:41.446489 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111884280>]}
[0m17:13:41.448302 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m17:13:41.448772 [info ] [Thread-4 (]: 3 of 8 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.22s]
[0m17:13:41.449353 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:13:41.449776 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:13:41.450042 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m17:13:41.467364 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.017 seconds
[0m17:13:41.468356 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m17:13:41.468752 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111855630>]}
[0m17:13:41.469153 [info ] [Thread-2 (]: 4 of 8 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.24s]
[0m17:13:41.469511 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:13:41.469978 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:13:41.470277 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m17:13:41.470834 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.properties
[0m17:13:41.470606 [info ] [Thread-1 (]: 6 of 8 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:13:41.471165 [info ] [Thread-3 (]: 7 of 8 START sql table model analytics_analytics.businesses .................... [RUN]
[0m17:13:41.471608 [info ] [Thread-4 (]: 8 of 8 START sql table model analytics_analytics.properties .................... [RUN]
[0m17:13:41.471930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m17:13:41.472162 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.businesses)
[0m17:13:41.472368 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.properties)
[0m17:13:41.472580 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:13:41.472777 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m17:13:41.473071 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.properties
[0m17:13:41.476462 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:13:41.478375 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m17:13:41.481053 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m17:13:41.481937 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:13:41.484138 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:13:41.484482 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m17:13:41.484861 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.properties
[0m17:13:41.486909 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m17:13:41.488901 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m17:13:41.489284 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:13:41.489808 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:13:41.490042 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:13:41.490427 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m17:13:41.490754 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m17:13:41.491058 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m17:13:41.491347 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m17:13:41.491697 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: BEGIN
[0m17:13:41.491939 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m17:13:41.506742 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m17:13:41.507084 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m17:13:41.507444 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m17:13:41.507695 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m17:13:41.507909 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m17:13:41.508107 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:13:41.508381 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m17:13:41.508710 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m17:13:41.509093 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select primary_liable_party_name as business_name, account_end_date  as date, 'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select primary_liable_party_name as business_name, account_start_date as date, 'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select primary_liable_party_name as business_name, liable_responsibility_start_date as date, 'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select primary_liable_party_name as business_name, liable_responsibility_start_date as date, 'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, date
  );
  
[0m17:13:41.511031 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "account_start_date" does not exist
LINE 20: ...elect primary_liable_party_name as business_name, account_st...
                                                              ^

[0m17:13:41.511325 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m17:13:41.512057 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:13:41.516143 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 20: ...elect primary_liable_party_name as business_name, account_st...
                                                                ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:13:41.516592 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11182c310>]}
[0m17:13:41.516999 [error] [Thread-1 (]: 6 of 8 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.04s]
[0m17:13:41.517321 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:13:41.517676 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 20: ...elect primary_liable_party_name as business_name, account_st...
                                                                ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m17:13:41.552963 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.044 seconds
[0m17:13:41.555292 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m17:13:41.555532 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m17:13:41.556761 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.559185 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m17:13:41.559417 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m17:13:41.560442 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.561317 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m17:13:41.561521 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m17:13:41.561707 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m17:13:41.563120 [debug] [Thread-4 (]: SQL status: SELECT 9083 in 0.054 seconds
[0m17:13:41.564939 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m17:13:41.565163 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m17:13:41.565953 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m17:13:41.567281 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m17:13:41.567703 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m17:13:41.567901 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:13:41.568122 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m17:13:41.569769 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m17:13:41.570024 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m17:13:41.570829 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:13:41.571712 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: COMMIT
[0m17:13:41.571953 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m17:13:41.572157 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: COMMIT
[0m17:13:41.573295 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m17:13:41.574679 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m17:13:41.575092 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m17:13:41.575284 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m17:13:41.575473 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m17:13:41.576225 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m17:13:41.576594 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118d7e80>]}
[0m17:13:41.576971 [info ] [Thread-3 (]: 7 of 8 OK created sql table model analytics_analytics.businesses ............... [[32mSELECT 6223[0m in 0.10s]
[0m17:13:41.577396 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m17:13:41.579839 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m17:13:41.580611 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: Close
[0m17:13:41.580947 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c93e2af-6366-4c5a-8b28-50fd41b81bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119508b0>]}
[0m17:13:41.581298 [info ] [Thread-4 (]: 8 of 8 OK created sql table model analytics_analytics.properties ............... [[32mSELECT 9083[0m in 0.11s]
[0m17:13:41.581615 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.properties
[0m17:13:41.582289 [debug] [MainThread]: Using postgres connection "master"
[0m17:13:41.582470 [debug] [MainThread]: On master: BEGIN
[0m17:13:41.582626 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:13:41.593518 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:13:41.593876 [debug] [MainThread]: On master: COMMIT
[0m17:13:41.594064 [debug] [MainThread]: Using postgres connection "master"
[0m17:13:41.594294 [debug] [MainThread]: On master: COMMIT
[0m17:13:41.595007 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:13:41.595228 [debug] [MainThread]: On master: Close
[0m17:13:41.595508 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:13:41.595674 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:13:41.595829 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m17:13:41.596030 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m17:13:41.596279 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m17:13:41.596618 [info ] [MainThread]: 
[0m17:13:41.597090 [info ] [MainThread]: Finished running 8 table models in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m17:13:41.598119 [debug] [MainThread]: Command end result
[0m17:13:41.616150 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:13:41.617365 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:13:41.625172 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:13:41.625696 [info ] [MainThread]: 
[0m17:13:41.626051 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:13:41.626339 [info ] [MainThread]: 
[0m17:13:41.626639 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m17:13:41.626988 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 20: ...elect primary_liable_party_name as business_name, account_st...
                                                                ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:13:41.627212 [info ] [MainThread]: 
[0m17:13:41.627419 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m17:13:41.627654 [info ] [MainThread]: 
[0m17:13:41.627879 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=8
[0m17:13:41.628217 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:13:41.631333 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.6531985, "process_in_blocks": "0", "process_kernel_time": 0.26154, "process_mem_max_rss": "136249344", "process_out_blocks": "0", "process_user_time": 1.548884}
[0m17:13:41.631731 [debug] [MainThread]: Command `dbt run` failed at 17:13:41.631681 after 1.65 seconds
[0m17:13:41.631985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062428f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102ac250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106396c80>]}
[0m17:13:41.632225 [debug] [MainThread]: Flushing usage events
[0m17:13:42.192315 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:14:54.919191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121e828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123ec0d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123ec0610>]}


============================== 17:14:54.922206 | ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345 ==============================
[0m17:14:54.922206 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:14:54.922546 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'invocation_command': 'dbt run -m int/business_timeline --profiles-dir .', 'fail_fast': 'False', 'warn_error': 'None', 'quiet': 'False', 'static_parser': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'use_colors': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_cache_events': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'partial_parse': 'True'}
[0m17:14:54.922842 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:14:54.923052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123e0e740>]}
[0m17:14:55.053312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12646c250>]}
[0m17:14:55.097261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123e9c100>]}
[0m17:14:55.098100 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:14:55.164593 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:14:55.234797 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:14:55.235176 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m17:14:55.428238 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:14:55.436507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1275ac130>]}
[0m17:14:55.481273 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:14:55.482808 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:14:55.494552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1275ac790>]}
[0m17:14:55.494911 [info ] [MainThread]: Found 8 models, 5 sources, 434 macros
[0m17:14:55.495109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca3aeb0d-92f5-4d4f-b6ab-25c935cf7345', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1275af850>]}
[0m17:14:55.495605 [warn ] [MainThread]: The selection criterion 'int/business_timeline' does not match any enabled nodes
[0m17:14:55.496251 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m17:14:55.496716 [debug] [MainThread]: Command end result
[0m17:14:55.510457 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:14:55.511710 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:14:55.513887 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:14:55.514225 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:14:55.516313 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6470693, "process_in_blocks": "0", "process_kernel_time": 0.169454, "process_mem_max_rss": "122355712", "process_out_blocks": "0", "process_user_time": 1.255565}
[0m17:14:55.516791 [debug] [MainThread]: Command `dbt run` succeeded at 17:14:55.516697 after 0.65 seconds
[0m17:14:55.517061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121e828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1273975e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1269a6470>]}
[0m17:14:55.517287 [debug] [MainThread]: Flushing usage events
[0m17:14:56.003889 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:15:15.955709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030ca890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10474cb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10474c460>]}


============================== 17:15:15.958548 | 57ccafb9-6a9b-4c8b-bf8a-325d5143c792 ==============================
[0m17:15:15.958548 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:15:15.958884 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'invocation_command': 'dbt run -m business_timeline --profiles-dir .', 'profiles_dir': '.', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'quiet': 'False', 'empty': 'False', 'introspect': 'True', 'partial_parse': 'True', 'log_format': 'default', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True'}
[0m17:15:15.959169 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:15:15.959382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104695a20>]}
[0m17:15:16.091167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104832980>]}
[0m17:15:16.133376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104871270>]}
[0m17:15:16.134589 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:15:16.201220 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:15:16.277294 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:15:16.277600 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:15:16.281074 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:15:16.300087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054b1c60>]}
[0m17:15:16.378309 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:15:16.379784 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:15:16.391403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054b6c80>]}
[0m17:15:16.391754 [info ] [MainThread]: Found 8 models, 5 sources, 434 macros
[0m17:15:16.391982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10547ed10>]}
[0m17:15:16.392729 [info ] [MainThread]: 
[0m17:15:16.392936 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:15:16.393106 [info ] [MainThread]: 
[0m17:15:16.393383 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:15:16.393852 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:15:16.426862 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:15:16.427186 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:15:16.427359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:15:16.501956 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.075 seconds
[0m17:15:16.502959 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:15:16.506541 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:15:16.510440 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:15:16.510720 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:15:16.510902 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:15:16.529526 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m17:15:16.529858 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:15:16.530069 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:15:16.539455 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.009 seconds
[0m17:15:16.540315 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:15:16.541088 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:15:16.544447 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:16.544652 [debug] [MainThread]: On master: BEGIN
[0m17:15:16.544807 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:15:16.563336 [debug] [MainThread]: SQL status: BEGIN in 0.018 seconds
[0m17:15:16.563676 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:16.563952 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:15:16.578616 [debug] [MainThread]: SQL status: SELECT 0 in 0.014 seconds
[0m17:15:16.579528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104706fe0>]}
[0m17:15:16.579865 [debug] [MainThread]: On master: ROLLBACK
[0m17:15:16.580922 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:16.581172 [debug] [MainThread]: On master: BEGIN
[0m17:15:16.582621 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:15:16.582859 [debug] [MainThread]: On master: COMMIT
[0m17:15:16.583063 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:16.583259 [debug] [MainThread]: On master: COMMIT
[0m17:15:16.583968 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:15:16.584189 [debug] [MainThread]: On master: Close
[0m17:15:16.586107 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:15:16.586534 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:15:16.586896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m17:15:16.587198 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:15:16.593930 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:15:16.594541 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:15:16.619607 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:15:16.620674 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:15:16.620897 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:15:16.621086 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:15:16.635075 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m17:15:16.635364 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:15:16.635595 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        account_start_date as date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, date
  );
  
[0m17:15:16.639066 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "account_start_date" does not exist
LINE 25:         account_start_date as date, 
                 ^

[0m17:15:16.639323 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m17:15:16.640508 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:15:16.644889 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 25:         account_start_date as date, 
                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:15:16.646266 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57ccafb9-6a9b-4c8b-bf8a-325d5143c792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f23bb0>]}
[0m17:15:16.646799 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.06s]
[0m17:15:16.647186 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:15:16.647543 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 25:         account_start_date as date, 
                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m17:15:16.648512 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:16.648713 [debug] [MainThread]: On master: BEGIN
[0m17:15:16.648937 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:15:16.660409 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:15:16.660720 [debug] [MainThread]: On master: COMMIT
[0m17:15:16.660902 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:16.661078 [debug] [MainThread]: On master: COMMIT
[0m17:15:16.661867 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:15:16.662101 [debug] [MainThread]: On master: Close
[0m17:15:16.662338 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:15:16.662494 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:15:16.662673 [info ] [MainThread]: 
[0m17:15:16.662906 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m17:15:16.663270 [debug] [MainThread]: Command end result
[0m17:15:16.675792 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:15:16.676910 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:15:16.680686 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:15:16.680881 [info ] [MainThread]: 
[0m17:15:16.681094 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:15:16.681270 [info ] [MainThread]: 
[0m17:15:16.681472 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m17:15:16.681671 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 25:         account_start_date as date, 
                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:15:16.681830 [info ] [MainThread]: 
[0m17:15:16.682011 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m17:15:16.682163 [info ] [MainThread]: 
[0m17:15:16.682329 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m17:15:16.682615 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:15:16.684992 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.776947, "process_in_blocks": "0", "process_kernel_time": 0.203959, "process_mem_max_rss": "129695744", "process_out_blocks": "0", "process_user_time": 1.215396}
[0m17:15:16.685436 [debug] [MainThread]: Command `dbt run` failed at 17:15:16.685380 after 0.78 seconds
[0m17:15:16.685701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030ca890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033e0580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b9fd00>]}
[0m17:15:16.685936 [debug] [MainThread]: Flushing usage events
[0m17:15:17.210869 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:15:40.725033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10837e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a540c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5404f0>]}


============================== 17:15:40.728276 | 251c8848-7327-494d-947a-95c533073c68 ==============================
[0m17:15:40.728276 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:15:40.728649 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'printer_width': '80', 'static_parser': 'True', 'target_path': 'None', 'empty': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'version_check': 'True', 'use_colors': 'True', 'debug': 'False', 'invocation_command': 'dbt run -m business_timeline --profiles-dir .', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'quiet': 'False'}
[0m17:15:40.728951 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:15:40.729172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '251c8848-7327-494d-947a-95c533073c68', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48ed40>]}
[0m17:15:40.862052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a62aaa0>]}
[0m17:15:40.907473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a664880>]}
[0m17:15:40.908642 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:15:40.976763 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:15:41.052649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:15:41.053089 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m17:15:41.252249 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:15:41.260839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4dc100>]}
[0m17:15:41.306017 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:15:41.307485 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:15:41.318491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4dd7e0>]}
[0m17:15:41.318821 [info ] [MainThread]: Found 8 models, 5 sources, 434 macros
[0m17:15:41.319026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2d7910>]}
[0m17:15:41.319783 [info ] [MainThread]: 
[0m17:15:41.319981 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:15:41.320143 [info ] [MainThread]: 
[0m17:15:41.320425 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:15:41.320871 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:15:41.355095 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:15:41.355424 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:15:41.355604 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:15:41.409838 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.054 seconds
[0m17:15:41.410828 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:15:41.414120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:15:41.417777 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:15:41.418037 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:15:41.418224 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:15:41.439529 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m17:15:41.439876 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:15:41.440112 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:15:41.447943 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.008 seconds
[0m17:15:41.448915 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:15:41.449947 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:15:41.453768 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:41.454013 [debug] [MainThread]: On master: BEGIN
[0m17:15:41.454202 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:15:41.469873 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m17:15:41.470164 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:41.470429 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:15:41.479751 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m17:15:41.480528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4d1a50>]}
[0m17:15:41.480859 [debug] [MainThread]: On master: ROLLBACK
[0m17:15:41.481759 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:41.482080 [debug] [MainThread]: On master: BEGIN
[0m17:15:41.483655 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:15:41.483898 [debug] [MainThread]: On master: COMMIT
[0m17:15:41.484096 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:41.484274 [debug] [MainThread]: On master: COMMIT
[0m17:15:41.484964 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:15:41.485159 [debug] [MainThread]: On master: Close
[0m17:15:41.487821 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:15:41.488182 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:15:41.488478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m17:15:41.488705 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:15:41.494907 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:15:41.495478 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:15:41.517758 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:15:41.518432 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:15:41.518662 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:15:41.518853 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:15:41.530271 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m17:15:41.530567 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:15:41.530827 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        account_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, date
  );
  
[0m17:15:41.532646 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "account_start_date" does not exist
LINE 25:         account_start_date as event_date, 
                 ^

[0m17:15:41.532948 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m17:15:41.533745 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:15:41.537749 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 25:         account_start_date as event_date, 
                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:15:41.539062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '251c8848-7327-494d-947a-95c533073c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081d7cd0>]}
[0m17:15:41.539500 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.05s]
[0m17:15:41.539855 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:15:41.540157 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 25:         account_start_date as event_date, 
                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m17:15:41.541110 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:41.541320 [debug] [MainThread]: On master: BEGIN
[0m17:15:41.541478 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:15:41.552067 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:15:41.552396 [debug] [MainThread]: On master: COMMIT
[0m17:15:41.552597 [debug] [MainThread]: Using postgres connection "master"
[0m17:15:41.552755 [debug] [MainThread]: On master: COMMIT
[0m17:15:41.553363 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:15:41.553536 [debug] [MainThread]: On master: Close
[0m17:15:41.553775 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:15:41.553973 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:15:41.554271 [info ] [MainThread]: 
[0m17:15:41.554474 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m17:15:41.554838 [debug] [MainThread]: Command end result
[0m17:15:41.567442 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:15:41.568508 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:15:41.571878 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:15:41.572087 [info ] [MainThread]: 
[0m17:15:41.572316 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:15:41.572513 [info ] [MainThread]: 
[0m17:15:41.572729 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m17:15:41.572936 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  column "account_start_date" does not exist
  LINE 25:         account_start_date as event_date, 
                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:15:41.573104 [info ] [MainThread]: 
[0m17:15:41.573292 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m17:15:41.573448 [info ] [MainThread]: 
[0m17:15:41.573618 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m17:15:41.573912 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:15:41.576468 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9051308, "process_in_blocks": "0", "process_kernel_time": 0.209322, "process_mem_max_rss": "135905280", "process_out_blocks": "0", "process_user_time": 1.36136}
[0m17:15:41.576899 [debug] [MainThread]: Command `dbt run` failed at 17:15:41.576849 after 0.91 seconds
[0m17:15:41.577144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10837e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fa69b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087ce560>]}
[0m17:15:41.577387 [debug] [MainThread]: Flushing usage events
[0m17:15:42.254539 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:16:45.367878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b2920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ac5000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ac48e0>]}


============================== 17:16:45.371174 | 920efbf1-29da-4e44-bbd4-374542adfff3 ==============================
[0m17:16:45.371174 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:16:45.371533 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'target_path': 'None', 'use_experimental_parser': 'False', 'empty': 'False', 'debug': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'introspect': 'True', 'quiet': 'False', 'no_print': 'None', 'partial_parse': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -m business_timeline --profiles-dir .', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'profiles_dir': '.', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'version_check': 'True'}
[0m17:16:45.371865 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:16:45.372086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106afd0f0>]}
[0m17:16:45.504435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f08d30>]}
[0m17:16:45.547805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108be46a0>]}
[0m17:16:45.548752 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:16:45.615077 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:16:45.687967 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:16:45.688378 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m17:16:45.875911 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:16:45.883886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109aa8130>]}
[0m17:16:45.928105 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:16:45.930179 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:16:45.941475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a5e40>]}
[0m17:16:45.941807 [info ] [MainThread]: Found 8 models, 5 sources, 434 macros
[0m17:16:45.942012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a5330>]}
[0m17:16:45.942781 [info ] [MainThread]: 
[0m17:16:45.942993 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:16:45.943157 [info ] [MainThread]: 
[0m17:16:45.943430 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:16:45.943891 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:16:45.976173 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:16:45.976494 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:16:45.976666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:16:46.034581 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.058 seconds
[0m17:16:46.035539 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:16:46.038666 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:16:46.042445 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:16:46.042712 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:16:46.042910 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:16:46.054960 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m17:16:46.055230 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:16:46.055431 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:16:46.067243 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.012 seconds
[0m17:16:46.068073 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:16:46.068836 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:16:46.072321 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:46.072574 [debug] [MainThread]: On master: BEGIN
[0m17:16:46.072753 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:16:46.084314 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:16:46.084619 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:46.084874 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:16:46.093144 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m17:16:46.094005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042904c0>]}
[0m17:16:46.094328 [debug] [MainThread]: On master: ROLLBACK
[0m17:16:46.095242 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:46.095524 [debug] [MainThread]: On master: BEGIN
[0m17:16:46.097070 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:16:46.097359 [debug] [MainThread]: On master: COMMIT
[0m17:16:46.097707 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:46.097911 [debug] [MainThread]: On master: COMMIT
[0m17:16:46.098961 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:16:46.099247 [debug] [MainThread]: On master: Close
[0m17:16:46.101211 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:16:46.101576 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:16:46.101978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m17:16:46.102333 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:16:46.107634 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:16:46.108198 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:16:46.129448 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:16:46.130061 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:16:46.130278 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:16:46.130465 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:16:46.141553 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m17:16:46.141909 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:16:46.142175 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, date
  );
  
[0m17:16:46.144600 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "date" does not exist
LINE 56: select * from combined_accounts order by business_name, date
                                                                 ^

[0m17:16:46.144855 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m17:16:46.145765 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:16:46.149685 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "date" does not exist
  LINE 56: select * from combined_accounts order by business_name, date
                                                                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:16:46.150994 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '920efbf1-29da-4e44-bbd4-374542adfff3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c08430>]}
[0m17:16:46.151523 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.05s]
[0m17:16:46.151851 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:16:46.152203 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  column "date" does not exist
  LINE 56: select * from combined_accounts order by business_name, date
                                                                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m17:16:46.153325 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:46.153567 [debug] [MainThread]: On master: BEGIN
[0m17:16:46.153738 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:16:46.165029 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:16:46.165349 [debug] [MainThread]: On master: COMMIT
[0m17:16:46.165521 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:46.165682 [debug] [MainThread]: On master: COMMIT
[0m17:16:46.166407 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:16:46.166600 [debug] [MainThread]: On master: Close
[0m17:16:46.166864 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:16:46.167028 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:16:46.167391 [info ] [MainThread]: 
[0m17:16:46.167594 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m17:16:46.168012 [debug] [MainThread]: Command end result
[0m17:16:46.181245 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:16:46.182312 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:16:46.185645 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:16:46.185842 [info ] [MainThread]: 
[0m17:16:46.186192 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:16:46.186468 [info ] [MainThread]: 
[0m17:16:46.186719 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m17:16:46.186936 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  column "date" does not exist
  LINE 56: select * from combined_accounts order by business_name, date
                                                                   ^
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m17:16:46.187110 [info ] [MainThread]: 
[0m17:16:46.187302 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m17:16:46.187461 [info ] [MainThread]: 
[0m17:16:46.187660 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m17:16:46.187974 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:16:46.190097 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8773625, "process_in_blocks": "0", "process_kernel_time": 0.204066, "process_mem_max_rss": "134561792", "process_out_blocks": "0", "process_user_time": 1.34275}
[0m17:16:46.190427 [debug] [MainThread]: Command `dbt run` failed at 17:16:46.190381 after 0.88 seconds
[0m17:16:46.190671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b2920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a8e710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a6a70>]}
[0m17:16:46.190974 [debug] [MainThread]: Flushing usage events
[0m17:16:46.974649 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:17:09.544795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10617e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b40c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b404f0>]}


============================== 17:17:09.547881 | d091af8a-a810-401d-bb2a-a82d9f5ed85c ==============================
[0m17:17:09.547881 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:17:09.548237 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_format': 'default', 'target_path': 'None', 'use_colors': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'profiles_dir': '.', 'introspect': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'static_parser': 'True', 'empty': 'False', 'invocation_command': 'dbt run -m business_timeline --profiles-dir .', 'no_print': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs'}
[0m17:17:09.548548 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:17:09.548752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107633f10>]}
[0m17:17:09.679937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ead930>]}
[0m17:17:09.722338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ee61d0>]}
[0m17:17:09.723414 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:17:09.790240 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:17:09.861432 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:17:09.861857 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m17:17:10.049181 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:17:10.057301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6a8130>]}
[0m17:17:10.101595 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:17:10.103318 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:17:10.114318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a385840>]}
[0m17:17:10.114639 [info ] [MainThread]: Found 8 models, 5 sources, 434 macros
[0m17:17:10.114869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a386ec0>]}
[0m17:17:10.115663 [info ] [MainThread]: 
[0m17:17:10.115905 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:17:10.116070 [info ] [MainThread]: 
[0m17:17:10.116346 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:17:10.116796 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:17:10.145022 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:17:10.145334 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:17:10.145507 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:17:10.200741 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.055 seconds
[0m17:17:10.201649 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:17:10.204592 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:17:10.208167 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:17:10.208437 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:17:10.208616 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:17:10.221346 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m17:17:10.221630 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:17:10.221836 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:17:10.228782 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.007 seconds
[0m17:17:10.229585 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:17:10.230314 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:17:10.233919 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:10.234218 [debug] [MainThread]: On master: BEGIN
[0m17:17:10.234395 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:17:10.245947 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m17:17:10.246265 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:10.246520 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:17:10.255946 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m17:17:10.256720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108afb490>]}
[0m17:17:10.257050 [debug] [MainThread]: On master: ROLLBACK
[0m17:17:10.257870 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:10.258080 [debug] [MainThread]: On master: BEGIN
[0m17:17:10.259525 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:17:10.259754 [debug] [MainThread]: On master: COMMIT
[0m17:17:10.259941 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:10.260126 [debug] [MainThread]: On master: COMMIT
[0m17:17:10.260826 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:17:10.261026 [debug] [MainThread]: On master: Close
[0m17:17:10.263682 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:17:10.264095 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:17:10.264462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m17:17:10.264739 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:17:10.270576 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:17:10.271109 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:17:10.292075 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:17:10.292672 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:17:10.292884 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:17:10.293076 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:17:10.303806 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m17:17:10.304130 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:17:10.304388 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, event_date
  );
  
[0m17:17:10.474757 [debug] [Thread-1 (]: SQL status: SELECT 59208 in 0.170 seconds
[0m17:17:10.480775 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:17:10.481294 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m17:17:10.482910 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:17:10.491041 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:17:10.491312 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:17:10.491507 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:17:10.507261 [debug] [Thread-1 (]: SQL status: COMMIT in 0.015 seconds
[0m17:17:10.510820 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m17:17:10.513686 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:17:10.514031 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m17:17:10.515765 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m17:17:10.517339 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:17:10.518730 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd091af8a-a810-401d-bb2a-a82d9f5ed85c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c1e230>]}
[0m17:17:10.519333 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 59208[0m in 0.25s]
[0m17:17:10.519772 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:17:10.520752 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:10.521067 [debug] [MainThread]: On master: BEGIN
[0m17:17:10.521283 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:17:10.533656 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m17:17:10.534016 [debug] [MainThread]: On master: COMMIT
[0m17:17:10.534391 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:10.534609 [debug] [MainThread]: On master: COMMIT
[0m17:17:10.542357 [debug] [MainThread]: SQL status: COMMIT in 0.007 seconds
[0m17:17:10.543745 [debug] [MainThread]: On master: Close
[0m17:17:10.545061 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:17:10.547245 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:17:10.548742 [info ] [MainThread]: 
[0m17:17:10.552617 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.43 seconds (0.43s).
[0m17:17:10.553302 [debug] [MainThread]: Command end result
[0m17:17:10.615107 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:17:10.616225 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:17:10.623636 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:17:10.624554 [info ] [MainThread]: 
[0m17:17:10.625382 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:17:10.625651 [info ] [MainThread]: 
[0m17:17:10.625872 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:17:10.626816 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:17:10.642088 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1499443, "process_in_blocks": "0", "process_kernel_time": 0.186019, "process_mem_max_rss": "136282112", "process_out_blocks": "0", "process_user_time": 1.358776}
[0m17:17:10.642732 [debug] [MainThread]: Command `dbt run` succeeded at 17:17:10.642649 after 1.15 seconds
[0m17:17:10.643014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10617e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065568c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3777c0>]}
[0m17:17:10.643274 [debug] [MainThread]: Flushing usage events
[0m17:17:11.073128 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:21:07.950600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e8a8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10550cc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10550c550>]}


============================== 17:21:07.954372 | d73adcd6-98c1-4f5e-925c-ccaa76ba15cd ==============================
[0m17:21:07.954372 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:21:07.954757 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_format': 'default', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_cache_events': 'False', 'empty': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'write_json': 'True', 'target_path': 'None', 'printer_width': '80', 'static_parser': 'True', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'debug': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True'}
[0m17:21:07.955070 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:21:07.955295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049035b0>]}
[0m17:21:08.119485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055dfbb0>]}
[0m17:21:08.162902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105630880>]}
[0m17:21:08.163674 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:21:08.230974 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:21:08.304866 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m17:21:08.305220 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/business_with_full_timeline.sql
[0m17:21:08.488025 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:21:08.496132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063a8100>]}
[0m17:21:08.543022 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:21:08.544849 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:21:08.558460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063ab220>]}
[0m17:21:08.558852 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m17:21:08.559065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063a9f00>]}
[0m17:21:08.560285 [info ] [MainThread]: 
[0m17:21:08.560561 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:21:08.560769 [info ] [MainThread]: 
[0m17:21:08.561052 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:21:08.563662 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:21:08.596616 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:21:08.596917 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:21:08.597088 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:21:08.652967 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.056 seconds
[0m17:21:08.653955 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:21:08.655037 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:21:08.658600 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:21:08.658853 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:21:08.659029 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:21:08.677220 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m17:21:08.677579 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:21:08.677797 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:21:08.688806 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.011 seconds
[0m17:21:08.689834 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:21:08.690675 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:21:08.694767 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:08.695044 [debug] [MainThread]: On master: BEGIN
[0m17:21:08.695236 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:21:08.709080 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m17:21:08.709436 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:08.709731 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:21:08.719631 [debug] [MainThread]: SQL status: SELECT 0 in 0.010 seconds
[0m17:21:08.720436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f191b0>]}
[0m17:21:08.720768 [debug] [MainThread]: On master: ROLLBACK
[0m17:21:08.721510 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:08.721720 [debug] [MainThread]: On master: BEGIN
[0m17:21:08.723071 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:21:08.723380 [debug] [MainThread]: On master: COMMIT
[0m17:21:08.723590 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:08.723785 [debug] [MainThread]: On master: COMMIT
[0m17:21:08.724500 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:21:08.724750 [debug] [MainThread]: On master: Close
[0m17:21:08.727279 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m17:21:08.727656 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m17:21:08.727971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m17:21:08.728208 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m17:21:08.734413 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m17:21:08.735421 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m17:21:08.756908 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m17:21:08.757527 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:08.757745 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m17:21:08.757941 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:08.769641 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m17:21:08.769998 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:08.770227 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m17:21:08.787996 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.017 seconds
[0m17:21:08.794191 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:08.794509 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m17:21:08.796093 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:08.798255 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:08.798505 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m17:21:08.799782 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:08.808675 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:21:08.808929 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:08.809131 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:21:08.810985 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m17:21:08.814776 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m17:21:08.817928 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:08.818192 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m17:21:08.823559 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m17:21:08.825267 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m17:21:08.826535 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106841f90>]}
[0m17:21:08.827035 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.10s]
[0m17:21:08.827381 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m17:21:08.827845 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:21:08.828127 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:08.828357 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:21:08.828801 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:21:08.828627 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m17:21:08.829168 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m17:21:08.829506 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m17:21:08.829888 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m17:21:08.830247 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m17:21:08.830518 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:21:08.830783 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m17:21:08.831033 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m17:21:08.831255 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:21:08.831449 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:08.831634 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:21:08.831886 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:21:08.833960 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.835816 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:08.837576 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:08.839687 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.840579 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:21:08.840923 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:21:08.841143 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:08.843546 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.843868 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:21:08.846203 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.849189 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:08.851623 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:08.852074 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.852538 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:08.852782 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.853017 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:08.853211 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m17:21:08.853426 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m17:21:08.853641 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m17:21:08.853875 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m17:21:08.854101 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:21:08.854304 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:21:08.854488 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:08.854674 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:21:08.874870 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m17:21:08.875283 [debug] [Thread-2 (]: SQL status: BEGIN in 0.021 seconds
[0m17:21:08.875672 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m17:21:08.875989 [debug] [Thread-3 (]: SQL status: BEGIN in 0.022 seconds
[0m17:21:08.876218 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:08.876452 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:08.876650 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.876844 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.877071 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:08.877342 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:08.877610 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:08.877872 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:08.909613 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.031 seconds
[0m17:21:08.912039 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.912410 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.034 seconds
[0m17:21:08.912619 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m17:21:08.914462 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.914775 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m17:21:08.915834 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:08.916192 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:08.918289 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.920273 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.920539 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m17:21:08.920765 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m17:21:08.922184 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:08.923239 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:21:08.923483 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.923687 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:21:08.923925 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:21:08.924817 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:21:08.925203 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.925418 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:21:08.944121 [debug] [Thread-1 (]: SQL status: COMMIT in 0.020 seconds
[0m17:21:08.946568 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m17:21:08.947041 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:08.947271 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m17:21:08.947551 [debug] [Thread-3 (]: SQL status: COMMIT in 0.022 seconds
[0m17:21:08.949072 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m17:21:08.949548 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:08.949773 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m17:21:08.957866 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m17:21:08.958909 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m17:21:08.959214 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m17:21:08.959735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e00a0>]}
[0m17:21:08.960548 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m17:21:08.960959 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.13s]
[0m17:21:08.961345 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:21:08.961630 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b2200>]}
[0m17:21:08.962053 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.13s]
[0m17:21:08.962359 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:21:09.060567 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.182 seconds
[0m17:21:09.062862 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:09.063096 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m17:21:09.064575 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.064815 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.187 seconds
[0m17:21:09.066604 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:09.068442 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:09.068678 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m17:21:09.068889 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m17:21:09.070094 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.070309 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.071886 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:09.072716 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:21:09.072930 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m17:21:09.073128 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:09.073348 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:21:09.074151 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.075120 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:21:09.075346 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:09.075534 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:21:09.082565 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m17:21:09.082816 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m17:21:09.084316 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m17:21:09.086369 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m17:21:09.086808 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:09.087224 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:09.087430 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m17:21:09.087633 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m17:21:09.099443 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m17:21:09.099706 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m17:21:09.100515 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m17:21:09.101693 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m17:21:09.102192 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a55810>]}
[0m17:21:09.102547 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069929e0>]}
[0m17:21:09.102949 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.27s]
[0m17:21:09.103282 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.27s]
[0m17:21:09.103694 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:21:09.103987 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:09.104398 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:21:09.104743 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:21:09.104997 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m17:21:09.105196 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:21:09.107498 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:21:09.107982 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:21:09.110346 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:21:09.110859 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:09.111070 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:21:09.111258 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:09.121690 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m17:21:09.121991 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:09.122238 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, event_date
  );
  
[0m17:21:09.236510 [debug] [Thread-1 (]: SQL status: SELECT 59208 in 0.114 seconds
[0m17:21:09.238669 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:09.238899 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m17:21:09.239988 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.241639 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:09.241893 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m17:21:09.243039 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.243861 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:21:09.244061 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:09.244244 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:21:09.253900 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m17:21:09.255683 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m17:21:09.256167 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:09.256376 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m17:21:09.263723 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:21:09.264594 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:21:09.264969 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a55810>]}
[0m17:21:09.265343 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 59208[0m in 0.16s]
[0m17:21:09.265642 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:21:09.266132 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m17:21:09.266582 [info ] [Thread-2 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m17:21:09.266892 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m17:21:09.267126 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m17:21:09.268881 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.269375 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m17:21:09.280438 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.281029 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.281241 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m17:21:09.281428 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m17:21:09.293126 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m17:21:09.293452 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.293682 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date
  );
[0m17:21:09.301204 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m17:21:09.303324 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.303570 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m17:21:09.304829 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:09.305726 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:21:09.305991 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.306188 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:21:09.307553 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m17:21:09.308939 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m17:21:09.310448 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:09.310675 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m17:21:09.311485 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m17:21:09.312223 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m17:21:09.312581 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd73adcd6-98c1-4f5e-925c-ccaa76ba15cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106939930>]}
[0m17:21:09.312973 [info ] [Thread-2 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.05s]
[0m17:21:09.313304 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m17:21:09.314095 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:09.314343 [debug] [MainThread]: On master: BEGIN
[0m17:21:09.314505 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:21:09.329753 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m17:21:09.330077 [debug] [MainThread]: On master: COMMIT
[0m17:21:09.330248 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:09.330411 [debug] [MainThread]: On master: COMMIT
[0m17:21:09.331160 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:21:09.331408 [debug] [MainThread]: On master: Close
[0m17:21:09.331678 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:21:09.331852 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:21:09.332004 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m17:21:09.332163 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m17:21:09.332303 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m17:21:09.332522 [info ] [MainThread]: 
[0m17:21:09.332705 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.77 seconds (0.77s).
[0m17:21:09.333406 [debug] [MainThread]: Command end result
[0m17:21:09.349427 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:21:09.350942 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:21:09.355708 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:21:09.355987 [info ] [MainThread]: 
[0m17:21:09.356241 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:21:09.356434 [info ] [MainThread]: 
[0m17:21:09.356645 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m17:21:09.357002 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:21:09.359365 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4602325, "process_in_blocks": "0", "process_kernel_time": 0.234453, "process_mem_max_rss": "137773056", "process_out_blocks": "0", "process_user_time": 1.530712}
[0m17:21:09.359777 [debug] [MainThread]: Command `dbt run` succeeded at 17:21:09.359719 after 1.46 seconds
[0m17:21:09.360044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e8a8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105630880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10419a560>]}
[0m17:21:09.360308 [debug] [MainThread]: Flushing usage events
[0m17:21:09.953253 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:21:49.237261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112268f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c44d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c44610>]}


============================== 17:21:49.240125 | c4d9a716-7af6-40b4-a640-7064b7539daf ==============================
[0m17:21:49.240125 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:21:49.240471 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'target_path': 'None', 'static_parser': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'use_colors': 'True', 'debug': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'quiet': 'False', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'version_check': 'True', 'write_json': 'True', 'partial_parse': 'True', 'printer_width': '80', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'indirect_selection': 'eager', 'introspect': 'True', 'fail_fast': 'False', 'log_format': 'default', 'empty': 'False'}
[0m17:21:49.240770 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:21:49.240986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b8e650>]}
[0m17:21:49.420247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112bd7e80>]}
[0m17:21:49.461711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b8feb0>]}
[0m17:21:49.462461 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:21:49.531940 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:21:49.609409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:21:49.609852 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_with_full_timeline.sql
[0m17:21:49.795699 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:21:49.804223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11438c0a0>]}
[0m17:21:49.850676 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:21:49.852129 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:21:49.864237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11438d7b0>]}
[0m17:21:49.864555 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m17:21:49.864760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11438ea70>]}
[0m17:21:49.865652 [info ] [MainThread]: 
[0m17:21:49.865862 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:21:49.866031 [info ] [MainThread]: 
[0m17:21:49.866318 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:21:49.868731 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:21:49.902701 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:21:49.903025 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:21:49.903196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:21:49.967047 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.064 seconds
[0m17:21:49.967977 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:21:49.969261 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:21:49.972911 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:21:49.973211 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:21:49.973391 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:21:49.987057 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m17:21:49.987355 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:21:49.987563 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:21:49.996631 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.009 seconds
[0m17:21:49.997589 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:21:49.998416 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:21:50.002551 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:50.002857 [debug] [MainThread]: On master: BEGIN
[0m17:21:50.003051 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:21:50.017276 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m17:21:50.017611 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:50.017894 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:21:50.028232 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m17:21:50.029479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b9bd30>]}
[0m17:21:50.029867 [debug] [MainThread]: On master: ROLLBACK
[0m17:21:50.032442 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:50.032890 [debug] [MainThread]: On master: BEGIN
[0m17:21:50.038724 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m17:21:50.039088 [debug] [MainThread]: On master: COMMIT
[0m17:21:50.039296 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:50.039474 [debug] [MainThread]: On master: COMMIT
[0m17:21:50.040559 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:21:50.040917 [debug] [MainThread]: On master: Close
[0m17:21:50.046876 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m17:21:50.052408 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m17:21:50.053257 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m17:21:50.053557 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m17:21:50.063406 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m17:21:50.064700 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m17:21:50.096637 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m17:21:50.097520 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:50.097787 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m17:21:50.098406 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:50.116407 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m17:21:50.117000 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:50.117388 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m17:21:50.126297 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.008 seconds
[0m17:21:50.131991 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:50.132288 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m17:21:50.133839 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.135797 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:50.136025 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m17:21:50.137118 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.145648 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:21:50.145912 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:50.146105 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:21:50.147831 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m17:21:50.151843 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m17:21:50.155046 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:21:50.155291 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m17:21:50.160424 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m17:21:50.162070 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m17:21:50.163509 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115145a50>]}
[0m17:21:50.164013 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.11s]
[0m17:21:50.164365 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m17:21:50.164884 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:21:50.165109 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:50.165351 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:21:50.165538 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:21:50.165810 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m17:21:50.166062 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m17:21:50.166478 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m17:21:50.166856 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m17:21:50.167206 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m17:21:50.167488 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:21:50.167736 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m17:21:50.167951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m17:21:50.168166 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:21:50.168367 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:50.168663 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:21:50.168897 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:21:50.171035 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.172817 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.174544 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.176153 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.176971 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:50.177261 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:21:50.177555 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:21:50.177748 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:21:50.179952 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.181906 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.184916 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.186922 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.187590 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.187824 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m17:21:50.188041 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.188286 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:21:50.188600 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.188885 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.189121 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m17:21:50.189485 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m17:21:50.189705 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m17:21:50.189953 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:50.190202 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:21:50.190424 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:21:50.211384 [debug] [Thread-3 (]: SQL status: BEGIN in 0.021 seconds
[0m17:21:50.211746 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m17:21:50.211952 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m17:21:50.212125 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m17:21:50.212349 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.212545 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.212733 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.212920 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.213246 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:50.213610 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:50.214083 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:50.214410 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:21:50.240441 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.026 seconds
[0m17:21:50.243777 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.244083 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m17:21:50.246087 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:21:50.248499 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.248778 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.034 seconds
[0m17:21:50.249037 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m17:21:50.251159 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.251566 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m17:21:50.252628 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.252931 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.253995 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:21:50.255700 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.255967 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.256193 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m17:21:50.256498 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:21:50.265582 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.009 seconds
[0m17:21:50.265920 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m17:21:50.267171 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:21:50.269515 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m17:21:50.270225 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.270970 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:21:50.271247 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:21:50.271482 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m17:21:50.276397 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m17:21:50.278972 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m17:21:50.279735 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:21:50.279993 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m17:21:50.280409 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m17:21:50.281238 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m17:21:50.281636 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1152e42b0>]}
[0m17:21:50.282029 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.11s]
[0m17:21:50.282356 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:21:50.289464 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m17:21:50.290854 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m17:21:50.292100 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115296a40>]}
[0m17:21:50.292639 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.12s]
[0m17:21:50.293105 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:21:50.371732 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.157 seconds
[0m17:21:50.374419 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.374716 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m17:21:50.376412 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.378465 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.378878 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m17:21:50.379766 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.165 seconds
[0m17:21:50.381755 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.382004 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m17:21:50.382283 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:21:50.383516 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:21:50.383864 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.384077 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:21:50.384321 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:21:50.386346 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.386636 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m17:21:50.388013 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.389048 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:21:50.389293 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.389480 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:21:50.392521 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m17:21:50.392831 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m17:21:50.394577 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m17:21:50.396928 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m17:21:50.397470 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:21:50.397947 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:21:50.398190 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m17:21:50.398417 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m17:21:50.417746 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.019 seconds
[0m17:21:50.418695 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m17:21:50.418934 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.020 seconds
[0m17:21:50.419304 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11534d2d0>]}
[0m17:21:50.420055 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m17:21:50.420450 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.25s]
[0m17:21:50.420943 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:21:50.421303 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115337cd0>]}
[0m17:21:50.421847 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.25s]
[0m17:21:50.422170 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:21:50.422628 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:21:50.423069 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:21:50.423419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m17:21:50.423705 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:21:50.426217 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:21:50.426934 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:21:50.429342 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:21:50.429844 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:50.430042 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:21:50.430222 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:50.443020 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m17:21:50.443359 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:50.443622 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, event_date
  );
  
[0m17:21:50.560382 [debug] [Thread-1 (]: SQL status: SELECT 59208 in 0.116 seconds
[0m17:21:50.562812 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:50.563132 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m17:21:50.564394 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.566505 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:50.566757 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m17:21:50.567878 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.568793 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:21:50.569008 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:50.569186 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:21:50.579498 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m17:21:50.581331 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m17:21:50.581847 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:21:50.582061 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m17:21:50.589190 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:21:50.590009 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:21:50.590394 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11532e320>]}
[0m17:21:50.590775 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 59208[0m in 0.17s]
[0m17:21:50.591151 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:21:50.591583 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m17:21:50.591900 [info ] [Thread-4 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m17:21:50.592166 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m17:21:50.592375 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m17:21:50.594140 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.594615 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m17:21:50.605545 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.606138 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.606351 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m17:21:50.606546 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m17:21:50.617586 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m17:21:50.617915 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.618154 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m17:21:50.624568 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m17:21:50.626557 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.626821 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m17:21:50.627906 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:21:50.628712 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:21:50.628923 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.629104 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:21:50.630342 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m17:21:50.631792 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m17:21:50.633355 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:21:50.633609 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m17:21:50.634433 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.001 seconds
[0m17:21:50.635166 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m17:21:50.635528 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d9a716-7af6-40b4-a640-7064b7539daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a1ca60>]}
[0m17:21:50.635905 [info ] [Thread-4 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.04s]
[0m17:21:50.636260 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m17:21:50.636941 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:50.637124 [debug] [MainThread]: On master: BEGIN
[0m17:21:50.637282 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:21:50.648397 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:21:50.648700 [debug] [MainThread]: On master: COMMIT
[0m17:21:50.648876 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:50.649025 [debug] [MainThread]: On master: COMMIT
[0m17:21:50.649626 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:21:50.649831 [debug] [MainThread]: On master: Close
[0m17:21:50.650092 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:21:50.650259 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:21:50.650408 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m17:21:50.650549 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m17:21:50.650688 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m17:21:50.650901 [info ] [MainThread]: 
[0m17:21:50.651175 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.78 seconds (0.78s).
[0m17:21:50.651958 [debug] [MainThread]: Command end result
[0m17:21:50.666276 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:21:50.667496 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:21:50.671541 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:21:50.671794 [info ] [MainThread]: 
[0m17:21:50.672025 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:21:50.672207 [info ] [MainThread]: 
[0m17:21:50.672393 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m17:21:50.672719 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:21:50.675037 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4871905, "process_in_blocks": "0", "process_kernel_time": 0.248162, "process_mem_max_rss": "136036352", "process_out_blocks": "0", "process_user_time": 1.5977}
[0m17:21:50.675419 [debug] [MainThread]: Command `dbt run` succeeded at 17:21:50.675366 after 1.49 seconds
[0m17:21:50.675649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112268f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112983c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111536c80>]}
[0m17:21:50.675870 [debug] [MainThread]: Flushing usage events
[0m17:21:51.171542 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:23:52.446402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091de8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4c0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4c0580>]}


============================== 17:23:52.449687 | 0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1 ==============================
[0m17:23:52.449687 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:23:52.450054 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run -m +business_with_full_timeline', 'version_check': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'printer_width': '80', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'debug': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'target_path': 'None', 'fail_fast': 'False', 'write_json': 'True', 'quiet': 'False', 'introspect': 'True', 'use_colors': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_cache_events': 'False'}
[0m17:23:52.450360 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:23:52.450587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b40b100>]}
[0m17:23:52.622630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b58fdf0>]}
[0m17:23:52.664660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b40a350>]}
[0m17:23:52.665448 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:23:52.734710 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:23:52.808176 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:23:52.808573 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_with_full_timeline.sql
[0m17:23:52.993403 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:23:53.001775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c58c0a0>]}
[0m17:23:53.045980 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:23:53.047536 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:23:53.059417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c58c6d0>]}
[0m17:23:53.059768 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m17:23:53.059970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c58d8a0>]}
[0m17:23:53.060902 [info ] [MainThread]: 
[0m17:23:53.061116 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:23:53.061285 [info ] [MainThread]: 
[0m17:23:53.061569 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:23:53.063910 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:23:53.096672 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:23:53.097001 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:23:53.097172 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:23:53.162621 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.065 seconds
[0m17:23:53.163528 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:23:53.164568 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:23:53.168280 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:23:53.168505 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:23:53.168685 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:23:53.183672 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m17:23:53.183960 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:23:53.184166 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:23:53.191278 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.007 seconds
[0m17:23:53.192306 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:23:53.193131 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:23:53.197193 [debug] [MainThread]: Using postgres connection "master"
[0m17:23:53.197518 [debug] [MainThread]: On master: BEGIN
[0m17:23:53.197758 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:23:53.211115 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m17:23:53.211424 [debug] [MainThread]: Using postgres connection "master"
[0m17:23:53.211706 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:23:53.220537 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m17:23:53.221596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cc83d0>]}
[0m17:23:53.221941 [debug] [MainThread]: On master: ROLLBACK
[0m17:23:53.222704 [debug] [MainThread]: Using postgres connection "master"
[0m17:23:53.222915 [debug] [MainThread]: On master: BEGIN
[0m17:23:53.224141 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:23:53.224346 [debug] [MainThread]: On master: COMMIT
[0m17:23:53.224535 [debug] [MainThread]: Using postgres connection "master"
[0m17:23:53.224715 [debug] [MainThread]: On master: COMMIT
[0m17:23:53.225388 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:23:53.225595 [debug] [MainThread]: On master: Close
[0m17:23:53.228186 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m17:23:53.228542 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m17:23:53.228842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m17:23:53.229069 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m17:23:53.235182 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m17:23:53.236129 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m17:23:53.257846 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m17:23:53.258519 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:23:53.258740 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m17:23:53.258935 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:23:53.274855 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m17:23:53.275192 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:23:53.275421 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m17:23:53.287926 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.012 seconds
[0m17:23:53.293965 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:23:53.294236 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m17:23:53.295669 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.297678 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:23:53.297943 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m17:23:53.298925 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.308255 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:23:53.308556 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:23:53.308769 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:23:53.310422 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m17:23:53.313942 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m17:23:53.316846 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:23:53.317083 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m17:23:53.322515 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m17:23:53.324147 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m17:23:53.325462 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca21a50>]}
[0m17:23:53.325911 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.10s]
[0m17:23:53.326256 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m17:23:53.326793 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:23:53.327086 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:23:53.327318 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:23:53.327525 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:23:53.327820 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m17:23:53.328107 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m17:23:53.328543 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m17:23:53.328905 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m17:23:53.329262 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m17:23:53.329539 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:23:53.329791 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m17:23:53.330014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m17:23:53.330237 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:23:53.330461 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:23:53.330667 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:23:53.330860 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:23:53.332992 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.334888 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.336633 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.338308 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.339362 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:23:53.339650 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:23:53.339962 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:23:53.340168 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:23:53.342493 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.344863 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.347752 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.349783 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.350339 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.350562 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m17:23:53.350802 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:23:53.351110 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.351416 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.351802 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.352010 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m17:23:53.352226 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m17:23:53.352442 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m17:23:53.352763 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:23:53.352995 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:23:53.353192 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:23:53.369466 [debug] [Thread-2 (]: SQL status: BEGIN in 0.019 seconds
[0m17:23:53.369822 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.370138 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:23:53.371857 [debug] [Thread-4 (]: SQL status: BEGIN in 0.019 seconds
[0m17:23:53.372233 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m17:23:53.372532 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.372782 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.372969 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m17:23:53.373213 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:23:53.373479 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:23:53.373713 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.374129 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:23:53.395458 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.021 seconds
[0m17:23:53.397998 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.398333 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m17:23:53.400982 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:23:53.403349 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.403820 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m17:23:53.404118 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.030 seconds
[0m17:23:53.406384 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.406638 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:23:53.406859 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m17:23:53.407798 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:23:53.408067 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.408263 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:23:53.409081 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.410835 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.411079 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m17:23:53.412382 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.413345 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:23:53.413637 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.413851 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:23:53.420463 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m17:23:53.422949 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m17:23:53.423485 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:23:53.423708 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m17:23:53.424700 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m17:23:53.426399 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m17:23:53.426893 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:23:53.427119 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m17:23:53.430308 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m17:23:53.431168 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m17:23:53.431558 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb05090>]}
[0m17:23:53.431941 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m17:23:53.432262 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:23:53.434473 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:23:53.435534 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m17:23:53.435935 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbc4280>]}
[0m17:23:53.436559 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.11s]
[0m17:23:53.437036 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:23:53.513226 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.143 seconds
[0m17:23:53.515529 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.515775 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m17:23:53.517169 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.518972 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.519206 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m17:23:53.520303 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.521341 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:23:53.521573 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.521808 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.148 seconds
[0m17:23:53.522055 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:23:53.524010 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.524329 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m17:23:53.528845 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:23:53.530910 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.531136 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m17:23:53.532256 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.533411 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:23:53.533671 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.533881 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:23:53.537166 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m17:23:53.537408 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m17:23:53.539077 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m17:23:53.541259 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m17:23:53.541741 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:23:53.542155 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:23:53.542366 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m17:23:53.542601 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m17:23:53.553856 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:23:53.554844 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m17:23:53.555073 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m17:23:53.555448 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf377f0>]}
[0m17:23:53.556156 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m17:23:53.556645 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.23s]
[0m17:23:53.557091 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf4cdf0>]}
[0m17:23:53.557482 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:23:53.557895 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.23s]
[0m17:23:53.558361 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:23:53.558758 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:23:53.559186 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:23:53.559476 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m17:23:53.559690 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:23:53.562069 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:23:53.563013 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:23:53.565454 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:23:53.565928 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:23:53.566126 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:23:53.566303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:23:53.577458 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m17:23:53.577792 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:23:53.578050 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, event_date
  );
  
[0m17:23:53.682823 [debug] [Thread-1 (]: SQL status: SELECT 59208 in 0.104 seconds
[0m17:23:53.685129 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:23:53.685354 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m17:23:53.686608 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.688248 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:23:53.688466 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m17:23:53.689519 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.690439 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:23:53.690641 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:23:53.690822 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:23:53.698618 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m17:23:53.700081 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m17:23:53.700567 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:23:53.700763 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m17:23:53.708332 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:23:53.709188 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:23:53.709559 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cade110>]}
[0m17:23:53.709949 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 59208[0m in 0.15s]
[0m17:23:53.710260 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:23:53.710760 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m17:23:53.711251 [info ] [Thread-4 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m17:23:53.711595 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m17:23:53.711822 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m17:23:53.713559 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.714381 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m17:23:53.727335 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.728477 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.728735 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m17:23:53.728942 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m17:23:53.739865 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m17:23:53.740195 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.740439 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m17:23:53.745760 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m17:23:53.747656 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.747886 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m17:23:53.749013 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:23:53.749782 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:23:53.749984 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.750163 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:23:53.751219 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m17:23:53.752580 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m17:23:53.754261 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:23:53.754572 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m17:23:53.755499 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.001 seconds
[0m17:23:53.756338 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m17:23:53.756707 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c67f5b5-98c8-4f8c-8d0d-3f23dc18b1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c017af0>]}
[0m17:23:53.757087 [info ] [Thread-4 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.05s]
[0m17:23:53.757392 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m17:23:53.758065 [debug] [MainThread]: Using postgres connection "master"
[0m17:23:53.758242 [debug] [MainThread]: On master: BEGIN
[0m17:23:53.758390 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:23:53.769527 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:23:53.769924 [debug] [MainThread]: On master: COMMIT
[0m17:23:53.770101 [debug] [MainThread]: Using postgres connection "master"
[0m17:23:53.770255 [debug] [MainThread]: On master: COMMIT
[0m17:23:53.771004 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:23:53.771296 [debug] [MainThread]: On master: Close
[0m17:23:53.771566 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:23:53.771732 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:23:53.771880 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m17:23:53.772018 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m17:23:53.772154 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m17:23:53.772382 [info ] [MainThread]: 
[0m17:23:53.772578 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m17:23:53.773281 [debug] [MainThread]: Command end result
[0m17:23:53.786813 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:23:53.787945 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:23:53.792351 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:23:53.792636 [info ] [MainThread]: 
[0m17:23:53.792874 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:23:53.793062 [info ] [MainThread]: 
[0m17:23:53.793294 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m17:23:53.793673 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:23:53.795825 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4038329, "process_in_blocks": "0", "process_kernel_time": 0.22973, "process_mem_max_rss": "137117696", "process_out_blocks": "0", "process_user_time": 1.513356}
[0m17:23:53.796149 [debug] [MainThread]: Command `dbt run` succeeded at 17:23:53.796102 after 1.40 seconds
[0m17:23:53.796388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091de8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf62fe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c307340>]}
[0m17:23:53.796621 [debug] [MainThread]: Flushing usage events
[0m17:23:54.274997 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:25:10.361218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110082920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129c0c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129c0520>]}


============================== 17:25:10.364226 | 0deaaec6-3689-4b41-bced-8b9d5232ed69 ==============================
[0m17:25:10.364226 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:25:10.364571 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error': 'None', 'log_cache_events': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'no_print': 'None', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'log_format': 'default', 'quiet': 'False', 'introspect': 'True', 'partial_parse': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure'}
[0m17:25:10.364875 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:25:10.365085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11290d6f0>]}
[0m17:25:10.531686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110300d00>]}
[0m17:25:10.573520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c51240>]}
[0m17:25:10.574377 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:25:10.641663 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:25:10.716147 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:25:10.716555 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_with_full_timeline.sql
[0m17:25:10.904635 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:25:10.912603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113aac070>]}
[0m17:25:10.959130 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:25:10.960640 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:25:10.972881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113aadd80>]}
[0m17:25:10.973222 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m17:25:10.973431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e32710>]}
[0m17:25:10.974347 [info ] [MainThread]: 
[0m17:25:10.974551 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:25:10.974717 [info ] [MainThread]: 
[0m17:25:10.974998 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:25:10.977377 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:25:11.010162 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:25:11.010473 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:25:11.010651 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:25:11.076383 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.066 seconds
[0m17:25:11.077355 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:25:11.078523 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:25:11.082483 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:25:11.082810 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:25:11.083028 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:25:11.095120 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m17:25:11.095452 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:25:11.095685 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:25:11.105516 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.010 seconds
[0m17:25:11.106413 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:25:11.107209 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:25:11.111192 [debug] [MainThread]: Using postgres connection "master"
[0m17:25:11.111506 [debug] [MainThread]: On master: BEGIN
[0m17:25:11.111704 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:25:11.125019 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m17:25:11.125319 [debug] [MainThread]: Using postgres connection "master"
[0m17:25:11.125592 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:25:11.137435 [debug] [MainThread]: SQL status: SELECT 1 in 0.012 seconds
[0m17:25:11.138412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11360a470>]}
[0m17:25:11.138732 [debug] [MainThread]: On master: ROLLBACK
[0m17:25:11.139493 [debug] [MainThread]: Using postgres connection "master"
[0m17:25:11.139693 [debug] [MainThread]: On master: BEGIN
[0m17:25:11.140917 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:25:11.141122 [debug] [MainThread]: On master: COMMIT
[0m17:25:11.141310 [debug] [MainThread]: Using postgres connection "master"
[0m17:25:11.141486 [debug] [MainThread]: On master: COMMIT
[0m17:25:11.142262 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:25:11.142459 [debug] [MainThread]: On master: Close
[0m17:25:11.145127 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m17:25:11.145534 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m17:25:11.145862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m17:25:11.146106 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m17:25:11.152621 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m17:25:11.153530 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m17:25:11.174819 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m17:25:11.175413 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:25:11.175639 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m17:25:11.175825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:25:11.189036 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m17:25:11.189399 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:25:11.189629 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m17:25:11.199750 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.010 seconds
[0m17:25:11.205619 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:25:11.205876 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m17:25:11.207179 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.209080 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:25:11.209321 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m17:25:11.210455 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.219339 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:25:11.219625 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:25:11.219842 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m17:25:11.221603 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m17:25:11.225328 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m17:25:11.228276 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m17:25:11.228522 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m17:25:11.233953 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m17:25:11.235519 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m17:25:11.236817 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114945a50>]}
[0m17:25:11.237264 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.09s]
[0m17:25:11.237614 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m17:25:11.238115 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:25:11.238339 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:25:11.238602 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:25:11.238887 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:25:11.239220 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m17:25:11.239617 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m17:25:11.240005 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m17:25:11.240407 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m17:25:11.240843 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m17:25:11.241219 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:25:11.241554 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m17:25:11.241818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m17:25:11.242038 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:25:11.242244 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:25:11.242443 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:25:11.242644 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:25:11.245051 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.247003 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.249245 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.251240 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.252117 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:25:11.252403 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:25:11.255047 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.257338 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.257568 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:25:11.257832 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:25:11.260638 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.260941 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.262957 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.263184 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.263444 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m17:25:11.263728 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m17:25:11.263942 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.264236 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:25:11.264482 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.264665 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:25:11.264880 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m17:25:11.265175 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m17:25:11.265598 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:25:11.265872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:25:11.279928 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m17:25:11.280291 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.280681 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:25:11.282640 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m17:25:11.282959 [debug] [Thread-2 (]: SQL status: BEGIN in 0.017 seconds
[0m17:25:11.283178 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.283388 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.283635 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:25:11.283976 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:25:11.284229 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m17:25:11.284530 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.284766 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m17:25:11.302323 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.018 seconds
[0m17:25:11.304946 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.305249 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m17:25:11.307265 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:25:11.309019 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.309249 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m17:25:11.310603 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.311818 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:25:11.312081 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.031 seconds
[0m17:25:11.312301 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.314344 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.314672 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m17:25:11.314945 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m17:25:11.316374 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.318449 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.318711 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m17:25:11.319023 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m17:25:11.321218 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m17:25:11.321858 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m17:25:11.322127 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m17:25:11.322380 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.323585 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:25:11.323843 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.324041 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m17:25:11.327708 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m17:25:11.329490 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m17:25:11.329744 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:25:11.330298 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m17:25:11.331156 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m17:25:11.331422 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m17:25:11.331913 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a26380>]}
[0m17:25:11.332448 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.09s]
[0m17:25:11.332839 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:25:11.343277 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:25:11.344292 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m17:25:11.344837 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114aba380>]}
[0m17:25:11.345356 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.10s]
[0m17:25:11.345722 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:25:11.443606 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.159 seconds
[0m17:25:11.445893 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.446132 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m17:25:11.447637 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.449528 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.449769 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m17:25:11.450909 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.451794 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:25:11.451998 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.452178 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m17:25:11.468961 [debug] [Thread-4 (]: SQL status: COMMIT in 0.017 seconds
[0m17:25:11.469266 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.185 seconds
[0m17:25:11.470826 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m17:25:11.472631 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.473088 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:25:11.473323 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m17:25:11.473543 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m17:25:11.474620 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.476329 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.476561 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m17:25:11.477522 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.478440 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:25:11.478651 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.478841 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m17:25:11.479833 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m17:25:11.482509 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m17:25:11.483087 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m17:25:11.483324 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m17:25:11.485161 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:25:11.486027 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m17:25:11.486414 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ae41c0>]}
[0m17:25:11.486809 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.25s]
[0m17:25:11.487147 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:25:11.490745 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.007 seconds
[0m17:25:11.491528 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m17:25:11.491864 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c67700>]}
[0m17:25:11.492204 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.25s]
[0m17:25:11.492643 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:25:11.493093 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:25:11.493467 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m17:25:11.493951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m17:25:11.494230 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:25:11.496540 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:25:11.497274 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:25:11.499794 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m17:25:11.500236 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:25:11.500438 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m17:25:11.500619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:25:11.511273 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m17:25:11.511579 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:25:11.511840 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select 
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select 
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select * from combined_accounts order by business_name, event_date
  );
  
[0m17:25:11.631298 [debug] [Thread-1 (]: SQL status: SELECT 59208 in 0.119 seconds
[0m17:25:11.633825 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:25:11.634103 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m17:25:11.635414 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.637448 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:25:11.637674 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m17:25:11.638688 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.639702 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:25:11.639984 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:25:11.640188 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m17:25:11.653177 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m17:25:11.654889 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m17:25:11.655321 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m17:25:11.655529 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m17:25:11.664474 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m17:25:11.667388 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m17:25:11.668473 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d08e20>]}
[0m17:25:11.669308 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 59208[0m in 0.17s]
[0m17:25:11.669711 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:25:11.670167 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m17:25:11.670466 [info ] [Thread-4 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m17:25:11.670758 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m17:25:11.670961 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m17:25:11.672671 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.673132 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m17:25:11.684224 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.685096 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.685426 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m17:25:11.685635 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m17:25:11.696915 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m17:25:11.697225 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.697464 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m17:25:11.703268 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m17:25:11.705256 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.705490 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m17:25:11.706528 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:25:11.707321 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:25:11.707535 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.707721 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m17:25:11.709058 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m17:25:11.710501 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m17:25:11.712042 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m17:25:11.712279 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m17:25:11.713019 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.001 seconds
[0m17:25:11.713742 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m17:25:11.714102 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0deaaec6-3689-4b41-bced-8b9d5232ed69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114adb670>]}
[0m17:25:11.714480 [info ] [Thread-4 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.04s]
[0m17:25:11.714799 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m17:25:11.715505 [debug] [MainThread]: Using postgres connection "master"
[0m17:25:11.715689 [debug] [MainThread]: On master: BEGIN
[0m17:25:11.715844 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:25:11.726734 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m17:25:11.727050 [debug] [MainThread]: On master: COMMIT
[0m17:25:11.727220 [debug] [MainThread]: Using postgres connection "master"
[0m17:25:11.727375 [debug] [MainThread]: On master: COMMIT
[0m17:25:11.727979 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:25:11.728159 [debug] [MainThread]: On master: Close
[0m17:25:11.728422 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:25:11.728584 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m17:25:11.728734 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m17:25:11.729076 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m17:25:11.729296 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m17:25:11.729548 [info ] [MainThread]: 
[0m17:25:11.729767 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.75 seconds (0.75s).
[0m17:25:11.730520 [debug] [MainThread]: Command end result
[0m17:25:11.744760 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:25:11.746107 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:25:11.750090 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:25:11.750310 [info ] [MainThread]: 
[0m17:25:11.750541 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:25:11.750727 [info ] [MainThread]: 
[0m17:25:11.750921 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m17:25:11.751247 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:25:11.753670 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4425724, "process_in_blocks": "0", "process_kernel_time": 0.226588, "process_mem_max_rss": "137330688", "process_out_blocks": "0", "process_user_time": 1.516093}
[0m17:25:11.754099 [debug] [MainThread]: Command `dbt run` succeeded at 17:25:11.754045 after 1.44 seconds
[0m17:25:11.754351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110082920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c51240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137ab7c0>]}
[0m17:25:11.754588 [debug] [MainThread]: Flushing usage events
[0m17:25:12.294427 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:24:49.010011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10780a8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e88d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e88610>]}


============================== 12:24:49.013521 | afd7538f-b78a-44a2-bf4b-36866577f098 ==============================
[0m12:24:49.013521 [info ] [MainThread]: Running with dbt=1.10.11
[0m12:24:49.013898 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'log_cache_events': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'empty': 'False', 'introspect': 'True', 'printer_width': '80', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'use_colors': 'True', 'debug': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'write_json': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_format': 'default', 'cache_selected_only': 'False', 'target_path': 'None', 'warn_error': 'None', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m12:24:49.014243 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m12:24:49.014473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dd5630>]}
[0m12:24:49.318734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e1be80>]}
[0m12:24:49.363782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dd7eb0>]}
[0m12:24:49.364636 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:24:49.434278 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m12:24:49.512696 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:24:49.513172 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m12:24:49.706345 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m12:24:49.714450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d200a0>]}
[0m12:24:49.759777 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m12:24:49.761105 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m12:24:49.772876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b1fdf0>]}
[0m12:24:49.773192 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m12:24:49.773405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b1f8b0>]}
[0m12:24:49.774316 [info ] [MainThread]: 
[0m12:24:49.774518 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:24:49.774696 [info ] [MainThread]: 
[0m12:24:49.774974 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:24:49.777339 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m12:24:49.810077 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m12:24:49.810413 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m12:24:49.810597 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:24:49.941908 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.131 seconds
[0m12:24:49.945743 [debug] [ThreadPool]: On list_highstreet: Close
[0m12:24:49.948067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m12:24:49.967402 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m12:24:49.967766 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m12:24:49.968194 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:24:49.982627 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m12:24:49.982993 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m12:24:49.983292 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m12:24:49.994512 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.011 seconds
[0m12:24:49.995503 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m12:24:49.996448 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m12:24:50.000443 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:50.000714 [debug] [MainThread]: On master: BEGIN
[0m12:24:50.000895 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:24:50.012280 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m12:24:50.012619 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:50.012880 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:24:50.021592 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m12:24:50.022517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b1d480>]}
[0m12:24:50.022818 [debug] [MainThread]: On master: ROLLBACK
[0m12:24:50.023577 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:50.023761 [debug] [MainThread]: On master: BEGIN
[0m12:24:50.024895 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:24:50.025113 [debug] [MainThread]: On master: COMMIT
[0m12:24:50.025340 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:50.025595 [debug] [MainThread]: On master: COMMIT
[0m12:24:50.026360 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:24:50.026581 [debug] [MainThread]: On master: Close
[0m12:24:50.028265 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m12:24:50.028583 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m12:24:50.028859 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m12:24:50.029065 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m12:24:50.034589 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m12:24:50.035342 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m12:24:50.055297 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m12:24:50.055988 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:24:50.056220 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m12:24:50.056415 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:24:50.068028 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m12:24:50.068364 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:24:50.068579 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m12:24:50.078809 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.010 seconds
[0m12:24:50.084922 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:24:50.085236 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m12:24:50.086791 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.088821 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:24:50.089070 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m12:24:50.089979 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.098598 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m12:24:50.098889 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:24:50.099101 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m12:24:50.100714 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:24:50.104343 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m12:24:50.107255 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:24:50.107487 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m12:24:50.113510 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m12:24:50.115056 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m12:24:50.116257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a341a50>]}
[0m12:24:50.116648 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.09s]
[0m12:24:50.116965 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m12:24:50.117430 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m12:24:50.117642 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m12:24:50.117900 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m12:24:50.118121 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m12:24:50.118389 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m12:24:50.118683 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m12:24:50.118962 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m12:24:50.119260 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m12:24:50.119618 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m12:24:50.119890 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m12:24:50.120162 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m12:24:50.120375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m12:24:50.120586 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m12:24:50.120786 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m12:24:50.120975 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m12:24:50.121163 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m12:24:50.123278 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.125307 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.127519 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.129218 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.129754 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m12:24:50.130098 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m12:24:50.132441 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.132699 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m12:24:50.132951 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m12:24:50.135391 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.138207 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.140348 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.140620 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.141134 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.141509 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m12:24:50.141756 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.142034 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.142236 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m12:24:50.142455 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:24:50.142689 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m12:24:50.142946 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m12:24:50.143177 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:24:50.143473 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:24:50.143703 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:24:50.161278 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m12:24:50.161641 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.161896 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:24:50.162192 [debug] [Thread-4 (]: SQL status: BEGIN in 0.019 seconds
[0m12:24:50.162677 [debug] [Thread-2 (]: SQL status: BEGIN in 0.019 seconds
[0m12:24:50.162952 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.163161 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.163509 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:24:50.163800 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m12:24:50.164108 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:24:50.164404 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.164817 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:24:50.185517 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.020 seconds
[0m12:24:50.188151 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.188450 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.026 seconds
[0m12:24:50.188779 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m12:24:50.190883 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.191293 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m12:24:50.193757 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m12:24:50.194023 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:24:50.195975 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.197841 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.198192 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m12:24:50.198529 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m12:24:50.199949 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.200187 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.201246 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m12:24:50.202350 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m12:24:50.202656 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.202919 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.203138 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m12:24:50.203405 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m12:24:50.211314 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m12:24:50.211659 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m12:24:50.214326 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m12:24:50.215899 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m12:24:50.216471 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:24:50.217024 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:24:50.217415 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m12:24:50.217772 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m12:24:50.225633 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m12:24:50.226666 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m12:24:50.226924 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m12:24:50.227439 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5168f0>]}
[0m12:24:50.228323 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m12:24:50.228831 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.11s]
[0m12:24:50.229302 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m12:24:50.229908 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4ba3b0>]}
[0m12:24:50.230436 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.11s]
[0m12:24:50.230763 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m12:24:50.307880 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.143 seconds
[0m12:24:50.310363 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.310646 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m12:24:50.312460 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:24:50.314137 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.314348 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m12:24:50.314606 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.150 seconds
[0m12:24:50.316986 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.317273 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:24:50.317657 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m12:24:50.318738 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m12:24:50.319061 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.319279 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m12:24:50.319938 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.321698 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.321921 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m12:24:50.323021 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.323879 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m12:24:50.324091 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.324275 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m12:24:50.328304 [debug] [Thread-4 (]: SQL status: COMMIT in 0.009 seconds
[0m12:24:50.328596 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m12:24:50.330468 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m12:24:50.332868 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m12:24:50.333406 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:24:50.333912 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:24:50.334195 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m12:24:50.334453 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m12:24:50.348571 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m12:24:50.349596 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m12:24:50.350004 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a55d690>]}
[0m12:24:50.350225 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.016 seconds
[0m12:24:50.350619 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.23s]
[0m12:24:50.351326 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m12:24:50.351736 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m12:24:50.352136 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a496a40>]}
[0m12:24:50.352480 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.23s]
[0m12:24:50.352824 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m12:24:50.353327 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m12:24:50.353693 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m12:24:50.353956 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m12:24:50.354157 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m12:24:50.356460 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m12:24:50.356979 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m12:24:50.359538 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m12:24:50.360037 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:24:50.360232 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m12:24:50.360409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:24:50.373240 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m12:24:50.373618 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:24:50.373884 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name, 
        account_end_date  as event_date, 
        'account_end' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_start' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as event_date, 
        'account_active' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select distinct * from combined_accounts order by business_name, event_date
  );
  
[0m12:24:50.544981 [debug] [Thread-1 (]: SQL status: SELECT 49072 in 0.171 seconds
[0m12:24:50.547194 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:24:50.547423 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m12:24:50.548629 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.550289 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:24:50.550504 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m12:24:50.551393 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.552226 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m12:24:50.552432 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:24:50.552614 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m12:24:50.561216 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m12:24:50.562758 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m12:24:50.563225 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:24:50.563418 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m12:24:50.572435 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m12:24:50.573369 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m12:24:50.573853 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109da1db0>]}
[0m12:24:50.574376 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 49072[0m in 0.22s]
[0m12:24:50.574724 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m12:24:50.575284 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m12:24:50.575710 [info ] [Thread-4 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m12:24:50.576035 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m12:24:50.576259 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m12:24:50.578054 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.578582 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m12:24:50.589141 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.589715 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.589937 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m12:24:50.590127 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:24:50.601238 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m12:24:50.601605 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.601854 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m12:24:50.606882 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m12:24:50.608846 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.609066 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m12:24:50.610209 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:24:50.610971 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m12:24:50.611174 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.611359 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m12:24:50.612554 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m12:24:50.613884 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m12:24:50.615349 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:24:50.615581 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m12:24:50.616393 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:24:50.617109 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m12:24:50.617482 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afd7538f-b78a-44a2-bf4b-36866577f098', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a42d2d0>]}
[0m12:24:50.617914 [info ] [Thread-4 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.04s]
[0m12:24:50.618328 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m12:24:50.619017 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:50.619215 [debug] [MainThread]: On master: BEGIN
[0m12:24:50.619378 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:24:50.631096 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m12:24:50.631415 [debug] [MainThread]: On master: COMMIT
[0m12:24:50.631598 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:50.631760 [debug] [MainThread]: On master: COMMIT
[0m12:24:50.635236 [debug] [MainThread]: SQL status: COMMIT in 0.003 seconds
[0m12:24:50.635514 [debug] [MainThread]: On master: Close
[0m12:24:50.635790 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:24:50.635955 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m12:24:50.636104 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m12:24:50.636250 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m12:24:50.636845 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m12:24:50.637160 [info ] [MainThread]: 
[0m12:24:50.637368 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m12:24:50.638115 [debug] [MainThread]: Command end result
[0m12:24:50.652827 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m12:24:50.654187 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m12:24:50.658337 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m12:24:50.658629 [info ] [MainThread]: 
[0m12:24:50.658897 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:24:50.659184 [info ] [MainThread]: 
[0m12:24:50.659391 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m12:24:50.659722 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:24:50.685068 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.7302034, "process_in_blocks": "0", "process_kernel_time": 0.274609, "process_mem_max_rss": "133971968", "process_out_blocks": "0", "process_user_time": 1.615488}
[0m12:24:50.685514 [debug] [MainThread]: Command `dbt run` succeeded at 12:24:50.685462 after 1.73 seconds
[0m12:24:50.685772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10780a8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b1ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bcfc40>]}
[0m12:24:50.686010 [debug] [MainThread]: Flushing usage events
[0m12:24:51.700147 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:34:35.491386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11157e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137c0b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137c0430>]}


============================== 12:34:35.494417 | 96f72f16-611e-4681-90f3-f6ebcdcc134f ==============================
[0m12:34:35.494417 [info ] [MainThread]: Running with dbt=1.10.11
[0m12:34:35.494756 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'partial_parse': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'no_print': 'None', 'debug': 'False', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'version_check': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'printer_width': '80'}
[0m12:34:35.495049 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m12:34:35.495257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129377c0>]}
[0m12:34:35.667972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113be47f0>]}
[0m12:34:35.712037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113503790>]}
[0m12:34:35.712860 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:34:35.781540 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m12:34:35.859358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:34:35.859786 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m12:34:36.047658 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m12:34:36.055610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147a80a0>]}
[0m12:34:36.100324 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m12:34:36.101992 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m12:34:36.114141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142f7040>]}
[0m12:34:36.114487 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m12:34:36.114707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11445bb80>]}
[0m12:34:36.115628 [info ] [MainThread]: 
[0m12:34:36.115833 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:34:36.116001 [info ] [MainThread]: 
[0m12:34:36.116288 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:34:36.118673 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m12:34:36.151858 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m12:34:36.152174 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m12:34:36.152532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:34:36.218161 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.066 seconds
[0m12:34:36.219066 [debug] [ThreadPool]: On list_highstreet: Close
[0m12:34:36.220050 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m12:34:36.223603 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m12:34:36.223854 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m12:34:36.224060 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:34:36.237310 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m12:34:36.237704 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m12:34:36.237931 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m12:34:36.248278 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.010 seconds
[0m12:34:36.249281 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m12:34:36.249941 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m12:34:36.253634 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:36.253877 [debug] [MainThread]: On master: BEGIN
[0m12:34:36.254052 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:34:36.266753 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m12:34:36.267103 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:36.267391 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:34:36.276739 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m12:34:36.277890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11490e080>]}
[0m12:34:36.278231 [debug] [MainThread]: On master: ROLLBACK
[0m12:34:36.279103 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:36.279341 [debug] [MainThread]: On master: BEGIN
[0m12:34:36.280587 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:34:36.280801 [debug] [MainThread]: On master: COMMIT
[0m12:34:36.280992 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:36.281178 [debug] [MainThread]: On master: COMMIT
[0m12:34:36.281891 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:34:36.282124 [debug] [MainThread]: On master: Close
[0m12:34:36.283862 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m12:34:36.284212 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m12:34:36.284513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m12:34:36.284749 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m12:34:36.290841 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m12:34:36.291804 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m12:34:36.312948 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m12:34:36.313632 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:34:36.313865 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m12:34:36.314053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:34:36.327355 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m12:34:36.327700 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:34:36.327925 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m12:34:36.347770 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.020 seconds
[0m12:34:36.354279 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:34:36.354610 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m12:34:36.356786 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:34:36.358967 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:34:36.359247 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m12:34:36.360412 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.369811 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m12:34:36.370075 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:34:36.370284 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m12:34:36.371769 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:34:36.375351 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m12:34:36.378464 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:34:36.378737 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m12:34:36.383918 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m12:34:36.385540 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m12:34:36.386862 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d41a20>]}
[0m12:34:36.387306 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.10s]
[0m12:34:36.387731 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m12:34:36.388298 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m12:34:36.388586 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m12:34:36.388805 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m12:34:36.389239 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m12:34:36.389067 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m12:34:36.389553 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m12:34:36.389901 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m12:34:36.390203 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m12:34:36.390567 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m12:34:36.390874 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m12:34:36.391155 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m12:34:36.391388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m12:34:36.391622 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m12:34:36.391838 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m12:34:36.392053 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m12:34:36.392295 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m12:34:36.394519 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.396535 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.398379 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.400081 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.400980 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m12:34:36.401239 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m12:34:36.401463 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m12:34:36.403935 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.404161 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m12:34:36.406635 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.409550 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.411984 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.412444 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.412834 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.413028 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m12:34:36.413363 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.413613 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.413863 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m12:34:36.414085 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:34:36.414358 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m12:34:36.414678 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m12:34:36.414924 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:34:36.415239 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:34:36.415479 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:34:36.432084 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:34:36.432454 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.432706 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:34:36.435954 [debug] [Thread-2 (]: SQL status: BEGIN in 0.020 seconds
[0m12:34:36.436286 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.436622 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:34:36.437021 [debug] [Thread-3 (]: SQL status: BEGIN in 0.022 seconds
[0m12:34:36.437235 [debug] [Thread-4 (]: SQL status: BEGIN in 0.022 seconds
[0m12:34:36.437502 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.437817 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.438116 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:34:36.438407 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:34:36.459917 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.027 seconds
[0m12:34:36.462610 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.462909 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m12:34:36.464761 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:34:36.466853 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.467127 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m12:34:36.468614 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.470165 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m12:34:36.470470 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.470683 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m12:34:36.474704 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.036 seconds
[0m12:34:36.477221 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.477573 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m12:34:36.477888 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m12:34:36.479771 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m12:34:36.480037 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:34:36.480595 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:34:36.483053 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.483346 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m12:34:36.483578 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m12:34:36.484790 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.486016 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m12:34:36.486339 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.486562 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m12:34:36.491306 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m12:34:36.493054 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m12:34:36.493662 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:34:36.493926 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m12:34:36.495095 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m12:34:36.495949 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m12:34:36.496355 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114eba380>]}
[0m12:34:36.496748 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m12:34:36.497086 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m12:34:36.502839 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.008 seconds
[0m12:34:36.504052 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m12:34:36.504488 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e9a830>]}
[0m12:34:36.505202 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.11s]
[0m12:34:36.505587 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m12:34:36.597083 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.158 seconds
[0m12:34:36.599389 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.599629 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m12:34:36.600937 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.602880 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.603126 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.166 seconds
[0m12:34:36.603419 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m12:34:36.605469 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.605795 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m12:34:36.606662 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.607516 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m12:34:36.607733 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.607916 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m12:34:36.608117 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:34:36.609814 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.610066 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m12:34:36.611135 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.612057 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m12:34:36.612281 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.612477 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m12:34:36.619102 [debug] [Thread-4 (]: SQL status: COMMIT in 0.011 seconds
[0m12:34:36.619390 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m12:34:36.621111 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m12:34:36.623258 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m12:34:36.623720 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:34:36.624132 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:34:36.624337 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m12:34:36.624539 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m12:34:36.636136 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.011 seconds
[0m12:34:36.636430 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m12:34:36.637242 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m12:34:36.637896 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m12:34:36.638269 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115056ad0>]}
[0m12:34:36.638749 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115056a10>]}
[0m12:34:36.639157 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.25s]
[0m12:34:36.639663 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.25s]
[0m12:34:36.639994 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m12:34:36.640344 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m12:34:36.640952 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m12:34:36.641252 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m12:34:36.641505 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m12:34:36.641697 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m12:34:36.643889 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m12:34:36.644924 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m12:34:36.647555 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m12:34:36.648136 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:34:36.648394 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m12:34:36.648592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:34:36.659516 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m12:34:36.659951 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:34:36.660267 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select distinct * from combined_accounts order by business_name, event_date
  );
  
[0m12:34:36.834509 [debug] [Thread-1 (]: SQL status: SELECT 49130 in 0.174 seconds
[0m12:34:36.837031 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:34:36.837342 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m12:34:36.838975 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.842191 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:34:36.842453 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m12:34:36.843445 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.844359 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m12:34:36.844600 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:34:36.844783 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m12:34:36.854696 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m12:34:36.858971 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m12:34:36.859631 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:34:36.859838 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m12:34:36.867956 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m12:34:36.870435 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m12:34:36.870873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e3f0a0>]}
[0m12:34:36.871287 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 49130[0m in 0.23s]
[0m12:34:36.871620 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m12:34:36.872078 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m12:34:36.872429 [info ] [Thread-2 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m12:34:36.872731 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m12:34:36.872958 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m12:34:36.874684 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.875357 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m12:34:36.886602 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.887199 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.887413 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m12:34:36.887676 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:34:36.898744 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m12:34:36.899114 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.899357 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m12:34:36.905677 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m12:34:36.907688 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.907913 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m12:34:36.908939 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:34:36.909717 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m12:34:36.909931 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.910115 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m12:34:36.911302 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m12:34:36.912703 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m12:34:36.914279 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:34:36.914523 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m12:34:36.915582 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:34:36.916381 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m12:34:36.916750 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f72f16-611e-4681-90f3-f6ebcdcc134f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ced180>]}
[0m12:34:36.917136 [info ] [Thread-2 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.04s]
[0m12:34:36.917461 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m12:34:36.918250 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:36.918495 [debug] [MainThread]: On master: BEGIN
[0m12:34:36.918661 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:34:36.929930 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m12:34:36.930265 [debug] [MainThread]: On master: COMMIT
[0m12:34:36.930446 [debug] [MainThread]: Using postgres connection "master"
[0m12:34:36.930608 [debug] [MainThread]: On master: COMMIT
[0m12:34:36.931246 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:34:36.931558 [debug] [MainThread]: On master: Close
[0m12:34:36.931833 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:34:36.932008 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m12:34:36.932164 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m12:34:36.932312 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m12:34:36.932458 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m12:34:36.932688 [info ] [MainThread]: 
[0m12:34:36.932878 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m12:34:36.933626 [debug] [MainThread]: Command end result
[0m12:34:36.947329 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m12:34:36.948369 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m12:34:36.953271 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m12:34:36.953562 [info ] [MainThread]: 
[0m12:34:36.953808 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:34:36.953997 [info ] [MainThread]: 
[0m12:34:36.954197 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m12:34:36.954533 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:34:36.956918 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.516125, "process_in_blocks": "0", "process_kernel_time": 0.247627, "process_mem_max_rss": "137412608", "process_out_blocks": "0", "process_user_time": 1.54944}
[0m12:34:36.957287 [debug] [MainThread]: Command `dbt run` succeeded at 12:34:36.957239 after 1.52 seconds
[0m12:34:36.957527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11157e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110183bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143d7640>]}
[0m12:34:36.957757 [debug] [MainThread]: Flushing usage events
[0m12:34:37.487733 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:38:00.519167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b40b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b40430>]}


============================== 12:38:00.522306 | 7c84af5f-816a-4e3a-9474-409b08f887cb ==============================
[0m12:38:00.522306 [info ] [MainThread]: Running with dbt=1.10.11
[0m12:38:00.522674 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'static_parser': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'warn_error': 'None', 'partial_parse': 'True', 'debug': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'indirect_selection': 'eager'}
[0m12:38:00.522975 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m12:38:00.523193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056337c0>]}
[0m12:38:00.716135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f647f0>]}
[0m12:38:00.764496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106883790>]}
[0m12:38:00.765513 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:38:00.839032 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m12:38:00.922651 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:38:00.923118 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m12:38:01.153509 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m12:38:01.161758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ba80a0>]}
[0m12:38:01.206523 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m12:38:01.208213 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m12:38:01.220795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108847040>]}
[0m12:38:01.221154 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m12:38:01.221369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089abb80>]}
[0m12:38:01.222315 [info ] [MainThread]: 
[0m12:38:01.222525 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:38:01.222693 [info ] [MainThread]: 
[0m12:38:01.222986 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:38:01.225510 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m12:38:01.259126 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m12:38:01.259467 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m12:38:01.259640 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:38:01.315213 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.056 seconds
[0m12:38:01.316097 [debug] [ThreadPool]: On list_highstreet: Close
[0m12:38:01.317139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m12:38:01.320880 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m12:38:01.321142 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m12:38:01.321317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:38:01.334497 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m12:38:01.334771 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m12:38:01.334960 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m12:38:01.344793 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.010 seconds
[0m12:38:01.345786 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m12:38:01.346746 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m12:38:01.350710 [debug] [MainThread]: Using postgres connection "master"
[0m12:38:01.350943 [debug] [MainThread]: On master: BEGIN
[0m12:38:01.351175 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:38:01.362930 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m12:38:01.363296 [debug] [MainThread]: Using postgres connection "master"
[0m12:38:01.363573 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:38:01.371830 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m12:38:01.372736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c0ffa0>]}
[0m12:38:01.373011 [debug] [MainThread]: On master: ROLLBACK
[0m12:38:01.373903 [debug] [MainThread]: Using postgres connection "master"
[0m12:38:01.374150 [debug] [MainThread]: On master: BEGIN
[0m12:38:01.375440 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:38:01.375647 [debug] [MainThread]: On master: COMMIT
[0m12:38:01.375820 [debug] [MainThread]: Using postgres connection "master"
[0m12:38:01.375980 [debug] [MainThread]: On master: COMMIT
[0m12:38:01.376592 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:38:01.376785 [debug] [MainThread]: On master: Close
[0m12:38:01.378588 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m12:38:01.378915 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m12:38:01.379218 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m12:38:01.379481 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m12:38:01.384905 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m12:38:01.385687 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m12:38:01.405369 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m12:38:01.406164 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:38:01.406487 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m12:38:01.406694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:38:01.418127 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m12:38:01.418494 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:38:01.418719 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m12:38:01.426613 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.008 seconds
[0m12:38:01.432425 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:38:01.432702 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m12:38:01.433873 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.435854 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:38:01.436105 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m12:38:01.437074 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.445988 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m12:38:01.446255 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:38:01.446459 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m12:38:01.447691 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:38:01.451029 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m12:38:01.453842 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m12:38:01.454075 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m12:38:01.457843 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m12:38:01.459314 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m12:38:01.460554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109141a20>]}
[0m12:38:01.460999 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.08s]
[0m12:38:01.461344 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m12:38:01.461819 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m12:38:01.462036 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m12:38:01.462273 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m12:38:01.462466 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m12:38:01.462724 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m12:38:01.463010 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m12:38:01.463282 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m12:38:01.463625 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m12:38:01.463947 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m12:38:01.464226 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m12:38:01.464473 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m12:38:01.464688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m12:38:01.464898 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m12:38:01.465096 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m12:38:01.465290 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m12:38:01.465475 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m12:38:01.467608 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.469647 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.471509 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.473126 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.474057 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m12:38:01.474340 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m12:38:01.474636 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m12:38:01.474883 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m12:38:01.477231 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.479695 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.482431 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.484572 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.485264 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.485573 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m12:38:01.485852 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.486173 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:38:01.486446 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.486695 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.486899 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m12:38:01.487275 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m12:38:01.487581 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m12:38:01.487891 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:38:01.488161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:38:01.488410 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:38:01.500812 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m12:38:01.501160 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.501405 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:38:01.503710 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m12:38:01.503961 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.504206 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:38:01.505205 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:38:01.505526 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.505781 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:38:01.506272 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m12:38:01.506513 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.506760 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m12:38:01.528635 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.023 seconds
[0m12:38:01.531316 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.531603 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m12:38:01.533006 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.534859 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.535184 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.028 seconds
[0m12:38:01.535468 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m12:38:01.537598 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.538010 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m12:38:01.538924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.539881 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m12:38:01.540120 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.540391 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m12:38:01.540605 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:38:01.542326 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.542563 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m12:38:01.543650 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.544503 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m12:38:01.544709 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.544892 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m12:38:01.547666 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m12:38:01.550100 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m12:38:01.550623 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m12:38:01.550835 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m12:38:01.551101 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m12:38:01.552730 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m12:38:01.553202 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m12:38:01.553414 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m12:38:01.558460 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m12:38:01.559358 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m12:38:01.559771 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10939cdc0>]}
[0m12:38:01.560541 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m12:38:01.560326 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.10s]
[0m12:38:01.561421 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m12:38:01.561821 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m12:38:01.562295 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109396830>]}
[0m12:38:01.562865 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.10s]
[0m12:38:01.563248 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m12:38:01.639843 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.138 seconds
[0m12:38:01.642145 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.642412 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m12:38:01.643937 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.646061 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.646383 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m12:38:01.649464 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.145 seconds
[0m12:38:01.651487 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.651794 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m12:38:01.652093 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m12:38:01.653714 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m12:38:01.654235 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.654621 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m12:38:01.655281 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.657089 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.657317 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m12:38:01.658326 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.659331 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m12:38:01.659582 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.659787 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m12:38:01.666609 [debug] [Thread-4 (]: SQL status: COMMIT in 0.012 seconds
[0m12:38:01.666898 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m12:38:01.668575 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m12:38:01.671117 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m12:38:01.671650 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m12:38:01.672202 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m12:38:01.672484 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m12:38:01.672737 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m12:38:01.682066 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m12:38:01.682999 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m12:38:01.683214 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.010 seconds
[0m12:38:01.683970 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m12:38:01.684343 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093e4220>]}
[0m12:38:01.684725 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109451030>]}
[0m12:38:01.685123 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.22s]
[0m12:38:01.685675 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m12:38:01.686000 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.22s]
[0m12:38:01.686362 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m12:38:01.686851 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m12:38:01.687388 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m12:38:01.687720 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m12:38:01.687943 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m12:38:01.690331 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m12:38:01.690832 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m12:38:01.693086 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m12:38:01.693530 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:38:01.693731 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m12:38:01.693911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:38:01.706190 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m12:38:01.706535 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:38:01.706802 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select distinct * from combined_accounts order by business_name, event_date
  );
  
[0m12:38:01.922525 [debug] [Thread-1 (]: SQL status: SELECT 55594 in 0.215 seconds
[0m12:38:01.928106 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:38:01.928496 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m12:38:01.929781 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.931581 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:38:01.931800 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m12:38:01.932795 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:01.933683 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m12:38:01.933894 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:38:01.934082 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m12:38:01.946535 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m12:38:01.950572 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m12:38:01.951229 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m12:38:01.951445 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m12:38:01.960197 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m12:38:01.963917 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m12:38:01.964456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c2ae30>]}
[0m12:38:01.964915 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 55594[0m in 0.28s]
[0m12:38:01.965278 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m12:38:01.965800 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m12:38:01.966242 [info ] [Thread-2 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m12:38:01.966619 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m12:38:01.966903 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m12:38:01.968820 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:01.969338 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m12:38:01.980590 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:01.981319 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:01.981647 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m12:38:01.981847 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:38:01.996578 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m12:38:01.996971 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:01.997211 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m12:38:02.001758 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m12:38:02.003666 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:02.004221 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m12:38:02.005712 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:38:02.006605 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m12:38:02.006831 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:02.007030 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m12:38:02.008536 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m12:38:02.010105 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m12:38:02.011716 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m12:38:02.011961 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m12:38:02.012901 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:38:02.013826 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m12:38:02.014234 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c84af5f-816a-4e3a-9474-409b08f887cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093890c0>]}
[0m12:38:02.014623 [info ] [Thread-2 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.05s]
[0m12:38:02.014951 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m12:38:02.015683 [debug] [MainThread]: Using postgres connection "master"
[0m12:38:02.015887 [debug] [MainThread]: On master: BEGIN
[0m12:38:02.016047 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:38:02.027968 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m12:38:02.028371 [debug] [MainThread]: On master: COMMIT
[0m12:38:02.028572 [debug] [MainThread]: Using postgres connection "master"
[0m12:38:02.028736 [debug] [MainThread]: On master: COMMIT
[0m12:38:02.029797 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:38:02.030025 [debug] [MainThread]: On master: Close
[0m12:38:02.030281 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:38:02.030542 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m12:38:02.030705 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m12:38:02.030853 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m12:38:02.031003 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m12:38:02.031224 [info ] [MainThread]: 
[0m12:38:02.031407 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m12:38:02.032109 [debug] [MainThread]: Command end result
[0m12:38:02.046334 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m12:38:02.047728 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m12:38:02.052676 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m12:38:02.052965 [info ] [MainThread]: 
[0m12:38:02.053254 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:38:02.053573 [info ] [MainThread]: 
[0m12:38:02.053907 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m12:38:02.054299 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:38:02.056811 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5892065, "process_in_blocks": "0", "process_kernel_time": 0.24669, "process_mem_max_rss": "135708672", "process_out_blocks": "0", "process_user_time": 1.58517}
[0m12:38:02.057216 [debug] [MainThread]: Command `dbt run` succeeded at 12:38:02.057163 after 1.59 seconds
[0m12:38:02.057465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497e860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10559f280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c97250>]}
[0m12:38:02.057712 [debug] [MainThread]: Flushing usage events
[0m12:38:02.641740 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:38:23.689049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a1aa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10509d1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10509ca90>]}


============================== 16:38:23.692824 | 0140c2c9-8ace-47ad-9131-259751e8085e ==============================
[0m16:38:23.692824 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:38:23.693210 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'target_path': 'None', 'profiles_dir': '.', 'printer_width': '80', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'write_json': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'use_colors': 'True', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False'}
[0m16:38:23.693543 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:38:23.693758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0140c2c9-8ace-47ad-9131-259751e8085e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10509d2d0>]}
[0m16:38:23.839857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0140c2c9-8ace-47ad-9131-259751e8085e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a05ae0>]}
[0m16:38:23.881730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0140c2c9-8ace-47ad-9131-259751e8085e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105186d10>]}
[0m16:38:23.882502 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:38:23.950915 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:38:24.032708 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:38:24.033005 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:38:24.036501 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:38:24.055347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0140c2c9-8ace-47ad-9131-259751e8085e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e0a2c0>]}
[0m16:38:24.132672 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:38:24.134371 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:38:24.147984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0140c2c9-8ace-47ad-9131-259751e8085e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b94a90>]}
[0m16:38:24.148374 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m16:38:24.148602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0140c2c9-8ace-47ad-9131-259751e8085e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e0e8f0>]}
[0m16:38:24.149494 [info ] [MainThread]: 
[0m16:38:24.149704 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:38:24.149872 [info ] [MainThread]: 
[0m16:38:24.150182 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:38:24.152623 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:38:24.198377 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:38:24.198711 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:38:24.198890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:24.199625 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
connection to server at "127.0.0.1", port 5433 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?

[0m16:38:24.200056 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:38:24.200251 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m16:38:24.200469 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m16:38:24.200637 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m16:38:24.200825 [debug] [ThreadPool]: On list_highstreet: No close available on handle
[0m16:38:24.201219 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:38:24.201409 [debug] [MainThread]: Connection 'list_highstreet' was properly closed.
[0m16:38:24.201587 [info ] [MainThread]: 
[0m16:38:24.201925 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.05 seconds (0.05s).
[0m16:38:24.202217 [error] [MainThread]: Encountered an error:
Database Error
  connection to server at "127.0.0.1", port 5433 failed: Connection refused
  	Is the server running on that host and accepting TCP/IP connections?
  
[0m16:38:24.202520 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:38:24.204744 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.5751319, "process_in_blocks": "0", "process_kernel_time": 0.19877, "process_mem_max_rss": "123469824", "process_out_blocks": "0", "process_user_time": 1.140859}
[0m16:38:24.205203 [debug] [MainThread]: Command `dbt run` failed at 16:38:24.205129 after 0.58 seconds
[0m16:38:24.205469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a1aa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e0f010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e08dc0>]}
[0m16:38:24.205724 [debug] [MainThread]: Flushing usage events
[0m16:38:25.638982 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:38:57.985764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f3e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079c0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079c0580>]}


============================== 16:38:57.988833 | b0557284-fafa-443c-9bc1-eb41f0745241 ==============================
[0m16:38:57.988833 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:38:57.989229 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error': 'None', 'static_parser': 'True', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'log_cache_events': 'False', 'printer_width': '80', 'debug': 'False', 'fail_fast': 'False', 'empty': 'False', 'write_json': 'True', 'partial_parse': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None'}
[0m16:38:57.989589 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:38:57.989816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107909600>]}
[0m16:38:58.173808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a8fdf0>]}
[0m16:38:58.219703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10790a350>]}
[0m16:38:58.220738 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:38:58.291697 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:38:58.344793 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m16:38:58.345219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10691ee90>]}
[0m16:38:59.010894 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:38:59.017420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b817b0>]}
[0m16:38:59.107152 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:38:59.108863 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:38:59.121219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b698d0>]}
[0m16:38:59.121564 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m16:38:59.121772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b825f0>]}
[0m16:38:59.122708 [info ] [MainThread]: 
[0m16:38:59.122920 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:38:59.123086 [info ] [MainThread]: 
[0m16:38:59.123369 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:38:59.125861 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:38:59.160506 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:38:59.160833 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:38:59.161033 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:59.309400 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.148 seconds
[0m16:38:59.310386 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:38:59.310966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now create_highstreet_analytics_analytics)
[0m16:38:59.311356 [debug] [ThreadPool]: Creating schema "database: "highstreet"
schema: "analytics_analytics"
"
[0m16:38:59.314515 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m16:38:59.314728 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: BEGIN
[0m16:38:59.314896 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:59.380265 [debug] [ThreadPool]: SQL status: BEGIN in 0.065 seconds
[0m16:38:59.380637 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m16:38:59.380821 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "create_highstreet_analytics_analytics"} */
create schema if not exists "analytics_analytics"
[0m16:38:59.389274 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.008 seconds
[0m16:38:59.389903 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m16:38:59.390110 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m16:38:59.390276 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m16:38:59.393587 [debug] [ThreadPool]: SQL status: COMMIT in 0.003 seconds
[0m16:38:59.393803 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: Close
[0m16:38:59.394850 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_highstreet_analytics_analytics, now list_highstreet_analytics_analytics)
[0m16:38:59.398426 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:38:59.398662 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:38:59.398831 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:59.451755 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m16:38:59.452088 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:38:59.452300 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:38:59.523945 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.071 seconds
[0m16:38:59.525667 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:38:59.527509 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:38:59.530640 [debug] [MainThread]: Using postgres connection "master"
[0m16:38:59.530942 [debug] [MainThread]: On master: BEGIN
[0m16:38:59.531112 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:38:59.583101 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m16:38:59.586301 [debug] [MainThread]: Using postgres connection "master"
[0m16:38:59.587188 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:38:59.952978 [debug] [MainThread]: SQL status: SELECT 0 in 0.365 seconds
[0m16:38:59.955547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a8c310>]}
[0m16:38:59.956285 [debug] [MainThread]: On master: ROLLBACK
[0m16:38:59.958203 [debug] [MainThread]: Using postgres connection "master"
[0m16:38:59.958457 [debug] [MainThread]: On master: BEGIN
[0m16:38:59.960386 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:38:59.961126 [debug] [MainThread]: On master: COMMIT
[0m16:38:59.961636 [debug] [MainThread]: Using postgres connection "master"
[0m16:38:59.962099 [debug] [MainThread]: On master: COMMIT
[0m16:38:59.963895 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:38:59.964497 [debug] [MainThread]: On master: Close
[0m16:38:59.970179 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:38:59.970950 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:38:59.971397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:38:59.971672 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:38:59.977540 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:38:59.978972 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:39:00.003184 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:39:00.006679 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:39:00.007040 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:39:00.007319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:39:00.066512 [debug] [Thread-1 (]: SQL status: BEGIN in 0.059 seconds
[0m16:39:00.066905 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:39:00.067129 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:39:00.119203 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.052 seconds
[0m16:39:00.124836 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:39:00.125112 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:39:00.127936 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:39:00.135625 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:39:00.135881 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:39:00.136081 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:39:00.139968 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m16:39:00.143520 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:39:00.145890 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:39:00.146120 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:39:00.147817 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:39:00.149307 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:39:00.150736 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a9a20>]}
[0m16:39:00.151222 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.18s]
[0m16:39:00.151591 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:39:00.152081 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:39:00.152411 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:39:00.153019 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:39:00.153268 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:39:00.152775 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:39:00.153580 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:39:00.153862 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:39:00.154167 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:39:00.154488 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:39:00.154766 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:39:00.155023 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:39:00.155240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:39:00.155446 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:39:00.155640 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:39:00.155827 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:39:00.156010 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:39:00.158285 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.161474 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.163356 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:00.164995 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.166029 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:39:00.166273 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:39:00.166470 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:39:00.168783 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:00.169012 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:39:00.171218 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.173513 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.177106 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.177603 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:00.177987 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:39:00.178281 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.178590 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:39:00.178869 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:39:00.179127 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.179362 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.179670 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:39:00.179887 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:39:00.180093 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:39:00.180380 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:39:00.180697 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:39:00.238680 [debug] [Thread-4 (]: SQL status: BEGIN in 0.059 seconds
[0m16:39:00.239052 [debug] [Thread-2 (]: SQL status: BEGIN in 0.060 seconds
[0m16:39:00.239323 [debug] [Thread-3 (]: SQL status: BEGIN in 0.059 seconds
[0m16:39:00.239612 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.239862 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:00.240084 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.240323 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:39:00.240549 [debug] [Thread-1 (]: SQL status: BEGIN in 0.060 seconds
[0m16:39:00.240797 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:39:00.241078 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:39:00.241348 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.241668 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:39:00.356119 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.114 seconds
[0m16:39:00.358439 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.359032 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:39:00.362075 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:39:00.362974 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:39:00.363201 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.363397 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:39:00.371998 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m16:39:00.374054 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:39:00.374683 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:39:00.375011 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:39:00.378227 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:39:00.379151 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:39:00.379574 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10790af80>]}
[0m16:39:00.379964 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.22s]
[0m16:39:00.380396 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:39:00.385298 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.144 seconds
[0m16:39:00.387614 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.387940 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:39:00.391304 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:39:00.392292 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:39:00.392578 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.392871 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:39:00.398789 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m16:39:00.400609 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:39:00.401172 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:39:00.401392 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:39:00.403363 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:39:00.404169 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:39:00.404530 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10790ae30>]}
[0m16:39:00.404885 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.25s]
[0m16:39:00.405187 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:39:00.918807 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.677 seconds
[0m16:39:00.923427 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.923776 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:39:00.927373 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:39:00.928368 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:39:00.928600 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.928794 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:39:00.982853 [debug] [Thread-4 (]: SQL status: COMMIT in 0.054 seconds
[0m16:39:00.987319 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:39:00.988225 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:39:00.988552 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:39:00.990657 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:39:00.991661 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:39:00.991875 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.750 seconds
[0m16:39:00.992730 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085ead40>]}
[0m16:39:00.996720 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:00.997756 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:39:00.997496 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.84s]
[0m16:39:00.999025 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:39:01.010700 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.012 seconds
[0m16:39:01.011996 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:39:01.012266 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:01.012481 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:39:01.015646 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m16:39:01.017674 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:39:01.018176 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:39:01.018472 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:39:01.020610 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:39:01.021491 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:39:01.021897 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089cfb50>]}
[0m16:39:01.022289 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.87s]
[0m16:39:01.022606 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:39:01.023077 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m16:39:01.023356 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m16:39:01.023601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m16:39:01.023799 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m16:39:01.026483 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m16:39:01.027097 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m16:39:01.029823 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m16:39:01.030341 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:39:01.030552 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m16:39:01.030747 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:39:01.101865 [debug] [Thread-1 (]: SQL status: BEGIN in 0.071 seconds
[0m16:39:01.102273 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:39:01.102573 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select distinct * from combined_accounts order by business_name, event_date
  );
  
[0m16:39:02.939970 [debug] [Thread-1 (]: SQL status: SELECT 55594 in 1.837 seconds
[0m16:39:02.945241 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:39:02.945646 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m16:39:02.948775 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:39:02.949864 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:39:02.950137 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:39:02.950685 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:39:02.958355 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m16:39:02.960063 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m16:39:02.960516 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:39:02.960849 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m16:39:02.963201 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:39:02.964117 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m16:39:02.964550 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086444f0>]}
[0m16:39:02.964969 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 55594[0m in 1.94s]
[0m16:39:02.965377 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m16:39:02.965901 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m16:39:02.966197 [info ] [Thread-4 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m16:39:02.966740 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m16:39:02.967068 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m16:39:02.968845 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:02.969653 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m16:39:02.981656 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:02.982250 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:02.982457 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m16:39:02.982644 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:39:03.036352 [debug] [Thread-4 (]: SQL status: BEGIN in 0.054 seconds
[0m16:39:03.036818 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:03.037060 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m16:39:03.082656 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.045 seconds
[0m16:39:03.092201 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:03.093017 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m16:39:03.097916 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:39:03.098860 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:39:03.099111 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:03.099310 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:39:03.103343 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m16:39:03.105068 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m16:39:03.106649 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:39:03.106893 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m16:39:03.108783 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:39:03.109704 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m16:39:03.110112 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0557284-fafa-443c-9bc1-eb41f0745241', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e96560>]}
[0m16:39:03.110585 [info ] [Thread-4 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.14s]
[0m16:39:03.111104 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m16:39:03.112247 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:03.112453 [debug] [MainThread]: On master: BEGIN
[0m16:39:03.112620 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:39:03.165594 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:39:03.165939 [debug] [MainThread]: On master: COMMIT
[0m16:39:03.166117 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:03.166277 [debug] [MainThread]: On master: COMMIT
[0m16:39:03.167279 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:39:03.167594 [debug] [MainThread]: On master: Close
[0m16:39:03.167883 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:39:03.168055 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m16:39:03.168210 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m16:39:03.168346 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m16:39:03.168479 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:39:03.168712 [info ] [MainThread]: 
[0m16:39:03.168902 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 4.05 seconds (4.05s).
[0m16:39:03.169768 [debug] [MainThread]: Command end result
[0m16:39:03.184605 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:39:03.186182 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:39:03.190784 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:39:03.191045 [info ] [MainThread]: 
[0m16:39:03.191283 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:39:03.191585 [info ] [MainThread]: 
[0m16:39:03.191835 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m16:39:03.192177 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:39:03.194355 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.2629557, "process_in_blocks": "0", "process_kernel_time": 0.291429, "process_mem_max_rss": "134905856", "process_out_blocks": "0", "process_user_time": 2.147534}
[0m16:39:03.194808 [debug] [MainThread]: Command `dbt run` succeeded at 16:39:03.194747 after 5.26 seconds
[0m16:39:03.195079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f3e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10866c0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10624e560>]}
[0m16:39:03.195335 [debug] [MainThread]: Flushing usage events
[0m16:39:08.265069 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:45:20.682773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12297e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124a394e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124a38dc0>]}


============================== 16:45:20.685899 | 217e0bc6-0d9c-4c5a-bed5-bce3399b8b97 ==============================
[0m16:45:20.685899 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:45:20.686270 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'introspect': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'empty': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'debug': 'False', 'printer_width': '80', 'target_path': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_cache_events': 'False', 'warn_error': 'None'}
[0m16:45:20.857761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124b09690>]}
[0m16:45:20.901004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1236779d0>]}
[0m16:45:20.901842 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:45:20.971747 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:45:21.047466 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:45:21.047786 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:45:21.051298 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:45:21.071108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125951ba0>]}
[0m16:45:21.149698 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:21.151338 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:21.163057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125961390>]}
[0m16:45:21.163398 [info ] [MainThread]: Found 9 models, 5 sources, 434 macros
[0m16:45:21.163606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12560ab30>]}
[0m16:45:21.164585 [info ] [MainThread]: 
[0m16:45:21.164790 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:45:21.164963 [info ] [MainThread]: 
[0m16:45:21.165238 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:45:21.167753 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:45:21.201594 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:45:21.201898 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:45:21.202070 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:21.356169 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.154 seconds
[0m16:45:21.357077 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:45:21.358163 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:45:21.362114 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:21.362394 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:45:21.362568 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:45:21.417610 [debug] [ThreadPool]: SQL status: BEGIN in 0.055 seconds
[0m16:45:21.417952 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:21.418152 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:45:21.488936 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.071 seconds
[0m16:45:21.489830 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:45:21.491489 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:45:21.495103 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:21.495359 [debug] [MainThread]: On master: BEGIN
[0m16:45:21.495526 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:45:21.554676 [debug] [MainThread]: SQL status: BEGIN in 0.059 seconds
[0m16:45:21.555570 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:21.557737 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:45:21.971912 [debug] [MainThread]: SQL status: SELECT 1 in 0.413 seconds
[0m16:45:21.975583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c66b0>]}
[0m16:45:21.976478 [debug] [MainThread]: On master: ROLLBACK
[0m16:45:21.979196 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:21.979884 [debug] [MainThread]: On master: BEGIN
[0m16:45:21.981905 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:45:21.982406 [debug] [MainThread]: On master: COMMIT
[0m16:45:21.982875 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:21.983503 [debug] [MainThread]: On master: COMMIT
[0m16:45:21.986428 [debug] [MainThread]: SQL status: COMMIT in 0.002 seconds
[0m16:45:21.987545 [debug] [MainThread]: On master: Close
[0m16:45:21.990806 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:45:21.991248 [info ] [Thread-1 (]: 1 of 9 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:45:21.991550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:45:21.991786 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:45:21.997234 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:45:21.998191 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:45:22.021274 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:45:22.022170 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:22.022506 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:45:22.022707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:22.083045 [debug] [Thread-1 (]: SQL status: BEGIN in 0.060 seconds
[0m16:45:22.083404 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:22.083636 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:45:22.141426 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.057 seconds
[0m16:45:22.151753 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:22.152442 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:45:22.158126 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:45:22.160380 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:22.160703 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:45:22.162539 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:22.172007 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:45:22.172744 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:22.173181 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:45:22.178263 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m16:45:22.182336 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:45:22.185127 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:22.185526 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:45:22.199887 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:45:22.201660 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:45:22.202959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125cf60e0>]}
[0m16:45:22.203414 [info ] [Thread-1 (]: 1 of 9 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.21s]
[0m16:45:22.203761 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:45:22.204262 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:45:22.204489 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:22.204718 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:45:22.205009 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:45:22.205274 [info ] [Thread-3 (]: 2 of 9 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:45:22.205594 [info ] [Thread-4 (]: 3 of 9 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:45:22.205932 [info ] [Thread-2 (]: 4 of 9 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:45:22.206222 [info ] [Thread-1 (]: 5 of 9 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:45:22.206545 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:45:22.206835 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:45:22.207107 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:45:22.207327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:45:22.207538 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:45:22.207740 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:22.207935 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:45:22.208121 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:45:22.210323 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.212725 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.215043 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:22.217881 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.218897 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:22.219161 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:45:22.221517 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.221793 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:45:22.223912 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.224126 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:45:22.226294 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.228735 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:22.229059 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.229452 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.229710 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:45:22.229961 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:45:22.230192 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.230402 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:22.230611 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:45:22.230815 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:45:22.231033 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:45:22.231307 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:45:22.231794 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:22.232060 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:45:22.297858 [debug] [Thread-3 (]: SQL status: BEGIN in 0.067 seconds
[0m16:45:22.298240 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.298489 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:22.298829 [debug] [Thread-1 (]: SQL status: BEGIN in 0.067 seconds
[0m16:45:22.299210 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.299502 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:22.299978 [debug] [Thread-4 (]: SQL status: BEGIN in 0.069 seconds
[0m16:45:22.300220 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.300457 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:22.309957 [debug] [Thread-2 (]: SQL status: BEGIN in 0.078 seconds
[0m16:45:22.310441 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:22.310775 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:22.418357 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.119 seconds
[0m16:45:22.420905 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.421156 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:45:22.425478 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:22.428165 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.428490 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:45:22.430309 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:22.431286 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:45:22.431516 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.431713 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:45:22.438335 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m16:45:22.440028 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:45:22.440496 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:22.440709 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:45:22.445802 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.147 seconds
[0m16:45:22.447968 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.448211 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:45:22.451196 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:22.453267 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.453555 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:45:22.456281 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:22.457461 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:45:22.457715 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.457928 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:45:22.492898 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.052 seconds
[0m16:45:22.498083 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:45:22.498485 [debug] [Thread-3 (]: SQL status: COMMIT in 0.040 seconds
[0m16:45:22.498965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1255e02e0>]}
[0m16:45:22.500635 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:45:22.501093 [info ] [Thread-1 (]: 5 of 9 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.29s]
[0m16:45:22.501691 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:22.502124 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:45:22.502390 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:45:22.518864 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.016 seconds
[0m16:45:22.519968 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:45:22.520390 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125563370>]}
[0m16:45:22.520798 [info ] [Thread-3 (]: 2 of 9 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.31s]
[0m16:45:22.521134 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:45:22.960499 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.659 seconds
[0m16:45:22.963671 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.964072 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:45:22.968512 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:22.970921 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.971201 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:45:22.973461 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:22.974613 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:45:22.974843 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.975127 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:45:22.980335 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m16:45:22.982826 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:45:22.983314 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:22.983529 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:45:22.998472 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:45:22.998798 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.688 seconds
[0m16:45:22.999722 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:45:23.001815 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:23.002639 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125e001f0>]}
[0m16:45:23.002919 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:45:23.003390 [info ] [Thread-4 (]: 3 of 9 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.80s]
[0m16:45:23.003857 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:23.007386 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:23.009348 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:23.009759 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:45:23.012756 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:23.014072 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:45:23.014377 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:23.014588 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:45:23.017621 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:23.020003 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:45:23.020524 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:23.020723 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:45:23.034365 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.013 seconds
[0m16:45:23.035455 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:45:23.035883 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1250dbdf0>]}
[0m16:45:23.036285 [info ] [Thread-2 (]: 4 of 9 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.83s]
[0m16:45:23.036618 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:45:23.037071 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m16:45:23.037331 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m16:45:23.037742 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.properties
[0m16:45:23.037582 [info ] [Thread-1 (]: 6 of 9 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m16:45:23.038078 [info ] [Thread-3 (]: 7 of 9 START sql table model analytics_analytics.businesses .................... [RUN]
[0m16:45:23.038389 [info ] [Thread-4 (]: 8 of 9 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:45:23.038693 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m16:45:23.038943 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.businesses)
[0m16:45:23.039162 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.properties)
[0m16:45:23.039370 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m16:45:23.039571 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:45:23.039761 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.properties
[0m16:45:23.042158 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m16:45:23.044526 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:45:23.047397 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:45:23.048537 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m16:45:23.051684 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:45:23.051939 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m16:45:23.052161 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.properties
[0m16:45:23.054369 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m16:45:23.056832 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:45:23.057299 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:23.057728 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:45:23.058007 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:23.058237 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:45:23.058462 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m16:45:23.058678 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:23.058983 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:23.059194 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:45:23.059573 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:45:23.115681 [debug] [Thread-1 (]: SQL status: BEGIN in 0.057 seconds
[0m16:45:23.116079 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:23.116363 [debug] [Thread-3 (]: SQL status: BEGIN in 0.058 seconds
[0m16:45:23.116753 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select * from account_ends
    union all
    select * from accounts_new
    union all
    select * from accounts_no_relief_active
    union all
    select * from accounts_relief_active
)

select distinct * from combined_accounts order by business_name, event_date
  );
  
[0m16:45:23.117132 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:23.117377 [debug] [Thread-4 (]: SQL status: BEGIN in 0.058 seconds
[0m16:45:23.117683 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:45:23.117926 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:23.118213 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:45:23.391425 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.273 seconds
[0m16:45:23.397368 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:23.397664 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:45:23.400723 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:23.401668 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:45:23.401896 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:23.402087 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:45:23.405626 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:23.407215 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:45:23.407664 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:23.407873 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:45:23.409643 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:45:23.410476 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m16:45:23.410857 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1268d6890>]}
[0m16:45:23.411239 [info ] [Thread-3 (]: 7 of 9 OK created sql table model analytics_analytics.businesses ............... [[32mSELECT 6223[0m in 0.37s]
[0m16:45:23.411557 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m16:45:23.466319 [debug] [Thread-4 (]: SQL status: SELECT 9083 in 0.348 seconds
[0m16:45:23.475334 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:23.475655 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m16:45:23.478646 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:23.479649 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:45:23.479891 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:23.480090 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:45:23.484416 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:23.489079 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m16:45:23.490123 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:23.490325 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m16:45:23.492104 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:45:23.492879 [debug] [Thread-4 (]: On model.highstreet_tenure.properties: Close
[0m16:45:23.493250 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1268d6770>]}
[0m16:45:23.493633 [info ] [Thread-4 (]: 8 of 9 OK created sql table model analytics_analytics.properties ............... [[32mSELECT 9083[0m in 0.45s]
[0m16:45:23.493992 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.properties
[0m16:45:25.195589 [debug] [Thread-1 (]: SQL status: SELECT 55594 in 2.078 seconds
[0m16:45:25.199902 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:25.200281 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m16:45:25.204552 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:25.206663 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:25.206906 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m16:45:25.209121 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:25.210596 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:45:25.210856 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:25.211047 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:45:25.219489 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m16:45:25.221198 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m16:45:25.221635 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:25.221840 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m16:45:25.241402 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.019 seconds
[0m16:45:25.245671 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m16:45:25.248129 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125c4b190>]}
[0m16:45:25.248678 [info ] [Thread-1 (]: 6 of 9 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 55594[0m in 2.21s]
[0m16:45:25.249030 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m16:45:25.249477 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m16:45:25.249874 [info ] [Thread-2 (]: 9 of 9 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m16:45:25.250155 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m16:45:25.250365 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m16:45:25.252586 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.253016 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m16:45:25.264768 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.265433 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.265676 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m16:45:25.265872 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:45:25.318682 [debug] [Thread-2 (]: SQL status: BEGIN in 0.053 seconds
[0m16:45:25.319046 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.319467 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m16:45:25.366237 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.046 seconds
[0m16:45:25.369550 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.370066 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m16:45:25.375478 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:45:25.376605 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:45:25.376996 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.377268 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:45:25.382404 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m16:45:25.384748 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m16:45:25.386313 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:25.386538 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m16:45:25.388822 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:45:25.389804 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m16:45:25.390202 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '217e0bc6-0d9c-4c5a-bed5-bce3399b8b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126935b40>]}
[0m16:45:25.390595 [info ] [Thread-2 (]: 9 of 9 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.14s]
[0m16:45:25.390991 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m16:45:25.391829 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:25.392054 [debug] [MainThread]: On master: BEGIN
[0m16:45:25.392215 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:45:25.455178 [debug] [MainThread]: SQL status: BEGIN in 0.063 seconds
[0m16:45:25.455535 [debug] [MainThread]: On master: COMMIT
[0m16:45:25.455729 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:25.455892 [debug] [MainThread]: On master: COMMIT
[0m16:45:25.456860 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:25.457191 [debug] [MainThread]: On master: Close
[0m16:45:25.457490 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:45:25.457667 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m16:45:25.457816 [debug] [MainThread]: Connection 'model.highstreet_tenure.businesses' was properly closed.
[0m16:45:25.457955 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:45:25.458096 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m16:45:25.458319 [info ] [MainThread]: 
[0m16:45:25.458506 [info ] [MainThread]: Finished running 8 table models, 1 view model in 0 hours 0 minutes and 4.29 seconds (4.29s).
[0m16:45:25.459321 [debug] [MainThread]: Command end result
[0m16:45:25.483937 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:25.485689 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:25.492588 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:45:25.492894 [info ] [MainThread]: 
[0m16:45:25.493207 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:45:25.493492 [info ] [MainThread]: 
[0m16:45:25.493701 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m16:45:25.496270 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8661404, "process_in_blocks": "0", "process_kernel_time": 0.249106, "process_mem_max_rss": "129859584", "process_out_blocks": "0", "process_user_time": 1.516545}
[0m16:45:25.496816 [debug] [MainThread]: Command `dbt run` succeeded at 16:45:25.496724 after 4.87 seconds
[0m16:45:25.497170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12297e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120fde290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126883f70>]}
[0m16:45:25.497691 [debug] [MainThread]: Flushing usage events
[0m16:45:26.438783 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:24:32.492407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105622830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ca4be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ca44c0>]}


============================== 16:24:32.495692 | 3a1d1746-7af2-4a5c-acd0-b9580aac0b5b ==============================
[0m16:24:32.495692 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:24:32.496050 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'printer_width': '80', 'partial_parse': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run -m +addresses', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'fail_fast': 'False', 'no_print': 'None', 'log_format': 'default', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'target_path': 'None', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'debug': 'False', 'version_check': 'True', 'quiet': 'False'}
[0m16:24:32.496343 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:24:32.496561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bf2110>]}
[0m16:24:32.867871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043e4b80>]}
[0m16:24:32.912038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dcb4f0>]}
[0m16:24:32.912917 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:24:33.012048 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:24:33.088545 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m16:24:33.088941 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/addresses.sql
[0m16:24:33.279818 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:24:33.287866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a9e500>]}
[0m16:24:33.332672 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:24:33.334317 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:24:33.347289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792a350>]}
[0m16:24:33.347607 [info ] [MainThread]: Found 10 models, 5 sources, 434 macros
[0m16:24:33.347809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10793c5b0>]}
[0m16:24:33.348697 [info ] [MainThread]: 
[0m16:24:33.348910 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:24:33.349075 [info ] [MainThread]: 
[0m16:24:33.349364 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:24:33.351776 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:24:33.395292 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:24:33.395732 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:24:33.395964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:33.524026 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.128 seconds
[0m16:24:33.524901 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:24:33.526033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:24:33.529686 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:24:33.529920 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:24:33.530092 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:24:33.593842 [debug] [ThreadPool]: SQL status: BEGIN in 0.064 seconds
[0m16:24:33.594203 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:24:33.594419 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:24:33.671573 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.077 seconds
[0m16:24:33.675536 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:24:33.677396 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:24:33.681123 [debug] [MainThread]: Using postgres connection "master"
[0m16:24:33.681406 [debug] [MainThread]: On master: BEGIN
[0m16:24:33.681573 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:24:33.744063 [debug] [MainThread]: SQL status: BEGIN in 0.062 seconds
[0m16:24:33.745593 [debug] [MainThread]: Using postgres connection "master"
[0m16:24:33.746772 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:24:34.177514 [debug] [MainThread]: SQL status: SELECT 1 in 0.430 seconds
[0m16:24:34.179234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10515e860>]}
[0m16:24:34.179759 [debug] [MainThread]: On master: ROLLBACK
[0m16:24:34.181635 [debug] [MainThread]: Using postgres connection "master"
[0m16:24:34.181801 [debug] [MainThread]: On master: BEGIN
[0m16:24:34.183683 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:24:34.184061 [debug] [MainThread]: On master: COMMIT
[0m16:24:34.184268 [debug] [MainThread]: Using postgres connection "master"
[0m16:24:34.184534 [debug] [MainThread]: On master: COMMIT
[0m16:24:34.185550 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:24:34.185772 [debug] [MainThread]: On master: Close
[0m16:24:34.187585 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:24:34.187917 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:24:34.188197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:24:34.188406 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:24:34.193480 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:24:34.194729 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:24:34.219699 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:24:34.220542 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:24:34.220848 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:24:34.221141 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:24:34.274014 [debug] [Thread-1 (]: SQL status: BEGIN in 0.053 seconds
[0m16:24:34.274446 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:24:34.274723 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:24:34.344410 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.069 seconds
[0m16:24:34.350585 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:24:34.351016 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:24:34.353929 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:24:34.355948 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:24:34.356203 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:24:34.358144 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:24:34.366980 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:24:34.367282 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:24:34.367490 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:24:34.373384 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m16:24:34.377133 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:24:34.379486 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:24:34.379718 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:24:34.399725 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.020 seconds
[0m16:24:34.401390 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:24:34.402678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ef5c60>]}
[0m16:24:34.403108 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.21s]
[0m16:24:34.403437 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:24:34.403933 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:24:34.404213 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:24:34.404459 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:24:34.404680 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:24:34.404942 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:24:34.405310 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:24:34.405668 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:24:34.405985 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:24:34.406303 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:24:34.406582 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:24:34.406825 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:24:34.407034 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:24:34.407234 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:24:34.407430 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:24:34.407628 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:24:34.407818 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:24:34.409847 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.411619 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:34.414198 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:34.415800 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.417005 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:24:34.417390 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:24:34.417680 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:24:34.417952 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:24:34.420459 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:34.422606 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.424588 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:34.426756 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.427734 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.428064 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.428317 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:34.428554 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:34.428790 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:24:34.429021 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:24:34.429244 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:24:34.429450 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:24:34.429663 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:24:34.429868 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:24:34.430067 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:24:34.430263 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:24:34.491423 [debug] [Thread-2 (]: SQL status: BEGIN in 0.061 seconds
[0m16:24:34.491800 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:34.492066 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:24:34.492417 [debug] [Thread-3 (]: SQL status: BEGIN in 0.063 seconds
[0m16:24:34.492671 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.492926 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:24:34.493188 [debug] [Thread-4 (]: SQL status: BEGIN in 0.063 seconds
[0m16:24:34.493413 [debug] [Thread-1 (]: SQL status: BEGIN in 0.064 seconds
[0m16:24:34.493667 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:34.493990 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.494337 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:24:34.494673 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:24:34.651885 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.157 seconds
[0m16:24:34.654642 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.654875 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:24:34.659496 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:24:34.661217 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.661440 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:24:34.663520 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:24:34.664674 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:24:34.664923 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.665130 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:24:34.671638 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m16:24:34.673085 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:24:34.673568 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:24:34.673762 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:24:34.697436 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.023 seconds
[0m16:24:34.701076 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:24:34.702404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108077d00>]}
[0m16:24:34.703303 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.30s]
[0m16:24:34.703732 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:24:34.709298 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.215 seconds
[0m16:24:34.714106 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.714386 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:24:34.718623 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:24:34.720954 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.721243 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:24:34.725178 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:24:34.726165 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:24:34.726389 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.726585 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:24:34.737566 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m16:24:34.739375 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:24:34.739856 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:24:34.740069 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:24:34.767489 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.027 seconds
[0m16:24:34.769208 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:24:34.770064 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ef5f60>]}
[0m16:24:34.770914 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.36s]
[0m16:24:34.771506 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:24:35.548056 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 1.053 seconds
[0m16:24:35.553635 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:35.553911 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:24:35.558598 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:24:35.561338 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:35.561585 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:24:35.563309 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:24:35.564257 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:24:35.564483 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:35.564682 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:24:35.598398 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 1.106 seconds
[0m16:24:35.600834 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:35.601093 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:24:35.606573 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:24:35.608658 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:35.608942 [debug] [Thread-4 (]: SQL status: COMMIT in 0.044 seconds
[0m16:24:35.609294 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:24:35.610980 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:24:35.611550 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:24:35.611788 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:24:35.615866 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:24:35.617047 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:24:35.617462 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:35.617722 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:24:35.627694 [debug] [Thread-2 (]: SQL status: COMMIT in 0.010 seconds
[0m16:24:35.629457 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:24:35.629935 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:24:35.630151 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:24:35.672136 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.060 seconds
[0m16:24:35.673280 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:24:35.673714 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10802d750>]}
[0m16:24:35.674121 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 1.27s]
[0m16:24:35.674453 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:24:35.686766 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.056 seconds
[0m16:24:35.688389 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:24:35.694676 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10805be80>]}
[0m16:24:35.695458 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 1.29s]
[0m16:24:35.695829 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:24:35.696506 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.properties
[0m16:24:35.697058 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.properties .................... [RUN]
[0m16:24:35.697413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.properties)
[0m16:24:35.697656 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.properties
[0m16:24:35.701177 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:24:35.701783 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.properties
[0m16:24:35.704300 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:24:35.705150 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:24:35.705479 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:24:35.705804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:24:35.768794 [debug] [Thread-1 (]: SQL status: BEGIN in 0.063 seconds
[0m16:24:35.769146 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:24:35.769394 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:24:36.178367 [debug] [Thread-1 (]: SQL status: SELECT 9083 in 0.408 seconds
[0m16:24:36.185575 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:24:36.185871 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m16:24:36.191004 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:24:36.193374 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:24:36.193663 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m16:24:36.197597 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:24:36.198638 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:24:36.198900 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:24:36.199237 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:24:36.225824 [debug] [Thread-1 (]: SQL status: COMMIT in 0.026 seconds
[0m16:24:36.234647 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m16:24:36.235228 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:24:36.235442 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m16:24:36.253567 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.018 seconds
[0m16:24:36.256108 [debug] [Thread-1 (]: On model.highstreet_tenure.properties: Close
[0m16:24:36.257526 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10802e440>]}
[0m16:24:36.259063 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.properties ............... [[32mSELECT 9083[0m in 0.56s]
[0m16:24:36.259475 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.properties
[0m16:24:36.259928 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.addresses
[0m16:24:36.260259 [info ] [Thread-4 (]: 7 of 7 START sql table model analytics_analytics.addresses ..................... [RUN]
[0m16:24:36.260527 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.addresses)
[0m16:24:36.260735 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.addresses
[0m16:24:36.262484 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m16:24:36.262929 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.addresses
[0m16:24:36.265049 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m16:24:36.265783 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:24:36.266057 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: BEGIN
[0m16:24:36.266249 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:24:36.318518 [debug] [Thread-4 (]: SQL status: BEGIN in 0.052 seconds
[0m16:24:36.319448 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:24:36.320042 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m16:24:36.419444 [debug] [Thread-4 (]: SQL status: SELECT 4945 in 0.099 seconds
[0m16:24:36.426201 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:24:36.426893 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m16:24:36.429960 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:24:36.430859 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:24:36.431082 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:24:36.431273 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:24:36.445628 [debug] [Thread-4 (]: SQL status: COMMIT in 0.014 seconds
[0m16:24:36.450866 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m16:24:36.451364 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:24:36.451566 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m16:24:36.453601 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:24:36.454399 [debug] [Thread-4 (]: On model.highstreet_tenure.addresses: Close
[0m16:24:36.454776 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a1d1746-7af2-4a5c-acd0-b9580aac0b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10813ffa0>]}
[0m16:24:36.455159 [info ] [Thread-4 (]: 7 of 7 OK created sql table model analytics_analytics.addresses ................ [[32mSELECT 4945[0m in 0.19s]
[0m16:24:36.455478 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.addresses
[0m16:24:36.456231 [debug] [MainThread]: Using postgres connection "master"
[0m16:24:36.456410 [debug] [MainThread]: On master: BEGIN
[0m16:24:36.456565 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:24:36.509739 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:24:36.512781 [debug] [MainThread]: On master: COMMIT
[0m16:24:36.514082 [debug] [MainThread]: Using postgres connection "master"
[0m16:24:36.514275 [debug] [MainThread]: On master: COMMIT
[0m16:24:36.515982 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:24:36.516704 [debug] [MainThread]: On master: Close
[0m16:24:36.517045 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:24:36.517218 [debug] [MainThread]: Connection 'model.highstreet_tenure.properties' was properly closed.
[0m16:24:36.517362 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m16:24:36.517508 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m16:24:36.517645 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:24:36.517857 [info ] [MainThread]: 
[0m16:24:36.518043 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 3.17 seconds (3.17s).
[0m16:24:36.518900 [debug] [MainThread]: Command end result
[0m16:24:36.531886 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:24:36.533027 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:24:36.537186 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:24:36.537499 [info ] [MainThread]: 
[0m16:24:36.537766 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:24:36.537957 [info ] [MainThread]: 
[0m16:24:36.538151 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m16:24:36.538484 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:24:36.571083 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.133534, "process_in_blocks": "0", "process_kernel_time": 0.279516, "process_mem_max_rss": "132218880", "process_out_blocks": "0", "process_user_time": 1.606165}
[0m16:24:36.571798 [debug] [MainThread]: Command `dbt run` succeeded at 16:24:36.571710 after 4.13 seconds
[0m16:24:36.572179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105622830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dc8c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792ab90>]}
[0m16:24:36.572527 [debug] [MainThread]: Flushing usage events
[0m16:24:37.025411 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:27:47.932461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112440ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112440580>]}


============================== 15:27:47.935800 | ad61282d-2e70-404b-a027-4414d16b708b ==============================
[0m15:27:47.935800 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:27:47.936263 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'use_colors': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run -m +business_with_full_timeline', 'log_format': 'default', 'no_print': 'None', 'introspect': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'empty': 'False', 'use_experimental_parser': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'partial_parse': 'True', 'write_json': 'True'}
[0m15:27:47.936749 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:27:47.937008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11238d600>]}
[0m15:27:48.397663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11250fdf0>]}
[0m15:27:48.573474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11238e350>]}
[0m15:27:48.574518 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:27:48.672231 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:27:48.767921 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:27:48.768349 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m15:27:48.987905 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:27:48.996283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112269db0>]}
[0m15:27:49.044390 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:27:49.046348 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:27:49.067904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114708a30>]}
[0m15:27:49.068536 [info ] [MainThread]: Found 10 models, 5 sources, 434 macros
[0m15:27:49.068968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114708b80>]}
[0m15:27:49.070094 [info ] [MainThread]: 
[0m15:27:49.070446 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:27:49.070631 [info ] [MainThread]: 
[0m15:27:49.070984 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:27:49.073750 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:27:49.136730 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:27:49.137075 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:27:49.137262 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:27:49.417315 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.280 seconds
[0m15:27:49.418716 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:27:49.420689 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:27:49.428307 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:27:49.429494 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:27:49.429777 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:27:49.492489 [debug] [ThreadPool]: SQL status: BEGIN in 0.063 seconds
[0m15:27:49.492848 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:27:49.493072 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:27:49.572690 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.079 seconds
[0m15:27:49.573802 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:27:49.575913 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:27:49.579834 [debug] [MainThread]: Using postgres connection "master"
[0m15:27:49.580111 [debug] [MainThread]: On master: BEGIN
[0m15:27:49.580285 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:27:49.645157 [debug] [MainThread]: SQL status: BEGIN in 0.065 seconds
[0m15:27:49.645505 [debug] [MainThread]: Using postgres connection "master"
[0m15:27:49.645754 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:27:50.112106 [debug] [MainThread]: SQL status: SELECT 1 in 0.466 seconds
[0m15:27:50.114972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11476b1c0>]}
[0m15:27:50.116708 [debug] [MainThread]: On master: ROLLBACK
[0m15:27:50.118378 [debug] [MainThread]: Using postgres connection "master"
[0m15:27:50.118596 [debug] [MainThread]: On master: BEGIN
[0m15:27:50.120240 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:27:50.121002 [debug] [MainThread]: On master: COMMIT
[0m15:27:50.121503 [debug] [MainThread]: Using postgres connection "master"
[0m15:27:50.121965 [debug] [MainThread]: On master: COMMIT
[0m15:27:50.123098 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:27:50.123465 [debug] [MainThread]: On master: Close
[0m15:27:50.125838 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:27:50.126243 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m15:27:50.126561 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m15:27:50.126777 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:27:50.131763 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:27:50.132912 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:27:50.155410 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:27:50.156092 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:27:50.156390 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:27:50.156656 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:27:50.212361 [debug] [Thread-1 (]: SQL status: BEGIN in 0.056 seconds
[0m15:27:50.212726 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:27:50.212951 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:27:50.283456 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.070 seconds
[0m15:27:50.289486 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:27:50.289782 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m15:27:50.297294 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m15:27:50.299381 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:27:50.299652 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:27:50.301392 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:27:50.311349 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:27:50.311674 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:27:50.311883 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:27:50.317932 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m15:27:50.321578 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:27:50.323843 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:27:50.324076 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:27:50.342044 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.018 seconds
[0m15:27:50.343720 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:27:50.344985 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11556a0e0>]}
[0m15:27:50.345440 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.22s]
[0m15:27:50.345810 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:27:50.346305 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:27:50.346588 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:27:50.346850 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:27:50.347308 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:27:50.347121 [info ] [Thread-3 (]: 2 of 7 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:27:50.347723 [info ] [Thread-4 (]: 3 of 7 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:27:50.348019 [info ] [Thread-2 (]: 4 of 7 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:27:50.348342 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:27:50.348772 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:27:50.349068 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:27:50.349339 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:27:50.349563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m15:27:50.349765 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:27:50.349946 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:27:50.350120 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:27:50.350298 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:27:50.352414 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.354977 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:50.356822 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:50.358882 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.360041 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:27:50.360345 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:27:50.360608 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:27:50.363251 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.365781 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.366064 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:27:50.368723 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:50.371952 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:50.372461 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.372769 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.373090 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:27:50.373303 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:50.373550 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:27:50.373822 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:27:50.374101 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:50.374405 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:27:50.374657 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:27:50.374971 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:27:50.375179 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:27:50.375464 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:27:50.432080 [debug] [Thread-1 (]: SQL status: BEGIN in 0.058 seconds
[0m15:27:50.432494 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.432834 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:27:50.433391 [debug] [Thread-3 (]: SQL status: BEGIN in 0.059 seconds
[0m15:27:50.433640 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.433883 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:27:50.438558 [debug] [Thread-4 (]: SQL status: BEGIN in 0.063 seconds
[0m15:27:50.438866 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:50.439107 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:27:50.444453 [debug] [Thread-2 (]: SQL status: BEGIN in 0.069 seconds
[0m15:27:50.444777 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:50.445031 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:27:50.578978 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.146 seconds
[0m15:27:50.581375 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.581656 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:27:50.586342 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:27:50.588235 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.588478 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:27:50.595958 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m15:27:50.597249 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:27:50.597514 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.597716 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:27:50.635763 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.202 seconds
[0m15:27:50.638044 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.638306 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m15:27:50.644055 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m15:27:50.645875 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.646090 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m15:27:50.648085 [debug] [Thread-1 (]: SQL status: COMMIT in 0.050 seconds
[0m15:27:50.648351 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:27:50.650063 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:27:50.651035 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:27:50.651529 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:27:50.651830 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.652134 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:27:50.652367 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:27:50.661792 [debug] [Thread-3 (]: SQL status: COMMIT in 0.009 seconds
[0m15:27:50.665718 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m15:27:50.666361 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:27:50.666613 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m15:27:50.670571 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.018 seconds
[0m15:27:50.671494 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:27:50.671892 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11476a950>]}
[0m15:27:50.672281 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.32s]
[0m15:27:50.672602 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:27:50.690858 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.024 seconds
[0m15:27:50.691990 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:27:50.692408 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11556a350>]}
[0m15:27:50.692803 [info ] [Thread-3 (]: 2 of 7 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.34s]
[0m15:27:50.693124 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:27:51.377883 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.938 seconds
[0m15:27:51.383072 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:51.383378 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m15:27:51.387154 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:27:51.389204 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:51.389457 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m15:27:51.391358 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:27:51.392418 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:27:51.392654 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:51.392857 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:27:51.409760 [debug] [Thread-4 (]: SQL status: COMMIT in 0.016 seconds
[0m15:27:51.414675 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m15:27:51.415242 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:27:51.415478 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m15:27:51.439934 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.994 seconds
[0m15:27:51.445253 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:51.445549 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m15:27:51.449021 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:27:51.450918 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:51.451148 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:27:51.454684 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:27:51.455659 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:27:51.455880 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:51.456070 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:27:51.459949 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m15:27:51.461523 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:27:51.461963 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:27:51.462163 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:27:51.477904 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.060 seconds
[0m15:27:51.481504 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:27:51.481936 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1156a19f0>]}
[0m15:27:51.482461 [info ] [Thread-4 (]: 3 of 7 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 1.13s]
[0m15:27:51.482844 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:27:51.514386 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.052 seconds
[0m15:27:51.518085 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:27:51.518747 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1155b3c70>]}
[0m15:27:51.519169 [info ] [Thread-2 (]: 4 of 7 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 1.17s]
[0m15:27:51.519667 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:27:51.520150 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:27:51.520523 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m15:27:51.520817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_timeline)
[0m15:27:51.521034 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m15:27:51.523511 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m15:27:51.524509 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m15:27:51.527791 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m15:27:51.528534 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:27:51.528815 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m15:27:51.529012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:27:51.584467 [debug] [Thread-1 (]: SQL status: BEGIN in 0.055 seconds
[0m15:27:51.584838 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:27:51.585122 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select * from combined_accounts order by business_name, event_date
  );
  
[0m15:27:52.920169 [debug] [Thread-1 (]: SQL status: SELECT 39661 in 1.335 seconds
[0m15:27:52.925449 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:27:52.925766 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m15:27:52.929060 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:27:52.930801 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:27:52.931018 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m15:27:52.934165 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:27:52.935136 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m15:27:52.935343 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:27:52.935523 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m15:27:53.009075 [debug] [Thread-1 (]: SQL status: COMMIT in 0.073 seconds
[0m15:27:53.013434 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m15:27:53.013959 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:27:53.014171 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m15:27:53.064881 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.050 seconds
[0m15:27:53.066390 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m15:27:53.066865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1156a2020>]}
[0m15:27:53.067257 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 39661[0m in 1.55s]
[0m15:27:53.067575 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:27:53.068101 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m15:27:53.068366 [info ] [Thread-4 (]: 7 of 7 START sql view model analytics_analytics.business_with_full_timeline .... [RUN]
[0m15:27:53.068609 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_with_full_timeline)
[0m15:27:53.068813 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m15:27:53.070550 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.070976 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m15:27:53.082181 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.082905 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.083146 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m15:27:53.083441 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:27:53.135637 [debug] [Thread-4 (]: SQL status: BEGIN in 0.052 seconds
[0m15:27:53.136031 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.136284 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m15:27:53.180528 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.044 seconds
[0m15:27:53.186106 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.186908 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m15:27:53.192261 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m15:27:53.193218 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m15:27:53.193442 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.193641 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m15:27:53.197719 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m15:27:53.203741 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m15:27:53.205303 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:27:53.205558 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m15:27:53.208230 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.002 seconds
[0m15:27:53.209101 [debug] [Thread-4 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m15:27:53.209488 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad61282d-2e70-404b-a027-4414d16b708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115779210>]}
[0m15:27:53.209856 [info ] [Thread-4 (]: 7 of 7 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.14s]
[0m15:27:53.210168 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m15:27:53.210964 [debug] [MainThread]: Using postgres connection "master"
[0m15:27:53.211234 [debug] [MainThread]: On master: BEGIN
[0m15:27:53.211405 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:27:53.262654 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m15:27:53.263788 [debug] [MainThread]: On master: COMMIT
[0m15:27:53.264556 [debug] [MainThread]: Using postgres connection "master"
[0m15:27:53.265460 [debug] [MainThread]: On master: COMMIT
[0m15:27:53.267018 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:27:53.267742 [debug] [MainThread]: On master: Close
[0m15:27:53.268559 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:27:53.269104 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m15:27:53.269311 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:27:53.269468 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m15:27:53.269621 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:27:53.269870 [info ] [MainThread]: 
[0m15:27:53.270169 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 4.20 seconds (4.20s).
[0m15:27:53.270967 [debug] [MainThread]: Command end result
[0m15:27:53.284226 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:27:53.285372 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:27:53.289962 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:27:53.290241 [info ] [MainThread]: 
[0m15:27:53.290536 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:27:53.290787 [info ] [MainThread]: 
[0m15:27:53.291002 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m15:27:53.291411 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:27:53.329387 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.452925, "process_in_blocks": "0", "process_kernel_time": 0.339147, "process_mem_max_rss": "132169728", "process_out_blocks": "0", "process_user_time": 1.700371}
[0m15:27:53.329880 [debug] [MainThread]: Command `dbt run` succeeded at 15:27:53.329824 after 5.45 seconds
[0m15:27:53.330141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114508940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d8e560>]}
[0m15:27:53.330382 [debug] [MainThread]: Flushing usage events
[0m15:27:53.902972 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:33:26.469806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039b2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105340d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105340640>]}


============================== 15:33:26.473056 | f73ef034-7ec7-4349-8715-78eee511e74b ==============================
[0m15:33:26.473056 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:33:26.473441 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select date_spine', 'introspect': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'quiet': 'False', 'write_json': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'debug': 'False', 'fail_fast': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'version_check': 'True', 'warn_error': 'None', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'static_parser': 'True', 'target_path': 'None'}
[0m15:33:26.648549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104702890>]}
[0m15:33:26.694055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105343850>]}
[0m15:33:26.694960 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:33:26.765154 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:33:26.844593 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:33:26.844977 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/date_spine.sql
[0m15:33:27.043505 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:33:27.052241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10640bee0>]}
[0m15:33:27.282672 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:33:27.284536 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:33:27.299746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106409de0>]}
[0m15:33:27.300149 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:33:27.300372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10640a9e0>]}
[0m15:33:27.301273 [info ] [MainThread]: 
[0m15:33:27.301514 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:33:27.301685 [info ] [MainThread]: 
[0m15:33:27.301992 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:33:27.302464 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:33:27.339990 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:33:27.340339 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:33:27.340521 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:33:27.470181 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.130 seconds
[0m15:33:27.471103 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:33:27.474676 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:33:27.478484 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:33:27.478735 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:33:27.478910 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:33:27.537545 [debug] [ThreadPool]: SQL status: BEGIN in 0.059 seconds
[0m15:33:27.537888 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:33:27.538084 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:33:27.616249 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.078 seconds
[0m15:33:27.617280 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:33:27.618882 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:33:27.623156 [debug] [MainThread]: Using postgres connection "master"
[0m15:33:27.623432 [debug] [MainThread]: On master: BEGIN
[0m15:33:27.623601 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:33:27.679405 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m15:33:27.679745 [debug] [MainThread]: Using postgres connection "master"
[0m15:33:27.679983 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:33:28.154436 [debug] [MainThread]: SQL status: SELECT 1 in 0.474 seconds
[0m15:33:28.155449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106409d20>]}
[0m15:33:28.155955 [debug] [MainThread]: On master: ROLLBACK
[0m15:33:28.158142 [debug] [MainThread]: Using postgres connection "master"
[0m15:33:28.158500 [debug] [MainThread]: On master: BEGIN
[0m15:33:28.160305 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m15:33:28.160560 [debug] [MainThread]: On master: COMMIT
[0m15:33:28.160747 [debug] [MainThread]: Using postgres connection "master"
[0m15:33:28.160916 [debug] [MainThread]: On master: COMMIT
[0m15:33:28.161844 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:33:28.162047 [debug] [MainThread]: On master: Close
[0m15:33:28.163920 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:33:28.164432 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.date_spine .................... [RUN]
[0m15:33:28.164810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:33:28.165050 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:33:28.169816 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:33:28.170381 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:33:28.196021 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:33:28.197049 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:33:28.197318 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:33:28.197645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:33:28.258795 [debug] [Thread-1 (]: SQL status: BEGIN in 0.061 seconds
[0m15:33:28.259212 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:33:28.259640 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        dateadd(month, row_number() over (order by null) - 1, '1991-01-01'::date) as date_month
    from table(generator(rowcount => 432))  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    year(date_month) as year,
    month(date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:33:28.263398 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "table"
LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                  ^

[0m15:33:28.263790 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: ROLLBACK
[0m15:33:28.264947 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:33:28.269149 [debug] [Thread-1 (]: Database Error in model date_spine (models/int/date_spine.sql)
  syntax error at or near "table"
  LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                    ^
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:33:28.270448 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f73ef034-7ec7-4349-8715-78eee511e74b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103807280>]}
[0m15:33:28.270881 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.date_spine ........... [[31mERROR[0m in 0.10s]
[0m15:33:28.271242 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:33:28.271640 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.date_spine' to be skipped because of status 'error'.  Reason: Database Error in model date_spine (models/int/date_spine.sql)
  syntax error at or near "table"
  LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                    ^
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql.
[0m15:33:28.272898 [debug] [MainThread]: Using postgres connection "master"
[0m15:33:28.273230 [debug] [MainThread]: On master: BEGIN
[0m15:33:28.273520 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:33:28.328219 [debug] [MainThread]: SQL status: BEGIN in 0.055 seconds
[0m15:33:28.328587 [debug] [MainThread]: On master: COMMIT
[0m15:33:28.328777 [debug] [MainThread]: Using postgres connection "master"
[0m15:33:28.328943 [debug] [MainThread]: On master: COMMIT
[0m15:33:28.329823 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:33:28.330142 [debug] [MainThread]: On master: Close
[0m15:33:28.330422 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:33:28.330593 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m15:33:28.330789 [info ] [MainThread]: 
[0m15:33:28.331407 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m15:33:28.331928 [debug] [MainThread]: Command end result
[0m15:33:28.351405 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:33:28.354016 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:33:28.359497 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:33:28.359825 [info ] [MainThread]: 
[0m15:33:28.360087 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:33:28.360289 [info ] [MainThread]: 
[0m15:33:28.360508 [error] [MainThread]: [31mFailure in model date_spine (models/int/date_spine.sql)[0m
[0m15:33:28.360722 [error] [MainThread]:   Database Error in model date_spine (models/int/date_spine.sql)
  syntax error at or near "table"
  LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                    ^
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:33:28.360891 [info ] [MainThread]: 
[0m15:33:28.361082 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/date_spine.sql
[0m15:33:28.361249 [info ] [MainThread]: 
[0m15:33:28.361433 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:33:28.363916 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.9474237, "process_in_blocks": "0", "process_kernel_time": 0.260662, "process_mem_max_rss": "135249920", "process_out_blocks": "0", "process_user_time": 1.482679}
[0m15:33:28.364337 [debug] [MainThread]: Command `dbt run` failed at 15:33:28.364283 after 1.95 seconds
[0m15:33:28.364624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039b2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104702890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cb6140>]}
[0m15:33:28.364886 [debug] [MainThread]: Flushing usage events
[0m15:33:28.767215 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:38:14.691044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10807e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc0580>]}


============================== 15:38:14.694241 | b603a1e9-7ef9-457f-954a-cf0f81b6e583 ==============================
[0m15:38:14.694241 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:38:14.694589 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'printer_width': '80', 'no_print': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error': 'None', 'target_path': 'None', 'partial_parse': 'True', 'version_check': 'True', 'invocation_command': 'dbt run -m date_spine', 'debug': 'False', 'log_cache_events': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure'}
[0m15:38:14.694895 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:38:14.695102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c0f100>]}
[0m15:38:14.860747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d93df0>]}
[0m15:38:14.904360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c0e350>]}
[0m15:38:14.905248 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:38:14.972254 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:38:15.047413 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:38:15.047725 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:38:15.051295 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:38:15.070745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca9aa10>]}
[0m15:38:15.147651 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:38:15.148889 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:38:15.161391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cabe680>]}
[0m15:38:15.161727 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:38:15.161947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cabda50>]}
[0m15:38:15.162736 [info ] [MainThread]: 
[0m15:38:15.162949 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:38:15.163112 [info ] [MainThread]: 
[0m15:38:15.163389 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:38:15.163875 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:38:15.199635 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:38:15.200001 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:38:15.200190 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:38:15.335123 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.135 seconds
[0m15:38:15.335985 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:38:15.339030 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:38:15.342786 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:38:15.343070 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:38:15.343272 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:38:15.396224 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m15:38:15.396583 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:38:15.396801 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:38:15.466035 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.069 seconds
[0m15:38:15.467012 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:38:15.468596 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:38:15.472450 [debug] [MainThread]: Using postgres connection "master"
[0m15:38:15.472707 [debug] [MainThread]: On master: BEGIN
[0m15:38:15.472879 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:38:15.527828 [debug] [MainThread]: SQL status: BEGIN in 0.055 seconds
[0m15:38:15.528221 [debug] [MainThread]: Using postgres connection "master"
[0m15:38:15.528472 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:38:15.998350 [debug] [MainThread]: SQL status: SELECT 1 in 0.469 seconds
[0m15:38:16.000860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c32740>]}
[0m15:38:16.001200 [debug] [MainThread]: On master: ROLLBACK
[0m15:38:16.004359 [debug] [MainThread]: Using postgres connection "master"
[0m15:38:16.004623 [debug] [MainThread]: On master: BEGIN
[0m15:38:16.006580 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m15:38:16.007375 [debug] [MainThread]: On master: COMMIT
[0m15:38:16.007883 [debug] [MainThread]: Using postgres connection "master"
[0m15:38:16.008348 [debug] [MainThread]: On master: COMMIT
[0m15:38:16.009312 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:38:16.009547 [debug] [MainThread]: On master: Close
[0m15:38:16.011699 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:38:16.012136 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.date_spine .................... [RUN]
[0m15:38:16.012430 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:38:16.012645 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:38:16.017548 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:38:16.018150 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:38:16.039924 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:38:16.040646 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:38:16.040880 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:38:16.041080 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:16.094917 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m15:38:16.095290 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:38:16.095523 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        dateadd(month, row_number() over (order by null) - 1, '1991-01-01'::date) as date_month
    from table(generator(rowcount => 432))  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    year(date_month) as year,
    month(date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:38:16.098501 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "table"
LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                  ^

[0m15:38:16.098763 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: ROLLBACK
[0m15:38:16.099731 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:38:16.104608 [debug] [Thread-1 (]: Database Error in model date_spine (models/int/date_spine.sql)
  syntax error at or near "table"
  LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                    ^
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:38:16.105775 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b603a1e9-7ef9-457f-954a-cf0f81b6e583', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cada350>]}
[0m15:38:16.106200 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.date_spine ........... [[31mERROR[0m in 0.09s]
[0m15:38:16.106648 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:38:16.106999 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.date_spine' to be skipped because of status 'error'.  Reason: Database Error in model date_spine (models/int/date_spine.sql)
  syntax error at or near "table"
  LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                    ^
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql.
[0m15:38:16.108001 [debug] [MainThread]: Using postgres connection "master"
[0m15:38:16.108223 [debug] [MainThread]: On master: BEGIN
[0m15:38:16.108394 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:38:16.172950 [debug] [MainThread]: SQL status: BEGIN in 0.065 seconds
[0m15:38:16.173319 [debug] [MainThread]: On master: COMMIT
[0m15:38:16.173509 [debug] [MainThread]: Using postgres connection "master"
[0m15:38:16.173677 [debug] [MainThread]: On master: COMMIT
[0m15:38:16.174546 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:38:16.174772 [debug] [MainThread]: On master: Close
[0m15:38:16.175055 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:38:16.175232 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m15:38:16.175414 [info ] [MainThread]: 
[0m15:38:16.175601 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.01 seconds (1.01s).
[0m15:38:16.175962 [debug] [MainThread]: Command end result
[0m15:38:16.190098 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:38:16.191270 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:38:16.196455 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:38:16.196757 [info ] [MainThread]: 
[0m15:38:16.197073 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:38:16.197340 [info ] [MainThread]: 
[0m15:38:16.197635 [error] [MainThread]: [31mFailure in model date_spine (models/int/date_spine.sql)[0m
[0m15:38:16.197931 [error] [MainThread]:   Database Error in model date_spine (models/int/date_spine.sql)
  syntax error at or near "table"
  LINE 17:     from table(generator(rowcount => 432))  -- 432 months fr...
                    ^
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:38:16.198163 [info ] [MainThread]: 
[0m15:38:16.198435 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/date_spine.sql
[0m15:38:16.198653 [info ] [MainThread]: 
[0m15:38:16.198898 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:38:16.199314 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:38:16.202015 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.5627426, "process_in_blocks": "0", "process_kernel_time": 0.224794, "process_mem_max_rss": "129482752", "process_out_blocks": "0", "process_user_time": 1.243903}
[0m15:38:16.202519 [debug] [MainThread]: Command `dbt run` failed at 15:38:16.202431 after 1.56 seconds
[0m15:38:16.202809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10807e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9c2050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d90bb0>]}
[0m15:38:16.203069 [debug] [MainThread]: Flushing usage events
[0m15:38:16.754572 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:39:02.412321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11007e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118c0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118c0580>]}


============================== 15:39:02.415583 | 062b87a8-8927-4309-a55e-2bb4ef184324 ==============================
[0m15:39:02.415583 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:39:02.415987 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'printer_width': '80', 'static_parser': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'introspect': 'True', 'invocation_command': 'dbt run -m date_spine', 'target_path': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'no_print': 'None', 'write_json': 'True', 'empty': 'False', 'fail_fast': 'False'}
[0m15:39:02.416422 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:39:02.416817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11180d930>]}
[0m15:39:02.559320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111993df0>]}
[0m15:39:02.613134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11180e350>]}
[0m15:39:02.614158 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:39:02.686661 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:39:02.772728 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:39:02.773223 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/date_spine.sql
[0m15:39:02.989935 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:39:02.998194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113228130>]}
[0m15:39:03.082547 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:03.084731 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:03.109375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113228a30>]}
[0m15:39:03.109765 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:39:03.109990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11322b610>]}
[0m15:39:03.110790 [info ] [MainThread]: 
[0m15:39:03.111002 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:39:03.111160 [info ] [MainThread]: 
[0m15:39:03.111434 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:39:03.111997 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:39:03.146747 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:39:03.147073 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:39:03.147251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:03.295570 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.148 seconds
[0m15:39:03.296719 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:39:03.300101 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:39:03.304211 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:03.304601 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:39:03.304784 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:39:03.379129 [debug] [ThreadPool]: SQL status: BEGIN in 0.074 seconds
[0m15:39:03.379548 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:03.379768 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:39:03.498023 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.118 seconds
[0m15:39:03.499046 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:39:03.501220 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:39:03.505720 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:03.506065 [debug] [MainThread]: On master: BEGIN
[0m15:39:03.506233 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:39:03.580028 [debug] [MainThread]: SQL status: BEGIN in 0.074 seconds
[0m15:39:03.580491 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:03.580835 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:39:04.049260 [debug] [MainThread]: SQL status: SELECT 1 in 0.468 seconds
[0m15:39:04.050365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11187afe0>]}
[0m15:39:04.050827 [debug] [MainThread]: On master: ROLLBACK
[0m15:39:04.052916 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:04.053212 [debug] [MainThread]: On master: BEGIN
[0m15:39:04.054675 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:39:04.054909 [debug] [MainThread]: On master: COMMIT
[0m15:39:04.055096 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:04.055294 [debug] [MainThread]: On master: COMMIT
[0m15:39:04.056098 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:04.056282 [debug] [MainThread]: On master: Close
[0m15:39:04.058783 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:39:04.059348 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.date_spine .................... [RUN]
[0m15:39:04.059733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:39:04.059957 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:39:04.064707 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:39:04.065297 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:39:04.087700 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:39:04.088326 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:04.088549 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:39:04.088770 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:39:04.142172 [debug] [Thread-1 (]: SQL status: BEGIN in 0.053 seconds
[0m15:39:04.142520 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:04.142738 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    year(date_month) as year,
    month(date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:39:04.168675 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function year(date) does not exist
LINE 24:     year(date_month) as year,
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:39:04.169070 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: ROLLBACK
[0m15:39:04.170519 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:39:04.174573 [debug] [Thread-1 (]: Database Error in model date_spine (models/int/date_spine.sql)
  function year(date) does not exist
  LINE 24:     year(date_month) as year,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:39:04.175997 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '062b87a8-8927-4309-a55e-2bb4ef184324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dd7cd0>]}
[0m15:39:04.176481 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.date_spine ........... [[31mERROR[0m in 0.12s]
[0m15:39:04.177034 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:39:04.177452 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.date_spine' to be skipped because of status 'error'.  Reason: Database Error in model date_spine (models/int/date_spine.sql)
  function year(date) does not exist
  LINE 24:     year(date_month) as year,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql.
[0m15:39:04.178673 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:04.178908 [debug] [MainThread]: On master: BEGIN
[0m15:39:04.179067 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:39:04.240676 [debug] [MainThread]: SQL status: BEGIN in 0.061 seconds
[0m15:39:04.241014 [debug] [MainThread]: On master: COMMIT
[0m15:39:04.241250 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:04.241568 [debug] [MainThread]: On master: COMMIT
[0m15:39:04.242895 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:04.243164 [debug] [MainThread]: On master: Close
[0m15:39:04.243441 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:39:04.243616 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m15:39:04.243789 [info ] [MainThread]: 
[0m15:39:04.243975 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.13 seconds (1.13s).
[0m15:39:04.244537 [debug] [MainThread]: Command end result
[0m15:39:04.259123 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:04.260231 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:04.264721 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:39:04.265002 [info ] [MainThread]: 
[0m15:39:04.265239 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:39:04.265433 [info ] [MainThread]: 
[0m15:39:04.265648 [error] [MainThread]: [31mFailure in model date_spine (models/int/date_spine.sql)[0m
[0m15:39:04.265849 [error] [MainThread]:   Database Error in model date_spine (models/int/date_spine.sql)
  function year(date) does not exist
  LINE 24:     year(date_month) as year,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:39:04.266011 [info ] [MainThread]: 
[0m15:39:04.266192 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/date_spine.sql
[0m15:39:04.266345 [info ] [MainThread]: 
[0m15:39:04.266518 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:39:04.266818 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:39:04.269456 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.9124568, "process_in_blocks": "0", "process_kernel_time": 0.254517, "process_mem_max_rss": "135839744", "process_out_blocks": "0", "process_user_time": 1.492845}
[0m15:39:04.269947 [debug] [MainThread]: Command `dbt run` failed at 15:39:04.269874 after 1.91 seconds
[0m15:39:04.270231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11007e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dd4d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11365c700>]}
[0m15:39:04.270477 [debug] [MainThread]: Flushing usage events
[0m15:39:04.714206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:39:13.251916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c40d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c40610>]}


============================== 15:39:13.255820 | 04463025-eaa1-4b02-bbac-8c8704a399ac ==============================
[0m15:39:13.255820 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:39:13.256264 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'quiet': 'False', 'debug': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'target_path': 'None', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select date_spine', 'printer_width': '80', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'empty': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False'}
[0m15:39:13.378903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f35ba0>]}
[0m15:39:13.423095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e8af50>]}
[0m15:39:13.424771 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:39:13.496195 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:39:13.573343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:39:13.573668 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:39:13.577546 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:39:13.596211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c02560>]}
[0m15:39:13.678243 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:13.679318 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:13.692175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c13a30>]}
[0m15:39:13.692497 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:39:13.692702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bd8250>]}
[0m15:39:13.693452 [info ] [MainThread]: 
[0m15:39:13.693675 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:39:13.693836 [info ] [MainThread]: 
[0m15:39:13.694102 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:39:13.694664 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:39:13.724907 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:39:13.725242 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:39:13.725430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:13.832002 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.107 seconds
[0m15:39:13.833070 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:39:13.836531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:39:13.840310 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:13.840584 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:39:13.840756 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:39:13.894064 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m15:39:13.894427 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:13.894628 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:39:13.957458 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.063 seconds
[0m15:39:13.958523 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:39:13.960586 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:39:13.964873 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:13.965130 [debug] [MainThread]: On master: BEGIN
[0m15:39:13.965354 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:39:14.017338 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m15:39:14.017722 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:14.017970 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:39:14.488660 [debug] [MainThread]: SQL status: SELECT 1 in 0.470 seconds
[0m15:39:14.489640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f4d720>]}
[0m15:39:14.489923 [debug] [MainThread]: On master: ROLLBACK
[0m15:39:14.491723 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:14.492120 [debug] [MainThread]: On master: BEGIN
[0m15:39:14.493956 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m15:39:14.494256 [debug] [MainThread]: On master: COMMIT
[0m15:39:14.494447 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:14.494624 [debug] [MainThread]: On master: COMMIT
[0m15:39:14.495423 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:14.495609 [debug] [MainThread]: On master: Close
[0m15:39:14.497522 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:39:14.497909 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.date_spine .................... [RUN]
[0m15:39:14.498265 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:39:14.498649 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:39:14.504079 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:39:14.504677 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:39:14.528422 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:39:14.529264 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:14.529539 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:39:14.529802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:39:14.587360 [debug] [Thread-1 (]: SQL status: BEGIN in 0.057 seconds
[0m15:39:14.587760 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:14.587997 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    year(date_month) as year,
    month(date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:39:14.605577 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function year(date) does not exist
LINE 24:     year(date_month) as year,
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:39:14.605934 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: ROLLBACK
[0m15:39:14.607104 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:39:14.610979 [debug] [Thread-1 (]: Database Error in model date_spine (models/int/date_spine.sql)
  function year(date) does not exist
  LINE 24:     year(date_month) as year,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:39:14.612307 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04463025-eaa1-4b02-bbac-8c8704a399ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c4f400>]}
[0m15:39:14.612761 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.date_spine ........... [[31mERROR[0m in 0.11s]
[0m15:39:14.613128 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:39:14.613452 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.date_spine' to be skipped because of status 'error'.  Reason: Database Error in model date_spine (models/int/date_spine.sql)
  function year(date) does not exist
  LINE 24:     year(date_month) as year,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql.
[0m15:39:14.614387 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:14.614590 [debug] [MainThread]: On master: BEGIN
[0m15:39:14.614758 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:39:14.666797 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m15:39:14.667193 [debug] [MainThread]: On master: COMMIT
[0m15:39:14.667398 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:14.667755 [debug] [MainThread]: On master: COMMIT
[0m15:39:14.669033 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:14.669296 [debug] [MainThread]: On master: Close
[0m15:39:14.669569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:39:14.669748 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m15:39:14.669938 [info ] [MainThread]: 
[0m15:39:14.670170 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.98 seconds (0.98s).
[0m15:39:14.670608 [debug] [MainThread]: Command end result
[0m15:39:14.684100 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:14.685217 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:14.688776 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:39:14.689034 [info ] [MainThread]: 
[0m15:39:14.689485 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:39:14.689704 [info ] [MainThread]: 
[0m15:39:14.689952 [error] [MainThread]: [31mFailure in model date_spine (models/int/date_spine.sql)[0m
[0m15:39:14.690177 [error] [MainThread]:   Database Error in model date_spine (models/int/date_spine.sql)
  function year(date) does not exist
  LINE 24:     year(date_month) as year,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/date_spine.sql
[0m15:39:14.690355 [info ] [MainThread]: 
[0m15:39:14.690551 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/date_spine.sql
[0m15:39:14.690779 [info ] [MainThread]: 
[0m15:39:14.691043 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:39:14.693202 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.4933301, "process_in_blocks": "0", "process_kernel_time": 0.206673, "process_mem_max_rss": "130416640", "process_out_blocks": "0", "process_user_time": 1.301953}
[0m15:39:14.693536 [debug] [MainThread]: Command `dbt run` failed at 15:39:14.693489 after 1.49 seconds
[0m15:39:14.693780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f35ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068d0460>]}
[0m15:39:14.694017 [debug] [MainThread]: Flushing usage events
[0m15:39:15.052241 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:39:30.342353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107316a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108999180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108998a60>]}


============================== 15:39:30.346216 | f1bd661f-0865-4ffc-8523-bbd49a2883a7 ==============================
[0m15:39:30.346216 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:39:30.346733 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'printer_width': '80', 'no_print': 'None', 'log_format': 'default', 'version_check': 'True', 'quiet': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'invocation_command': 'dbt run --select date_spine', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'use_colors': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'write_json': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m15:39:30.501326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10894d930>]}
[0m15:39:30.548691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10896a560>]}
[0m15:39:30.549661 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:39:30.619980 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:39:30.697020 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:39:30.697479 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/date_spine.sql
[0m15:39:30.900837 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:39:30.909900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097900a0>]}
[0m15:39:30.958576 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:30.962380 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:30.977961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109793040>]}
[0m15:39:30.978334 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:39:30.978546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109657a60>]}
[0m15:39:30.979274 [info ] [MainThread]: 
[0m15:39:30.979477 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:39:30.979649 [info ] [MainThread]: 
[0m15:39:30.979927 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:39:30.980474 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:39:31.018695 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:39:31.019015 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:39:31.019196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:31.144307 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.125 seconds
[0m15:39:31.145262 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:39:31.148485 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:39:31.152957 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:31.153393 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:39:31.153728 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:39:31.219289 [debug] [ThreadPool]: SQL status: BEGIN in 0.065 seconds
[0m15:39:31.219784 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:39:31.220113 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:39:31.304836 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.084 seconds
[0m15:39:31.306152 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:39:31.312051 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:39:31.318679 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:31.319066 [debug] [MainThread]: On master: BEGIN
[0m15:39:31.319266 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:39:31.379913 [debug] [MainThread]: SQL status: BEGIN in 0.061 seconds
[0m15:39:31.380265 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:31.380515 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:39:31.897383 [debug] [MainThread]: SQL status: SELECT 1 in 0.517 seconds
[0m15:39:31.898394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a63430>]}
[0m15:39:31.898708 [debug] [MainThread]: On master: ROLLBACK
[0m15:39:31.901025 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:31.901344 [debug] [MainThread]: On master: BEGIN
[0m15:39:31.903055 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:39:31.903269 [debug] [MainThread]: On master: COMMIT
[0m15:39:31.903445 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:31.903609 [debug] [MainThread]: On master: COMMIT
[0m15:39:31.904588 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:31.904902 [debug] [MainThread]: On master: Close
[0m15:39:31.906701 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:39:31.907064 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.date_spine .................... [RUN]
[0m15:39:31.907468 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:39:31.907894 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:39:31.912974 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:39:31.913644 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:39:31.938891 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:39:31.939578 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:31.939813 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:39:31.940017 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:39:31.994495 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m15:39:31.994918 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:31.995171 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:39:32.082048 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.087 seconds
[0m15:39:32.089290 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:32.089936 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m15:39:32.093685 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:39:32.101948 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m15:39:32.102382 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:32.102771 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m15:39:32.109024 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m15:39:32.113298 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m15:39:32.116558 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:39:32.116817 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m15:39:32.120181 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m15:39:32.121970 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:39:32.123288 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1bd661f-0865-4ffc-8523-bbd49a2883a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109be6320>]}
[0m15:39:32.123900 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.date_spine ............... [[32mSELECT 432[0m in 0.21s]
[0m15:39:32.124391 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:39:32.125328 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:32.125562 [debug] [MainThread]: On master: BEGIN
[0m15:39:32.125731 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:39:32.184551 [debug] [MainThread]: SQL status: BEGIN in 0.059 seconds
[0m15:39:32.184946 [debug] [MainThread]: On master: COMMIT
[0m15:39:32.185251 [debug] [MainThread]: Using postgres connection "master"
[0m15:39:32.185564 [debug] [MainThread]: On master: COMMIT
[0m15:39:32.186693 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:39:32.186958 [debug] [MainThread]: On master: Close
[0m15:39:32.187257 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:39:32.187443 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m15:39:32.187641 [info ] [MainThread]: 
[0m15:39:32.187839 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.21 seconds (1.21s).
[0m15:39:32.188243 [debug] [MainThread]: Command end result
[0m15:39:32.204141 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:39:32.205880 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:39:32.210199 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:39:32.210530 [info ] [MainThread]: 
[0m15:39:32.210861 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:39:32.211197 [info ] [MainThread]: 
[0m15:39:32.211439 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:39:32.214076 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9285868, "process_in_blocks": "0", "process_kernel_time": 0.257438, "process_mem_max_rss": "134463488", "process_out_blocks": "0", "process_user_time": 1.504024}
[0m15:39:32.214516 [debug] [MainThread]: Command `dbt run` succeeded at 15:39:32.214464 after 1.93 seconds
[0m15:39:32.214765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107316a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10894fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071c9180>]}
[0m15:39:32.215005 [debug] [MainThread]: Flushing usage events
[0m15:39:32.600921 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:42:20.481663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034fa920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b78c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b78520>]}


============================== 15:42:20.485008 | 0440507d-9674-405c-97c0-6a6a821dc639 ==============================
[0m15:42:20.485008 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:42:20.485404 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'debug': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'quiet': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt run -m business_timeline', 'write_json': 'True', 'partial_parse': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'no_print': 'None', 'target_path': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'printer_width': '80', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True'}
[0m15:42:20.485710 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:42:20.485919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ac56f0>]}
[0m15:42:20.654050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103838d00>]}
[0m15:42:20.695815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102339240>]}
[0m15:42:20.696597 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:42:20.763539 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:42:20.837437 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:42:20.837894 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m15:42:21.033882 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:42:21.041910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105990130>]}
[0m15:42:21.089251 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:42:21.090775 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:42:21.103402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105992b60>]}
[0m15:42:21.103745 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:42:21.103950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105990730>]}
[0m15:42:21.104717 [info ] [MainThread]: 
[0m15:42:21.104921 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:42:21.105085 [info ] [MainThread]: 
[0m15:42:21.105360 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:42:21.105821 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:42:21.138834 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:42:21.139137 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:42:21.139307 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:42:21.287349 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.148 seconds
[0m15:42:21.288216 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:42:21.291362 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:42:21.295000 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:42:21.295236 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:42:21.295414 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:42:21.359740 [debug] [ThreadPool]: SQL status: BEGIN in 0.064 seconds
[0m15:42:21.360114 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:42:21.360338 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:42:21.440287 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.080 seconds
[0m15:42:21.441244 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:42:21.443197 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:42:21.447767 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:21.448055 [debug] [MainThread]: On master: BEGIN
[0m15:42:21.448220 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:42:21.522232 [debug] [MainThread]: SQL status: BEGIN in 0.074 seconds
[0m15:42:21.522577 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:21.522823 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:42:21.987138 [debug] [MainThread]: SQL status: SELECT 1 in 0.464 seconds
[0m15:42:21.991112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105992830>]}
[0m15:42:21.993418 [debug] [MainThread]: On master: ROLLBACK
[0m15:42:21.996015 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:21.996662 [debug] [MainThread]: On master: BEGIN
[0m15:42:21.998326 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:42:21.998835 [debug] [MainThread]: On master: COMMIT
[0m15:42:21.999310 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:22.000425 [debug] [MainThread]: On master: COMMIT
[0m15:42:22.002580 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:42:22.002795 [debug] [MainThread]: On master: Close
[0m15:42:22.004767 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:42:22.005142 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m15:42:22.005443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m15:42:22.005743 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m15:42:22.010995 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m15:42:22.011742 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m15:42:22.037547 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m15:42:22.038352 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:42:22.038662 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m15:42:22.038934 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:42:22.090795 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m15:42:22.091168 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:42:22.091468 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select *, cast(to_char(event_date, 'YYYYMM') as int) as year_month_key from combined_accounts order by business_name, event_date
  );
  
[0m15:42:22.106929 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function to_char(text, unknown) does not exist
LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as int) as year...
                        ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:42:22.107254 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m15:42:22.108355 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m15:42:22.113543 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as int) as year...
                          ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m15:42:22.114838 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0440507d-9674-405c-97c0-6a6a821dc639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105993040>]}
[0m15:42:22.115284 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.11s]
[0m15:42:22.115640 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:42:22.115950 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as int) as year...
                          ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m15:42:22.116984 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:22.117265 [debug] [MainThread]: On master: BEGIN
[0m15:42:22.117427 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:42:22.170778 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m15:42:22.171126 [debug] [MainThread]: On master: COMMIT
[0m15:42:22.171306 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:22.171467 [debug] [MainThread]: On master: COMMIT
[0m15:42:22.172296 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:42:22.172463 [debug] [MainThread]: On master: Close
[0m15:42:22.172705 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:42:22.172869 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m15:42:22.173054 [info ] [MainThread]: 
[0m15:42:22.173234 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.07 seconds (1.07s).
[0m15:42:22.173608 [debug] [MainThread]: Command end result
[0m15:42:22.187173 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:42:22.188293 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:42:22.192743 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:42:22.193022 [info ] [MainThread]: 
[0m15:42:22.193279 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:42:22.193529 [info ] [MainThread]: 
[0m15:42:22.193767 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m15:42:22.193991 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as int) as year...
                          ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m15:42:22.194178 [info ] [MainThread]: 
[0m15:42:22.194371 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m15:42:22.194536 [info ] [MainThread]: 
[0m15:42:22.194718 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:42:22.195027 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:42:22.197480 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7744057, "process_in_blocks": "0", "process_kernel_time": 0.225533, "process_mem_max_rss": "134856704", "process_out_blocks": "0", "process_user_time": 1.350791}
[0m15:42:22.197833 [debug] [MainThread]: Command `dbt run` failed at 15:42:22.197778 after 1.77 seconds
[0m15:42:22.198079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034fa920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103838d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10380f880>]}
[0m15:42:22.198299 [debug] [MainThread]: Flushing usage events
[0m15:42:22.613025 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:42:46.938706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ee2860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105564b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105564430>]}


============================== 15:42:46.941635 | eac96e9d-e4ec-4898-ba92-29085904f9db ==============================
[0m15:42:46.941635 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:42:46.941982 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run -m business_timeline', 'write_json': 'True', 'quiet': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error': 'None', 'target_path': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_cache_events': 'False', 'introspect': 'True', 'empty': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'static_parser': 'True', 'printer_width': '80', 'version_check': 'True'}
[0m15:42:46.942280 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:42:46.942501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104954730>]}
[0m15:42:47.073506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059887f0>]}
[0m15:42:47.115510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052a7790>]}
[0m15:42:47.116243 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:42:47.183689 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:42:47.258434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:42:47.258858 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m15:42:47.446830 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:42:47.454815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059b5e40>]}
[0m15:42:47.500602 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:42:47.502119 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:42:47.514233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10637f6a0>]}
[0m15:42:47.514571 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:42:47.514780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106212710>]}
[0m15:42:47.515542 [info ] [MainThread]: 
[0m15:42:47.515743 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:42:47.515906 [info ] [MainThread]: 
[0m15:42:47.516188 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:42:47.516644 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:42:47.548810 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:42:47.549130 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:42:47.549303 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:42:47.670144 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.121 seconds
[0m15:42:47.671034 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:42:47.674260 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:42:47.677986 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:42:47.678260 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:42:47.678439 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:42:47.736629 [debug] [ThreadPool]: SQL status: BEGIN in 0.058 seconds
[0m15:42:47.736984 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:42:47.737180 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:42:47.807378 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.070 seconds
[0m15:42:47.808326 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:42:47.809845 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:42:47.813719 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:47.813943 [debug] [MainThread]: On master: BEGIN
[0m15:42:47.814109 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:42:47.871940 [debug] [MainThread]: SQL status: BEGIN in 0.058 seconds
[0m15:42:47.874054 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:47.874837 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:42:48.385074 [debug] [MainThread]: SQL status: SELECT 1 in 0.509 seconds
[0m15:42:48.387903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056373a0>]}
[0m15:42:48.388942 [debug] [MainThread]: On master: ROLLBACK
[0m15:42:48.391412 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:48.391720 [debug] [MainThread]: On master: BEGIN
[0m15:42:48.393491 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:42:48.394189 [debug] [MainThread]: On master: COMMIT
[0m15:42:48.394687 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:48.395151 [debug] [MainThread]: On master: COMMIT
[0m15:42:48.396441 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:42:48.396763 [debug] [MainThread]: On master: Close
[0m15:42:48.398663 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:42:48.399044 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m15:42:48.399341 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m15:42:48.399654 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m15:42:48.405035 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m15:42:48.405605 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m15:42:48.431749 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m15:42:48.432408 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:42:48.432639 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m15:42:48.432841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:42:48.502344 [debug] [Thread-1 (]: SQL status: BEGIN in 0.069 seconds
[0m15:42:48.502771 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:42:48.503063 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select *, cast(to_char(event_date, 'YYYYMM') as integer) as year_month_key from combined_accounts order by business_name, event_date
  );
  
[0m15:42:48.519010 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function to_char(text, unknown) does not exist
LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as integer) as ...
                        ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:42:48.519432 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m15:42:48.521173 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m15:42:48.529010 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as integer) as ...
                          ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m15:42:48.530576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eac96e9d-e4ec-4898-ba92-29085904f9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d39d80>]}
[0m15:42:48.531158 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.13s]
[0m15:42:48.531501 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:42:48.531847 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as integer) as ...
                          ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m15:42:48.532924 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:48.533156 [debug] [MainThread]: On master: BEGIN
[0m15:42:48.533339 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:42:48.608424 [debug] [MainThread]: SQL status: BEGIN in 0.075 seconds
[0m15:42:48.608803 [debug] [MainThread]: On master: COMMIT
[0m15:42:48.608994 [debug] [MainThread]: Using postgres connection "master"
[0m15:42:48.609161 [debug] [MainThread]: On master: COMMIT
[0m15:42:48.610202 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:42:48.610510 [debug] [MainThread]: On master: Close
[0m15:42:48.610783 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:42:48.610953 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m15:42:48.611142 [info ] [MainThread]: 
[0m15:42:48.611329 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m15:42:48.611708 [debug] [MainThread]: Command end result
[0m15:42:48.629231 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:42:48.631721 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:42:48.635560 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:42:48.635812 [info ] [MainThread]: 
[0m15:42:48.636043 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:42:48.636232 [info ] [MainThread]: 
[0m15:42:48.636443 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m15:42:48.636653 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, cast(to_char(event_date, 'YYYYMM') as integer) as ...
                          ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m15:42:48.636825 [info ] [MainThread]: 
[0m15:42:48.637012 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m15:42:48.637168 [info ] [MainThread]: 
[0m15:42:48.637349 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:42:48.637658 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:42:48.640157 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7535677, "process_in_blocks": "0", "process_kernel_time": 0.206411, "process_mem_max_rss": "132726784", "process_out_blocks": "0", "process_user_time": 1.360337}
[0m15:42:48.640588 [debug] [MainThread]: Command `dbt run` failed at 15:42:48.640531 after 1.75 seconds
[0m15:42:48.640827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ee2860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052a7790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041f4fa0>]}
[0m15:42:48.641103 [debug] [MainThread]: Flushing usage events
[0m15:42:49.086488 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:44:40.604187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545e800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ae0b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ae0430>]}


============================== 15:44:40.607263 | ab2384e7-b13d-40e5-b117-214bf9d57258 ==============================
[0m15:44:40.607263 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:44:40.607841 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'empty': 'False', 'printer_width': '80', 'quiet': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'log_format': 'default', 'no_print': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'version_check': 'True', 'partial_parse': 'True', 'target_path': 'None', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run -m business_timeline', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'write_json': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True'}
[0m15:44:40.608205 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:44:40.608423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a2e0e0>]}
[0m15:44:40.790385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a99b40>]}
[0m15:44:40.837323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c06110>]}
[0m15:44:40.838356 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:44:40.909970 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:44:40.992967 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:44:40.994676 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m15:44:41.201011 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:44:41.208894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f8040>]}
[0m15:44:41.256468 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:44:41.258161 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:44:41.271646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078fa5f0>]}
[0m15:44:41.272014 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:44:41.272228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f9630>]}
[0m15:44:41.273051 [info ] [MainThread]: 
[0m15:44:41.273263 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:44:41.273433 [info ] [MainThread]: 
[0m15:44:41.273722 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:44:41.274188 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:44:41.312106 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:44:41.312441 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:44:41.312619 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:44:41.470877 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.158 seconds
[0m15:44:41.471783 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:44:41.474956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:44:41.478501 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:44:41.478733 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:44:41.478906 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:44:41.534712 [debug] [ThreadPool]: SQL status: BEGIN in 0.056 seconds
[0m15:44:41.535070 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:44:41.535288 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:44:41.615556 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.080 seconds
[0m15:44:41.618596 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:44:41.620506 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:44:41.624572 [debug] [MainThread]: Using postgres connection "master"
[0m15:44:41.624819 [debug] [MainThread]: On master: BEGIN
[0m15:44:41.624984 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:44:41.698347 [debug] [MainThread]: SQL status: BEGIN in 0.073 seconds
[0m15:44:41.699521 [debug] [MainThread]: Using postgres connection "master"
[0m15:44:41.700418 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:44:42.182795 [debug] [MainThread]: SQL status: SELECT 1 in 0.481 seconds
[0m15:44:42.186146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078bf7f0>]}
[0m15:44:42.188559 [debug] [MainThread]: On master: ROLLBACK
[0m15:44:42.190928 [debug] [MainThread]: Using postgres connection "master"
[0m15:44:42.191233 [debug] [MainThread]: On master: BEGIN
[0m15:44:42.193118 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m15:44:42.193917 [debug] [MainThread]: On master: COMMIT
[0m15:44:42.196310 [debug] [MainThread]: Using postgres connection "master"
[0m15:44:42.197103 [debug] [MainThread]: On master: COMMIT
[0m15:44:42.198360 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:44:42.198577 [debug] [MainThread]: On master: Close
[0m15:44:42.201389 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:44:42.201864 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m15:44:42.202231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m15:44:42.202559 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m15:44:42.207818 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m15:44:42.208366 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m15:44:42.232131 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m15:44:42.232888 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:44:42.233200 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m15:44:42.233410 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:42.290901 [debug] [Thread-1 (]: SQL status: BEGIN in 0.057 seconds
[0m15:44:42.291271 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:44:42.291566 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select *, to_char(event_date, 'YYYYMM')::int as year_month_key from combined_accounts order by business_name, event_date
  );
  
[0m15:44:42.307461 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function to_char(text, unknown) does not exist
LINE 72: select *, to_char(event_date, 'YYYYMM')::int as year_month_k...
                   ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:44:42.307839 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: ROLLBACK
[0m15:44:42.309174 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m15:44:42.314502 [debug] [Thread-1 (]: Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, to_char(event_date, 'YYYYMM')::int as year_month_k...
                     ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m15:44:42.315924 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab2384e7-b13d-40e5-b117-214bf9d57258', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b4dc0>]}
[0m15:44:42.316405 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_timeline .... [[31mERROR[0m in 0.11s]
[0m15:44:42.316936 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:44:42.317399 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_timeline' to be skipped because of status 'error'.  Reason: Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, to_char(event_date, 'YYYYMM')::int as year_month_k...
                     ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql.
[0m15:44:42.318490 [debug] [MainThread]: Using postgres connection "master"
[0m15:44:42.318876 [debug] [MainThread]: On master: BEGIN
[0m15:44:42.319095 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:44:42.371265 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m15:44:42.371621 [debug] [MainThread]: On master: COMMIT
[0m15:44:42.371806 [debug] [MainThread]: Using postgres connection "master"
[0m15:44:42.371969 [debug] [MainThread]: On master: COMMIT
[0m15:44:42.372798 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:44:42.373029 [debug] [MainThread]: On master: Close
[0m15:44:42.373307 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:44:42.373479 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m15:44:42.373667 [info ] [MainThread]: 
[0m15:44:42.373854 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m15:44:42.374236 [debug] [MainThread]: Command end result
[0m15:44:42.387982 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:44:42.389169 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:44:42.393274 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:44:42.393556 [info ] [MainThread]: 
[0m15:44:42.393798 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:44:42.394044 [info ] [MainThread]: 
[0m15:44:42.394311 [error] [MainThread]: [31mFailure in model business_timeline (models/int/business_timeline.sql)[0m
[0m15:44:42.394547 [error] [MainThread]:   Database Error in model business_timeline (models/int/business_timeline.sql)
  function to_char(text, unknown) does not exist
  LINE 72: select *, to_char(event_date, 'YYYYMM')::int as year_month_k...
                     ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/highstreet_tenure/models/int/business_timeline.sql
[0m15:44:42.394745 [info ] [MainThread]: 
[0m15:44:42.395027 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/int/business_timeline.sql
[0m15:44:42.395201 [info ] [MainThread]: 
[0m15:44:42.395385 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:44:42.395698 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:44:42.397855 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.8472725, "process_in_blocks": "0", "process_kernel_time": 0.248716, "process_mem_max_rss": "134283264", "process_out_blocks": "0", "process_user_time": 1.451738}
[0m15:44:42.398216 [debug] [MainThread]: Command `dbt run` failed at 15:44:42.398162 after 1.85 seconds
[0m15:44:42.398501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545e800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fbaf80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a99b40>]}
[0m15:44:42.398802 [debug] [MainThread]: Flushing usage events
[0m15:44:42.775938 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:46:02.814527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1204829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c40c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c40550>]}


============================== 15:46:02.818350 | 52f006a2-3fe1-48c3-abdd-7ec01298768d ==============================
[0m15:46:02.818350 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:46:02.818921 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'write_json': 'True', 'log_format': 'default', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'invocation_command': 'dbt run --select business_timeline', 'static_parser': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_cache_events': 'False', 'empty': 'False', 'debug': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'target_path': 'None', 'fail_fast': 'False', 'introspect': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'no_print': 'None', 'warn_error': 'None', 'version_check': 'True'}
[0m15:46:03.008696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eddc00>]}
[0m15:46:03.055490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121d0b760>]}
[0m15:46:03.056452 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:46:03.136099 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:46:03.224227 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:46:03.224667 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m15:46:03.436897 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:46:03.445780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121030850>]}
[0m15:46:03.498678 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:46:03.500529 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:46:03.516055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123505150>]}
[0m15:46:03.516497 [info ] [MainThread]: Found 11 models, 5 sources, 434 macros
[0m15:46:03.516807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123506230>]}
[0m15:46:03.517761 [info ] [MainThread]: 
[0m15:46:03.517993 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:46:03.518283 [info ] [MainThread]: 
[0m15:46:03.519196 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:46:03.519860 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:46:03.555028 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:46:03.555483 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:46:03.555738 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:46:03.684625 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.129 seconds
[0m15:46:03.685513 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:46:03.688871 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:46:03.692975 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:46:03.693449 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:46:03.693807 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:46:03.772365 [debug] [ThreadPool]: SQL status: BEGIN in 0.078 seconds
[0m15:46:03.772731 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:46:03.772932 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:46:03.851411 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.078 seconds
[0m15:46:03.852476 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:46:03.854657 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:46:03.858656 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:03.858904 [debug] [MainThread]: On master: BEGIN
[0m15:46:03.859076 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:46:03.920246 [debug] [MainThread]: SQL status: BEGIN in 0.061 seconds
[0m15:46:03.920623 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:03.920875 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:46:04.405120 [debug] [MainThread]: SQL status: SELECT 1 in 0.484 seconds
[0m15:46:04.406345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1235056f0>]}
[0m15:46:04.406722 [debug] [MainThread]: On master: ROLLBACK
[0m15:46:04.408711 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:04.409032 [debug] [MainThread]: On master: BEGIN
[0m15:46:04.414611 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m15:46:04.414920 [debug] [MainThread]: On master: COMMIT
[0m15:46:04.415113 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:04.415280 [debug] [MainThread]: On master: COMMIT
[0m15:46:04.416367 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:46:04.416683 [debug] [MainThread]: On master: Close
[0m15:46:04.418707 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:46:04.419418 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_timeline ............. [RUN]
[0m15:46:04.419826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_timeline)
[0m15:46:04.420206 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m15:46:04.425498 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m15:46:04.426401 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m15:46:04.451001 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m15:46:04.451719 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:46:04.451947 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m15:46:04.452149 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:46:04.506501 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m15:46:04.506909 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:46:04.507197 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select *, to_char(event_date::date, 'YYYYMM')::int as year_month_key from combined_accounts order by business_name, event_date
  );
  
[0m15:46:06.141572 [debug] [Thread-1 (]: SQL status: SELECT 39661 in 1.634 seconds
[0m15:46:06.147800 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:46:06.148165 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m15:46:06.152711 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:46:06.154733 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:46:06.154985 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m15:46:06.158177 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:46:06.172342 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m15:46:06.172993 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:46:06.173414 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m15:46:06.222017 [debug] [Thread-1 (]: SQL status: COMMIT in 0.048 seconds
[0m15:46:06.226178 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m15:46:06.228822 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:46:06.229078 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m15:46:06.253157 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.024 seconds
[0m15:46:06.254949 [debug] [Thread-1 (]: On model.highstreet_tenure.business_timeline: Close
[0m15:46:06.256218 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '52f006a2-3fe1-48c3-abdd-7ec01298768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124166440>]}
[0m15:46:06.256764 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_timeline ........ [[32mSELECT 39661[0m in 1.84s]
[0m15:46:06.257121 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:46:06.257864 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:06.258099 [debug] [MainThread]: On master: BEGIN
[0m15:46:06.258289 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:46:06.317698 [debug] [MainThread]: SQL status: BEGIN in 0.059 seconds
[0m15:46:06.318178 [debug] [MainThread]: On master: COMMIT
[0m15:46:06.318466 [debug] [MainThread]: Using postgres connection "master"
[0m15:46:06.318641 [debug] [MainThread]: On master: COMMIT
[0m15:46:06.319591 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:46:06.319775 [debug] [MainThread]: On master: Close
[0m15:46:06.320040 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:46:06.320200 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m15:46:06.320380 [info ] [MainThread]: 
[0m15:46:06.320564 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.80 seconds (2.80s).
[0m15:46:06.320921 [debug] [MainThread]: Command end result
[0m15:46:06.335346 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:46:06.336754 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:46:06.342057 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:46:06.342370 [info ] [MainThread]: 
[0m15:46:06.342607 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:46:06.342801 [info ] [MainThread]: 
[0m15:46:06.342994 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:46:06.345518 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5897703, "process_in_blocks": "0", "process_kernel_time": 0.280852, "process_mem_max_rss": "134037504", "process_out_blocks": "0", "process_user_time": 1.526579}
[0m15:46:06.346000 [debug] [MainThread]: Command `dbt run` succeeded at 15:46:06.345942 after 3.59 seconds
[0m15:46:06.346271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1204829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c43e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120772a40>]}
[0m15:46:06.346520 [debug] [MainThread]: Flushing usage events
[0m15:46:06.782479 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:56:23.102035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120c0d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120c0610>]}


============================== 15:56:23.105498 | 72025c0e-f7ab-46f8-a14f-eef24e38ec2e ==============================
[0m15:56:23.105498 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:56:23.105860 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run -m business_tenures', 'write_json': 'True', 'static_parser': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'introspect': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'no_print': 'None', 'version_check': 'True', 'warn_error': 'None', 'log_format': 'default', 'quiet': 'False', 'empty': 'False', 'debug': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'cache_selected_only': 'False', 'printer_width': '80'}
[0m15:56:23.106171 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:56:23.106394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11200eb30>]}
[0m15:56:23.275599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112053e80>]}
[0m15:56:23.317586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11200feb0>]}
[0m15:56:23.318317 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:56:23.384241 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:56:23.459534 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m15:56:23.459936 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/business_tenures.sql
[0m15:56:23.460168 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/int/business_timeline.sql
[0m15:56:23.645117 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:56:23.653153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11382c4c0>]}
[0m15:56:23.697855 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:56:23.699569 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:56:23.712827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ffbd00>]}
[0m15:56:23.713149 [info ] [MainThread]: Found 12 models, 5 sources, 434 macros
[0m15:56:23.713351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10722c5e0>]}
[0m15:56:23.714099 [info ] [MainThread]: 
[0m15:56:23.714304 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:56:23.714533 [info ] [MainThread]: 
[0m15:56:23.714842 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:56:23.715344 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:56:23.748839 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:56:23.749122 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:56:23.749298 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:56:23.875350 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.126 seconds
[0m15:56:23.876201 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:56:23.879301 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:56:23.882761 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:56:23.882978 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:56:23.883149 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:56:23.936274 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m15:56:23.936631 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:56:23.936836 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:56:24.000763 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.064 seconds
[0m15:56:24.001714 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:56:24.003244 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:56:24.007025 [debug] [MainThread]: Using postgres connection "master"
[0m15:56:24.007242 [debug] [MainThread]: On master: BEGIN
[0m15:56:24.007413 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:56:24.058919 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m15:56:24.060039 [debug] [MainThread]: Using postgres connection "master"
[0m15:56:24.061027 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:56:24.511121 [debug] [MainThread]: SQL status: SELECT 0 in 0.449 seconds
[0m15:56:24.514373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112051a50>]}
[0m15:56:24.515536 [debug] [MainThread]: On master: ROLLBACK
[0m15:56:24.518095 [debug] [MainThread]: Using postgres connection "master"
[0m15:56:24.518344 [debug] [MainThread]: On master: BEGIN
[0m15:56:24.519628 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:56:24.519827 [debug] [MainThread]: On master: COMMIT
[0m15:56:24.519999 [debug] [MainThread]: Using postgres connection "master"
[0m15:56:24.520160 [debug] [MainThread]: On master: COMMIT
[0m15:56:24.520873 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:56:24.521105 [debug] [MainThread]: On master: Close
[0m15:56:24.522755 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_tenures
[0m15:56:24.523091 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_tenures .............. [RUN]
[0m15:56:24.523372 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_tenures)
[0m15:56:24.523583 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m15:56:24.528202 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m15:56:24.528739 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_tenures
[0m15:56:24.551336 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m15:56:24.552011 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:56:24.552240 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m15:56:24.552436 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:56:24.606417 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m15:56:24.606770 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:56:24.606997 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select * from business_tenures
  );
  
[0m15:56:24.842670 [debug] [Thread-1 (]: SQL status: SELECT 6223 in 0.235 seconds
[0m15:56:24.852768 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:56:24.853140 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m15:56:24.856256 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:56:24.864815 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m15:56:24.865247 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:56:24.865536 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m15:56:24.874527 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m15:56:24.878734 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m15:56:24.881306 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:56:24.881601 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m15:56:24.883978 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:56:24.885818 [debug] [Thread-1 (]: On model.highstreet_tenure.business_tenures: Close
[0m15:56:24.887093 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72025c0e-f7ab-46f8-a14f-eef24e38ec2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d4e5f0>]}
[0m15:56:24.887616 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_tenures ......... [[32mSELECT 6223[0m in 0.36s]
[0m15:56:24.888063 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_tenures
[0m15:56:24.888818 [debug] [MainThread]: Using postgres connection "master"
[0m15:56:24.889097 [debug] [MainThread]: On master: BEGIN
[0m15:56:24.889277 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:56:24.944518 [debug] [MainThread]: SQL status: BEGIN in 0.055 seconds
[0m15:56:24.944911 [debug] [MainThread]: On master: COMMIT
[0m15:56:24.945106 [debug] [MainThread]: Using postgres connection "master"
[0m15:56:24.945278 [debug] [MainThread]: On master: COMMIT
[0m15:56:24.946226 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:56:24.946533 [debug] [MainThread]: On master: Close
[0m15:56:24.946805 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:56:24.946974 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m15:56:24.947156 [info ] [MainThread]: 
[0m15:56:24.947336 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m15:56:24.947689 [debug] [MainThread]: Command end result
[0m15:56:24.962298 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:56:24.966513 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:56:24.971484 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:56:24.971764 [info ] [MainThread]: 
[0m15:56:24.972058 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:56:24.972276 [info ] [MainThread]: 
[0m15:56:24.972481 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:56:24.972801 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:56:24.975128 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9258282, "process_in_blocks": "0", "process_kernel_time": 0.218107, "process_mem_max_rss": "133873664", "process_out_blocks": "0", "process_user_time": 1.367829}
[0m15:56:24.975516 [debug] [MainThread]: Command `dbt run` succeeded at 15:56:24.975467 after 1.93 seconds
[0m15:56:24.975746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113857b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112053e80>]}
[0m15:56:24.975964 [debug] [MainThread]: Flushing usage events
[0m15:56:25.435278 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:38:04.164667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059f2890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107074be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070744c0>]}


============================== 17:38:04.168045 | 94328ed2-8476-4805-992f-056633354027 ==============================
[0m17:38:04.168045 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:38:04.168441 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'static_parser': 'True', 'write_json': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'no_print': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'printer_width': '80', 'debug': 'False', 'use_colors': 'True', 'quiet': 'False', 'empty': 'False', 'invocation_command': 'dbt run -m business_addresses', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'introspect': 'True', 'warn_error': 'None', 'target_path': 'None', 'cache_selected_only': 'False'}
[0m17:38:04.168760 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:38:04.168978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '94328ed2-8476-4805-992f-056633354027', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fc1660>]}
[0m17:38:04.561218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107024ee0>]}
[0m17:38:04.605310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10719a1d0>]}
[0m17:38:04.606119 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:38:04.673378 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:38:04.751085 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m17:38:04.751508 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/int/business_addresses.sql
[0m17:38:04.934873 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m17:38:04.943009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e98ee0>]}
[0m17:38:04.989492 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:38:04.991218 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:38:05.004593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e51870>]}
[0m17:38:05.004925 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m17:38:05.005130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e51e10>]}
[0m17:38:05.006020 [info ] [MainThread]: 
[0m17:38:05.006271 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:38:05.006453 [info ] [MainThread]: 
[0m17:38:05.006750 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:38:05.007259 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:38:05.041236 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:38:05.041564 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:38:05.041748 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:38:05.178491 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.137 seconds
[0m17:38:05.179403 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:38:05.182550 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:38:05.186078 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:38:05.186330 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:38:05.186500 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:05.263157 [debug] [ThreadPool]: SQL status: BEGIN in 0.077 seconds
[0m17:38:05.263471 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:38:05.263679 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:38:05.338656 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.075 seconds
[0m17:38:05.343940 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:38:05.345887 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:38:05.350003 [debug] [MainThread]: Using postgres connection "master"
[0m17:38:05.350232 [debug] [MainThread]: On master: BEGIN
[0m17:38:05.350400 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:38:05.407020 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m17:38:05.408390 [debug] [MainThread]: Using postgres connection "master"
[0m17:38:05.411253 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:38:05.868696 [debug] [MainThread]: SQL status: SELECT 0 in 0.456 seconds
[0m17:38:05.871589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107efeaa0>]}
[0m17:38:05.872602 [debug] [MainThread]: On master: ROLLBACK
[0m17:38:05.874599 [debug] [MainThread]: Using postgres connection "master"
[0m17:38:05.874885 [debug] [MainThread]: On master: BEGIN
[0m17:38:05.876566 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:38:05.877384 [debug] [MainThread]: On master: COMMIT
[0m17:38:05.877870 [debug] [MainThread]: Using postgres connection "master"
[0m17:38:05.878334 [debug] [MainThread]: On master: COMMIT
[0m17:38:05.879453 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:38:05.879968 [debug] [MainThread]: On master: Close
[0m17:38:05.883624 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m17:38:05.884003 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_addresses ............ [RUN]
[0m17:38:05.884308 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_addresses)
[0m17:38:05.884531 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m17:38:05.889769 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m17:38:05.890334 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m17:38:05.912303 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m17:38:05.913043 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m17:38:05.913295 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m17:38:05.913529 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:05.966046 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m17:38:05.966415 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m17:38:05.966695 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct business_name, business_address from combined_business_addresses
  );
  
[0m17:38:06.348278 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.381 seconds
[0m17:38:06.364259 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m17:38:06.365111 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m17:38:06.369134 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:38:06.377008 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m17:38:06.377273 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m17:38:06.377492 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m17:38:06.390930 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m17:38:06.394859 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m17:38:06.397741 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m17:38:06.398041 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m17:38:06.400195 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m17:38:06.401748 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m17:38:06.403026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94328ed2-8476-4805-992f-056633354027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082cea10>]}
[0m17:38:06.403580 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_addresses ....... [[32mSELECT 11450[0m in 0.52s]
[0m17:38:06.403941 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m17:38:06.404683 [debug] [MainThread]: Using postgres connection "master"
[0m17:38:06.404863 [debug] [MainThread]: On master: BEGIN
[0m17:38:06.405012 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:38:06.460347 [debug] [MainThread]: SQL status: BEGIN in 0.055 seconds
[0m17:38:06.460706 [debug] [MainThread]: On master: COMMIT
[0m17:38:06.460890 [debug] [MainThread]: Using postgres connection "master"
[0m17:38:06.461053 [debug] [MainThread]: On master: COMMIT
[0m17:38:06.461954 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:38:06.462270 [debug] [MainThread]: On master: Close
[0m17:38:06.462545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:38:06.462701 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_addresses' was properly closed.
[0m17:38:06.462870 [info ] [MainThread]: 
[0m17:38:06.463051 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.46 seconds (1.46s).
[0m17:38:06.463397 [debug] [MainThread]: Command end result
[0m17:38:06.478190 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:38:06.479440 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:38:06.483399 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:38:06.483667 [info ] [MainThread]: 
[0m17:38:06.483944 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:38:06.484120 [info ] [MainThread]: 
[0m17:38:06.484393 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:38:06.484897 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:38:06.508231 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.3980668, "process_in_blocks": "0", "process_kernel_time": 0.233213, "process_mem_max_rss": "136462336", "process_out_blocks": "0", "process_user_time": 1.42414}
[0m17:38:06.508950 [debug] [MainThread]: Command `dbt run` succeeded at 17:38:06.508839 after 2.40 seconds
[0m17:38:06.509312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059f2890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d0bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ebfa90>]}
[0m17:38:06.509645 [debug] [MainThread]: Flushing usage events
[0m17:38:06.922240 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:44:18.778942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053067d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106981210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106980af0>]}


============================== 16:44:18.782259 | ac604d93-a3b6-4925-80ea-f82a4d2b32e2 ==============================
[0m16:44:18.782259 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:44:18.782705 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'introspect': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'use_experimental_parser': 'False', 'write_json': 'True', 'printer_width': '80', 'version_check': 'True', 'log_format': 'default', 'static_parser': 'True', 'debug': 'False'}
[0m16:44:19.151745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a50f10>]}
[0m16:44:19.196088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d78730>]}
[0m16:44:19.196989 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:44:19.291519 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:44:19.371120 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:44:19.371358 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:44:19.374750 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:44:19.394824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076a0130>]}
[0m16:44:19.470971 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:44:19.472466 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:44:19.485321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10761ca60>]}
[0m16:44:19.485648 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m16:44:19.485852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d904f0>]}
[0m16:44:19.486902 [info ] [MainThread]: 
[0m16:44:19.487111 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:44:19.487276 [info ] [MainThread]: 
[0m16:44:19.487542 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:44:19.490189 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:44:19.535268 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:44:19.535582 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:44:19.535761 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:44:19.649113 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.113 seconds
[0m16:44:19.649995 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:44:19.650471 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now create_highstreet_analytics_analytics)
[0m16:44:19.650772 [debug] [ThreadPool]: Creating schema "database: "highstreet"
schema: "analytics_analytics"
"
[0m16:44:19.653914 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m16:44:19.654134 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: BEGIN
[0m16:44:19.654297 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:19.702612 [debug] [ThreadPool]: SQL status: BEGIN in 0.048 seconds
[0m16:44:19.702974 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m16:44:19.703161 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "create_highstreet_analytics_analytics"} */
create schema if not exists "analytics_analytics"
[0m16:44:19.711595 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.008 seconds
[0m16:44:19.712216 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m16:44:19.712414 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m16:44:19.712572 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m16:44:19.716238 [debug] [ThreadPool]: SQL status: COMMIT in 0.003 seconds
[0m16:44:19.716464 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: Close
[0m16:44:19.717606 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_highstreet_analytics_analytics, now list_highstreet_analytics_analytics)
[0m16:44:19.720948 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:44:19.721164 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:44:19.721323 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:19.769400 [debug] [ThreadPool]: SQL status: BEGIN in 0.048 seconds
[0m16:44:19.769692 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:44:19.769874 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:44:19.831309 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.061 seconds
[0m16:44:19.834801 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:44:19.836755 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:44:19.840021 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:19.840286 [debug] [MainThread]: On master: BEGIN
[0m16:44:19.840455 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:44:19.893537 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:44:19.895197 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:19.896001 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:44:20.207905 [debug] [MainThread]: SQL status: SELECT 0 in 0.311 seconds
[0m16:44:20.211011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076d7100>]}
[0m16:44:20.211874 [debug] [MainThread]: On master: ROLLBACK
[0m16:44:20.213836 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:20.214365 [debug] [MainThread]: On master: BEGIN
[0m16:44:20.216054 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:44:20.216591 [debug] [MainThread]: On master: COMMIT
[0m16:44:20.217038 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:20.217463 [debug] [MainThread]: On master: COMMIT
[0m16:44:20.218507 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:44:20.218772 [debug] [MainThread]: On master: Close
[0m16:44:20.220753 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m16:44:20.221035 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:44:20.221336 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m16:44:20.221824 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m16:44:20.222255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m16:44:20.222546 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m16:44:20.222749 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m16:44:20.222939 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:44:20.227771 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m16:44:20.229941 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:44:20.230904 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m16:44:20.231188 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:44:20.252921 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m16:44:20.255041 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:44:20.255693 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:44:20.256029 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:44:20.256311 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m16:44:20.256590 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:44:20.256845 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:20.257103 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:44:20.310771 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m16:44:20.311077 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m16:44:20.311360 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:44:20.311574 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:44:20.311799 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m16:44:20.312036 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:44:20.316783 [debug] [Thread-2 (]: Postgres adapter: Postgres error: relation "public.filename_mapping" does not exist
LINE 15:     select * from "highstreet"."public"."filename_mapping"
                           ^

[0m16:44:20.317114 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: ROLLBACK
[0m16:44:20.318206 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:44:20.322626 [debug] [Thread-2 (]: Database Error in model stg_filemap (models/staging/stg_filemap.sql)
  relation "public.filename_mapping" does not exist
  LINE 15:     select * from "highstreet"."public"."filename_mapping"
                             ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_filemap.sql
[0m16:44:20.324237 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10515c8e0>]}
[0m16:44:20.324683 [error] [Thread-2 (]: 2 of 13 ERROR creating sql table model analytics_analytics.stg_filemap ......... [[31mERROR[0m in 0.10s]
[0m16:44:20.325022 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:44:20.325324 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_filemap' to be skipped because of status 'error'.  Reason: Database Error in model stg_filemap (models/staging/stg_filemap.sql)
  relation "public.filename_mapping" does not exist
  LINE 15:     select * from "highstreet"."public"."filename_mapping"
                             ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_filemap.sql.
[0m16:44:20.325977 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:44:20.326192 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:44:20.326401 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:44:20.326601 [info ] [Thread-4 (]: 3 of 13 SKIP relation analytics_analytics.stg_accounts_closed .................. [[33mSKIP[0m]
[0m16:44:20.326831 [info ] [Thread-3 (]: 4 of 13 SKIP relation analytics_analytics.stg_accounts_no_relief ............... [[33mSKIP[0m]
[0m16:44:20.327090 [info ] [Thread-2 (]: 5 of 13 SKIP relation analytics_analytics.stg_accounts_relief .................. [[33mSKIP[0m]
[0m16:44:20.327324 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:44:20.327529 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:44:20.327763 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:44:20.327999 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:44:20.328329 [info ] [Thread-4 (]: 6 of 13 SKIP relation analytics_analytics.stg_new_businesses ................... [[33mSKIP[0m]
[0m16:44:20.328550 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:44:20.328891 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_addresses
[0m16:44:20.329079 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_timeline
[0m16:44:20.329268 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.businesses
[0m16:44:20.329454 [info ] [Thread-3 (]: 7 of 13 SKIP relation analytics_analytics.business_addresses ................... [[33mSKIP[0m]
[0m16:44:20.329819 [info ] [Thread-2 (]: 8 of 13 SKIP relation analytics_analytics.business_timeline .................... [[33mSKIP[0m]
[0m16:44:20.330197 [info ] [Thread-4 (]: 9 of 13 SKIP relation analytics_analytics.businesses ........................... [[33mSKIP[0m]
[0m16:44:20.330554 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_addresses
[0m16:44:20.330806 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_timeline
[0m16:44:20.331018 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.businesses
[0m16:44:20.331231 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m16:44:20.332079 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m16:44:20.332315 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m16:44:20.331823 [info ] [Thread-3 (]: 10 of 13 SKIP relation analytics_analytics.properties .......................... [[33mSKIP[0m]
[0m16:44:20.332588 [info ] [Thread-2 (]: 11 of 13 SKIP relation analytics_analytics.business_tenures .................... [[33mSKIP[0m]
[0m16:44:20.332938 [info ] [Thread-4 (]: 12 of 13 SKIP relation analytics_analytics.business_with_full_timeline ......... [[33mSKIP[0m]
[0m16:44:20.333435 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m16:44:20.333795 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m16:44:20.334074 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m16:44:20.334585 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m16:44:20.335083 [info ] [Thread-3 (]: 13 of 13 SKIP relation analytics_analytics.addresses ........................... [[33mSKIP[0m]
[0m16:44:20.335374 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m16:44:20.387536 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.075 seconds
[0m16:44:20.393220 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:44:20.393501 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m16:44:20.396764 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:44:20.404806 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:44:20.405105 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:44:20.405297 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:44:20.408600 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:44:20.411974 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m16:44:20.414175 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:44:20.414410 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m16:44:20.416215 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:44:20.417745 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m16:44:20.418147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac604d93-a3b6-4925-80ea-f82a4d2b32e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104138ac0>]}
[0m16:44:20.418531 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.20s]
[0m16:44:20.418940 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m16:44:20.419724 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:20.419971 [debug] [MainThread]: On master: BEGIN
[0m16:44:20.420144 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:44:20.469837 [debug] [MainThread]: SQL status: BEGIN in 0.050 seconds
[0m16:44:20.470166 [debug] [MainThread]: On master: COMMIT
[0m16:44:20.470344 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:20.470503 [debug] [MainThread]: On master: COMMIT
[0m16:44:20.471257 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:44:20.471471 [debug] [MainThread]: On master: Close
[0m16:44:20.471733 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:44:20.471896 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m16:44:20.472038 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_filemap' was properly closed.
[0m16:44:20.472252 [info ] [MainThread]: 
[0m16:44:20.472434 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 0.98 seconds (0.98s).
[0m16:44:20.472993 [debug] [MainThread]: Command end result
[0m16:44:20.487197 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:44:20.488410 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:44:20.492995 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:44:20.493248 [info ] [MainThread]: 
[0m16:44:20.493517 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:44:20.493740 [info ] [MainThread]: 
[0m16:44:20.493965 [error] [MainThread]: [31mFailure in model stg_filemap (models/staging/stg_filemap.sql)[0m
[0m16:44:20.494180 [error] [MainThread]:   Database Error in model stg_filemap (models/staging/stg_filemap.sql)
  relation "public.filename_mapping" does not exist
  LINE 15:     select * from "highstreet"."public"."filename_mapping"
                             ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_filemap.sql
[0m16:44:20.494348 [info ] [MainThread]: 
[0m16:44:20.494583 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_filemap.sql
[0m16:44:20.494842 [info ] [MainThread]: 
[0m16:44:20.495041 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=11 NO-OP=0 TOTAL=13
[0m16:44:20.527306 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7987139, "process_in_blocks": "0", "process_kernel_time": 0.268951, "process_mem_max_rss": "131350528", "process_out_blocks": "0", "process_user_time": 1.342655}
[0m16:44:20.527749 [debug] [MainThread]: Command `dbt run` failed at 16:44:20.527698 after 1.80 seconds
[0m16:44:20.527980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053067d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a50f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d578b0>]}
[0m16:44:20.528197 [debug] [MainThread]: Flushing usage events
[0m16:44:20.973792 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:45:16.135379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c40c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c40550>]}


============================== 16:45:16.138861 | 3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5 ==============================
[0m16:45:16.138861 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:45:16.139268 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'debug': 'False', 'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'target_path': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'introspect': 'True', 'static_parser': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '.', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'no_print': 'None', 'warn_error': 'None'}
[0m16:45:16.139605 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:45:16.139836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f31ae0>]}
[0m16:45:16.271349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d66d10>]}
[0m16:45:16.316545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ed3310>]}
[0m16:45:16.317635 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:45:16.389211 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:45:16.472046 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:45:16.472460 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:45:16.476171 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:45:16.496554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10798c040>]}
[0m16:45:16.578919 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:16.581037 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:16.594843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107163e80>]}
[0m16:45:16.595178 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m16:45:16.595391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079aea10>]}
[0m16:45:16.596217 [info ] [MainThread]: 
[0m16:45:16.596420 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:45:16.596584 [info ] [MainThread]: 
[0m16:45:16.596871 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:45:16.599336 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:45:16.634807 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:45:16.635142 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:45:16.635330 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:16.754582 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.119 seconds
[0m16:45:16.755575 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:45:16.757082 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:45:16.760666 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:16.760924 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:45:16.761096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:45:16.813885 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m16:45:16.814260 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:16.814467 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:45:16.881003 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.066 seconds
[0m16:45:16.881944 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:45:16.883546 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:45:16.886742 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:16.886999 [debug] [MainThread]: On master: BEGIN
[0m16:45:16.887171 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:45:16.948197 [debug] [MainThread]: SQL status: BEGIN in 0.059 seconds
[0m16:45:16.949633 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:16.950436 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:45:17.346621 [debug] [MainThread]: SQL status: SELECT 0 in 0.395 seconds
[0m16:45:17.349471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10798fdc0>]}
[0m16:45:17.350663 [debug] [MainThread]: On master: ROLLBACK
[0m16:45:17.352710 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:17.354334 [debug] [MainThread]: On master: BEGIN
[0m16:45:17.358340 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m16:45:17.359141 [debug] [MainThread]: On master: COMMIT
[0m16:45:17.359710 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:17.360294 [debug] [MainThread]: On master: COMMIT
[0m16:45:17.361430 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:17.361664 [debug] [MainThread]: On master: Close
[0m16:45:17.363646 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:45:17.364023 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m16:45:17.364351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m16:45:17.364599 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:45:17.369668 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:45:17.370625 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:45:17.392268 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:45:17.393253 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:17.393544 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:45:17.393777 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:17.445326 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m16:45:17.445734 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:17.445969 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:45:17.494096 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.048 seconds
[0m16:45:17.500212 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:17.500637 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:45:17.503766 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:17.511597 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:45:17.511911 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:17.512123 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:45:17.516405 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:17.520031 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:45:17.522575 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:17.522828 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:45:17.525110 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:45:17.526602 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:45:17.527854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079d24d0>]}
[0m16:45:17.528428 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.16s]
[0m16:45:17.528918 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:45:17.529458 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:45:17.529729 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:17.530015 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:45:17.530241 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:45:17.530594 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m16:45:17.531020 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m16:45:17.531361 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m16:45:17.531724 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m16:45:17.532121 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:45:17.532428 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:45:17.532697 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m16:45:17.532915 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m16:45:17.533123 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:45:17.533318 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:17.533506 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:45:17.533696 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:45:17.536033 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.538059 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:17.539828 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:17.541460 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.542648 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:45:17.542955 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:45:17.543222 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:45:17.543416 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:17.546604 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.548690 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:17.550829 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.552859 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:17.553497 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.553780 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:17.554004 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.554238 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:45:17.554511 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:17.554717 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:45:17.554953 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:45:17.555151 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:45:17.555349 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:45:17.555536 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:45:17.555741 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:17.556027 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:45:17.618810 [debug] [Thread-2 (]: SQL status: BEGIN in 0.063 seconds
[0m16:45:17.619126 [debug] [Thread-1 (]: SQL status: BEGIN in 0.063 seconds
[0m16:45:17.619418 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:17.619657 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.619952 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:17.620245 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:17.620544 [debug] [Thread-4 (]: SQL status: BEGIN in 0.065 seconds
[0m16:45:17.620915 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:17.621251 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:17.622868 [debug] [Thread-3 (]: SQL status: BEGIN in 0.068 seconds
[0m16:45:17.623112 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.623350 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:17.727460 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.106 seconds
[0m16:45:17.729820 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.730102 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:45:17.733292 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:17.734314 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:45:17.734570 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.734778 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:45:17.739373 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:17.741552 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:45:17.742037 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:17.742259 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:45:17.744192 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:45:17.744994 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:45:17.745366 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e26ad0>]}
[0m16:45:17.745744 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.21s]
[0m16:45:17.746058 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:45:17.760834 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.137 seconds
[0m16:45:17.763025 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.763270 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:45:17.766045 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:17.767110 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:45:17.767383 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.767582 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:45:17.772696 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m16:45:17.774395 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:45:17.774891 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:17.775108 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:45:17.776878 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:45:17.777686 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:45:17.778048 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079d2740>]}
[0m16:45:17.778421 [info ] [Thread-3 (]: 2 of 5 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.25s]
[0m16:45:17.778739 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:45:18.231617 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.609 seconds
[0m16:45:18.236672 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:18.237027 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:45:18.240085 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:18.241012 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:45:18.241236 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:18.241423 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:45:18.273151 [debug] [Thread-4 (]: SQL status: COMMIT in 0.031 seconds
[0m16:45:18.277699 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:45:18.277978 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.657 seconds
[0m16:45:18.278529 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:18.280312 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:18.280554 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:45:18.280769 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:45:18.282609 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m16:45:18.283442 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:45:18.283831 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057940a0>]}
[0m16:45:18.284075 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:18.285206 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:45:18.285426 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:18.285621 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:45:18.284442 [info ] [Thread-4 (]: 3 of 5 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.75s]
[0m16:45:18.286015 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:18.288692 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:18.290100 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:45:18.290511 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:18.290707 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:45:18.292312 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:18.293310 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:45:18.293688 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3bdd1f8e-7c0b-41d8-a9fe-7982c897e3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bd3e20>]}
[0m16:45:18.294078 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.76s]
[0m16:45:18.294403 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:45:18.295275 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:18.295529 [debug] [MainThread]: On master: BEGIN
[0m16:45:18.295691 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:45:18.348616 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m16:45:18.349683 [debug] [MainThread]: On master: COMMIT
[0m16:45:18.350014 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:18.350185 [debug] [MainThread]: On master: COMMIT
[0m16:45:18.351061 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:18.351241 [debug] [MainThread]: On master: Close
[0m16:45:18.351494 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:45:18.351664 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m16:45:18.351819 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m16:45:18.351964 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m16:45:18.352110 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m16:45:18.352335 [info ] [MainThread]: 
[0m16:45:18.352539 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 1.76 seconds (1.76s).
[0m16:45:18.353215 [debug] [MainThread]: Command end result
[0m16:45:18.368997 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:18.370739 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:18.374803 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:45:18.375020 [info ] [MainThread]: 
[0m16:45:18.375254 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:45:18.375431 [info ] [MainThread]: 
[0m16:45:18.375622 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m16:45:18.375928 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:45:18.378415 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.302523, "process_in_blocks": "0", "process_kernel_time": 0.22402, "process_mem_max_rss": "129187840", "process_out_blocks": "0", "process_user_time": 1.473538}
[0m16:45:18.378863 [debug] [MainThread]: Command `dbt run` succeeded at 16:45:18.378808 after 2.30 seconds
[0m16:45:18.379122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d2e980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104532560>]}
[0m16:45:18.379357 [debug] [MainThread]: Flushing usage events
[0m16:45:18.865688 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:45:23.162731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c393c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c38ca0>]}


============================== 16:45:23.165774 | 8983a532-081e-49d6-8416-9a15e2e70ae9 ==============================
[0m16:45:23.165774 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:45:23.166137 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'version_check': 'True', 'write_json': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'fail_fast': 'False', 'printer_width': '80', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'use_colors': 'True'}
[0m16:45:23.294826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d091e0>]}
[0m16:45:23.349304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d0bca0>]}
[0m16:45:23.350261 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:45:23.417699 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:45:23.499603 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:45:23.499944 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:45:23.503856 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m16:45:23.535693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118c28130>]}
[0m16:45:23.623342 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:23.624692 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:23.636865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ba4b80>]}
[0m16:45:23.637222 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m16:45:23.637423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ba4b50>]}
[0m16:45:23.638514 [info ] [MainThread]: 
[0m16:45:23.638722 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:45:23.638884 [info ] [MainThread]: 
[0m16:45:23.639150 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:45:23.647223 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:45:23.678894 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:45:23.679224 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:45:23.679403 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:23.784150 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.105 seconds
[0m16:45:23.785138 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:45:23.786495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:45:23.794168 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:23.794494 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:45:23.794671 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:45:23.853552 [debug] [ThreadPool]: SQL status: BEGIN in 0.059 seconds
[0m16:45:23.853941 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:23.854173 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:45:23.918597 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.064 seconds
[0m16:45:23.919504 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:45:23.921105 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:45:23.924697 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.924950 [debug] [MainThread]: On master: BEGIN
[0m16:45:23.925119 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:45:23.978306 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:45:23.979454 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.980370 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:45:24.374158 [debug] [MainThread]: SQL status: SELECT 0 in 0.393 seconds
[0m16:45:24.377657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118bbb4f0>]}
[0m16:45:24.378484 [debug] [MainThread]: On master: ROLLBACK
[0m16:45:24.380344 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:24.380626 [debug] [MainThread]: On master: BEGIN
[0m16:45:24.382440 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:45:24.383264 [debug] [MainThread]: On master: COMMIT
[0m16:45:24.383991 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:24.384632 [debug] [MainThread]: On master: COMMIT
[0m16:45:24.386036 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:24.386679 [debug] [MainThread]: On master: Close
[0m16:45:24.390457 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m16:45:24.390830 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:45:24.391142 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m16:45:24.391479 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m16:45:24.391812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m16:45:24.392076 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m16:45:24.392374 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m16:45:24.392570 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:45:24.397089 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m16:45:24.398798 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:45:24.399544 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:45:24.399909 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m16:45:24.422481 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:45:24.425487 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m16:45:24.426295 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:24.426650 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:45:24.426937 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:45:24.427219 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m16:45:24.427491 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:45:24.427751 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:24.481788 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m16:45:24.482115 [debug] [Thread-2 (]: SQL status: BEGIN in 0.055 seconds
[0m16:45:24.482419 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:45:24.482668 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:24.482930 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m16:45:24.483186 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:45:24.533000 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.049 seconds
[0m16:45:24.539212 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:24.539512 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:45:24.543793 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:24.545851 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:24.546108 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:45:24.547819 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:45:24.556516 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:45:24.556771 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:24.556972 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:45:24.557209 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.074 seconds
[0m16:45:24.559196 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:45:24.559443 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m16:45:24.561175 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:24.564528 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:45:24.564790 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:45:24.567418 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:45:24.570131 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:45:24.570389 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:45:24.570616 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m16:45:24.573747 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:24.574674 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:45:24.574880 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:45:24.575060 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:45:24.577968 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:24.579433 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m16:45:24.579881 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:45:24.580088 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m16:45:24.582864 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m16:45:24.584363 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:45:24.585595 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c19330>]}
[0m16:45:24.586018 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.19s]
[0m16:45:24.586377 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:45:24.586750 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:45:24.586980 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:24.587208 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:45:24.587471 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m16:45:24.587918 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m16:45:24.588292 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m16:45:24.588652 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:45:24.589082 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:45:24.589397 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m16:45:24.589632 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:45:24.589842 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:24.590039 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:45:24.592202 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.592431 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m16:45:24.594350 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:24.596523 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:24.597592 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m16:45:24.598053 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:45:24.598424 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:24.600722 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.601027 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118233ca0>]}
[0m16:45:24.603698 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:24.603953 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:45:24.604512 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.21s]
[0m16:45:24.607126 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:24.607480 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.607846 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m16:45:24.608124 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:24.608466 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:45:24.608770 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:45:24.609055 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:24.609344 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:45:24.609631 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:45:24.610044 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m16:45:24.610339 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:45:24.610596 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:45:24.611030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m16:45:24.611323 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:45:24.611872 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:45:24.614622 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.615137 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:45:24.617308 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.617699 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.617900 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:45:24.618085 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:24.669351 [debug] [Thread-4 (]: SQL status: BEGIN in 0.060 seconds
[0m16:45:24.669744 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.669994 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:24.670512 [debug] [Thread-2 (]: SQL status: BEGIN in 0.059 seconds
[0m16:45:24.670847 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:24.671105 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:24.671869 [debug] [Thread-3 (]: SQL status: BEGIN in 0.061 seconds
[0m16:45:24.672107 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:24.672345 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:24.679235 [debug] [Thread-1 (]: SQL status: BEGIN in 0.061 seconds
[0m16:45:24.679561 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.679806 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:45:24.791262 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.111 seconds
[0m16:45:24.793622 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.793870 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:45:24.796513 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:24.798357 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.798582 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:45:24.800046 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:45:24.800940 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:45:24.801159 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.801344 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:45:24.803017 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.133 seconds
[0m16:45:24.804893 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.805124 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:45:24.807286 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m16:45:24.809522 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:45:24.809773 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:24.810218 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:45:24.812041 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.812268 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:45:24.812470 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:45:24.815902 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:24.816798 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:45:24.817002 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.817183 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:45:24.821100 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:24.822720 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:45:24.823240 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:45:24.823460 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:45:24.828747 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.016 seconds
[0m16:45:24.829594 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:45:24.829968 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118c6e140>]}
[0m16:45:24.830339 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.22s]
[0m16:45:24.830654 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:45:24.835280 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m16:45:24.836058 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:45:24.836398 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11915bee0>]}
[0m16:45:24.836808 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.25s]
[0m16:45:24.837394 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:45:25.286855 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.614 seconds
[0m16:45:25.291970 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:25.292269 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:45:25.296563 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:25.298391 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:25.298614 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:45:25.300252 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:45:25.301119 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:45:25.301321 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:25.301499 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:45:25.303732 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.632 seconds
[0m16:45:25.305638 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:25.305864 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:45:25.310068 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:25.311815 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:25.312037 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:45:25.316019 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:25.317039 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:45:25.317278 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:25.317477 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:45:25.338621 [debug] [Thread-3 (]: SQL status: COMMIT in 0.036 seconds
[0m16:45:25.339973 [debug] [Thread-2 (]: SQL status: COMMIT in 0.022 seconds
[0m16:45:25.344648 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:45:25.345955 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:45:25.346385 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:45:25.346764 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:45:25.346957 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:45:25.347148 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:45:25.358126 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.011 seconds
[0m16:45:25.358615 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.011 seconds
[0m16:45:25.360826 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:45:25.361591 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:45:25.361980 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191f3eb0>]}
[0m16:45:25.362448 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119177d90>]}
[0m16:45:25.362906 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.77s]
[0m16:45:25.363410 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 0.77s]
[0m16:45:25.363844 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:45:25.364166 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:45:25.364709 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m16:45:25.364964 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m16:45:25.365399 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.businesses
[0m16:45:25.365236 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m16:45:25.365634 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m16:45:25.365885 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m16:45:25.366164 [info ] [Thread-2 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m16:45:25.366442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m16:45:25.366706 [info ] [Thread-3 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m16:45:25.367012 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m16:45:25.367310 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.businesses)
[0m16:45:25.367541 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m16:45:25.367755 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.properties)
[0m16:45:25.367964 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m16:45:25.368154 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:45:25.370500 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m16:45:25.370763 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m16:45:25.372916 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m16:45:25.375266 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:45:25.378003 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:45:25.378579 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m16:45:25.382134 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m16:45:25.382464 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.businesses
[0m16:45:25.382734 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m16:45:25.384884 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:45:25.387167 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m16:45:25.387413 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m16:45:25.387710 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:45:25.389995 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:45:25.390284 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m16:45:25.390565 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:25.390784 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:25.391002 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:25.391189 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:25.391384 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m16:45:25.391587 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:45:25.391867 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:45:25.392056 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:45:25.392256 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:45:25.392502 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:45:25.449297 [debug] [Thread-2 (]: SQL status: BEGIN in 0.057 seconds
[0m16:45:25.449678 [debug] [Thread-1 (]: SQL status: BEGIN in 0.059 seconds
[0m16:45:25.449936 [debug] [Thread-4 (]: SQL status: BEGIN in 0.058 seconds
[0m16:45:25.450110 [debug] [Thread-3 (]: SQL status: BEGIN in 0.058 seconds
[0m16:45:25.450372 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:25.450569 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:45:25.450757 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:25.450934 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:25.451149 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:45:25.451406 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct business_name, business_address from combined_business_addresses
  );
  
[0m16:45:25.451698 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    *, 
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m16:45:25.451991 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:45:25.708802 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.256 seconds
[0m16:45:25.715294 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:25.715607 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:45:25.718227 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:25.719029 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:45:25.719244 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:25.719447 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:45:25.723369 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:25.724866 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:45:25.725299 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:45:25.725499 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:45:25.727193 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:25.728055 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: Close
[0m16:45:25.728439 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118c5d360>]}
[0m16:45:25.728813 [info ] [Thread-2 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.36s]
[0m16:45:25.729129 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.businesses
[0m16:45:25.782113 [debug] [Thread-3 (]: SQL status: SELECT 9083 in 0.329 seconds
[0m16:45:25.788116 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:25.788418 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m16:45:25.791386 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:25.795814 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:45:25.796685 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:25.797114 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:45:25.803243 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m16:45:25.806892 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m16:45:25.807427 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:45:25.807644 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m16:45:25.809279 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:25.810146 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: Close
[0m16:45:25.810515 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191494b0>]}
[0m16:45:25.810883 [info ] [Thread-3 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.44s]
[0m16:45:25.811190 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m16:45:25.811603 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.addresses
[0m16:45:25.812007 [info ] [Thread-2 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m16:45:25.812321 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m16:45:25.812544 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.addresses
[0m16:45:25.814333 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m16:45:25.814586 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.362 seconds
[0m16:45:25.816508 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:45:25.816730 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m16:45:25.817016 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.addresses
[0m16:45:25.820375 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m16:45:25.821058 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:45:25.821280 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: BEGIN
[0m16:45:25.821469 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:45:25.821757 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:45:25.823044 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:45:25.823327 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:45:25.823529 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:45:25.826985 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:25.828667 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m16:45:25.829216 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:45:25.829431 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m16:45:25.831014 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:25.831779 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m16:45:25.832146 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119227e20>]}
[0m16:45:25.832515 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 11450[0m in 0.47s]
[0m16:45:25.833009 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m16:45:25.873478 [debug] [Thread-2 (]: SQL status: BEGIN in 0.052 seconds
[0m16:45:25.873835 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:45:25.874047 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m16:45:25.970694 [debug] [Thread-2 (]: SQL status: SELECT 4945 in 0.096 seconds
[0m16:45:25.975976 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:45:25.976284 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m16:45:25.979192 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:25.981204 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:45:25.981506 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:45:25.981729 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:45:25.985841 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m16:45:25.988165 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m16:45:25.988617 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:45:25.988820 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m16:45:25.990447 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:25.991214 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: Close
[0m16:45:25.991581 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11926c0a0>]}
[0m16:45:25.991953 [info ] [Thread-2 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.18s]
[0m16:45:25.992261 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.addresses
[0m16:45:26.932821 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.480 seconds
[0m16:45:26.937917 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:26.938485 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m16:45:26.942078 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:45:26.943092 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:45:26.943333 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:26.943534 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:45:26.950756 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m16:45:26.953549 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m16:45:26.954097 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:45:26.954316 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m16:45:26.955885 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:26.956653 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m16:45:26.957020 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bf4ee0>]}
[0m16:45:26.957392 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 1.59s]
[0m16:45:26.957783 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m16:45:26.958179 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_tenures
[0m16:45:26.958557 [info ] [Thread-3 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m16:45:26.958953 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m16:45:26.959242 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m16:45:26.961092 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m16:45:26.961369 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m16:45:26.961879 [info ] [Thread-1 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m16:45:26.962238 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.business_with_full_timeline)
[0m16:45:26.962542 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m16:45:26.964295 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:26.964688 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.business_tenures
[0m16:45:26.966805 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m16:45:26.967123 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m16:45:26.973838 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:45:26.979945 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:26.980385 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m16:45:26.980779 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:45:26.981235 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:26.981479 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m16:45:26.981692 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:27.034551 [debug] [Thread-3 (]: SQL status: BEGIN in 0.054 seconds
[0m16:45:27.034932 [debug] [Thread-1 (]: SQL status: BEGIN in 0.053 seconds
[0m16:45:27.035329 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:45:27.035556 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:27.035781 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select * from business_tenures
  );
  
[0m16:45:27.036042 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m16:45:27.079175 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.043 seconds
[0m16:45:27.081423 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:27.081741 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m16:45:27.086444 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:27.087309 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:45:27.087546 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:27.087739 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:45:27.090786 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:27.092287 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m16:45:27.093744 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:45:27.093975 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m16:45:27.095750 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:45:27.096673 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m16:45:27.097058 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191fe770>]}
[0m16:45:27.097532 [info ] [Thread-1 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.13s]
[0m16:45:27.097870 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m16:45:27.279366 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.243 seconds
[0m16:45:27.284641 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:45:27.284946 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m16:45:27.287646 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:45:27.288622 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m16:45:27.288846 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:45:27.289035 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m16:45:27.292066 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:27.293585 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m16:45:27.294093 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:45:27.294307 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m16:45:27.295695 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m16:45:27.296456 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: Close
[0m16:45:27.296820 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8983a532-081e-49d6-8416-9a15e2e70ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11921c9a0>]}
[0m16:45:27.297187 [info ] [Thread-3 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.34s]
[0m16:45:27.297503 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_tenures
[0m16:45:27.298204 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:27.298405 [debug] [MainThread]: On master: BEGIN
[0m16:45:27.298561 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:45:27.352671 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:45:27.354535 [debug] [MainThread]: On master: COMMIT
[0m16:45:27.355171 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:27.355730 [debug] [MainThread]: On master: COMMIT
[0m16:45:27.357065 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:27.357371 [debug] [MainThread]: On master: Close
[0m16:45:27.357641 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:45:27.357814 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m16:45:27.357960 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m16:45:27.358096 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m16:45:27.358226 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m16:45:27.358439 [info ] [MainThread]: 
[0m16:45:27.358617 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 3.72 seconds (3.72s).
[0m16:45:27.359656 [debug] [MainThread]: Command end result
[0m16:45:27.373658 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:27.374759 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:27.379679 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:45:27.379969 [info ] [MainThread]: 
[0m16:45:27.380214 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:45:27.380397 [info ] [MainThread]: 
[0m16:45:27.380581 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m16:45:27.382395 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.271904, "process_in_blocks": "0", "process_kernel_time": 0.217182, "process_mem_max_rss": "128516096", "process_out_blocks": "0", "process_user_time": 1.612169}
[0m16:45:27.382749 [debug] [MainThread]: Command `dbt run` succeeded at 16:45:27.382695 after 4.27 seconds
[0m16:45:27.383030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c32b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118beadd0>]}
[0m16:45:27.383265 [debug] [MainThread]: Flushing usage events
[0m16:45:27.919574 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:00:57.222971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038fe8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f793c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f78ca0>]}


============================== 15:00:57.226020 | 11d2e24f-bd05-44b0-ae3a-36772e0d0e66 ==============================
[0m15:00:57.226020 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:00:57.226382 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'printer_width': '80', 'version_check': 'True', 'no_print': 'None', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'warn_error': 'None', 'quiet': 'False', 'debug': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'empty': 'False', 'fail_fast': 'False', 'log_format': 'default'}
[0m15:00:57.398846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050491e0>]}
[0m15:00:57.441627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10504bca0>]}
[0m15:00:57.442439 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:00:57.535205 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:00:57.609905 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:00:57.610191 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:00:57.613697 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:00:57.632975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c98130>]}
[0m15:00:57.709336 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:00:57.710805 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:00:57.723669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c14b80>]}
[0m15:00:57.723987 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m15:00:57.724196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c14b50>]}
[0m15:00:57.725256 [info ] [MainThread]: 
[0m15:00:57.725466 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:00:57.725637 [info ] [MainThread]: 
[0m15:00:57.725914 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:00:57.728514 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:00:57.775105 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:00:57.775436 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:00:57.775611 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:57.891024 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.115 seconds
[0m15:00:57.891961 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:00:57.892457 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now create_highstreet_analytics_analytics)
[0m15:00:57.892782 [debug] [ThreadPool]: Creating schema "database: "highstreet"
schema: "analytics_analytics"
"
[0m15:00:57.896027 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m15:00:57.896259 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: BEGIN
[0m15:00:57.896439 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:57.955175 [debug] [ThreadPool]: SQL status: BEGIN in 0.059 seconds
[0m15:00:57.955591 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m15:00:57.955772 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "create_highstreet_analytics_analytics"} */
create schema if not exists "analytics_analytics"
[0m15:00:57.967836 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.012 seconds
[0m15:00:57.968464 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m15:00:57.968680 [debug] [ThreadPool]: Using postgres connection "create_highstreet_analytics_analytics"
[0m15:00:57.968843 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: COMMIT
[0m15:00:57.972976 [debug] [ThreadPool]: SQL status: COMMIT in 0.004 seconds
[0m15:00:57.973196 [debug] [ThreadPool]: On create_highstreet_analytics_analytics: Close
[0m15:00:57.974374 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_highstreet_analytics_analytics, now list_highstreet_analytics_analytics)
[0m15:00:57.977975 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:00:57.978212 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:00:57.978381 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:58.026717 [debug] [ThreadPool]: SQL status: BEGIN in 0.048 seconds
[0m15:00:58.027042 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:00:58.027240 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:00:58.090362 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.063 seconds
[0m15:00:58.094348 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:00:58.097886 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:00:58.103480 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:58.103781 [debug] [MainThread]: On master: BEGIN
[0m15:00:58.103950 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:00:58.157483 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m15:00:58.159158 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:58.160521 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:00:58.462088 [debug] [MainThread]: SQL status: SELECT 0 in 0.300 seconds
[0m15:00:58.465748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ccb160>]}
[0m15:00:58.466701 [debug] [MainThread]: On master: ROLLBACK
[0m15:00:58.468225 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:58.468461 [debug] [MainThread]: On master: BEGIN
[0m15:00:58.469812 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:00:58.470125 [debug] [MainThread]: On master: COMMIT
[0m15:00:58.470306 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:58.470470 [debug] [MainThread]: On master: COMMIT
[0m15:00:58.471406 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:00:58.472228 [debug] [MainThread]: On master: Close
[0m15:00:58.477406 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:00:58.477828 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m15:00:58.478114 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:00:58.478465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:00:58.478736 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m15:00:58.478973 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:00:58.479241 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m15:00:58.483807 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:00:58.484112 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:00:58.486252 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:00:58.486741 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:00:58.492465 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:00:58.517735 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:00:58.515855 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:00:58.518553 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:58.518910 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:00:58.519279 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:00:58.519789 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:00:58.520045 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:00:58.520248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:58.570860 [debug] [Thread-2 (]: SQL status: BEGIN in 0.052 seconds
[0m15:00:58.571214 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m15:00:58.571572 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:00:58.571798 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:00:58.572028 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:00:58.572273 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:00:58.578109 [debug] [Thread-2 (]: Postgres adapter: Postgres error: relation "public.filename_mapping" does not exist
LINE 15:     select * from "highstreet"."public"."filename_mapping"
                           ^

[0m15:00:58.578405 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: ROLLBACK
[0m15:00:58.579507 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:00:58.583616 [debug] [Thread-2 (]: Database Error in model stg_filemap (models/staging/stg_filemap.sql)
  relation "public.filename_mapping" does not exist
  LINE 15:     select * from "highstreet"."public"."filename_mapping"
                             ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_filemap.sql
[0m15:00:58.584954 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103757cd0>]}
[0m15:00:58.585422 [error] [Thread-2 (]: 2 of 13 ERROR creating sql table model analytics_analytics.stg_filemap ......... [[31mERROR[0m in 0.10s]
[0m15:00:58.585769 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:00:58.586082 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.stg_filemap' to be skipped because of status 'error'.  Reason: Database Error in model stg_filemap (models/staging/stg_filemap.sql)
  relation "public.filename_mapping" does not exist
  LINE 15:     select * from "highstreet"."public"."filename_mapping"
                             ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_filemap.sql.
[0m15:00:58.586719 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:00:58.586944 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:00:58.587145 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:00:58.587376 [info ] [Thread-4 (]: 3 of 13 SKIP relation analytics_analytics.stg_accounts_closed .................. [[33mSKIP[0m]
[0m15:00:58.587727 [info ] [Thread-3 (]: 4 of 13 SKIP relation analytics_analytics.stg_accounts_no_relief ............... [[33mSKIP[0m]
[0m15:00:58.588072 [info ] [Thread-2 (]: 5 of 13 SKIP relation analytics_analytics.stg_accounts_relief .................. [[33mSKIP[0m]
[0m15:00:58.588385 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:00:58.588664 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:00:58.588925 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:00:58.589226 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:00:58.589692 [info ] [Thread-4 (]: 6 of 13 SKIP relation analytics_analytics.stg_new_businesses ................... [[33mSKIP[0m]
[0m15:00:58.590037 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:00:58.590505 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_addresses
[0m15:00:58.590728 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:00:58.590932 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.businesses
[0m15:00:58.591280 [info ] [Thread-3 (]: 7 of 13 SKIP relation analytics_analytics.business_addresses ................... [[33mSKIP[0m]
[0m15:00:58.591602 [info ] [Thread-2 (]: 8 of 13 SKIP relation analytics_analytics.business_timeline .................... [[33mSKIP[0m]
[0m15:00:58.591891 [info ] [Thread-4 (]: 9 of 13 SKIP relation analytics_analytics.businesses ........................... [[33mSKIP[0m]
[0m15:00:58.592212 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_addresses
[0m15:00:58.592479 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:00:58.592765 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.businesses
[0m15:00:58.593032 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m15:00:58.593760 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m15:00:58.594068 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m15:00:58.594354 [info ] [Thread-3 (]: 10 of 13 SKIP relation analytics_analytics.properties .......................... [[33mSKIP[0m]
[0m15:00:58.594740 [info ] [Thread-2 (]: 11 of 13 SKIP relation analytics_analytics.business_tenures .................... [[33mSKIP[0m]
[0m15:00:58.595106 [info ] [Thread-4 (]: 12 of 13 SKIP relation analytics_analytics.business_with_full_timeline ......... [[33mSKIP[0m]
[0m15:00:58.595388 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m15:00:58.595590 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m15:00:58.595789 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m15:00:58.596117 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m15:00:58.596455 [info ] [Thread-3 (]: 13 of 13 SKIP relation analytics_analytics.addresses ........................... [[33mSKIP[0m]
[0m15:00:58.596760 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m15:00:58.651783 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.079 seconds
[0m15:00:58.658505 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:00:58.658916 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m15:00:58.662692 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:00:58.670672 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m15:00:58.670972 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:00:58.671182 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m15:00:58.674169 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m15:00:58.677824 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m15:00:58.680149 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:00:58.680457 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m15:00:58.682194 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:00:58.683784 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:00:58.684179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11d2e24f-bd05-44b0-ae3a-36772e0d0e66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102705330>]}
[0m15:00:58.684563 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.21s]
[0m15:00:58.684954 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:00:58.685749 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:58.685973 [debug] [MainThread]: On master: BEGIN
[0m15:00:58.686136 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:00:58.737399 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m15:00:58.737734 [debug] [MainThread]: On master: COMMIT
[0m15:00:58.737921 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:58.738089 [debug] [MainThread]: On master: COMMIT
[0m15:00:58.738929 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:00:58.739147 [debug] [MainThread]: On master: Close
[0m15:00:58.739421 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:58.739599 [debug] [MainThread]: Connection 'model.highstreet_tenure.date_spine' was properly closed.
[0m15:00:58.739751 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_filemap' was properly closed.
[0m15:00:58.739979 [info ] [MainThread]: 
[0m15:00:58.740171 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 1.01 seconds (1.01s).
[0m15:00:58.740766 [debug] [MainThread]: Command end result
[0m15:00:58.754214 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:00:58.755465 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:00:58.760183 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:00:58.760457 [info ] [MainThread]: 
[0m15:00:58.760695 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:00:58.760891 [info ] [MainThread]: 
[0m15:00:58.761117 [error] [MainThread]: [31mFailure in model stg_filemap (models/staging/stg_filemap.sql)[0m
[0m15:00:58.761354 [error] [MainThread]:   Database Error in model stg_filemap (models/staging/stg_filemap.sql)
  relation "public.filename_mapping" does not exist
  LINE 15:     select * from "highstreet"."public"."filename_mapping"
                             ^
  compiled code at target/run/highstreet_tenure/models/staging/stg_filemap.sql
[0m15:00:58.761525 [info ] [MainThread]: 
[0m15:00:58.761725 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/staging/stg_filemap.sql
[0m15:00:58.761957 [info ] [MainThread]: 
[0m15:00:58.762206 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=11 NO-OP=0 TOTAL=13
[0m15:00:58.794947 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.6242616, "process_in_blocks": "0", "process_kernel_time": 0.25731, "process_mem_max_rss": "136462336", "process_out_blocks": "0", "process_user_time": 1.323377}
[0m15:00:58.795444 [debug] [MainThread]: Command `dbt run` failed at 15:00:58.795387 after 1.62 seconds
[0m15:00:58.795690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038fe8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033976a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c26d40>]}
[0m15:00:58.795920 [debug] [MainThread]: Flushing usage events
[0m15:00:59.220702 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:18.723841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10367e9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cfcc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cfc550>]}


============================== 15:02:18.726845 | edf93ac8-5894-4e5d-a9f8-92a81a8dc050 ==============================
[0m15:02:18.726845 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:02:18.727221 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'static_parser': 'True', 'write_json': 'True', 'printer_width': '80', 'log_format': 'default', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'quiet': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'invocation_command': 'dbt run -m staging --profiles-dir .', 'profiles_dir': '.', 'cache_selected_only': 'False', 'no_print': 'None', 'use_colors': 'True', 'debug': 'False'}
[0m15:02:18.727531 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:02:18.727750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040f1ae0>]}
[0m15:02:18.875492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e22d10>]}
[0m15:02:18.917152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10408f310>]}
[0m15:02:18.917929 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:02:18.983807 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:02:19.058538 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:02:19.058813 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:02:19.062409 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:02:19.081648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a1c040>]}
[0m15:02:19.158592 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:02:19.159991 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:02:19.172475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10522be80>]}
[0m15:02:19.172797 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m15:02:19.173007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a3ea10>]}
[0m15:02:19.173832 [info ] [MainThread]: 
[0m15:02:19.174040 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:02:19.174211 [info ] [MainThread]: 
[0m15:02:19.174494 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:02:19.176879 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:02:19.212020 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:02:19.212368 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:02:19.212555 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:19.312241 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.100 seconds
[0m15:02:19.313208 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:02:19.314573 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:02:19.318572 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:02:19.318846 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:02:19.319080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:19.368250 [debug] [ThreadPool]: SQL status: BEGIN in 0.049 seconds
[0m15:02:19.368596 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:02:19.368798 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:02:19.431203 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.062 seconds
[0m15:02:19.432019 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:02:19.434031 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:02:19.437236 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:19.437529 [debug] [MainThread]: On master: BEGIN
[0m15:02:19.437700 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:19.489134 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m15:02:19.490610 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:19.492906 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:02:19.848761 [debug] [MainThread]: SQL status: SELECT 0 in 0.355 seconds
[0m15:02:19.851136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10598b910>]}
[0m15:02:19.854036 [debug] [MainThread]: On master: ROLLBACK
[0m15:02:19.857436 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:19.858165 [debug] [MainThread]: On master: BEGIN
[0m15:02:19.859778 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:02:19.860452 [debug] [MainThread]: On master: COMMIT
[0m15:02:19.861190 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:19.861698 [debug] [MainThread]: On master: COMMIT
[0m15:02:19.862803 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:02:19.863368 [debug] [MainThread]: On master: Close
[0m15:02:19.867176 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:02:19.867621 [info ] [Thread-1 (]: 1 of 5 START sql table model analytics_analytics.stg_filemap ................... [RUN]
[0m15:02:19.867968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.stg_filemap)
[0m15:02:19.868182 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:02:19.873247 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:02:19.873807 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:02:19.895896 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:02:19.896957 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:19.897291 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:02:19.897506 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:19.949345 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m15:02:19.949736 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:19.949967 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:02:20.001960 [debug] [Thread-1 (]: SQL status: SELECT 45 in 0.052 seconds
[0m15:02:20.007338 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:20.007643 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:02:20.011018 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:20.018551 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:02:20.018811 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:20.019021 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:02:20.022169 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:20.025459 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:02:20.027720 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:20.027949 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:02:20.029777 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:20.031241 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:02:20.032446 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10246f4c0>]}
[0m15:02:20.032849 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analytics_analytics.stg_filemap .............. [[32mSELECT 45[0m in 0.16s]
[0m15:02:20.033187 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:02:20.033646 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:02:20.033891 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:20.034088 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:02:20.034326 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:02:20.034599 [info ] [Thread-3 (]: 2 of 5 START sql table model analytics_analytics.stg_accounts_closed ........... [RUN]
[0m15:02:20.035070 [info ] [Thread-4 (]: 3 of 5 START sql table model analytics_analytics.stg_accounts_no_relief ........ [RUN]
[0m15:02:20.035483 [info ] [Thread-2 (]: 4 of 5 START sql table model analytics_analytics.stg_accounts_relief ........... [RUN]
[0m15:02:20.035823 [info ] [Thread-1 (]: 5 of 5 START sql table model analytics_analytics.stg_new_businesses ............ [RUN]
[0m15:02:20.036180 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:02:20.036494 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:02:20.036756 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_relief'
[0m15:02:20.036974 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m15:02:20.037201 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:02:20.037405 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:20.037593 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:02:20.037784 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:02:20.040132 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.042268 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.044554 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.046505 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.047556 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:02:20.047864 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:02:20.048120 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:20.051381 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.051702 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:02:20.054367 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.056875 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.059398 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.060001 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.060435 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:02:20.060675 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.060940 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:02:20.061162 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.061400 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.061624 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:02:20.061929 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:02:20.062147 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:02:20.062375 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:02:20.062643 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:20.062909 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:02:20.127817 [debug] [Thread-2 (]: SQL status: BEGIN in 0.065 seconds
[0m15:02:20.128197 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.128458 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:20.131184 [debug] [Thread-1 (]: SQL status: BEGIN in 0.069 seconds
[0m15:02:20.131495 [debug] [Thread-3 (]: SQL status: BEGIN in 0.070 seconds
[0m15:02:20.131840 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.132065 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.132317 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:20.132600 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:20.136683 [debug] [Thread-4 (]: SQL status: BEGIN in 0.074 seconds
[0m15:02:20.136957 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.137203 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:20.239846 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.107 seconds
[0m15:02:20.242165 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.242419 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:02:20.245390 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:20.246376 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:02:20.246622 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.246823 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:02:20.252924 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m15:02:20.255044 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:02:20.255531 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:20.255749 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:02:20.257418 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:02:20.258279 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:02:20.258684 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a043c10>]}
[0m15:02:20.259072 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analytics_analytics.stg_new_businesses ....... [[32mSELECT 1307[0m in 0.22s]
[0m15:02:20.259403 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:02:20.263964 [debug] [Thread-3 (]: SQL status: SELECT 2683 in 0.131 seconds
[0m15:02:20.266042 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.266340 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m15:02:20.271377 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m15:02:20.272461 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:02:20.272696 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.272894 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:02:20.277085 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m15:02:20.278924 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m15:02:20.279438 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:20.279656 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m15:02:20.281599 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:20.282589 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:02:20.283018 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c8f430>]}
[0m15:02:20.283420 [info ] [Thread-3 (]: 2 of 5 OK created sql table model analytics_analytics.stg_accounts_closed ...... [[32mSELECT 2683[0m in 0.25s]
[0m15:02:20.283876 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:02:20.740303 [debug] [Thread-4 (]: SQL status: SELECT 27009 in 0.602 seconds
[0m15:02:20.745739 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.746102 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m15:02:20.746375 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.618 seconds
[0m15:02:20.748444 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.748732 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:02:20.749035 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:20.750014 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:02:20.750272 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.750482 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:02:20.752387 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:20.753459 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:02:20.753754 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.753948 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:02:20.798187 [debug] [Thread-4 (]: SQL status: COMMIT in 0.047 seconds
[0m15:02:20.799157 [debug] [Thread-2 (]: SQL status: COMMIT in 0.045 seconds
[0m15:02:20.802667 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m15:02:20.804097 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:02:20.804565 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:20.805013 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:20.805250 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m15:02:20.805494 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:02:20.807568 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:20.807817 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:20.808873 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:02:20.809790 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:02:20.810254 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059c5ab0>]}
[0m15:02:20.810690 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edf93ac8-5894-4e5d-a9f8-92a81a8dc050', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c8e8f0>]}
[0m15:02:20.811066 [info ] [Thread-4 (]: 3 of 5 OK created sql table model analytics_analytics.stg_accounts_no_relief ... [[32mSELECT 27009[0m in 0.77s]
[0m15:02:20.811501 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analytics_analytics.stg_accounts_relief ...... [[32mSELECT 28209[0m in 0.77s]
[0m15:02:20.811843 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:20.812152 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:02:20.813013 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:20.813236 [debug] [MainThread]: On master: BEGIN
[0m15:02:20.813402 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:20.866774 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m15:02:20.867111 [debug] [MainThread]: On master: COMMIT
[0m15:02:20.867302 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:20.867475 [debug] [MainThread]: On master: COMMIT
[0m15:02:20.868284 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:02:20.868521 [debug] [MainThread]: On master: Close
[0m15:02:20.868795 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:20.868979 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_new_businesses' was properly closed.
[0m15:02:20.869137 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_closed' was properly closed.
[0m15:02:20.869292 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_no_relief' was properly closed.
[0m15:02:20.869436 [debug] [MainThread]: Connection 'model.highstreet_tenure.stg_accounts_relief' was properly closed.
[0m15:02:20.869653 [info ] [MainThread]: 
[0m15:02:20.869851 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 1.70 seconds (1.70s).
[0m15:02:20.870469 [debug] [MainThread]: Command end result
[0m15:02:20.884502 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:02:20.885775 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:02:20.890242 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:02:20.890554 [info ] [MainThread]: 
[0m15:02:20.890836 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:02:20.891080 [info ] [MainThread]: 
[0m15:02:20.891337 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m15:02:20.891696 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:02:20.894214 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.2179844, "process_in_blocks": "0", "process_kernel_time": 0.192629, "process_mem_max_rss": "137052160", "process_out_blocks": "0", "process_user_time": 1.320066}
[0m15:02:20.894660 [debug] [MainThread]: Command `dbt run` succeeded at 15:02:20.894604 after 2.22 seconds
[0m15:02:20.894933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10367e9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dea980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a6e560>]}
[0m15:02:20.895199 [debug] [MainThread]: Flushing usage events
[0m15:02:21.371400 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:41.385355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ebd4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ebcdc0>]}


============================== 15:02:41.388268 | bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d ==============================
[0m15:02:41.388268 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:02:41.388623 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'warn_error': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'no_print': 'None', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'printer_width': '80', 'version_check': 'True'}
[0m15:02:41.518205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f89690>]}
[0m15:02:41.559101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f89180>]}
[0m15:02:41.559769 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:02:41.625989 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:02:41.698439 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:02:41.698749 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:02:41.702570 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.highstreet_tenure.marts
[0m15:02:41.721273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d2c130>]}
[0m15:02:41.799264 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:02:41.800576 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:02:41.811953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ca4bb0>]}
[0m15:02:41.812275 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m15:02:41.812481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ca4b80>]}
[0m15:02:41.813524 [info ] [MainThread]: 
[0m15:02:41.813731 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:02:41.813897 [info ] [MainThread]: 
[0m15:02:41.814185 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:02:41.816782 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:02:41.850095 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:02:41.850422 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:02:41.850609 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:41.954146 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.103 seconds
[0m15:02:41.955231 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:02:41.956662 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:02:41.961251 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:02:41.961565 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:02:41.961783 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:42.014664 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m15:02:42.015000 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:02:42.015196 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:02:42.076489 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.061 seconds
[0m15:02:42.077364 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:02:42.079709 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:02:42.083428 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:42.083668 [debug] [MainThread]: On master: BEGIN
[0m15:02:42.083835 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:42.134231 [debug] [MainThread]: SQL status: BEGIN in 0.050 seconds
[0m15:02:42.134571 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:42.134810 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:02:42.519405 [debug] [MainThread]: SQL status: SELECT 0 in 0.384 seconds
[0m15:02:42.521948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cac790>]}
[0m15:02:42.522441 [debug] [MainThread]: On master: ROLLBACK
[0m15:02:42.523956 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:42.524189 [debug] [MainThread]: On master: BEGIN
[0m15:02:42.525471 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:02:42.525699 [debug] [MainThread]: On master: COMMIT
[0m15:02:42.525882 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:42.526049 [debug] [MainThread]: On master: COMMIT
[0m15:02:42.527037 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:02:42.527827 [debug] [MainThread]: On master: Close
[0m15:02:42.531232 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m15:02:42.531520 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m15:02:42.531819 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m15:02:42.532145 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m15:02:42.532464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m15:02:42.532720 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m15:02:42.532926 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m15:02:42.533203 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m15:02:42.537875 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m15:02:42.540035 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m15:02:42.540748 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m15:02:42.566044 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m15:02:42.566435 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m15:02:42.569583 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m15:02:42.570248 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:02:42.570545 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:42.570781 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m15:02:42.571016 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m15:02:42.571230 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:42.571447 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:02:42.625557 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m15:02:42.625971 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m15:02:42.626348 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:02:42.626609 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:42.626868 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m15:02:42.627122 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m15:02:42.677320 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.050 seconds
[0m15:02:42.683136 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:42.683422 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m15:02:42.686278 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:42.688127 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:42.688363 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m15:02:42.691564 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:42.700153 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:02:42.700411 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.073 seconds
[0m15:02:42.700674 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:42.702656 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:02:42.702915 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m15:02:42.703120 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m15:02:42.706704 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:42.706951 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:02:42.710417 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m15:02:42.712841 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:02:42.715863 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m15:02:42.716299 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m15:02:42.716624 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m15:02:42.718460 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:42.719445 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m15:02:42.719678 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:02:42.719876 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m15:02:42.722821 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:42.724369 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m15:02:42.724845 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m15:02:42.725060 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m15:02:42.726571 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.010 seconds
[0m15:02:42.728120 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m15:02:42.729388 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103959330>]}
[0m15:02:42.729809 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.20s]
[0m15:02:42.730142 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m15:02:42.730616 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m15:02:42.730919 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:42.731150 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m15:02:42.731435 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m15:02:42.731752 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m15:02:42.732073 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m15:02:42.732403 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m15:02:42.732681 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m15:02:42.732905 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m15:02:42.733125 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m15:02:42.733327 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:42.733524 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m15:02:42.735645 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.737985 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:42.738329 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.013 seconds
[0m15:02:42.740694 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:42.741901 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m15:02:42.742385 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:42.742821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10739ae30>]}
[0m15:02:42.743085 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m15:02:42.745340 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:42.745583 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m15:02:42.746044 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.21s]
[0m15:02:42.749183 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.751872 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:42.752374 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m15:02:42.752962 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:42.753396 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m15:02:42.753755 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.754105 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m15:02:42.754374 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:42.754747 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m15:02:42.755055 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m15:02:42.755331 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:02:42.755590 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m15:02:42.755961 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m15:02:42.756219 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:02:42.756569 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:02:42.756799 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m15:02:42.759420 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.759974 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m15:02:42.762760 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.763431 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.763678 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m15:02:42.763925 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:42.811343 [debug] [Thread-3 (]: SQL status: BEGIN in 0.056 seconds
[0m15:02:42.811736 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:42.811991 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:42.813682 [debug] [Thread-2 (]: SQL status: BEGIN in 0.057 seconds
[0m15:02:42.814014 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:42.814282 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:42.814994 [debug] [Thread-4 (]: SQL status: BEGIN in 0.059 seconds
[0m15:02:42.815256 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.815515 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:42.822094 [debug] [Thread-1 (]: SQL status: BEGIN in 0.058 seconds
[0m15:02:42.822399 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.822650 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m15:02:42.920287 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.097 seconds
[0m15:02:42.922849 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.923176 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m15:02:42.926833 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:42.928738 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.928986 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m15:02:42.930737 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:42.931731 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:02:42.931957 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.932151 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m15:02:42.937516 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m15:02:42.939160 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m15:02:42.939629 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m15:02:42.939841 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m15:02:42.943180 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.127 seconds
[0m15:02:42.945832 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.946069 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m15:02:42.951144 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m15:02:42.951430 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m15:02:42.953286 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.954039 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m15:02:42.954268 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m15:02:42.954671 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6e170>]}
[0m15:02:42.955056 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.20s]
[0m15:02:42.955554 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m15:02:42.956083 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:42.957110 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:02:42.957388 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.957591 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m15:02:42.961237 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:42.963002 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m15:02:42.963565 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m15:02:42.963802 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m15:02:42.975295 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m15:02:42.976442 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m15:02:42.976950 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111565e70>]}
[0m15:02:42.977348 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.24s]
[0m15:02:42.977668 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m15:02:43.422002 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.609 seconds
[0m15:02:43.429865 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:43.430225 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m15:02:43.433561 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:43.437536 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:43.437857 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m15:02:43.439208 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.625 seconds
[0m15:02:43.441412 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:43.441691 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:02:43.441954 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m15:02:43.442997 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:02:43.443278 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:43.443480 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m15:02:43.446500 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:43.448550 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:43.448796 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m15:02:43.449561 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m15:02:43.451963 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m15:02:43.452458 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m15:02:43.452696 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:02:43.452933 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m15:02:43.453856 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:02:43.454127 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:43.454337 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m15:02:43.456960 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m15:02:43.458427 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m15:02:43.458890 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m15:02:43.459094 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m15:02:43.464669 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.011 seconds
[0m15:02:43.465441 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m15:02:43.465803 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111564be0>]}
[0m15:02:43.466180 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 0.73s]
[0m15:02:43.466683 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m15:02:43.470981 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m15:02:43.471870 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m15:02:43.472239 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115d1330>]}
[0m15:02:43.472607 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.74s]
[0m15:02:43.472985 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m15:02:43.473708 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m15:02:43.474057 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m15:02:43.474805 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m15:02:43.474555 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m15:02:43.475178 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m15:02:43.475560 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m15:02:43.475942 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m15:02:43.476319 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m15:02:43.476676 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m15:02:43.477063 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m15:02:43.477346 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m15:02:43.477583 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m15:02:43.477910 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m15:02:43.478182 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m15:02:43.478425 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m15:02:43.480972 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m15:02:43.481260 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m15:02:43.483567 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m15:02:43.486106 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m15:02:43.488626 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m15:02:43.489538 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m15:02:43.489851 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m15:02:43.490099 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m15:02:43.493765 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m15:02:43.494053 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m15:02:43.496463 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m15:02:43.498718 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m15:02:43.500910 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m15:02:43.501393 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m15:02:43.501853 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:02:43.502122 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m15:02:43.502453 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m15:02:43.502736 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m15:02:43.502956 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m15:02:43.503152 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m15:02:43.503350 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:43.503575 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m15:02:43.503778 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:02:43.503973 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:02:43.504272 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:02:43.562445 [debug] [Thread-1 (]: SQL status: BEGIN in 0.059 seconds
[0m15:02:43.562855 [debug] [Thread-4 (]: SQL status: BEGIN in 0.059 seconds
[0m15:02:43.563148 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m15:02:43.563467 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:02:43.563844 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct business_name, business_address from combined_business_addresses
  );
  
[0m15:02:43.564240 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    *, 
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m15:02:43.564665 [debug] [Thread-3 (]: SQL status: BEGIN in 0.061 seconds
[0m15:02:43.564905 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m15:02:43.565149 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m15:02:43.565441 [debug] [Thread-2 (]: SQL status: BEGIN in 0.061 seconds
[0m15:02:43.565715 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m15:02:43.565965 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m15:02:43.818009 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.252 seconds
[0m15:02:43.824155 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m15:02:43.824523 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m15:02:43.827562 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:43.829963 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m15:02:43.830557 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m15:02:43.831065 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m15:02:43.835120 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m15:02:43.839176 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m15:02:43.839728 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m15:02:43.839952 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m15:02:43.841840 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:43.842740 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m15:02:43.843143 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115b6980>]}
[0m15:02:43.843524 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.37s]
[0m15:02:43.843851 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m15:02:43.899682 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.333 seconds
[0m15:02:43.901947 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m15:02:43.902189 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m15:02:43.904917 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:43.905780 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m15:02:43.905995 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m15:02:43.906188 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m15:02:43.909457 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:43.911628 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m15:02:43.912063 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m15:02:43.912289 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m15:02:43.913843 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:02:43.914630 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m15:02:43.915123 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115d16f0>]}
[0m15:02:43.915628 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.44s]
[0m15:02:43.915959 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m15:02:43.916353 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m15:02:43.916701 [info ] [Thread-3 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m15:02:43.917045 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m15:02:43.917293 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.addresses
[0m15:02:43.919106 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m15:02:43.920148 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.addresses
[0m15:02:43.922369 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m15:02:43.923144 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m15:02:43.923467 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: BEGIN
[0m15:02:43.923680 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:02:43.928502 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.364 seconds
[0m15:02:43.930771 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m15:02:43.931018 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m15:02:43.934402 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:02:43.935404 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m15:02:43.935625 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m15:02:43.935812 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m15:02:43.939441 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m15:02:43.941118 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m15:02:43.941599 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m15:02:43.941807 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m15:02:43.943458 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:02:43.944323 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m15:02:43.944704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111643940>]}
[0m15:02:43.945086 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 11450[0m in 0.47s]
[0m15:02:43.945497 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m15:02:43.975520 [debug] [Thread-3 (]: SQL status: BEGIN in 0.052 seconds
[0m15:02:43.975930 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m15:02:43.976155 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m15:02:44.070790 [debug] [Thread-3 (]: SQL status: SELECT 4945 in 0.094 seconds
[0m15:02:44.075159 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m15:02:44.075466 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m15:02:44.077977 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:44.078864 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m15:02:44.079088 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m15:02:44.079282 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m15:02:44.083126 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m15:02:44.085347 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m15:02:44.085797 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m15:02:44.085994 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m15:02:44.087589 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:02:44.088296 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: Close
[0m15:02:44.088644 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11151b550>]}
[0m15:02:44.089014 [info ] [Thread-3 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.17s]
[0m15:02:44.089327 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m15:02:45.035307 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.470 seconds
[0m15:02:45.040906 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:02:45.041260 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m15:02:45.045107 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:02:45.045963 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m15:02:45.046186 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:02:45.046385 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m15:02:45.052429 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m15:02:45.057020 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m15:02:45.057542 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m15:02:45.057756 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m15:02:45.059385 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.001 seconds
[0m15:02:45.060203 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m15:02:45.060588 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107334760>]}
[0m15:02:45.060964 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 1.58s]
[0m15:02:45.061354 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m15:02:45.061782 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m15:02:45.062150 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m15:02:45.062419 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m15:02:45.062649 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m15:02:45.062955 [info ] [Thread-1 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m15:02:45.063207 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m15:02:45.063423 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.business_with_full_timeline)
[0m15:02:45.065234 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m15:02:45.065464 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m15:02:45.067101 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.067588 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_tenures
[0m15:02:45.070185 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m15:02:45.070816 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m15:02:45.083089 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.083631 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:02:45.083960 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m15:02:45.084197 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:02:45.084547 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.084806 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m15:02:45.085038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:45.135734 [debug] [Thread-2 (]: SQL status: BEGIN in 0.051 seconds
[0m15:02:45.136099 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m15:02:45.136465 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:02:45.136689 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.136920 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select * from business_tenures
  );
  
[0m15:02:45.137174 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m15:02:45.178408 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.041 seconds
[0m15:02:45.180484 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.180729 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m15:02:45.185161 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m15:02:45.186167 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m15:02:45.186429 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.186634 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m15:02:45.190559 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m15:02:45.192408 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m15:02:45.194026 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m15:02:45.194287 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m15:02:45.196077 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m15:02:45.196940 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m15:02:45.197322 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115480d0>]}
[0m15:02:45.197706 [info ] [Thread-1 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.13s]
[0m15:02:45.198087 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m15:02:45.372332 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.234 seconds
[0m15:02:45.377408 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:02:45.377681 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m15:02:45.380098 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m15:02:45.381039 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m15:02:45.381266 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:02:45.381463 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m15:02:45.385309 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m15:02:45.386657 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m15:02:45.387134 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m15:02:45.387328 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m15:02:45.389361 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:45.390070 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: Close
[0m15:02:45.390420 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd71367d-dfe4-4f06-a9f5-1d1a7a64b66d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107334760>]}
[0m15:02:45.390770 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.33s]
[0m15:02:45.391068 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m15:02:45.391811 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:45.392076 [debug] [MainThread]: On master: BEGIN
[0m15:02:45.392368 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:45.444190 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m15:02:45.445686 [debug] [MainThread]: On master: COMMIT
[0m15:02:45.446676 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:45.447250 [debug] [MainThread]: On master: COMMIT
[0m15:02:45.448691 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:02:45.449592 [debug] [MainThread]: On master: Close
[0m15:02:45.450551 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:45.450886 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m15:02:45.451061 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m15:02:45.451219 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m15:02:45.451369 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m15:02:45.451632 [info ] [MainThread]: 
[0m15:02:45.451844 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 3.64 seconds (3.64s).
[0m15:02:45.453040 [debug] [MainThread]: Command end result
[0m15:02:45.468595 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:02:45.470076 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:02:45.477425 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:02:45.477701 [info ] [MainThread]: 
[0m15:02:45.477927 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:02:45.478149 [info ] [MainThread]: 
[0m15:02:45.478367 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m15:02:45.480800 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.145308, "process_in_blocks": "0", "process_kernel_time": 0.225616, "process_mem_max_rss": "138657792", "process_out_blocks": "0", "process_user_time": 1.571456}
[0m15:02:45.481147 [debug] [MainThread]: Command `dbt run` succeeded at 15:02:45.481098 after 4.15 seconds
[0m15:02:45.481387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c7e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d4ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c4c0d0>]}
[0m15:02:45.481616 [debug] [MainThread]: Flushing usage events
[0m15:02:46.203965 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:29:50.784106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10569e8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f39450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f38d30>]}


============================== 16:29:50.787100 | 287ddd41-ac32-45ce-bb9a-16a10e86d819 ==============================
[0m16:29:50.787100 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:29:50.787446 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'write_json': 'True', 'printer_width': '80', 'warn_error': 'None', 'log_format': 'default', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'introspect': 'True', 'debug': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'target_path': 'None', 'use_colors': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None'}
[0m16:29:50.956475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104445ba0>]}
[0m16:29:50.997590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107188490>]}
[0m16:29:50.998298 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:29:51.065205 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:29:51.141352 [debug] [MainThread]: Partial parsing enabled: 13 files deleted, 13 files added, 0 files changed.
[0m16:29:51.141753 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/business_addresses.sql
[0m16:29:51.141954 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/business_with_full_timeline.sql
[0m16:29:51.142130 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/addresses.sql
[0m16:29:51.142298 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/properties.sql
[0m16:29:51.142465 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/1_staging/stg_new_businesses.sql
[0m16:29:51.142635 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/date_spine.sql
[0m16:29:51.142799 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/1_staging/stg_accounts_closed.sql
[0m16:29:51.142967 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/1_staging/stg_accounts_relief.sql
[0m16:29:51.143149 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/business_tenures.sql
[0m16:29:51.143310 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/businesses.sql
[0m16:29:51.143478 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/1_staging/stg_filemap.sql
[0m16:29:51.143671 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/1_staging/stg_accounts_no_relief.sql
[0m16:29:51.143841 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/business_timeline.sql
[0m16:29:51.144008 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/staging/stg_accounts_no_relief.sql
[0m16:29:51.144159 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/date_spine.sql
[0m16:29:51.144308 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/business_with_full_timeline.sql
[0m16:29:51.144463 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/staging/stg_filemap.sql
[0m16:29:51.144608 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/addresses.sql
[0m16:29:51.144760 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/staging/stg_accounts_closed.sql
[0m16:29:51.144903 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/business_tenures.sql
[0m16:29:51.145054 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/staging/stg_new_businesses.sql
[0m16:29:51.145195 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/properties.sql
[0m16:29:51.145335 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/business_addresses.sql
[0m16:29:51.145479 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/business_timeline.sql
[0m16:29:51.145627 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/staging/stg_accounts_relief.sql
[0m16:29:51.145774 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/int/businesses.sql
[0m16:29:51.350340 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m16:29:51.358302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110938550>]}
[0m16:29:51.404700 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:29:51.406628 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:29:51.419791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11093b130>]}
[0m16:29:51.420129 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m16:29:51.420341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d734f0>]}
[0m16:29:51.421419 [info ] [MainThread]: 
[0m16:29:51.421622 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:29:51.421793 [info ] [MainThread]: 
[0m16:29:51.422093 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:29:51.424696 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:29:51.457281 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:29:51.457638 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:29:51.457821 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:29:51.575220 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.117 seconds
[0m16:29:51.576155 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:29:51.577486 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:29:51.581370 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:29:51.581647 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:29:51.581839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:51.638210 [debug] [ThreadPool]: SQL status: BEGIN in 0.056 seconds
[0m16:29:51.638567 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:29:51.638767 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:29:51.698928 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.060 seconds
[0m16:29:51.699939 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:29:51.702857 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:29:51.706906 [debug] [MainThread]: Using postgres connection "master"
[0m16:29:51.707159 [debug] [MainThread]: On master: BEGIN
[0m16:29:51.707335 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:29:51.760218 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:29:51.761669 [debug] [MainThread]: Using postgres connection "master"
[0m16:29:51.762803 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:29:52.201243 [debug] [MainThread]: SQL status: SELECT 1 in 0.437 seconds
[0m16:29:52.205420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e8eb60>]}
[0m16:29:52.206006 [debug] [MainThread]: On master: ROLLBACK
[0m16:29:52.207568 [debug] [MainThread]: Using postgres connection "master"
[0m16:29:52.207811 [debug] [MainThread]: On master: BEGIN
[0m16:29:52.209120 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:29:52.209427 [debug] [MainThread]: On master: COMMIT
[0m16:29:52.209612 [debug] [MainThread]: Using postgres connection "master"
[0m16:29:52.209775 [debug] [MainThread]: On master: COMMIT
[0m16:29:52.210711 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:29:52.211512 [debug] [MainThread]: On master: Close
[0m16:29:52.214480 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m16:29:52.214787 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:29:52.215103 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m16:29:52.215576 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m16:29:52.215955 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m16:29:52.216338 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m16:29:52.216609 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m16:29:52.216837 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:29:52.222327 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m16:29:52.224337 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:29:52.225084 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:29:52.225407 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m16:29:52.249372 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:29:52.252665 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m16:29:52.253491 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:29:52.253876 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:29:52.254167 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:29:52.254535 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:29:52.254766 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m16:29:52.254965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:52.307122 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m16:29:52.307452 [debug] [Thread-2 (]: SQL status: BEGIN in 0.053 seconds
[0m16:29:52.307736 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:29:52.307980 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:29:52.308250 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m16:29:52.308516 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:29:52.364685 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.056 seconds
[0m16:29:52.370809 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:29:52.371082 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:29:52.375521 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:29:52.378021 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:29:52.378264 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:29:52.380077 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:29:52.388533 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:29:52.388807 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.080 seconds
[0m16:29:52.389055 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:29:52.390964 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:29:52.391193 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:29:52.391400 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m16:29:52.395363 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m16:29:52.399112 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:29:52.399438 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m16:29:52.402143 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:29:52.403952 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:29:52.404195 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:29:52.404411 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m16:29:52.408609 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:29:52.409577 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:29:52.409801 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:29:52.409992 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:29:52.413063 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:29:52.414603 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m16:29:52.415078 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:29:52.415280 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m16:29:52.419015 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:29:52.420664 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:29:52.421990 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ea5c60>]}
[0m16:29:52.422449 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.20s]
[0m16:29:52.422978 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:29:52.423444 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:29:52.423706 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:29:52.424030 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:29:52.424442 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m16:29:52.424993 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m16:29:52.425396 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m16:29:52.425766 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m16:29:52.426215 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:29:52.426543 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:29:52.427508 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m16:29:52.427861 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m16:29:52.428170 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:29:52.428428 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:29:52.428839 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:29:52.429356 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f6ba00>]}
[0m16:29:52.432409 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.435931 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:52.437928 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:52.438349 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.21s]
[0m16:29:52.439271 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m16:29:52.439639 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:29:52.439905 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:29:52.440257 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:29:52.440579 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:29:52.442998 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:52.445240 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.445613 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m16:29:52.448100 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:52.448700 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m16:29:52.449136 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:52.449456 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:29:52.449720 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.449992 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:29:52.450272 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:52.452348 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.452674 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:29:52.452954 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:29:52.453173 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:29:52.453466 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:29:52.453852 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:29:52.454080 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:29:52.458251 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.458922 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.459153 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:29:52.459356 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:52.514512 [debug] [Thread-2 (]: SQL status: BEGIN in 0.061 seconds
[0m16:29:52.515109 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:52.515415 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:29:52.515704 [debug] [Thread-3 (]: SQL status: BEGIN in 0.063 seconds
[0m16:29:52.515903 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:52.516133 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:29:52.518127 [debug] [Thread-4 (]: SQL status: BEGIN in 0.065 seconds
[0m16:29:52.518386 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.518630 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:29:52.519185 [debug] [Thread-1 (]: SQL status: BEGIN in 0.060 seconds
[0m16:29:52.519520 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.519773 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:29:52.659180 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.139 seconds
[0m16:29:52.661770 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.662097 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:29:52.665643 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:52.667656 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.667923 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:29:52.671997 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:29:52.673295 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:29:52.673622 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.673837 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:29:52.676215 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.157 seconds
[0m16:29:52.678454 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.678716 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:29:52.682201 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:52.684110 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.684413 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m16:29:52.684754 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:29:52.686330 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:29:52.686901 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:29:52.687144 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:29:52.688462 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:29:52.689412 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:29:52.689629 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.689818 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:29:52.694165 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m16:29:52.695745 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:29:52.696218 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:29:52.696431 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:29:52.700804 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.013 seconds
[0m16:29:52.701688 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:29:52.702123 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e56410>]}
[0m16:29:52.702557 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.25s]
[0m16:29:52.702944 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:29:52.715230 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.018 seconds
[0m16:29:52.717226 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:29:52.717792 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f6b6d0>]}
[0m16:29:52.718247 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.29s]
[0m16:29:52.718607 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:29:53.193265 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.677 seconds
[0m16:29:53.199262 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:53.199567 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:29:53.202845 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:53.205002 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:53.205264 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:29:53.206982 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:29:53.207949 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:29:53.208182 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:53.208380 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:29:53.220012 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m16:29:53.225559 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:29:53.225868 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.710 seconds
[0m16:29:53.226551 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:29:53.228656 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:53.228891 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:29:53.229108 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:29:53.232498 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:53.234394 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:53.234662 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:29:53.236796 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:29:53.237908 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:29:53.238164 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:53.238367 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:29:53.241232 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m16:29:53.242828 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:29:53.243296 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:29:53.243509 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:29:53.252451 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.023 seconds
[0m16:29:53.253462 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:29:53.253909 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11190b040>]}
[0m16:29:53.254429 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 0.83s]
[0m16:29:53.255690 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:29:53.274872 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.031 seconds
[0m16:29:53.275944 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:29:53.276400 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ff7f40>]}
[0m16:29:53.276796 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.85s]
[0m16:29:53.277246 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:29:53.277986 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m16:29:53.278446 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m16:29:53.278796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m16:29:53.279018 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m16:29:53.279334 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m16:29:53.281650 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m16:29:53.281902 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m16:29:53.282218 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m16:29:53.282621 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m16:29:53.283089 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m16:29:53.283607 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m16:29:53.283896 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m16:29:53.284495 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m16:29:53.284848 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m16:29:53.288406 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m16:29:53.288854 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m16:29:53.289195 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m16:29:53.289449 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:29:53.292385 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m16:29:53.292773 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m16:29:53.295115 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:29:53.295456 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:29:53.297650 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:29:53.298089 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m16:29:53.298389 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m16:29:53.298711 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m16:29:53.301322 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m16:29:53.301675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:53.304220 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:29:53.304506 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m16:29:53.305063 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:29:53.308113 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:29:53.308529 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m16:29:53.308832 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:29:53.309143 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:29:53.309443 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:29:53.309726 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:29:53.310031 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:29:53.310248 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:29:53.310630 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:29:53.357489 [debug] [Thread-1 (]: SQL status: BEGIN in 0.056 seconds
[0m16:29:53.357878 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:29:53.358142 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct business_name, business_address from combined_business_addresses
  );
  
[0m16:29:53.366241 [debug] [Thread-3 (]: SQL status: BEGIN in 0.056 seconds
[0m16:29:53.366576 [debug] [Thread-2 (]: SQL status: BEGIN in 0.056 seconds
[0m16:29:53.366906 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:29:53.367131 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:29:53.367371 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:29:53.367684 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:29:53.372464 [debug] [Thread-4 (]: SQL status: BEGIN in 0.063 seconds
[0m16:29:53.372870 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:29:53.373239 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m16:29:53.631260 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.263 seconds
[0m16:29:53.633615 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:29:53.633871 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m16:29:53.638477 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:29:53.640388 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:29:53.640621 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:29:53.642491 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:29:53.643457 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:29:53.643676 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:29:53.643870 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:29:53.648458 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m16:29:53.650044 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:29:53.650508 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:29:53.650713 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:29:53.664466 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:29:53.665371 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m16:29:53.665775 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111973cd0>]}
[0m16:29:53.666165 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.38s]
[0m16:29:53.666699 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m16:29:53.703205 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.335 seconds
[0m16:29:53.705646 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:29:53.705913 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m16:29:53.708772 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:53.710710 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:29:53.710990 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m16:29:53.712520 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:29:53.713516 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:29:53.713750 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:29:53.713949 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:29:53.720486 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m16:29:53.722032 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m16:29:53.722483 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:29:53.722686 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m16:29:53.734724 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.376 seconds
[0m16:29:53.737602 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:29:53.737840 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.015 seconds
[0m16:29:53.738103 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses" rename to "business_addresses__dbt_backup"
[0m16:29:53.738825 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m16:29:53.739255 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a24d00>]}
[0m16:29:53.739664 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.45s]
[0m16:29:53.739984 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m16:29:53.740299 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m16:29:53.740551 [info ] [Thread-3 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m16:29:53.740795 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m16:29:53.740994 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.addresses
[0m16:29:53.742703 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m16:29:53.742924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:29:53.744807 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:29:53.745034 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m16:29:53.745381 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.addresses
[0m16:29:53.747954 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m16:29:53.748259 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:53.749442 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:29:53.749801 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:29:53.750087 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:29:53.750380 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:29:53.750642 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: BEGIN
[0m16:29:53.750837 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:29:53.754236 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m16:29:53.756085 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m16:29:53.756584 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:29:53.756801 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m16:29:53.770876 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:29:53.771870 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m16:29:53.772280 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f6fb80>]}
[0m16:29:53.772702 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 11450[0m in 0.49s]
[0m16:29:53.773044 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m16:29:53.802476 [debug] [Thread-3 (]: SQL status: BEGIN in 0.052 seconds
[0m16:29:53.802878 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:29:53.803103 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m16:29:53.898767 [debug] [Thread-3 (]: SQL status: SELECT 4945 in 0.095 seconds
[0m16:29:53.901067 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:29:53.901348 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m16:29:53.907314 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m16:29:53.909049 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:29:53.909278 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m16:29:53.910870 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:29:53.911825 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:29:53.912042 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:29:53.912231 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:29:53.916067 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m16:29:53.918302 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m16:29:53.918755 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:29:53.918957 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m16:29:53.931035 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m16:29:53.931927 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: Close
[0m16:29:53.932333 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a62920>]}
[0m16:29:53.932735 [info ] [Thread-3 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.19s]
[0m16:29:53.933070 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m16:29:55.067690 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.694 seconds
[0m16:29:55.109962 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:29:55.110392 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m16:29:55.115033 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:29:55.117101 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:29:55.117360 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m16:29:55.119069 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:29:55.120095 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:29:55.120336 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:29:55.120556 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:29:55.127858 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m16:29:55.129482 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m16:29:55.129963 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:29:55.130182 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m16:29:55.156325 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.026 seconds
[0m16:29:55.157253 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m16:29:55.157628 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111983b20>]}
[0m16:29:55.158025 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 1.87s]
[0m16:29:55.158350 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m16:29:55.158801 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m16:29:55.159173 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m16:29:55.159532 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m16:29:55.159971 [info ] [Thread-1 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m16:29:55.160334 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m16:29:55.160659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.business_with_full_timeline)
[0m16:29:55.160930 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m16:29:55.161150 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m16:29:55.163097 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m16:29:55.164919 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.165815 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_tenures
[0m16:29:55.168328 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m16:29:55.168653 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m16:29:55.180853 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.181377 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:29:55.181712 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m16:29:55.181928 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:29:55.182447 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.182740 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m16:29:55.182962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:55.235628 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m16:29:55.236019 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:29:55.236254 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select * from business_tenures
  );
  
[0m16:29:55.237948 [debug] [Thread-1 (]: SQL status: BEGIN in 0.055 seconds
[0m16:29:55.238271 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.238514 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m16:29:55.284776 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.046 seconds
[0m16:29:55.287065 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.287305 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m16:29:55.292186 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:29:55.293291 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:29:55.293611 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.293818 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:29:55.297483 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:29:55.299097 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m16:29:55.300622 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:29:55.300850 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m16:29:55.302503 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:29:55.303304 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m16:29:55.303677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f738b0>]}
[0m16:29:55.304062 [info ] [Thread-1 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.14s]
[0m16:29:55.304454 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m16:29:55.495775 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.259 seconds
[0m16:29:55.498194 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:29:55.498457 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures" rename to "business_tenures__dbt_backup"
[0m16:29:55.502105 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:29:55.504271 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:29:55.504556 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m16:29:55.506852 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:29:55.507969 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m16:29:55.508221 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:29:55.508417 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m16:29:55.513475 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m16:29:55.515030 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m16:29:55.515473 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:29:55.515673 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m16:29:55.528562 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.013 seconds
[0m16:29:55.529552 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: Close
[0m16:29:55.529944 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287ddd41-ac32-45ce-bb9a-16a10e86d819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11097eda0>]}
[0m16:29:55.530334 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.37s]
[0m16:29:55.530652 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m16:29:55.531443 [debug] [MainThread]: Using postgres connection "master"
[0m16:29:55.531669 [debug] [MainThread]: On master: BEGIN
[0m16:29:55.531843 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:29:55.587513 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m16:29:55.587892 [debug] [MainThread]: On master: COMMIT
[0m16:29:55.588080 [debug] [MainThread]: Using postgres connection "master"
[0m16:29:55.588245 [debug] [MainThread]: On master: COMMIT
[0m16:29:55.589092 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:29:55.589282 [debug] [MainThread]: On master: Close
[0m16:29:55.589547 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:29:55.589716 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m16:29:55.589871 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m16:29:55.590018 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m16:29:55.590321 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m16:29:55.590645 [info ] [MainThread]: 
[0m16:29:55.590853 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 4.17 seconds (4.17s).
[0m16:29:55.591923 [debug] [MainThread]: Command end result
[0m16:29:55.607711 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:29:55.609077 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:29:55.614760 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:29:55.615105 [info ] [MainThread]: 
[0m16:29:55.615448 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:29:55.615657 [info ] [MainThread]: 
[0m16:29:55.615863 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m16:29:55.618413 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.884598, "process_in_blocks": "0", "process_kernel_time": 0.249234, "process_mem_max_rss": "142999552", "process_out_blocks": "0", "process_user_time": 1.738943}
[0m16:29:55.618792 [debug] [MainThread]: Command `dbt run` succeeded at 16:29:55.618743 after 4.89 seconds
[0m16:29:55.619030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10569e8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059aec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e8e980>]}
[0m16:29:55.619268 [debug] [MainThread]: Flushing usage events
[0m16:29:56.238567 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:36:00.691933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075de8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c55450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c54d30>]}


============================== 16:36:00.694976 | 9dee0b56-2e1a-448a-a899-c4dfbe1d0d71 ==============================
[0m16:36:00.694976 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:36:00.695337 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_cache_events': 'False', 'empty': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_colors': 'True', 'static_parser': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'partial_parse': 'True', 'version_check': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'target_path': 'None', 'log_format': 'default', 'debug': 'False'}
[0m16:36:00.868171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10640dba0>]}
[0m16:36:00.911630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d24490>]}
[0m16:36:00.912440 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:36:00.980351 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:36:01.057909 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:36:01.058230 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:36:01.061813 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m16:36:01.081104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109978130>]}
[0m16:36:01.160181 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:36:01.161761 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:36:01.174247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098fbfa0>]}
[0m16:36:01.174594 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m16:36:01.174815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10999e770>]}
[0m16:36:01.175886 [info ] [MainThread]: 
[0m16:36:01.176093 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:36:01.176263 [info ] [MainThread]: 
[0m16:36:01.176553 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:36:01.179189 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:36:01.212800 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:36:01.213138 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:36:01.213323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:36:01.328852 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.115 seconds
[0m16:36:01.329903 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:36:01.331185 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:36:01.334913 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:36:01.335155 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:36:01.335327 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:36:01.388690 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m16:36:01.389033 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:36:01.389240 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:36:01.455627 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.066 seconds
[0m16:36:01.456540 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:36:01.458018 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:36:01.462264 [debug] [MainThread]: Using postgres connection "master"
[0m16:36:01.462542 [debug] [MainThread]: On master: BEGIN
[0m16:36:01.462719 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:36:01.513839 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m16:36:01.514184 [debug] [MainThread]: Using postgres connection "master"
[0m16:36:01.514430 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:36:01.954500 [debug] [MainThread]: SQL status: SELECT 1 in 0.439 seconds
[0m16:36:01.958780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10990c2e0>]}
[0m16:36:01.959149 [debug] [MainThread]: On master: ROLLBACK
[0m16:36:01.961004 [debug] [MainThread]: Using postgres connection "master"
[0m16:36:01.962105 [debug] [MainThread]: On master: BEGIN
[0m16:36:01.964246 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:36:01.965038 [debug] [MainThread]: On master: COMMIT
[0m16:36:01.965675 [debug] [MainThread]: Using postgres connection "master"
[0m16:36:01.966249 [debug] [MainThread]: On master: COMMIT
[0m16:36:01.967348 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:36:01.967565 [debug] [MainThread]: On master: Close
[0m16:36:01.969427 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m16:36:01.969790 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m16:36:01.970114 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m16:36:01.970531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m16:36:01.970862 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m16:36:01.971158 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m16:36:01.971481 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m16:36:01.976202 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m16:36:01.976602 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m16:36:01.978781 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m16:36:01.979351 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m16:36:01.986059 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m16:36:02.003390 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m16:36:02.006027 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m16:36:02.006855 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:36:02.007145 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:36:02.007391 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m16:36:02.007608 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m16:36:02.007814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:02.008015 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:36:02.062292 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m16:36:02.062660 [debug] [Thread-1 (]: SQL status: BEGIN in 0.055 seconds
[0m16:36:02.063040 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:36:02.063330 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:36:02.063562 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m16:36:02.063808 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m16:36:02.121427 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.057 seconds
[0m16:36:02.127248 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:36:02.127529 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m16:36:02.130565 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:02.132396 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:36:02.132630 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m16:36:02.137972 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:36:02.146466 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:36:02.146770 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.083 seconds
[0m16:36:02.147075 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:36:02.149115 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:36:02.149368 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m16:36:02.149610 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m16:36:02.152770 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:02.154605 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:36:02.154829 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m16:36:02.155068 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m16:36:02.159296 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m16:36:02.161735 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m16:36:02.162005 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:02.162227 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m16:36:02.163137 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:36:02.163391 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:36:02.163605 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m16:36:02.166327 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:36:02.167811 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m16:36:02.168244 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m16:36:02.168445 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m16:36:02.174043 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.011 seconds
[0m16:36:02.175639 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m16:36:02.176918 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10640d390>]}
[0m16:36:02.177339 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.20s]
[0m16:36:02.177906 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m16:36:02.178517 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m16:36:02.178882 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:36:02.179131 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m16:36:02.179471 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m16:36:02.179769 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m16:36:02.180155 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m16:36:02.181109 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m16:36:02.181465 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m16:36:02.181815 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m16:36:02.182104 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m16:36:02.182391 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m16:36:02.182811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109df2980>]}
[0m16:36:02.183203 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m16:36:02.183598 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m16:36:02.183839 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m16:36:02.184523 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.21s]
[0m16:36:02.187084 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.189474 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.191950 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.192373 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m16:36:02.192999 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m16:36:02.193362 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m16:36:02.193749 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m16:36:02.196288 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.196571 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m16:36:02.196939 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m16:36:02.200422 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.203246 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.203633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m16:36:02.204081 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.204455 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.204758 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m16:36:02.204989 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.205278 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m16:36:02.205585 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m16:36:02.207863 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.208267 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m16:36:02.208585 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:36:02.208808 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:36:02.209128 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:36:02.209682 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m16:36:02.212231 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.212702 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.212916 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m16:36:02.213107 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:02.268692 [debug] [Thread-2 (]: SQL status: BEGIN in 0.060 seconds
[0m16:36:02.269085 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.269363 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:36:02.270783 [debug] [Thread-3 (]: SQL status: BEGIN in 0.062 seconds
[0m16:36:02.271124 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.271380 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:36:02.271705 [debug] [Thread-4 (]: SQL status: BEGIN in 0.063 seconds
[0m16:36:02.272017 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.272282 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:36:02.278521 [debug] [Thread-1 (]: SQL status: BEGIN in 0.065 seconds
[0m16:36:02.278824 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.279075 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m16:36:02.384338 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.105 seconds
[0m16:36:02.386789 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.387043 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m16:36:02.390044 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:02.391707 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.391929 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m16:36:02.393843 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:02.394868 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:36:02.395102 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.395299 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m16:36:02.401363 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m16:36:02.402923 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m16:36:02.403397 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m16:36:02.403608 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m16:36:02.409288 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.137 seconds
[0m16:36:02.412001 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.412231 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m16:36:02.416159 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:36:02.417946 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.418208 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:36:02.418508 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m16:36:02.419343 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m16:36:02.419815 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109df3400>]}
[0m16:36:02.420201 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.22s]
[0m16:36:02.420528 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m16:36:02.421695 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:02.422625 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:36:02.422845 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.423039 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m16:36:02.426482 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m16:36:02.428117 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m16:36:02.428656 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m16:36:02.428868 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m16:36:02.444138 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.015 seconds
[0m16:36:02.445091 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m16:36:02.445481 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e286d0>]}
[0m16:36:02.445876 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.26s]
[0m16:36:02.446208 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m16:36:02.878625 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.606 seconds
[0m16:36:02.883555 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.883865 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m16:36:02.887028 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:02.888839 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.889064 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m16:36:02.892090 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:02.893033 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:36:02.893255 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.893443 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m16:36:02.903573 [debug] [Thread-3 (]: SQL status: COMMIT in 0.010 seconds
[0m16:36:02.908489 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m16:36:02.909076 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m16:36:02.909292 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m16:36:02.909534 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.640 seconds
[0m16:36:02.911393 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.911603 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m16:36:02.914790 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:02.917364 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.917611 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m16:36:02.919474 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:02.920493 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:36:02.920739 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.920945 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m16:36:02.923887 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m16:36:02.925523 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m16:36:02.926004 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m16:36:02.926234 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m16:36:02.929940 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.020 seconds
[0m16:36:02.930731 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m16:36:02.931108 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108beac20>]}
[0m16:36:02.931487 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 0.75s]
[0m16:36:02.931810 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m16:36:02.944122 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.017 seconds
[0m16:36:02.947934 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m16:36:02.948606 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10990c2e0>]}
[0m16:36:02.949242 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.77s]
[0m16:36:02.949621 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m16:36:02.950246 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m16:36:02.950595 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m16:36:02.950868 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m16:36:02.951169 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m16:36:02.951472 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m16:36:02.951739 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m16:36:02.951969 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m16:36:02.952211 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m16:36:02.952423 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m16:36:02.952618 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m16:36:02.953004 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m16:36:02.953362 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m16:36:02.953580 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m16:36:02.953775 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m16:36:02.954086 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m16:36:02.956644 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m16:36:02.959404 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m16:36:02.965506 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m16:36:02.966009 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m16:36:02.966645 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m16:36:02.968837 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m16:36:02.969071 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m16:36:02.972246 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m16:36:02.972499 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m16:36:02.975141 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m16:36:02.977809 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m16:36:02.978132 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m16:36:02.978606 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:36:02.980936 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m16:36:02.981258 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m16:36:02.981584 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:36:02.981879 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:36:02.982193 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:36:02.982422 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m16:36:02.982639 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m16:36:02.983010 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:36:02.983224 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:36:02.983488 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:02.983773 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m16:36:02.984317 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:36:03.039877 [debug] [Thread-4 (]: SQL status: BEGIN in 0.058 seconds
[0m16:36:03.040262 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:36:03.040494 [debug] [Thread-3 (]: SQL status: BEGIN in 0.057 seconds
[0m16:36:03.040835 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m16:36:03.041146 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:36:03.041444 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m16:36:03.041941 [debug] [Thread-1 (]: SQL status: BEGIN in 0.058 seconds
[0m16:36:03.042153 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:36:03.042393 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct business_name, business_address from combined_business_addresses
  );
  
[0m16:36:03.042864 [debug] [Thread-2 (]: SQL status: BEGIN in 0.059 seconds
[0m16:36:03.043114 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:36:03.043362 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m16:36:03.335556 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.293 seconds
[0m16:36:03.341566 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:36:03.341865 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m16:36:03.346255 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:36:03.348181 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:36:03.348453 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m16:36:03.350555 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:03.351569 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:36:03.352235 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:36:03.352925 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m16:36:03.356269 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m16:36:03.357831 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m16:36:03.358402 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m16:36:03.358695 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m16:36:03.373054 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:36:03.376466 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m16:36:03.377548 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e29ea0>]}
[0m16:36:03.378018 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.42s]
[0m16:36:03.378405 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m16:36:03.420763 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.377 seconds
[0m16:36:03.425476 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:36:03.425982 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m16:36:03.431073 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:36:03.433403 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:36:03.433674 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m16:36:03.436639 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:03.437771 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:36:03.438012 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:36:03.438210 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m16:36:03.445950 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m16:36:03.447608 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m16:36:03.448149 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m16:36:03.448390 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m16:36:03.455025 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.412 seconds
[0m16:36:03.457558 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:36:03.457867 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses" rename to "business_addresses__dbt_backup"
[0m16:36:03.461102 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m16:36:03.461361 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:03.462191 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m16:36:03.463946 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:36:03.464225 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m16:36:03.464693 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ef7fa0>]}
[0m16:36:03.465307 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.51s]
[0m16:36:03.465737 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m16:36:03.466064 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m16:36:03.466507 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:03.466331 [info ] [Thread-3 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m16:36:03.467614 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:36:03.468015 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m16:36:03.468375 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:36:03.468682 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.addresses
[0m16:36:03.468978 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:36:03.470781 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m16:36:03.471415 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.addresses
[0m16:36:03.475272 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m16:36:03.475908 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:36:03.476359 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m16:36:03.476710 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: BEGIN
[0m16:36:03.478390 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m16:36:03.478687 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:36:03.479271 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:36:03.479594 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m16:36:03.493935 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:36:03.494932 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m16:36:03.495424 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc56c0>]}
[0m16:36:03.495945 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 11450[0m in 0.54s]
[0m16:36:03.496280 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m16:36:03.534103 [debug] [Thread-3 (]: SQL status: BEGIN in 0.055 seconds
[0m16:36:03.534470 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:36:03.534695 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m16:36:03.633686 [debug] [Thread-3 (]: SQL status: SELECT 4945 in 0.098 seconds
[0m16:36:03.638333 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:36:03.638612 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m16:36:03.641119 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:36:03.642895 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:36:03.643132 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m16:36:03.644750 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:36:03.645801 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:36:03.646039 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:36:03.646234 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m16:36:03.650897 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m16:36:03.652312 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m16:36:03.652756 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m16:36:03.652965 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m16:36:03.663829 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.010 seconds
[0m16:36:03.666431 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: Close
[0m16:36:03.667523 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ba7010>]}
[0m16:36:03.668538 [info ] [Thread-3 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.20s]
[0m16:36:03.669043 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m16:36:04.760964 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.719 seconds
[0m16:36:04.770135 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:36:04.770809 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m16:36:04.774462 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:04.776468 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:36:04.776712 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m16:36:04.779625 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:04.780559 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:36:04.780793 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:36:04.781043 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m16:36:04.788744 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m16:36:04.790287 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m16:36:04.790765 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m16:36:04.790978 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m16:36:04.814319 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.023 seconds
[0m16:36:04.817714 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m16:36:04.818193 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0274f0>]}
[0m16:36:04.818615 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 1.87s]
[0m16:36:04.818961 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m16:36:04.819580 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m16:36:04.819922 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m16:36:04.820263 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m16:36:04.820572 [info ] [Thread-1 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m16:36:04.820943 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m16:36:04.821192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.business_with_full_timeline)
[0m16:36:04.821416 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m16:36:04.821670 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m16:36:04.823669 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m16:36:04.825783 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.826692 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m16:36:04.833323 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_tenures
[0m16:36:04.838312 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.840886 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m16:36:04.841510 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:36:04.841747 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m16:36:04.841948 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:36:04.842182 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.842495 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m16:36:04.842686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:04.894176 [debug] [Thread-2 (]: SQL status: BEGIN in 0.052 seconds
[0m16:36:04.894497 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m16:36:04.894777 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:36:04.895030 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.895285 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select * from business_tenures
  );
  
[0m16:36:04.895551 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m16:36:04.937441 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.042 seconds
[0m16:36:04.939599 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.939905 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m16:36:04.944532 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:36:04.945568 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:36:04.945823 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.946026 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m16:36:04.949075 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:36:04.950552 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m16:36:04.952009 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m16:36:04.952229 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m16:36:04.953741 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:36:04.954462 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m16:36:04.954823 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f03cd0>]}
[0m16:36:04.955205 [info ] [Thread-1 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.13s]
[0m16:36:04.955527 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m16:36:05.140899 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.245 seconds
[0m16:36:05.144158 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:36:05.144433 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures" rename to "business_tenures__dbt_backup"
[0m16:36:05.147189 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:36:05.148930 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:36:05.149160 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m16:36:05.150718 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:36:05.151703 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m16:36:05.151920 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:36:05.152140 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m16:36:05.157682 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m16:36:05.159227 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m16:36:05.159707 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m16:36:05.159964 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m16:36:05.170843 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.011 seconds
[0m16:36:05.171760 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: Close
[0m16:36:05.172152 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dee0b56-2e1a-448a-a899-c4dfbe1d0d71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fd3af0>]}
[0m16:36:05.172545 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.35s]
[0m16:36:05.172867 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m16:36:05.173617 [debug] [MainThread]: Using postgres connection "master"
[0m16:36:05.173826 [debug] [MainThread]: On master: BEGIN
[0m16:36:05.173998 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:36:05.225092 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m16:36:05.225447 [debug] [MainThread]: On master: COMMIT
[0m16:36:05.225641 [debug] [MainThread]: Using postgres connection "master"
[0m16:36:05.226007 [debug] [MainThread]: On master: COMMIT
[0m16:36:05.226976 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:36:05.227239 [debug] [MainThread]: On master: Close
[0m16:36:05.227520 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:36:05.227696 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m16:36:05.227855 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m16:36:05.228003 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m16:36:05.228141 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m16:36:05.228368 [info ] [MainThread]: 
[0m16:36:05.228559 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 4.05 seconds (4.05s).
[0m16:36:05.229627 [debug] [MainThread]: Command end result
[0m16:36:05.244958 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:36:05.246236 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:36:05.250711 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:36:05.251010 [info ] [MainThread]: 
[0m16:36:05.251303 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:36:05.251545 [info ] [MainThread]: 
[0m16:36:05.251779 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m16:36:05.254495 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6111712, "process_in_blocks": "0", "process_kernel_time": 0.239736, "process_mem_max_rss": "138395648", "process_out_blocks": "0", "process_user_time": 1.609376}
[0m16:36:05.255274 [debug] [MainThread]: Command `dbt run` succeeded at 16:36:05.255107 after 4.61 seconds
[0m16:36:05.255607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075de8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078ef880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107013b80>]}
[0m16:36:05.255871 [debug] [MainThread]: Flushing usage events
[0m16:36:05.881886 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:31:46.046766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2c0c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2c0550>]}


============================== 16:31:46.050260 | 88c799bd-61c0-4c2b-bdf9-8ff11883c651 ==============================
[0m16:31:46.050260 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:31:46.050635 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'no_print': 'None', 'write_json': 'True', 'use_colors': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'printer_width': '80', 'debug': 'False', 'invocation_command': 'dbt run -m business_addresses', 'empty': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'partial_parse': 'True', 'target_path': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'version_check': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True'}
[0m16:31:46.050956 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:31:46.051179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d30730>]}
[0m16:31:46.423162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6d9fc0>]}
[0m16:31:46.468488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10932a740>]}
[0m16:31:46.469425 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:31:46.571976 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:31:46.654182 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:31:46.654602 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m16:31:46.907706 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m16:31:46.924526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c330bb0>]}
[0m16:31:46.971368 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:31:46.973125 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:31:46.987043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0b4130>]}
[0m16:31:46.987372 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m16:31:46.987581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0b91b0>]}
[0m16:31:46.988431 [info ] [MainThread]: 
[0m16:31:46.988655 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:31:46.988828 [info ] [MainThread]: 
[0m16:31:46.989119 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:31:46.989590 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:31:47.036615 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:31:47.037051 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:31:47.037230 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:31:47.194144 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.157 seconds
[0m16:31:47.195168 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:31:47.198622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:31:47.202525 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:31:47.202874 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:31:47.203052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:31:47.268247 [debug] [ThreadPool]: SQL status: BEGIN in 0.065 seconds
[0m16:31:47.268603 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:31:47.268819 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:31:47.346841 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.078 seconds
[0m16:31:47.347905 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:31:47.350422 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:31:47.354600 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:47.354861 [debug] [MainThread]: On master: BEGIN
[0m16:31:47.355030 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:31:47.420375 [debug] [MainThread]: SQL status: BEGIN in 0.065 seconds
[0m16:31:47.420907 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:47.421280 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:31:47.890607 [debug] [MainThread]: SQL status: SELECT 1 in 0.469 seconds
[0m16:31:47.893642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ebd9f0>]}
[0m16:31:47.894033 [debug] [MainThread]: On master: ROLLBACK
[0m16:31:47.895657 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:47.895860 [debug] [MainThread]: On master: BEGIN
[0m16:31:47.897496 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:31:47.897696 [debug] [MainThread]: On master: COMMIT
[0m16:31:47.897865 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:47.898024 [debug] [MainThread]: On master: COMMIT
[0m16:31:47.898929 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:31:47.899109 [debug] [MainThread]: On master: Close
[0m16:31:47.901620 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m16:31:47.901970 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_addresses ............ [RUN]
[0m16:31:47.902327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_addresses)
[0m16:31:47.902543 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m16:31:47.907762 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m16:31:47.908671 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m16:31:47.930943 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m16:31:47.931836 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:31:47.932174 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m16:31:47.932477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:31:47.983878 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m16:31:47.984258 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:31:47.984518 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct 
    business_name, business_address,
    split_part(business_address, ',', -1) as postcode
from combined_business_addresses
  );
  
[0m16:31:48.597125 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.612 seconds
[0m16:31:48.608352 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:31:48.608646 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses" rename to "business_addresses__dbt_backup"
[0m16:31:48.613776 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:31:48.615600 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:31:48.615818 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m16:31:48.619210 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:31:48.629705 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:31:48.630037 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:31:48.630278 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m16:31:48.648148 [debug] [Thread-1 (]: SQL status: COMMIT in 0.018 seconds
[0m16:31:48.652155 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m16:31:48.657087 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m16:31:48.657585 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m16:31:48.687459 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.029 seconds
[0m16:31:48.689239 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m16:31:48.690538 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88c799bd-61c0-4c2b-bdf9-8ff11883c651', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c77a740>]}
[0m16:31:48.691070 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_addresses ....... [[32mSELECT 11450[0m in 0.79s]
[0m16:31:48.691412 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m16:31:48.692210 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:48.692421 [debug] [MainThread]: On master: BEGIN
[0m16:31:48.692591 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:31:48.744731 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m16:31:48.745071 [debug] [MainThread]: On master: COMMIT
[0m16:31:48.745260 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:48.745424 [debug] [MainThread]: On master: COMMIT
[0m16:31:48.746283 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:31:48.746503 [debug] [MainThread]: On master: Close
[0m16:31:48.746776 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:31:48.746947 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_addresses' was properly closed.
[0m16:31:48.747135 [info ] [MainThread]: 
[0m16:31:48.747323 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.76 seconds (1.76s).
[0m16:31:48.747706 [debug] [MainThread]: Command end result
[0m16:31:48.764035 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:31:48.765246 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:31:48.769481 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:31:48.769835 [info ] [MainThread]: 
[0m16:31:48.770197 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:31:48.770392 [info ] [MainThread]: 
[0m16:31:48.770585 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:31:48.770884 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:31:48.803753 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.8148162, "process_in_blocks": "0", "process_kernel_time": 0.280709, "process_mem_max_rss": "138248192", "process_out_blocks": "0", "process_user_time": 1.470576}
[0m16:31:48.804252 [debug] [MainThread]: Command `dbt run` succeeded at 16:31:48.804198 after 2.82 seconds
[0m16:31:48.804517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109394400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10932a740>]}
[0m16:31:48.804746 [debug] [MainThread]: Flushing usage events
[0m16:31:49.385729 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:25:53.975724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bea950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109261510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109260df0>]}


============================== 14:25:53.979043 | 8194a3d7-cc97-4786-83d8-9b6a1312c24c ==============================
[0m14:25:53.979043 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:25:53.979412 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'warn_error': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'version_check': 'True', 'invocation_command': 'dbt run', 'use_colors': 'True', 'no_print': 'None', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'log_format': 'default', 'quiet': 'False', 'introspect': 'True', 'partial_parse': 'True', 'log_cache_events': 'False'}
[0m14:25:54.245924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a546a0>]}
[0m14:25:54.287211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092606a0>]}
[0m14:25:54.287985 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:25:54.406927 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:25:54.485367 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:25:54.485812 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m14:25:54.486034 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_tenures.sql
[0m14:25:54.679063 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m14:25:54.687388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fad180>]}
[0m14:25:54.733604 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:25:54.735233 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:25:54.749348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0496f0>]}
[0m14:25:54.749726 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m14:25:54.749980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a049480>]}
[0m14:25:54.751212 [info ] [MainThread]: 
[0m14:25:54.751504 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:25:54.751677 [info ] [MainThread]: 
[0m14:25:54.751956 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:25:54.754607 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:25:54.799094 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:25:54.799425 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:25:54.799606 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:54.922818 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.123 seconds
[0m14:25:54.923712 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:25:54.924936 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:25:54.928376 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:25:54.928606 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:25:54.928778 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:25:54.981236 [debug] [ThreadPool]: SQL status: BEGIN in 0.052 seconds
[0m14:25:54.981597 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:25:54.981797 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:25:55.050454 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.068 seconds
[0m14:25:55.051691 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:25:55.058922 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:25:55.063701 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:55.063997 [debug] [MainThread]: On master: BEGIN
[0m14:25:55.064171 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:25:55.124039 [debug] [MainThread]: SQL status: BEGIN in 0.060 seconds
[0m14:25:55.125093 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:55.127329 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:25:55.573202 [debug] [MainThread]: SQL status: SELECT 1 in 0.445 seconds
[0m14:25:55.579161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a067d90>]}
[0m14:25:55.580140 [debug] [MainThread]: On master: ROLLBACK
[0m14:25:55.582261 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:55.582459 [debug] [MainThread]: On master: BEGIN
[0m14:25:55.583829 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:25:55.584044 [debug] [MainThread]: On master: COMMIT
[0m14:25:55.584219 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:55.584383 [debug] [MainThread]: On master: COMMIT
[0m14:25:55.585228 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:25:55.585422 [debug] [MainThread]: On master: Close
[0m14:25:55.588135 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m14:25:55.588414 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:25:55.588738 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m14:25:55.589418 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m14:25:55.589146 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m14:25:55.589707 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m14:25:55.589993 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:25:55.594595 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m14:25:55.594855 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:25:55.596969 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:25:55.597528 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m14:25:55.604431 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:25:55.620574 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m14:25:55.624073 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:25:55.625249 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:25:55.625522 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:25:55.625746 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:25:55.625949 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m14:25:55.626142 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:25:55.626330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:55.680816 [debug] [Thread-2 (]: SQL status: BEGIN in 0.055 seconds
[0m14:25:55.681140 [debug] [Thread-1 (]: SQL status: BEGIN in 0.055 seconds
[0m14:25:55.681432 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:25:55.681650 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:25:55.681876 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:25:55.682119 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m14:25:55.748123 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.066 seconds
[0m14:25:55.753847 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:25:55.754138 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:25:55.758836 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:25:55.760862 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:25:55.761136 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:25:55.764408 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:55.773773 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:25:55.774115 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.092 seconds
[0m14:25:55.774459 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:25:55.776840 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:25:55.777120 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:25:55.777356 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m14:25:55.781013 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:55.783630 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:25:55.783900 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m14:25:55.786474 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:55.786705 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m14:25:55.787726 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:25:55.791285 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:25:55.791571 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:25:55.794041 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:25:55.794348 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:25:55.794613 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:25:55.798134 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m14:25:55.799788 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m14:25:55.800261 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:25:55.800544 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m14:25:55.817647 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.017 seconds
[0m14:25:55.817994 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.023 seconds
[0m14:25:55.819560 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m14:25:55.820300 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:25:55.822154 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109330310>]}
[0m14:25:55.822372 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f05030>]}
[0m14:25:55.822788 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.23s]
[0m14:25:55.823161 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.23s]
[0m14:25:55.823736 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:25:55.824114 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m14:25:55.824571 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:25:55.824814 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:25:55.825022 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:25:55.825240 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:25:55.825547 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m14:25:55.825925 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m14:25:55.826301 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m14:25:55.826659 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m14:25:55.827087 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m14:25:55.827390 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:25:55.827635 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m14:25:55.827862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m14:25:55.828081 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:25:55.828360 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:25:55.828635 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:25:55.828915 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:25:55.831676 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:55.833931 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:55.835843 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:55.837569 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:25:55.838195 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:25:55.838492 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:25:55.838766 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:25:55.842051 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:55.844412 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:55.847065 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:55.847478 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:25:55.848036 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:55.850456 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:25:55.850761 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:55.851051 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:25:55.851334 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:55.851563 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:25:55.851789 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:25:55.852019 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:25:55.852243 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:25:55.852474 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:25:55.852767 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:25:55.852966 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:25:55.853253 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:55.912080 [debug] [Thread-1 (]: SQL status: BEGIN in 0.059 seconds
[0m14:25:55.912451 [debug] [Thread-2 (]: SQL status: BEGIN in 0.059 seconds
[0m14:25:55.912753 [debug] [Thread-3 (]: SQL status: BEGIN in 0.061 seconds
[0m14:25:55.912985 [debug] [Thread-4 (]: SQL status: BEGIN in 0.060 seconds
[0m14:25:55.913254 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:25:55.913465 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:55.913668 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:55.913872 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:55.914101 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:25:55.914366 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:25:55.914629 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:25:55.914883 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:25:56.120811 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.204 seconds
[0m14:25:56.127469 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:25:56.127879 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:25:56.142422 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.014 seconds
[0m14:25:56.147285 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:25:56.147648 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:25:56.149870 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:56.152351 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:25:56.152648 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:25:56.152858 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:25:56.174606 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.259 seconds
[0m14:25:56.181507 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:56.181840 [debug] [Thread-1 (]: SQL status: COMMIT in 0.029 seconds
[0m14:25:56.182202 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:25:56.183942 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:25:56.184598 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:25:56.184863 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:25:56.187838 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:25:56.189912 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:56.190183 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:25:56.192072 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:56.193238 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:25:56.193491 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:56.193695 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:25:56.216903 [debug] [Thread-4 (]: SQL status: COMMIT in 0.023 seconds
[0m14:25:56.221434 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:25:56.222014 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:25:56.222241 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:25:56.231137 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.046 seconds
[0m14:25:56.233733 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:25:56.234703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a3f280>]}
[0m14:25:56.235206 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.41s]
[0m14:25:56.235556 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:25:56.251187 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.029 seconds
[0m14:25:56.252241 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:25:56.252982 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f05030>]}
[0m14:25:56.253594 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.43s]
[0m14:25:56.254247 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:25:56.999274 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 1.083 seconds
[0m14:25:57.007481 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:57.007879 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:25:57.016268 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m14:25:57.019211 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:57.019538 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:25:57.023296 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:57.024865 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:25:57.025162 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:57.025387 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:25:57.056399 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 1.141 seconds
[0m14:25:57.059749 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:57.059995 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:25:57.063933 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:25:57.066004 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:57.066256 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:25:57.068033 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:57.069005 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:25:57.069225 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:57.069422 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:25:57.087834 [debug] [Thread-3 (]: SQL status: COMMIT in 0.062 seconds
[0m14:25:57.089630 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:25:57.090128 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:25:57.090428 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:25:57.091715 [debug] [Thread-2 (]: SQL status: COMMIT in 0.022 seconds
[0m14:25:57.093375 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:25:57.093864 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:25:57.094083 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:25:57.148976 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.058 seconds
[0m14:25:57.150025 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:25:57.150597 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b33a410>]}
[0m14:25:57.151115 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 1.32s]
[0m14:25:57.151443 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:25:57.153597 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.059 seconds
[0m14:25:57.154382 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:25:57.154706 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b468cd0>]}
[0m14:25:57.155028 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 1.33s]
[0m14:25:57.155316 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:25:57.155806 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m14:25:57.156146 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m14:25:57.156372 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m14:25:57.156677 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m14:25:57.157012 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m14:25:57.157444 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m14:25:57.157852 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m14:25:57.158207 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m14:25:57.158589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m14:25:57.158895 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m14:25:57.159293 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m14:25:57.159634 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m14:25:57.159930 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m14:25:57.160227 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m14:25:57.160515 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m14:25:57.160781 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m14:25:57.163438 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m14:25:57.166360 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m14:25:57.169278 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m14:25:57.171394 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m14:25:57.172278 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m14:25:57.172626 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m14:25:57.175742 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m14:25:57.176165 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m14:25:57.178427 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m14:25:57.178817 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m14:25:57.181487 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m14:25:57.183911 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m14:25:57.184253 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:25:57.184796 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:25:57.185098 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m14:25:57.185336 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:25:57.185592 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:25:57.185791 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m14:25:57.186031 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:57.186256 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m14:25:57.186463 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m14:25:57.186659 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:25:57.186944 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:25:57.187141 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:25:57.243953 [debug] [Thread-1 (]: SQL status: BEGIN in 0.058 seconds
[0m14:25:57.244330 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:25:57.244597 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct 
    business_name, business_address,
    split_part(business_address, ',', -1) as postcode,
from combined_business_addresses
  );
  
[0m14:25:57.245226 [debug] [Thread-4 (]: SQL status: BEGIN in 0.059 seconds
[0m14:25:57.245444 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:25:57.245725 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m14:25:57.246149 [debug] [Thread-2 (]: SQL status: BEGIN in 0.059 seconds
[0m14:25:57.246411 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:25:57.246674 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m14:25:57.249104 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "from"
LINE 48: from combined_business_addresses
         ^

[0m14:25:57.249434 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: ROLLBACK
[0m14:25:57.250507 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m14:25:57.254877 [debug] [Thread-1 (]: Database Error in model business_addresses (models/2_int/business_addresses.sql)
  syntax error at or near "from"
  LINE 48: from combined_business_addresses
           ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_addresses.sql
[0m14:25:57.255254 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b487fd0>]}
[0m14:25:57.255678 [error] [Thread-1 (]: 7 of 13 ERROR creating sql table model analytics_analytics.business_addresses .. [[31mERROR[0m in 0.10s]
[0m14:25:57.256026 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m14:25:57.256452 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_addresses' to be skipped because of status 'error'.  Reason: Database Error in model business_addresses (models/2_int/business_addresses.sql)
  syntax error at or near "from"
  LINE 48: from combined_business_addresses
           ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_addresses.sql.
[0m14:25:57.257408 [debug] [Thread-3 (]: SQL status: BEGIN in 0.070 seconds
[0m14:25:57.257675 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:25:57.257929 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m14:25:57.502945 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.244 seconds
[0m14:25:57.507811 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:25:57.508109 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m14:25:57.510744 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:57.512569 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:25:57.512805 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m14:25:57.514532 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:25:57.515487 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:25:57.515703 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:25:57.515889 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:25:57.520926 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m14:25:57.523111 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m14:25:57.523561 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:25:57.523770 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m14:25:57.540544 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.016 seconds
[0m14:25:57.544205 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m14:25:57.545277 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4cb970>]}
[0m14:25:57.546130 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.39s]
[0m14:25:57.546705 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m14:25:57.567979 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.321 seconds
[0m14:25:57.570206 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:25:57.570444 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m14:25:57.573783 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:57.576004 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:25:57.576350 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m14:25:57.578282 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:57.579329 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:25:57.579576 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:25:57.579779 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:25:57.592810 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m14:25:57.597876 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m14:25:57.598441 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:25:57.598652 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m14:25:57.615629 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.016 seconds
[0m14:25:57.621137 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m14:25:57.622381 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4f08e0>]}
[0m14:25:57.623119 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.46s]
[0m14:25:57.623504 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m14:25:57.623869 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.addresses
[0m14:25:57.624172 [info ] [Thread-1 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m14:25:57.624515 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.addresses)
[0m14:25:57.624829 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.addresses
[0m14:25:57.626684 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m14:25:57.627129 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.addresses
[0m14:25:57.629372 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m14:25:57.630170 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:25:57.630407 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: BEGIN
[0m14:25:57.630601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:57.680478 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m14:25:57.682429 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:25:57.683648 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m14:25:57.782456 [debug] [Thread-1 (]: SQL status: SELECT 4945 in 0.098 seconds
[0m14:25:57.787561 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:25:57.787936 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m14:25:57.791686 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:57.794541 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:25:57.794789 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m14:25:57.798115 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:57.799052 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:25:57.799270 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:25:57.799460 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:25:57.807410 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m14:25:57.810966 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m14:25:57.811578 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:25:57.811796 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m14:25:57.825252 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.013 seconds
[0m14:25:57.828216 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: Close
[0m14:25:57.829658 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b761e70>]}
[0m14:25:57.830187 [info ] [Thread-1 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.21s]
[0m14:25:57.830564 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.addresses
[0m14:25:59.034664 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.788 seconds
[0m14:25:59.037195 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:25:59.037526 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m14:25:59.041197 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:59.043508 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:25:59.043825 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m14:25:59.046230 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:59.047351 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:25:59.047583 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:25:59.047773 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:25:59.090554 [debug] [Thread-4 (]: SQL status: COMMIT in 0.042 seconds
[0m14:25:59.094983 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m14:25:59.095563 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:25:59.095774 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m14:25:59.153222 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.057 seconds
[0m14:25:59.160185 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m14:25:59.161098 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b469ba0>]}
[0m14:25:59.161484 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 2.00s]
[0m14:25:59.161790 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m14:25:59.162266 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m14:25:59.162625 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m14:25:59.163052 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m14:25:59.163413 [info ] [Thread-3 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m14:25:59.163722 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m14:25:59.163987 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.business_with_full_timeline)
[0m14:25:59.164239 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m14:25:59.164547 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m14:25:59.166678 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m14:25:59.168690 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.169241 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_tenures
[0m14:25:59.169536 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m14:25:59.214286 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m14:25:59.226144 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.226958 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:25:59.227333 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.227581 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m14:25:59.227817 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m14:25:59.228027 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:25:59.228235 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:25:59.279897 [debug] [Thread-3 (]: SQL status: BEGIN in 0.052 seconds
[0m14:25:59.280279 [debug] [Thread-2 (]: SQL status: BEGIN in 0.052 seconds
[0m14:25:59.280665 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.281056 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:25:59.281377 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m14:25:59.281746 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select 
    business_name,
    tenure_start_date,
    tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_tenures
  );
  
[0m14:25:59.331929 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.050 seconds
[0m14:25:59.334030 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.334268 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m14:25:59.338545 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:25:59.339406 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:25:59.339634 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.339832 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:25:59.343475 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m14:25:59.344989 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m14:25:59.346542 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:25:59.346797 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m14:25:59.348528 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:25:59.349300 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m14:25:59.349661 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b602050>]}
[0m14:25:59.350041 [info ] [Thread-3 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.19s]
[0m14:25:59.350359 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m14:25:59.575057 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.293 seconds
[0m14:25:59.580452 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:25:59.580746 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures" rename to "business_tenures__dbt_backup"
[0m14:25:59.583989 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:25:59.585967 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:25:59.586202 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m14:25:59.588166 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:25:59.589223 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:25:59.589461 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:25:59.589663 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:25:59.594175 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m14:25:59.596317 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m14:25:59.596748 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:25:59.596945 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m14:25:59.612248 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.015 seconds
[0m14:25:59.613121 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: Close
[0m14:25:59.613504 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8194a3d7-cc97-4786-83d8-9b6a1312c24c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7a33d0>]}
[0m14:25:59.613896 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.45s]
[0m14:25:59.614231 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m14:25:59.615049 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:59.615351 [debug] [MainThread]: On master: BEGIN
[0m14:25:59.615537 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:25:59.666632 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m14:25:59.666971 [debug] [MainThread]: On master: COMMIT
[0m14:25:59.667149 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:59.667306 [debug] [MainThread]: On master: COMMIT
[0m14:25:59.668231 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:25:59.668413 [debug] [MainThread]: On master: Close
[0m14:25:59.668674 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:25:59.668838 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m14:25:59.668988 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m14:25:59.669123 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m14:25:59.669258 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m14:25:59.669483 [info ] [MainThread]: 
[0m14:25:59.669663 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 4.92 seconds (4.92s).
[0m14:25:59.670696 [debug] [MainThread]: Command end result
[0m14:25:59.684698 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:25:59.686131 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:25:59.690360 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:25:59.690674 [info ] [MainThread]: 
[0m14:25:59.690987 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:25:59.691222 [info ] [MainThread]: 
[0m14:25:59.691449 [error] [MainThread]: [31mFailure in model business_addresses (models/2_int/business_addresses.sql)[0m
[0m14:25:59.691657 [error] [MainThread]:   Database Error in model business_addresses (models/2_int/business_addresses.sql)
  syntax error at or near "from"
  LINE 48: from combined_business_addresses
           ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_addresses.sql
[0m14:25:59.691821 [info ] [MainThread]: 
[0m14:25:59.692020 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/2_int/business_addresses.sql
[0m14:25:59.692195 [info ] [MainThread]: 
[0m14:25:59.692382 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=13
[0m14:25:59.694938 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.771897, "process_in_blocks": "0", "process_kernel_time": 0.291698, "process_mem_max_rss": "143310848", "process_out_blocks": "0", "process_user_time": 1.841727}
[0m14:25:59.695275 [debug] [MainThread]: Command `dbt run` failed at 14:25:59.695230 after 5.77 seconds
[0m14:25:59.695506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bea950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a546a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ee6140>]}
[0m14:25:59.695722 [debug] [MainThread]: Flushing usage events
[0m14:26:00.240654 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:26:15.770858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033268f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105539450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105538d30>]}


============================== 14:26:15.773963 | 71971a22-a19d-408a-b8b9-c24069f0a2c5 ==============================
[0m14:26:15.773963 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:26:15.774330 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'target_path': 'None', 'printer_width': '80', 'version_check': 'True', 'introspect': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'warn_error': 'None', 'empty': 'False', 'log_format': 'default', 'partial_parse': 'True', 'no_print': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'quiet': 'False'}
[0m14:26:15.909777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1020f9ba0>]}
[0m14:26:15.954562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105788490>]}
[0m14:26:15.955714 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:26:16.024837 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:26:16.102307 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:26:16.102778 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m14:26:16.299127 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m14:26:16.307274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ca6f80>]}
[0m14:26:16.353771 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:26:16.355206 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:26:16.367885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066a7a90>]}
[0m14:26:16.368257 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m14:26:16.368476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066c2d10>]}
[0m14:26:16.369586 [info ] [MainThread]: 
[0m14:26:16.369809 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:26:16.369975 [info ] [MainThread]: 
[0m14:26:16.370250 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:26:16.372945 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:26:16.458983 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:26:16.459334 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:26:16.459510 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:26:16.582223 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.123 seconds
[0m14:26:16.583137 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:26:16.584370 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:26:16.588272 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:26:16.588570 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:26:16.588749 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:16.640219 [debug] [ThreadPool]: SQL status: BEGIN in 0.051 seconds
[0m14:26:16.640578 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:26:16.640777 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:26:16.705223 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.064 seconds
[0m14:26:16.706203 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:26:16.707755 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:26:16.711733 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:16.712013 [debug] [MainThread]: On master: BEGIN
[0m14:26:16.712178 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:26:16.769282 [debug] [MainThread]: SQL status: BEGIN in 0.057 seconds
[0m14:26:16.769628 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:16.769872 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:26:17.233471 [debug] [MainThread]: SQL status: SELECT 1 in 0.463 seconds
[0m14:26:17.234618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106719cf0>]}
[0m14:26:17.234930 [debug] [MainThread]: On master: ROLLBACK
[0m14:26:17.236962 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:17.237244 [debug] [MainThread]: On master: BEGIN
[0m14:26:17.239011 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m14:26:17.239294 [debug] [MainThread]: On master: COMMIT
[0m14:26:17.239479 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:17.239648 [debug] [MainThread]: On master: COMMIT
[0m14:26:17.240626 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:26:17.240885 [debug] [MainThread]: On master: Close
[0m14:26:17.244669 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m14:26:17.245485 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:26:17.245209 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m14:26:17.246560 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m14:26:17.246800 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m14:26:17.251763 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m14:26:17.246196 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m14:26:17.252468 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:26:17.252774 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:26:17.254822 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:26:17.255424 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m14:26:17.255719 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:26:17.283365 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:26:17.283683 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m14:26:17.284461 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:26:17.284790 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m14:26:17.285108 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:26:17.285381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:17.285629 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:26:17.285996 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:26:17.340080 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m14:26:17.340474 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:26:17.340712 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:26:17.341312 [debug] [Thread-1 (]: SQL status: BEGIN in 0.056 seconds
[0m14:26:17.341562 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:26:17.341792 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m14:26:17.394120 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.053 seconds
[0m14:26:17.400149 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:26:17.400456 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:26:17.404581 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:26:17.406593 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:26:17.406838 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:26:17.408642 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:26:17.417669 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:26:17.418005 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.076 seconds
[0m14:26:17.418363 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:26:17.420523 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:26:17.420761 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:26:17.420966 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m14:26:17.424854 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:26:17.427327 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:26:17.427594 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m14:26:17.427928 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m14:26:17.432181 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:26:17.434950 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:26:17.435257 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:17.435567 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:26:17.436642 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:26:17.436932 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:26:17.437221 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:26:17.440763 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m14:26:17.442553 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m14:26:17.443032 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:26:17.443248 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m14:26:17.447162 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.010 seconds
[0m14:26:17.448833 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:26:17.450150 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c67eb0>]}
[0m14:26:17.450655 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.20s]
[0m14:26:17.450998 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:26:17.451409 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:26:17.451654 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:26:17.451855 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:26:17.452143 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m14:26:17.452471 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m14:26:17.452873 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m14:26:17.453303 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m14:26:17.453691 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:26:17.453997 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m14:26:17.454320 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m14:26:17.454671 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:26:17.454976 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:26:17.455850 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m14:26:17.456096 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:26:17.458422 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.460951 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:17.461529 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d40730>]}
[0m14:26:17.463839 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:17.464955 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:26:17.464701 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.21s]
[0m14:26:17.468696 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.469022 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:26:17.469456 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m14:26:17.472585 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:17.473020 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:26:17.473427 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:26:17.473852 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.476523 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:17.476904 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m14:26:17.477246 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:17.477529 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:26:17.477891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m14:26:17.478161 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:26:17.478536 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:17.478789 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:26:17.479064 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:26:17.479338 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:26:17.479623 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:26:17.482310 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.482893 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:26:17.483668 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:26:17.486320 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.486904 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.487214 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:26:17.487786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:17.539052 [debug] [Thread-3 (]: SQL status: BEGIN in 0.060 seconds
[0m14:26:17.539502 [debug] [Thread-2 (]: SQL status: BEGIN in 0.057 seconds
[0m14:26:17.539804 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:17.540098 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:17.540414 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:26:17.540710 [debug] [Thread-1 (]: SQL status: BEGIN in 0.053 seconds
[0m14:26:17.541063 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:26:17.541394 [debug] [Thread-4 (]: SQL status: BEGIN in 0.063 seconds
[0m14:26:17.541790 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.542096 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.542367 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:26:17.542633 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:26:17.642569 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.100 seconds
[0m14:26:17.644874 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.645125 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:26:17.648033 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:17.650380 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.650695 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:26:17.652547 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:26:17.654289 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:26:17.654556 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.654764 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:26:17.668448 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.125 seconds
[0m14:26:17.670756 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.671071 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:26:17.673369 [debug] [Thread-1 (]: SQL status: COMMIT in 0.018 seconds
[0m14:26:17.675106 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:26:17.675367 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:26:17.675942 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:26:17.677827 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.678068 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:26:17.678302 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:26:17.680074 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:17.681139 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:26:17.681422 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.681633 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:26:17.691544 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m14:26:17.693360 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:26:17.693851 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:26:17.694063 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:26:17.694428 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.016 seconds
[0m14:26:17.695373 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:26:17.695848 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e025c0>]}
[0m14:26:17.696260 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.22s]
[0m14:26:17.696594 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:26:17.707884 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:26:17.708955 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:26:17.709377 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9ea70>]}
[0m14:26:17.709799 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.26s]
[0m14:26:17.710136 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:26:18.169604 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.628 seconds
[0m14:26:18.173493 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:18.173785 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:26:18.177157 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:18.179180 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:18.179481 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:26:18.182437 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:18.183456 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:26:18.183700 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:18.183910 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:26:18.206995 [debug] [Thread-3 (]: SQL status: COMMIT in 0.023 seconds
[0m14:26:18.213023 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.671 seconds
[0m14:26:18.216116 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:26:18.220170 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:18.221095 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:26:18.221612 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:26:18.222127 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:26:18.226527 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:26:18.228604 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:18.228844 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:26:18.231026 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:26:18.231898 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:26:18.232100 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:18.232284 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:26:18.234735 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:26:18.235606 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:26:18.235893 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m14:26:18.236424 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd4850>]}
[0m14:26:18.238205 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:26:18.238766 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 0.78s]
[0m14:26:18.239389 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:26:18.239784 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:26:18.240040 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:26:18.253024 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.013 seconds
[0m14:26:18.254069 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:26:18.254477 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c54340>]}
[0m14:26:18.254870 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.80s]
[0m14:26:18.255189 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:26:18.255690 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m14:26:18.255915 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m14:26:18.256153 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m14:26:18.256500 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m14:26:18.256906 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m14:26:18.257322 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m14:26:18.257845 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m14:26:18.258248 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m14:26:18.258694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m14:26:18.259044 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m14:26:18.259307 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m14:26:18.259548 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m14:26:18.259866 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m14:26:18.260164 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m14:26:18.260413 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m14:26:18.260699 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m14:26:18.263135 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m14:26:18.265826 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m14:26:18.268347 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m14:26:18.270725 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m14:26:18.271360 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m14:26:18.271577 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m14:26:18.275351 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m14:26:18.277746 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m14:26:18.278085 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m14:26:18.278401 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m14:26:18.281397 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m14:26:18.281824 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:26:18.282133 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:26:18.284954 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m14:26:18.285454 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m14:26:18.285777 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m14:26:18.286120 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:26:18.286370 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:26:18.286598 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:18.286855 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:26:18.287110 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m14:26:18.287614 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m14:26:18.287911 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:26:18.288138 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:26:18.349910 [debug] [Thread-3 (]: SQL status: BEGIN in 0.062 seconds
[0m14:26:18.350378 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:26:18.350646 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m14:26:18.352970 [debug] [Thread-2 (]: SQL status: BEGIN in 0.065 seconds
[0m14:26:18.353340 [debug] [Thread-4 (]: SQL status: BEGIN in 0.067 seconds
[0m14:26:18.353566 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:26:18.353798 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:26:18.354044 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m14:26:18.354364 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m14:26:18.365372 [debug] [Thread-1 (]: SQL status: BEGIN in 0.079 seconds
[0m14:26:18.365800 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:26:18.366068 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct 
    business_name, business_address,
    split_part(business_address, ',', -1) as postcode
from combined_business_addresses
  );
  
[0m14:26:18.706914 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.356 seconds
[0m14:26:18.709362 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:26:18.709650 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m14:26:18.712614 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:18.714558 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:26:18.714810 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m14:26:18.716450 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:18.717344 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:26:18.717557 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:26:18.717748 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:26:18.723588 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m14:26:18.725841 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m14:26:18.726375 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:26:18.726635 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m14:26:18.738458 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:26:18.739412 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m14:26:18.739872 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d7bbb0>]}
[0m14:26:18.740480 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.48s]
[0m14:26:18.740837 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m14:26:18.789832 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.435 seconds
[0m14:26:18.792376 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:26:18.792702 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m14:26:18.796042 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:18.798001 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:26:18.798245 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m14:26:18.799962 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:18.801101 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:26:18.801364 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:26:18.801560 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:26:18.814080 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m14:26:18.815924 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m14:26:18.816505 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:26:18.816728 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m14:26:18.830504 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:26:18.831447 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m14:26:18.831856 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e382b0>]}
[0m14:26:18.832430 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.57s]
[0m14:26:18.832783 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m14:26:18.833178 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m14:26:18.833569 [info ] [Thread-3 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m14:26:18.833906 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m14:26:18.834133 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.addresses
[0m14:26:18.835925 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m14:26:18.836375 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.addresses
[0m14:26:18.838695 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m14:26:18.839206 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:26:18.839423 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: BEGIN
[0m14:26:18.839610 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:26:18.853714 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.487 seconds
[0m14:26:18.856419 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:26:18.856800 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses" rename to "business_addresses__dbt_backup"
[0m14:26:18.860677 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:26:18.863464 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:26:18.863722 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m14:26:18.866531 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:18.867846 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m14:26:18.868128 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:26:18.868331 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m14:26:18.874905 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m14:26:18.876598 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m14:26:18.877057 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:26:18.877261 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m14:26:18.890002 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:26:18.891208 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m14:26:18.891690 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9ed70>]}
[0m14:26:18.892110 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 11450[0m in 0.63s]
[0m14:26:18.892770 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m14:26:18.894480 [debug] [Thread-3 (]: SQL status: BEGIN in 0.055 seconds
[0m14:26:18.894782 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:26:18.895055 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m14:26:18.993021 [debug] [Thread-3 (]: SQL status: SELECT 4945 in 0.098 seconds
[0m14:26:18.995324 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:26:18.995569 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m14:26:18.998032 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:26:18.999792 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:26:19.000012 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m14:26:19.001741 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:26:19.002669 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:26:19.002887 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:26:19.003079 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:26:19.011174 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m14:26:19.012980 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m14:26:19.013473 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:26:19.013686 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m14:26:19.025920 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:26:19.027062 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: Close
[0m14:26:19.027573 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ef32b0>]}
[0m14:26:19.028085 [info ] [Thread-3 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.19s]
[0m14:26:19.028542 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m14:26:20.253001 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.898 seconds
[0m14:26:20.255394 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:26:20.255628 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m14:26:20.258970 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:20.260860 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:26:20.261096 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m14:26:20.263225 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:26:20.264261 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:26:20.264484 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:26:20.264670 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:26:20.272115 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m14:26:20.314315 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m14:26:20.314979 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:26:20.315201 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m14:26:20.335211 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.020 seconds
[0m14:26:20.336273 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m14:26:20.336669 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f3b1f0>]}
[0m14:26:20.337261 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 2.08s]
[0m14:26:20.337668 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m14:26:20.338311 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m14:26:20.338606 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m14:26:20.338896 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m14:26:20.339159 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m14:26:20.339427 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m14:26:20.339814 [info ] [Thread-1 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m14:26:20.341910 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m14:26:20.342239 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.business_with_full_timeline)
[0m14:26:20.342626 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m14:26:20.344400 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.344837 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_tenures
[0m14:26:20.345149 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m14:26:20.347880 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m14:26:20.359069 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.359880 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.360187 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m14:26:20.360420 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:20.360802 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:26:20.361060 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m14:26:20.361374 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:26:20.415717 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m14:26:20.416094 [debug] [Thread-1 (]: SQL status: BEGIN in 0.056 seconds
[0m14:26:20.416512 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:26:20.416766 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.417009 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select 
    business_name,
    tenure_start_date,
    tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_tenures
  );
  
[0m14:26:20.417274 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m14:26:20.460728 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.043 seconds
[0m14:26:20.462909 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.463242 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m14:26:20.467973 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:26:20.468980 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:26:20.469222 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.469424 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:26:20.472675 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m14:26:20.474826 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m14:26:20.476262 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:26:20.476485 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m14:26:20.478085 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:26:20.478918 [debug] [Thread-1 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m14:26:20.479422 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d8b040>]}
[0m14:26:20.479913 [info ] [Thread-1 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.14s]
[0m14:26:20.480249 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m14:26:20.711709 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.294 seconds
[0m14:26:20.714523 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:26:20.714876 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures" rename to "business_tenures__dbt_backup"
[0m14:26:20.718423 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:26:20.720958 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:26:20.721379 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m14:26:20.726543 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m14:26:20.728292 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:26:20.728610 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:26:20.728862 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:26:20.737794 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m14:26:20.739648 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m14:26:20.740138 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:26:20.740358 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m14:26:20.753638 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.013 seconds
[0m14:26:20.755056 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: Close
[0m14:26:20.756601 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71971a22-a19d-408a-b8b9-c24069f0a2c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f0d330>]}
[0m14:26:20.757059 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.42s]
[0m14:26:20.757446 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m14:26:20.758294 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:20.758585 [debug] [MainThread]: On master: BEGIN
[0m14:26:20.758759 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:26:20.811665 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m14:26:20.812036 [debug] [MainThread]: On master: COMMIT
[0m14:26:20.812231 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:20.812399 [debug] [MainThread]: On master: COMMIT
[0m14:26:20.813435 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:26:20.813757 [debug] [MainThread]: On master: Close
[0m14:26:20.814049 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:26:20.814268 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m14:26:20.814424 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m14:26:20.814575 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m14:26:20.814718 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m14:26:20.814963 [info ] [MainThread]: 
[0m14:26:20.815189 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 4.44 seconds (4.44s).
[0m14:26:20.816736 [debug] [MainThread]: Command end result
[0m14:26:20.834084 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:26:20.835372 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:26:20.839479 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:26:20.839732 [info ] [MainThread]: 
[0m14:26:20.839953 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:26:20.840140 [info ] [MainThread]: 
[0m14:26:20.840331 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m14:26:20.843030 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.1219087, "process_in_blocks": "0", "process_kernel_time": 0.241062, "process_mem_max_rss": "143048704", "process_out_blocks": "0", "process_user_time": 1.788547}
[0m14:26:20.843411 [debug] [MainThread]: Command `dbt run` succeeded at 14:26:20.843362 after 5.12 seconds
[0m14:26:20.843641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033268f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b2050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057dcb80>]}
[0m14:26:20.843876 [debug] [MainThread]: Flushing usage events
[0m14:26:21.285346 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:41:02.107755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e56890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110939930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110939210>]}


============================== 14:41:02.111563 | abf979c3-d4e8-4a16-8054-181095e4b376 ==============================
[0m14:41:02.111563 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:41:02.112115 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'log_format': 'default', 'warn_error': 'None', 'target_path': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'empty': 'False', 'invocation_command': 'dbt run', 'quiet': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'fail_fast': 'False', 'no_print': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'printer_width': '80', 'introspect': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'partial_parse': 'True', 'debug': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:41:02.282594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108f70d0>]}
[0m14:41:02.324551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c33490>]}
[0m14:41:02.325374 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:41:02.390491 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:41:02.470325 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:41:02.470789 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m14:41:02.665103 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m14:41:02.673791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11197a260>]}
[0m14:41:02.719327 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:41:02.720986 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:41:02.734779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118ad060>]}
[0m14:41:02.735150 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m14:41:02.735369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119e9030>]}
[0m14:41:02.736487 [info ] [MainThread]: 
[0m14:41:02.736725 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:41:02.736902 [info ] [MainThread]: 
[0m14:41:02.737193 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:41:02.739815 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:41:02.772504 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:41:02.772838 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:41:02.773017 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:02.925007 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.152 seconds
[0m14:41:02.925890 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:41:02.927112 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:41:02.930535 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:41:02.930748 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:41:02.930914 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:02.990693 [debug] [ThreadPool]: SQL status: BEGIN in 0.060 seconds
[0m14:41:02.991046 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:41:02.991248 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:41:03.081911 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.090 seconds
[0m14:41:03.082924 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:41:03.084704 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:41:03.088948 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:03.089219 [debug] [MainThread]: On master: BEGIN
[0m14:41:03.089398 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:41:03.141067 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m14:41:03.141405 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:03.141656 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:41:03.589794 [debug] [MainThread]: SQL status: SELECT 1 in 0.448 seconds
[0m14:41:03.593277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a539d0>]}
[0m14:41:03.593814 [debug] [MainThread]: On master: ROLLBACK
[0m14:41:03.597362 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:03.597619 [debug] [MainThread]: On master: BEGIN
[0m14:41:03.599260 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:41:03.599517 [debug] [MainThread]: On master: COMMIT
[0m14:41:03.599700 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:03.599859 [debug] [MainThread]: On master: COMMIT
[0m14:41:03.600740 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:41:03.600959 [debug] [MainThread]: On master: Close
[0m14:41:03.603391 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m14:41:03.603697 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m14:41:03.603965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m14:41:03.604244 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m14:41:03.608767 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m14:41:03.609062 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:41:03.609534 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m14:41:03.610017 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:41:03.610326 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:41:03.612215 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:41:03.612697 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m14:41:03.630602 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:41:03.636447 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m14:41:03.639699 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:41:03.640581 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:03.641022 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:03.641366 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m14:41:03.641653 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:41:03.641927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:03.642197 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:41:03.697454 [debug] [Thread-2 (]: SQL status: BEGIN in 0.055 seconds
[0m14:41:03.697819 [debug] [Thread-1 (]: SQL status: BEGIN in 0.056 seconds
[0m14:41:03.698222 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:03.698557 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:03.698811 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:41:03.699061 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m14:41:03.757640 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.058 seconds
[0m14:41:03.763660 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:03.763967 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:41:03.768545 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:41:03.770413 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:03.770652 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:41:03.772355 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:03.780968 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:41:03.781292 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.082 seconds
[0m14:41:03.781666 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:03.783851 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:03.784101 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:41:03.784302 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m14:41:03.787345 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:03.789872 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:03.790107 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m14:41:03.790353 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m14:41:03.794076 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:41:03.796904 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:03.797183 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:03.797451 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:41:03.798413 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:41:03.798680 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:03.798889 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:41:03.801651 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m14:41:03.803131 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m14:41:03.803570 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:03.803772 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m14:41:03.809060 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.010 seconds
[0m14:41:03.810718 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:41:03.812014 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f296f0>]}
[0m14:41:03.812532 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.20s]
[0m14:41:03.812972 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:41:03.813431 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:41:03.813706 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:03.813996 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:41:03.814312 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m14:41:03.814643 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m14:41:03.815024 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m14:41:03.815411 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m14:41:03.815691 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:41:03.815958 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:41:03.816244 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m14:41:03.816513 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:41:03.816744 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:03.817551 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m14:41:03.817776 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:41:03.820230 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:03.822367 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:03.824609 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:03.825077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e705b0>]}
[0m14:41:03.825965 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.22s]
[0m14:41:03.826296 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:41:03.826566 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:41:03.826922 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m14:41:03.827129 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:03.830543 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:03.833704 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:03.834113 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:41:03.836746 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:03.837400 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m14:41:03.837929 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:03.838247 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:03.838624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m14:41:03.838889 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:41:03.839136 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:03.839399 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:41:03.839620 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:41:03.839879 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:41:03.840160 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:41:03.840423 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:03.842683 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:41:03.843190 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:41:03.844212 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:41:03.846925 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:41:03.847501 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:03.847736 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:41:03.847945 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:03.902946 [debug] [Thread-3 (]: SQL status: BEGIN in 0.060 seconds
[0m14:41:03.903355 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:03.903624 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:03.904921 [debug] [Thread-2 (]: SQL status: BEGIN in 0.064 seconds
[0m14:41:03.905257 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:03.905518 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:03.905943 [debug] [Thread-4 (]: SQL status: BEGIN in 0.066 seconds
[0m14:41:03.906194 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:03.906458 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:03.914644 [debug] [Thread-1 (]: SQL status: BEGIN in 0.067 seconds
[0m14:41:03.914970 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:03.915224 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:04.038592 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.123 seconds
[0m14:41:04.041052 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:04.041322 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:41:04.045032 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:04.047286 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:04.047633 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:41:04.049584 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:04.051413 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:41:04.051673 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:04.051875 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:41:04.065243 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.158 seconds
[0m14:41:04.067608 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:04.067862 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:41:04.071731 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:04.074284 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:04.074600 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:41:04.077674 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:04.078726 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:41:04.078974 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:04.079183 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:41:04.086457 [debug] [Thread-1 (]: SQL status: COMMIT in 0.034 seconds
[0m14:41:04.087974 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:41:04.088419 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:04.088617 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:41:04.089263 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m14:41:04.090791 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:41:04.091236 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:04.091440 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:41:04.102695 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:41:04.103655 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:41:04.104078 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fa6e90>]}
[0m14:41:04.104482 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.27s]
[0m14:41:04.104814 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:41:04.106491 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.015 seconds
[0m14:41:04.107301 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:41:04.107654 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fc4940>]}
[0m14:41:04.108008 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.29s]
[0m14:41:04.108426 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:41:04.585421 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.681 seconds
[0m14:41:04.591129 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:04.591450 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:41:04.597438 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m14:41:04.599431 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:04.599663 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:41:04.601253 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:04.602176 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:41:04.602389 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:04.602586 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:41:04.619383 [debug] [Thread-3 (]: SQL status: COMMIT in 0.016 seconds
[0m14:41:04.625749 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:41:04.626446 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:04.626691 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:41:04.627624 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.722 seconds
[0m14:41:04.629725 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:04.629959 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:41:04.634658 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:41:04.636650 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:04.636961 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:41:04.638974 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:04.640071 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:41:04.640321 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:04.640529 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:41:04.644135 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m14:41:04.646003 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:41:04.646521 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:04.646750 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:41:04.651790 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.025 seconds
[0m14:41:04.652659 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:41:04.653050 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a648e0>]}
[0m14:41:04.653440 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 0.84s]
[0m14:41:04.653952 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:04.668818 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.022 seconds
[0m14:41:04.669782 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:41:04.670159 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11290ef80>]}
[0m14:41:04.670533 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.85s]
[0m14:41:04.670846 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:41:04.671323 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m14:41:04.671689 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m14:41:04.671963 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m14:41:04.672148 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m14:41:04.672353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m14:41:04.672535 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m14:41:04.672796 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m14:41:04.673338 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m14:41:04.673663 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m14:41:04.674056 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m14:41:04.674419 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m14:41:04.674664 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m14:41:04.676982 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m14:41:04.677462 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m14:41:04.677727 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m14:41:04.677937 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m14:41:04.678350 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m14:41:04.680908 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m14:41:04.681232 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m14:41:04.683763 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m14:41:04.686247 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m14:41:04.689655 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m14:41:04.690307 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m14:41:04.693031 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m14:41:04.693354 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m14:41:04.693687 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m14:41:04.694026 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:04.696559 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m14:41:04.699097 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m14:41:04.699397 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:04.699639 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m14:41:04.699993 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m14:41:04.700288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:04.700515 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:04.700717 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:04.700925 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:41:04.701210 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m14:41:04.701423 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m14:41:04.701719 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:04.702035 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:41:04.756063 [debug] [Thread-1 (]: SQL status: BEGIN in 0.056 seconds
[0m14:41:04.756464 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:04.756754 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct 
    business_name, business_address,
    split_part(business_address, ',', -1) as postcode
from combined_business_addresses
lower(business_address) like '%st peters street%' 
or lower(business_address) like '%market place%'
or lower(business_address) like '%french row%'
or lower(business_address) like '%checker st%'
or lower(business_address) like '%george st%'
or lower(business_address) like '%holywell hill%'
or lower(business_address) like '%london r%'
or lower(business_address) like '%victoria st%'
or lower(business_address) like '%hatfield r%'
  );
  
[0m14:41:04.757056 [debug] [Thread-3 (]: SQL status: BEGIN in 0.055 seconds
[0m14:41:04.757253 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:04.757479 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m14:41:04.760666 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "like"
LINE 49: lower(business_address) like '%st peters street%' 
                                 ^

[0m14:41:04.761045 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: ROLLBACK
[0m14:41:04.762475 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m14:41:04.767022 [debug] [Thread-1 (]: Database Error in model business_addresses (models/2_int/business_addresses.sql)
  syntax error at or near "like"
  LINE 49: lower(business_address) like '%st peters street%' 
                                   ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_addresses.sql
[0m14:41:04.768262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129a7e80>]}
[0m14:41:04.768807 [error] [Thread-1 (]: 7 of 13 ERROR creating sql table model analytics_analytics.business_addresses .. [[31mERROR[0m in 0.10s]
[0m14:41:04.769238 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m14:41:04.769575 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_addresses' to be skipped because of status 'error'.  Reason: Database Error in model business_addresses (models/2_int/business_addresses.sql)
  syntax error at or near "like"
  LINE 49: lower(business_address) like '%st peters street%' 
                                   ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_addresses.sql.
[0m14:41:04.772445 [debug] [Thread-4 (]: SQL status: BEGIN in 0.071 seconds
[0m14:41:04.772786 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:04.773109 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m14:41:04.774741 [debug] [Thread-2 (]: SQL status: BEGIN in 0.073 seconds
[0m14:41:04.775060 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:04.775312 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m14:41:05.003776 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.246 seconds
[0m14:41:05.009586 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:05.010082 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m14:41:05.013317 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:05.015756 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:05.016106 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m14:41:05.018753 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:05.019986 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:41:05.020326 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:05.020548 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:41:05.025300 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m14:41:05.027806 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m14:41:05.028314 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:05.028533 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m14:41:05.042639 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.013 seconds
[0m14:41:05.046331 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m14:41:05.047644 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f2aad0>]}
[0m14:41:05.048255 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.37s]
[0m14:41:05.048611 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m14:41:05.099904 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.324 seconds
[0m14:41:05.104013 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:05.104340 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m14:41:05.107784 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:05.109674 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:05.109910 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m14:41:05.111454 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:05.112403 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:41:05.112638 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:05.112835 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:41:05.120563 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m14:41:05.122127 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m14:41:05.122599 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:05.122807 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m14:41:05.137774 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:41:05.141775 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m14:41:05.142289 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fde0b0>]}
[0m14:41:05.142725 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.46s]
[0m14:41:05.143058 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m14:41:05.143400 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.addresses
[0m14:41:05.143648 [info ] [Thread-1 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m14:41:05.143907 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.addresses)
[0m14:41:05.144108 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.addresses
[0m14:41:05.145905 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m14:41:05.146369 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.addresses
[0m14:41:05.148585 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m14:41:05.149052 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:05.149415 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: BEGIN
[0m14:41:05.149614 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:05.199206 [debug] [Thread-1 (]: SQL status: BEGIN in 0.049 seconds
[0m14:41:05.201027 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:05.201649 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m14:41:05.299729 [debug] [Thread-1 (]: SQL status: SELECT 4945 in 0.097 seconds
[0m14:41:05.306939 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:05.307619 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m14:41:05.312753 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m14:41:05.315491 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:05.315771 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m14:41:05.317537 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:05.318486 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:41:05.318711 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:05.318909 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:41:05.325233 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m14:41:05.326837 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m14:41:05.327407 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:05.327736 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m14:41:05.339329 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m14:41:05.340298 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses: Close
[0m14:41:05.340691 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a6ada0>]}
[0m14:41:05.341078 [info ] [Thread-1 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.20s]
[0m14:41:05.341404 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.addresses
[0m14:41:06.574357 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 1.800 seconds
[0m14:41:06.579126 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:06.579942 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m14:41:06.583538 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:06.585832 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:06.586070 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m14:41:06.587988 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:06.589072 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:41:06.589300 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:06.589532 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:41:06.604158 [debug] [Thread-4 (]: SQL status: COMMIT in 0.014 seconds
[0m14:41:06.609813 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m14:41:06.611165 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:06.611770 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m14:41:06.641545 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.029 seconds
[0m14:41:06.642659 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m14:41:06.643193 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fdfc10>]}
[0m14:41:06.643678 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 1.97s]
[0m14:41:06.644104 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m14:41:06.644661 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_tenures
[0m14:41:06.645227 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m14:41:06.644953 [info ] [Thread-2 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m14:41:06.645676 [info ] [Thread-3 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m14:41:06.646083 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m14:41:06.646485 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.business_with_full_timeline)
[0m14:41:06.646796 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m14:41:06.647105 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m14:41:06.649412 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m14:41:06.652008 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.653223 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_tenures
[0m14:41:06.653545 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m14:41:06.705425 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m14:41:06.717428 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.718284 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:06.718610 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m14:41:06.718913 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:06.719345 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.719588 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m14:41:06.719803 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:41:06.772694 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m14:41:06.773141 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:06.773387 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select 
    business_name,
    tenure_start_date,
    tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_tenures
  );
  
[0m14:41:06.773680 [debug] [Thread-3 (]: SQL status: BEGIN in 0.054 seconds
[0m14:41:06.774017 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.774295 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m14:41:06.814111 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.039 seconds
[0m14:41:06.816382 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.816664 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m14:41:06.821077 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:41:06.822043 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:41:06.822277 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.822473 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:41:06.825772 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m14:41:06.827235 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m14:41:06.828808 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:06.829049 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m14:41:06.830750 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m14:41:06.831592 [debug] [Thread-3 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m14:41:06.832065 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cafbb0>]}
[0m14:41:06.832593 [info ] [Thread-3 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.19s]
[0m14:41:06.832936 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m14:41:07.063905 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.290 seconds
[0m14:41:07.066221 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:07.066463 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures" rename to "business_tenures__dbt_backup"
[0m14:41:07.070199 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:07.072645 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:07.072986 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m14:41:07.075206 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:07.076231 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:41:07.076464 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:07.076659 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:41:07.081614 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m14:41:07.084148 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m14:41:07.084663 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:07.084888 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m14:41:07.097824 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:41:07.100570 [debug] [Thread-2 (]: On model.highstreet_tenure.business_tenures: Close
[0m14:41:07.101024 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abf979c3-d4e8-4a16-8054-181095e4b376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109386d0>]}
[0m14:41:07.101429 [info ] [Thread-2 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.45s]
[0m14:41:07.101762 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_tenures
[0m14:41:07.102508 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:07.102723 [debug] [MainThread]: On master: BEGIN
[0m14:41:07.102896 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:41:07.156585 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m14:41:07.158477 [debug] [MainThread]: On master: COMMIT
[0m14:41:07.159319 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:07.159796 [debug] [MainThread]: On master: COMMIT
[0m14:41:07.160952 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:41:07.161431 [debug] [MainThread]: On master: Close
[0m14:41:07.162122 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:07.162563 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m14:41:07.163086 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m14:41:07.163396 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m14:41:07.163564 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m14:41:07.163851 [info ] [MainThread]: 
[0m14:41:07.164068 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 4.43 seconds (4.43s).
[0m14:41:07.165338 [debug] [MainThread]: Command end result
[0m14:41:07.178878 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:41:07.180043 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:41:07.186920 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:41:07.187219 [info ] [MainThread]: 
[0m14:41:07.187556 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:41:07.187978 [info ] [MainThread]: 
[0m14:41:07.188383 [error] [MainThread]: [31mFailure in model business_addresses (models/2_int/business_addresses.sql)[0m
[0m14:41:07.188742 [error] [MainThread]:   Database Error in model business_addresses (models/2_int/business_addresses.sql)
  syntax error at or near "like"
  LINE 49: lower(business_address) like '%st peters street%' 
                                   ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_addresses.sql
[0m14:41:07.189009 [info ] [MainThread]: 
[0m14:41:07.189315 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/2_int/business_addresses.sql
[0m14:41:07.189585 [info ] [MainThread]: 
[0m14:41:07.189868 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=13
[0m14:41:07.192500 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.1406646, "process_in_blocks": "0", "process_kernel_time": 0.266321, "process_mem_max_rss": "142114816", "process_out_blocks": "0", "process_user_time": 1.807512}
[0m14:41:07.192911 [debug] [MainThread]: Command `dbt run` failed at 14:41:07.192856 after 5.14 seconds
[0m14:41:07.193417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e56890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119f5240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112930f40>]}
[0m14:41:07.193806 [debug] [MainThread]: Flushing usage events
[0m14:41:07.708468 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:41:20.352492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a7e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114bbd930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114bbd210>]}


============================== 14:41:20.355638 | c8504bd9-0ea0-4a5b-923f-9d19dde925bb ==============================
[0m14:41:20.355638 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:41:20.355999 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'introspect': 'True', 'static_parser': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'target_path': 'None', 'debug': 'False', 'partial_parse': 'True', 'log_format': 'default', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'no_print': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'printer_width': '80', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'quiet': 'False', 'version_check': 'True', 'indirect_selection': 'eager'}
[0m14:41:20.487724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b730d0>]}
[0m14:41:20.531794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134f3490>]}
[0m14:41:20.533015 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m14:41:20.599325 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:41:20.673924 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:41:20.674370 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m14:41:20.870278 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m14:41:20.878919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115b26260>]}
[0m14:41:20.925868 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:41:20.927276 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:41:20.939251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115a5d060>]}
[0m14:41:20.939636 [info ] [MainThread]: Found 13 models, 5 sources, 434 macros
[0m14:41:20.940012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115ba5030>]}
[0m14:41:20.941263 [info ] [MainThread]: 
[0m14:41:20.941496 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:41:20.941674 [info ] [MainThread]: 
[0m14:41:20.941966 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:41:20.944711 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m14:41:20.973420 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m14:41:20.973772 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m14:41:20.973950 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:21.082638 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.109 seconds
[0m14:41:21.083623 [debug] [ThreadPool]: On list_highstreet: Close
[0m14:41:21.084929 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m14:41:21.088662 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:41:21.088901 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m14:41:21.089076 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:21.139735 [debug] [ThreadPool]: SQL status: BEGIN in 0.051 seconds
[0m14:41:21.140073 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m14:41:21.140274 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m14:41:21.204694 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.064 seconds
[0m14:41:21.205696 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m14:41:21.207432 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m14:41:21.211492 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:21.211765 [debug] [MainThread]: On master: BEGIN
[0m14:41:21.211939 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:41:21.261348 [debug] [MainThread]: SQL status: BEGIN in 0.049 seconds
[0m14:41:21.261699 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:21.261949 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:41:21.714893 [debug] [MainThread]: SQL status: SELECT 1 in 0.453 seconds
[0m14:41:21.715876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115c079d0>]}
[0m14:41:21.716161 [debug] [MainThread]: On master: ROLLBACK
[0m14:41:21.717646 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:21.717846 [debug] [MainThread]: On master: BEGIN
[0m14:41:21.719434 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:41:21.719689 [debug] [MainThread]: On master: COMMIT
[0m14:41:21.719869 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:21.720035 [debug] [MainThread]: On master: COMMIT
[0m14:41:21.720755 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:41:21.720937 [debug] [MainThread]: On master: Close
[0m14:41:21.722809 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m14:41:21.723173 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m14:41:21.723514 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m14:41:21.724041 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m14:41:21.724424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m14:41:21.724786 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m14:41:21.725034 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m14:41:21.725257 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m14:41:21.729901 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m14:41:21.731934 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m14:41:21.732788 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m14:41:21.738458 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m14:41:21.759860 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m14:41:21.762341 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m14:41:21.763101 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:21.763406 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:21.763621 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m14:41:21.763843 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m14:41:21.764043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:21.764240 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:41:21.814222 [debug] [Thread-2 (]: SQL status: BEGIN in 0.050 seconds
[0m14:41:21.814588 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m14:41:21.814957 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:21.815294 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:21.815602 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m14:41:21.815886 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m14:41:21.862500 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.046 seconds
[0m14:41:21.868732 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:21.869033 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m14:41:21.872113 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:21.874070 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:21.874340 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m14:41:21.876302 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:21.884957 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:41:21.885316 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:21.885535 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m14:41:21.886771 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.071 seconds
[0m14:41:21.888918 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:21.889154 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m14:41:21.889728 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m14:41:21.893649 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m14:41:21.893934 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m14:41:21.896656 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m14:41:21.898551 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:21.898792 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m14:41:21.899012 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m14:41:21.901129 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:21.902063 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:41:21.902278 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:21.902469 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m14:41:21.905976 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m14:41:21.907529 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m14:41:21.907753 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m14:41:21.908234 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m14:41:21.909647 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m14:41:21.909899 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m14:41:21.911175 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115bc1000>]}
[0m14:41:21.911581 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.19s]
[0m14:41:21.911908 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m14:41:21.912311 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m14:41:21.912523 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:21.912750 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m14:41:21.913244 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m14:41:21.913759 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m14:41:21.914677 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m14:41:21.915064 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m14:41:21.915376 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m14:41:21.915622 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m14:41:21.915856 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m14:41:21.916213 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:21.916579 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m14:41:21.919687 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:21.922361 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:21.922627 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:41:21.924689 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:21.925769 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m14:41:21.926177 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m14:41:21.926703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115c2e1a0>]}
[0m14:41:21.930014 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:21.930347 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:21.931136 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m14:41:21.930913 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.20s]
[0m14:41:21.933675 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:21.936165 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:21.936646 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m14:41:21.936926 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:21.937542 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m14:41:21.937922 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m14:41:21.938166 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:21.938502 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:21.939188 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:41:21.938931 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m14:41:21.939553 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m14:41:21.939791 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m14:41:21.940205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m14:41:21.940433 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:21.940630 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:41:21.940931 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m14:41:21.943699 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m14:41:21.944364 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m14:41:21.947277 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m14:41:21.948125 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:21.948443 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m14:41:21.948666 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:21.997089 [debug] [Thread-3 (]: SQL status: BEGIN in 0.056 seconds
[0m14:41:21.997478 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:21.997746 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:21.998108 [debug] [Thread-2 (]: SQL status: BEGIN in 0.058 seconds
[0m14:41:21.998441 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:21.998984 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:22.027830 [debug] [Thread-4 (]: SQL status: BEGIN in 0.089 seconds
[0m14:41:22.028261 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:22.028545 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:22.054669 [debug] [Thread-1 (]: SQL status: BEGIN in 0.106 seconds
[0m14:41:22.055081 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:22.055337 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m14:41:22.148673 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.093 seconds
[0m14:41:22.151241 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:22.151617 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m14:41:22.161048 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.009 seconds
[0m14:41:22.162889 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:22.163127 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m14:41:22.164744 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:22.165763 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:41:22.165996 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:22.166194 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m14:41:22.171747 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m14:41:22.173964 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m14:41:22.174434 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m14:41:22.174649 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m14:41:22.182426 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.154 seconds
[0m14:41:22.184542 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:22.184804 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m14:41:22.186490 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:41:22.187251 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m14:41:22.187620 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116b1dd80>]}
[0m14:41:22.187995 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.25s]
[0m14:41:22.188316 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m14:41:22.188669 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:41:22.190653 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:22.190899 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m14:41:22.192927 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:22.193841 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:41:22.194048 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:22.194233 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m14:41:22.199052 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m14:41:22.200852 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m14:41:22.201396 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m14:41:22.201665 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m14:41:22.214315 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:41:22.215310 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m14:41:22.215704 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116ae2d70>]}
[0m14:41:22.216103 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.30s]
[0m14:41:22.216432 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m14:41:22.633562 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.634 seconds
[0m14:41:22.639150 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:22.639501 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m14:41:22.642516 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:22.644437 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:22.644677 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m14:41:22.646395 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:22.647458 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:41:22.647764 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:22.648055 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m14:41:22.658006 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m14:41:22.662264 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m14:41:22.662892 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m14:41:22.663130 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m14:41:22.670511 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.672 seconds
[0m14:41:22.675247 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:22.675522 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m14:41:22.675849 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m14:41:22.676678 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m14:41:22.677121 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115c2f070>]}
[0m14:41:22.677645 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 0.76s]
[0m14:41:22.677993 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m14:41:23.685807 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 1.008 seconds
[0m14:41:23.691896 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:23.692229 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m14:41:23.694272 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:23.698101 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:41:23.698508 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:23.698707 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m14:41:23.702615 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m14:41:23.704377 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m14:41:23.704901 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m14:41:23.705121 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m14:41:23.715975 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.010 seconds
[0m14:41:23.719960 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m14:41:23.721274 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116af0df0>]}
[0m14:41:23.721709 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 1.81s]
[0m14:41:23.722021 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m14:41:23.722600 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_addresses
[0m14:41:23.722890 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_timeline
[0m14:41:23.723144 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.businesses
[0m14:41:23.723402 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m14:41:23.723714 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m14:41:23.724023 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_timeline ............ [RUN]
[0m14:41:23.724301 [info ] [Thread-2 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m14:41:23.724605 [info ] [Thread-3 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m14:41:23.724950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_addresses)
[0m14:41:23.725351 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_timeline)
[0m14:41:23.725588 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.businesses)
[0m14:41:23.725805 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.properties)
[0m14:41:23.726020 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m14:41:23.726215 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m14:41:23.726408 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.businesses
[0m14:41:23.726593 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m14:41:23.729038 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m14:41:23.731502 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m14:41:23.733816 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m14:41:23.735857 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m14:41:23.736589 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_timeline
[0m14:41:23.736840 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.businesses
[0m14:41:23.739786 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_timeline"
[0m14:41:23.741932 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m14:41:23.742261 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_addresses
[0m14:41:23.742648 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m14:41:23.744991 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m14:41:23.747340 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m14:41:23.748773 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:23.749094 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:23.749658 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: BEGIN
[0m14:41:23.750047 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: BEGIN
[0m14:41:23.750389 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:23.750759 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:41:23.751182 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:23.751553 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:23.751814 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m14:41:23.752220 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: BEGIN
[0m14:41:23.752664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:23.752963 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:41:23.821980 [debug] [Thread-1 (]: SQL status: BEGIN in 0.069 seconds
[0m14:41:23.822335 [debug] [Thread-4 (]: SQL status: BEGIN in 0.072 seconds
[0m14:41:23.822645 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:23.822871 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:23.823141 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct 
    business_name, business_address,
    split_part(business_address, ',', -1) as postcode
from combined_business_addresses
where lower(business_address) like '%st peters street%' 
or lower(business_address) like '%market place%'
or lower(business_address) like '%french row%'
or lower(business_address) like '%checker st%'
or lower(business_address) like '%george st%'
or lower(business_address) like '%holywell hill%'
or lower(business_address) like '%london r%'
or lower(business_address) like '%victoria st%'
or lower(business_address) like '%hatfield r%'
  );
  
[0m14:41:23.823587 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, event_date
  );
  
[0m14:41:23.824240 [debug] [Thread-2 (]: SQL status: BEGIN in 0.073 seconds
[0m14:41:23.824471 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:23.824696 [debug] [Thread-3 (]: SQL status: BEGIN in 0.072 seconds
[0m14:41:23.824938 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m14:41:23.825205 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:23.825522 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m14:41:24.082807 [debug] [Thread-2 (]: SQL status: SELECT 6223 in 0.257 seconds
[0m14:41:24.089309 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:24.089687 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m14:41:24.097313 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m14:41:24.101464 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:24.101796 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m14:41:24.103833 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:24.104998 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:41:24.105232 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:24.105431 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: COMMIT
[0m14:41:24.113670 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m14:41:24.152761 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m14:41:24.153468 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m14:41:24.153706 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m14:41:24.153923 [debug] [Thread-3 (]: SQL status: SELECT 9083 in 0.328 seconds
[0m14:41:24.156033 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:24.156264 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m14:41:24.175285 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.019 seconds
[0m14:41:24.192782 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:24.194322 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m14:41:24.237036 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.041 seconds
[0m14:41:24.250438 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:41:24.255111 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:24.257024 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: COMMIT
[0m14:41:24.479200 [debug] [Thread-3 (]: SQL status: COMMIT in 0.217 seconds
[0m14:41:24.481654 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m14:41:24.482325 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m14:41:24.482578 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m14:41:24.497000 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.343 seconds
[0m14:41:24.498774 [debug] [Thread-2 (]: On model.highstreet_tenure.businesses: Close
[0m14:41:24.499238 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116b8e170>]}
[0m14:41:24.499661 [info ] [Thread-2 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.77s]
[0m14:41:24.499984 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.businesses
[0m14:41:24.523832 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.041 seconds
[0m14:41:24.524884 [debug] [Thread-3 (]: On model.highstreet_tenure.properties: Close
[0m14:41:24.525322 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116ad6020>]}
[0m14:41:24.525728 [info ] [Thread-3 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.80s]
[0m14:41:24.526046 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m14:41:24.526543 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.addresses
[0m14:41:24.527264 [info ] [Thread-2 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m14:41:24.527639 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m14:41:24.528347 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.addresses
[0m14:41:24.532457 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m14:41:24.534465 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.addresses
[0m14:41:24.538012 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m14:41:24.538652 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:24.538888 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: BEGIN
[0m14:41:24.539095 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:24.658519 [debug] [Thread-2 (]: SQL status: BEGIN in 0.119 seconds
[0m14:41:24.658946 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:24.659176 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m14:41:24.765600 [debug] [Thread-2 (]: SQL status: SELECT 4945 in 0.106 seconds
[0m14:41:24.768263 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:24.768558 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m14:41:24.771672 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m14:41:24.774656 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:24.774984 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m14:41:24.776967 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:24.778057 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:41:24.778295 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:24.778487 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: COMMIT
[0m14:41:24.783844 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m14:41:24.785572 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m14:41:24.786064 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m14:41:24.786276 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m14:41:24.800400 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m14:41:24.807116 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses: Close
[0m14:41:24.807901 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116ab1ae0>]}
[0m14:41:24.808448 [info ] [Thread-2 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.28s]
[0m14:41:24.808883 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.addresses
[0m14:41:26.008242 [debug] [Thread-4 (]: SQL status: SELECT 39661 in 2.184 seconds
[0m14:41:26.026750 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:26.027457 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline" rename to "business_timeline__dbt_backup"
[0m14:41:26.109749 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.082 seconds
[0m14:41:26.114592 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:26.114892 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
alter table "highstreet"."analytics_analytics"."business_timeline__dbt_tmp" rename to "business_timeline"
[0m14:41:26.117461 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m14:41:26.118481 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:41:26.118708 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:26.118903 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: COMMIT
[0m14:41:26.125458 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m14:41:26.127143 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_timeline__dbt_backup"
[0m14:41:26.127801 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_timeline"
[0m14:41:26.128087 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_timeline__dbt_backup" cascade
[0m14:41:26.144995 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.017 seconds
[0m14:41:26.145954 [debug] [Thread-4 (]: On model.highstreet_tenure.business_timeline: Close
[0m14:41:26.146364 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116b4ab00>]}
[0m14:41:26.146749 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_timeline ....... [[32mSELECT 39661[0m in 2.42s]
[0m14:41:26.147076 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_timeline
[0m14:41:26.147412 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_tenures
[0m14:41:26.147694 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m14:41:26.147975 [info ] [Thread-3 (]: 12 of 13 START sql table model analytics_analytics.business_tenures ............ [RUN]
[0m14:41:26.148242 [info ] [Thread-2 (]: 13 of 13 START sql view model analytics_analytics.business_with_full_timeline .. [RUN]
[0m14:41:26.148499 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_tenures)
[0m14:41:26.148807 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.addresses, now model.highstreet_tenure.business_with_full_timeline)
[0m14:41:26.149080 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m14:41:26.149328 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m14:41:26.151211 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m14:41:26.152971 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.153500 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.business_tenures
[0m14:41:26.157211 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.business_tenures"
[0m14:41:26.157567 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m14:41:26.169252 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.169848 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:26.170172 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: BEGIN
[0m14:41:26.170452 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:41:26.170792 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.171001 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: BEGIN
[0m14:41:26.171198 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:41:26.224092 [debug] [Thread-2 (]: SQL status: BEGIN in 0.053 seconds
[0m14:41:26.224391 [debug] [Thread-3 (]: SQL status: BEGIN in 0.054 seconds
[0m14:41:26.224667 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.224899 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:26.225160 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */

  create view "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp"
    
    
  as (
    with 

business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

new_event_counts_by_business as (
    select 
        business_name,
        count(*) as new_event_count
    from business_timeline
    where event_type = 'account_start'
    group by 1
    having count(*) > 1
),

end_event_counts_by_business as (
    select 
        business_name,
        count(*) as end_event_count
    from business_timeline
    where event_type = 'account_end'
    group by 1
    having count(*) > 1
)

select business_timeline.* 
from business_timeline
inner join new_event_counts_by_business on business_timeline.business_name = new_event_counts_by_business.business_name
inner join end_event_counts_by_business on business_timeline.business_name = end_event_counts_by_business.business_name
order by business_timeline.business_name, business_timeline.event_date desc
  );
[0m14:41:26.225414 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_timeline"
),

business_tenures as (
    select 
        business_name, 
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select 
    business_name,
    tenure_start_date,
    tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_tenures
  );
  
[0m14:41:26.265913 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.040 seconds
[0m14:41:26.268006 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.268266 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
alter table "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_tmp" rename to "business_with_full_timeline"
[0m14:41:26.272899 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:41:26.273837 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:41:26.274241 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.274453 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: COMMIT
[0m14:41:26.277804 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m14:41:26.279454 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup"
[0m14:41:26.281044 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.business_with_full_timeline"
[0m14:41:26.281306 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_with_full_timeline"} */
drop view if exists "highstreet"."analytics_analytics"."business_with_full_timeline__dbt_backup" cascade
[0m14:41:26.283080 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:41:26.283957 [debug] [Thread-2 (]: On model.highstreet_tenure.business_with_full_timeline: Close
[0m14:41:26.284439 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116945c00>]}
[0m14:41:26.284855 [info ] [Thread-2 (]: 13 of 13 OK created sql view model analytics_analytics.business_with_full_timeline  [[32mCREATE VIEW[0m in 0.14s]
[0m14:41:26.285183 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m14:41:26.518246 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.292 seconds
[0m14:41:26.524481 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:26.524777 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures" rename to "business_tenures__dbt_backup"
[0m14:41:26.529911 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m14:41:26.531693 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:26.531920 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
alter table "highstreet"."analytics_analytics"."business_tenures__dbt_tmp" rename to "business_tenures"
[0m14:41:26.533506 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:26.534511 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:41:26.534740 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:26.534936 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: COMMIT
[0m14:41:26.539013 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m14:41:26.542642 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_tenures__dbt_backup"
[0m14:41:26.543151 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.business_tenures"
[0m14:41:26.543371 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_tenures__dbt_backup" cascade
[0m14:41:26.562270 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.018 seconds
[0m14:41:26.565641 [debug] [Thread-3 (]: On model.highstreet_tenure.business_tenures: Close
[0m14:41:26.566568 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116a41a20>]}
[0m14:41:26.567133 [info ] [Thread-3 (]: 12 of 13 OK created sql table model analytics_analytics.business_tenures ....... [[32mSELECT 6223[0m in 0.42s]
[0m14:41:26.567671 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_tenures
[0m14:41:27.383930 [debug] [Thread-1 (]: SQL status: SELECT 2611 in 3.560 seconds
[0m14:41:27.389803 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:27.390117 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses" rename to "business_addresses__dbt_backup"
[0m14:41:27.394093 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m14:41:27.395883 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:27.396115 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m14:41:27.397737 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:41:27.398604 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m14:41:27.398802 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:27.398978 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m14:41:27.404989 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m14:41:27.406572 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m14:41:27.407039 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m14:41:27.407243 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m14:41:27.424198 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.015 seconds
[0m14:41:27.426749 [debug] [Thread-1 (]: On model.highstreet_tenure.business_addresses: Close
[0m14:41:27.427761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8504bd9-0ea0-4a5b-923f-9d19dde925bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116af0df0>]}
[0m14:41:27.428360 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 2611[0m in 3.70s]
[0m14:41:27.428720 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_addresses
[0m14:41:27.429566 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:27.429780 [debug] [MainThread]: On master: BEGIN
[0m14:41:27.429951 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:41:27.482167 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m14:41:27.482514 [debug] [MainThread]: On master: COMMIT
[0m14:41:27.482697 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:27.482860 [debug] [MainThread]: On master: COMMIT
[0m14:41:27.483704 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m14:41:27.483877 [debug] [MainThread]: On master: Close
[0m14:41:27.484132 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:27.484296 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_addresses' was properly closed.
[0m14:41:27.484451 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m14:41:27.484602 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_timeline' was properly closed.
[0m14:41:27.484743 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m14:41:27.484974 [info ] [MainThread]: 
[0m14:41:27.485170 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 6.54 seconds (6.54s).
[0m14:41:27.486448 [debug] [MainThread]: Command end result
[0m14:41:27.501133 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m14:41:27.502284 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m14:41:27.506775 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m14:41:27.507014 [info ] [MainThread]: 
[0m14:41:27.507249 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:41:27.507431 [info ] [MainThread]: 
[0m14:41:27.507627 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m14:41:27.510179 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.206794, "process_in_blocks": "0", "process_kernel_time": 0.225621, "process_mem_max_rss": "141918208", "process_out_blocks": "0", "process_user_time": 1.835762}
[0m14:41:27.510621 [debug] [MainThread]: Command `dbt run` succeeded at 14:41:27.510568 after 7.21 seconds
[0m14:41:27.510878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a7e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115bb0670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1156e07c0>]}
[0m14:41:27.511137 [debug] [MainThread]: Flushing usage events
[0m14:41:29.021574 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:45:21.748692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b62920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d48c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d48520>]}


============================== 16:45:21.751726 | 2084f654-d9b2-4c41-89d0-5d24c95158d4 ==============================
[0m16:45:21.751726 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:45:21.752075 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'printer_width': '80', 'warn_error': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'cache_selected_only': 'False', 'debug': 'False', 'invocation_command': 'dbt run -m addresses_with_most_tenants', 'log_cache_events': 'False', 'introspect': 'True', 'quiet': 'False', 'target_path': 'None', 'no_print': 'None', 'use_colors': 'True'}
[0m16:45:21.752377 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:45:21.752596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c8ec50>]}
[0m16:45:22.064853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106000d00>]}
[0m16:45:22.107882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049cd240>]}
[0m16:45:22.108819 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:45:22.202382 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:45:22.279103 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m16:45:22.279510 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/addresses_with_most_tenants.sql
[0m16:45:22.279738 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m16:45:22.465114 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m16:45:22.473328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d39420>]}
[0m16:45:22.519049 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:22.520740 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:22.533938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ab4910>]}
[0m16:45:22.534295 [info ] [MainThread]: Found 14 models, 5 sources, 434 macros
[0m16:45:22.534530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f50940>]}
[0m16:45:22.535318 [info ] [MainThread]: 
[0m16:45:22.535520 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:45:22.535686 [info ] [MainThread]: 
[0m16:45:22.535966 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:45:22.536414 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:45:22.609786 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:45:22.610102 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:45:22.610278 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:22.831415 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.221 seconds
[0m16:45:22.832595 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:45:22.836247 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:45:22.840063 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:22.840316 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:45:22.840696 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:45:22.902210 [debug] [ThreadPool]: SQL status: BEGIN in 0.061 seconds
[0m16:45:22.902536 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:45:22.902727 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:45:22.977554 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.074 seconds
[0m16:45:22.980256 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:45:22.982292 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:45:22.989465 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:22.989755 [debug] [MainThread]: On master: BEGIN
[0m16:45:22.989930 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:45:23.046050 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m16:45:23.047151 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.048095 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:45:23.506873 [debug] [MainThread]: SQL status: SELECT 1 in 0.458 seconds
[0m16:45:23.507844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d38ee0>]}
[0m16:45:23.508129 [debug] [MainThread]: On master: ROLLBACK
[0m16:45:23.509924 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.510261 [debug] [MainThread]: On master: BEGIN
[0m16:45:23.511797 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m16:45:23.512043 [debug] [MainThread]: On master: COMMIT
[0m16:45:23.512225 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.512384 [debug] [MainThread]: On master: COMMIT
[0m16:45:23.513232 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:23.513527 [debug] [MainThread]: On master: Close
[0m16:45:23.515487 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.addresses_with_most_tenants
[0m16:45:23.515846 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics_analytics.addresses_with_most_tenants .... [RUN]
[0m16:45:23.516218 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.addresses_with_most_tenants)
[0m16:45:23.516425 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.addresses_with_most_tenants
[0m16:45:23.520912 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.521394 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.addresses_with_most_tenants
[0m16:45:23.541377 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.542161 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.542470 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: BEGIN
[0m16:45:23.542743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:45:23.592999 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m16:45:23.593414 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.593645 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */

  create view "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_tmp"
    
    
  as (
    with business_addresses as (
    select * from "highstreet"."analytics_analytics"."business_addresses"
)

select 
    business_address,
    postcode,
    count(distinct business_name) as tenant_count
from business_addresses
group by 1, 2
  );
[0m16:45:23.637354 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.043 seconds
[0m16:45:23.641082 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.641331 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
alter table "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_tmp" rename to "addresses_with_most_tenants"
[0m16:45:23.645205 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:45:23.652681 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: COMMIT
[0m16:45:23.652930 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.653133 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: COMMIT
[0m16:45:23.656220 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:45:23.659566 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_backup"
[0m16:45:23.661853 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:45:23.662085 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
drop view if exists "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_backup" cascade
[0m16:45:23.663716 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:45:23.665137 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: Close
[0m16:45:23.666407 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2084f654-d9b2-4c41-89d0-5d24c95158d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a6de10>]}
[0m16:45:23.666856 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics_analytics.addresses_with_most_tenants  [[32mCREATE VIEW[0m in 0.15s]
[0m16:45:23.667409 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.addresses_with_most_tenants
[0m16:45:23.668150 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.668382 [debug] [MainThread]: On master: BEGIN
[0m16:45:23.668552 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:45:23.721187 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:45:23.721579 [debug] [MainThread]: On master: COMMIT
[0m16:45:23.721773 [debug] [MainThread]: Using postgres connection "master"
[0m16:45:23.721947 [debug] [MainThread]: On master: COMMIT
[0m16:45:23.722816 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:45:23.723013 [debug] [MainThread]: On master: Close
[0m16:45:23.723488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:45:23.723668 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses_with_most_tenants' was properly closed.
[0m16:45:23.723854 [info ] [MainThread]: 
[0m16:45:23.724042 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.19 seconds (1.19s).
[0m16:45:23.724398 [debug] [MainThread]: Command end result
[0m16:45:23.739704 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:45:23.740827 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:45:23.744988 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:45:23.745272 [info ] [MainThread]: 
[0m16:45:23.745537 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:45:23.745729 [info ] [MainThread]: 
[0m16:45:23.746034 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:45:23.746525 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:45:23.779765 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.0822017, "process_in_blocks": "0", "process_kernel_time": 0.253094, "process_mem_max_rss": "143638528", "process_out_blocks": "0", "process_user_time": 1.403141}
[0m16:45:23.780306 [debug] [MainThread]: Command `dbt run` succeeded at 16:45:23.780244 after 2.08 seconds
[0m16:45:23.780596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b62920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b508e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106000d00>]}
[0m16:45:23.780870 [debug] [MainThread]: Flushing usage events
[0m16:45:24.215880 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:55:27.514158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c96950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109314d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109314640>]}


============================== 16:55:27.517284 | b1175fc7-62da-417f-99d2-4d015174ba36 ==============================
[0m16:55:27.517284 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:55:27.517638 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'target_path': 'None', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'introspect': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'version_check': 'True', 'debug': 'False', 'invocation_command': 'dbt run -m addresses_with_most_tenants', 'printer_width': '80', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'cache_selected_only': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'warn_error': 'None'}
[0m16:55:27.517971 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:55:27.518187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10925fa00>]}
[0m16:55:27.693201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fd4d90>]}
[0m16:55:27.736799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092edd20>]}
[0m16:55:27.737622 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:55:27.802890 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:55:27.882783 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:55:27.883243 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/addresses_with_most_tenants.sql
[0m16:55:28.118338 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m16:55:28.126614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a539480>]}
[0m16:55:28.174198 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:55:28.175860 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:55:28.188999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a512c80>]}
[0m16:55:28.189381 [info ] [MainThread]: Found 14 models, 5 sources, 434 macros
[0m16:55:28.189738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a512dd0>]}
[0m16:55:28.190592 [info ] [MainThread]: 
[0m16:55:28.190806 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:55:28.190971 [info ] [MainThread]: 
[0m16:55:28.191247 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:55:28.191771 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:55:28.225126 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:55:28.225469 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:55:28.225661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:55:28.364140 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.138 seconds
[0m16:55:28.365118 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:55:28.368559 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:55:28.372377 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:55:28.372672 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:55:28.372906 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:55:28.438187 [debug] [ThreadPool]: SQL status: BEGIN in 0.065 seconds
[0m16:55:28.438565 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:55:28.438789 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:55:28.520322 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.081 seconds
[0m16:55:28.525966 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:55:28.528661 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:55:28.533097 [debug] [MainThread]: Using postgres connection "master"
[0m16:55:28.533352 [debug] [MainThread]: On master: BEGIN
[0m16:55:28.533525 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:55:28.594930 [debug] [MainThread]: SQL status: BEGIN in 0.061 seconds
[0m16:55:28.596061 [debug] [MainThread]: Using postgres connection "master"
[0m16:55:28.598017 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:55:29.051262 [debug] [MainThread]: SQL status: SELECT 2 in 0.452 seconds
[0m16:55:29.056662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3b7fa0>]}
[0m16:55:29.057264 [debug] [MainThread]: On master: ROLLBACK
[0m16:55:29.060140 [debug] [MainThread]: Using postgres connection "master"
[0m16:55:29.060522 [debug] [MainThread]: On master: BEGIN
[0m16:55:29.063436 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m16:55:29.063734 [debug] [MainThread]: On master: COMMIT
[0m16:55:29.063940 [debug] [MainThread]: Using postgres connection "master"
[0m16:55:29.064118 [debug] [MainThread]: On master: COMMIT
[0m16:55:29.065278 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:55:29.065496 [debug] [MainThread]: On master: Close
[0m16:55:29.071157 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.addresses_with_most_tenants
[0m16:55:29.072098 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics_analytics.addresses_with_most_tenants .... [RUN]
[0m16:55:29.073162 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.addresses_with_most_tenants)
[0m16:55:29.073745 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.addresses_with_most_tenants
[0m16:55:29.078647 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.079186 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.addresses_with_most_tenants
[0m16:55:29.101470 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.102288 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.102640 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: BEGIN
[0m16:55:29.102869 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:55:29.157281 [debug] [Thread-1 (]: SQL status: BEGIN in 0.054 seconds
[0m16:55:29.157693 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.157934 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */

  create view "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_tmp"
    
    
  as (
    with business_addresses as (
    select * from "highstreet"."analytics_analytics"."business_addresses"
)

select 
    business_address,
    postcode,
    left(postcode, 4) as postcode_three_letter,
    count(distinct business_name) as tenant_count
from business_addresses
group by 1, 2
  );
[0m16:55:29.199226 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.041 seconds
[0m16:55:29.203168 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.203415 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
alter table "highstreet"."analytics_analytics"."addresses_with_most_tenants" rename to "addresses_with_most_tenants__dbt_backup"
[0m16:55:29.207340 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m16:55:29.209126 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.209352 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
alter table "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_tmp" rename to "addresses_with_most_tenants"
[0m16:55:29.214210 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m16:55:29.222808 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: COMMIT
[0m16:55:29.223109 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.223331 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: COMMIT
[0m16:55:29.229736 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m16:55:29.233118 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_backup"
[0m16:55:29.235535 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m16:55:29.235789 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
drop view if exists "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_backup" cascade
[0m16:55:29.245299 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m16:55:29.246819 [debug] [Thread-1 (]: On model.highstreet_tenure.addresses_with_most_tenants: Close
[0m16:55:29.248064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1175fc7-62da-417f-99d2-4d015174ba36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a514310>]}
[0m16:55:29.248470 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics_analytics.addresses_with_most_tenants  [[32mCREATE VIEW[0m in 0.17s]
[0m16:55:29.248814 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.addresses_with_most_tenants
[0m16:55:29.249590 [debug] [MainThread]: Using postgres connection "master"
[0m16:55:29.249824 [debug] [MainThread]: On master: BEGIN
[0m16:55:29.250007 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:55:29.301916 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m16:55:29.302258 [debug] [MainThread]: On master: COMMIT
[0m16:55:29.302453 [debug] [MainThread]: Using postgres connection "master"
[0m16:55:29.302618 [debug] [MainThread]: On master: COMMIT
[0m16:55:29.303468 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:55:29.303704 [debug] [MainThread]: On master: Close
[0m16:55:29.303974 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:55:29.304150 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses_with_most_tenants' was properly closed.
[0m16:55:29.304333 [info ] [MainThread]: 
[0m16:55:29.304519 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.11 seconds (1.11s).
[0m16:55:29.304898 [debug] [MainThread]: Command end result
[0m16:55:29.318515 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:55:29.319609 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:55:29.324734 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:55:29.325017 [info ] [MainThread]: 
[0m16:55:29.325269 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:55:29.325457 [info ] [MainThread]: 
[0m16:55:29.325665 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:55:29.325989 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:55:29.328716 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8661417, "process_in_blocks": "0", "process_kernel_time": 0.220916, "process_mem_max_rss": "139870208", "process_out_blocks": "0", "process_user_time": 1.430195}
[0m16:55:29.329125 [debug] [MainThread]: Command `dbt run` succeeded at 16:55:29.329075 after 1.87 seconds
[0m16:55:29.329354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c96950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b886a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108709240>]}
[0m16:55:29.329576 [debug] [MainThread]: Flushing usage events
[0m16:55:29.835632 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:05:27.860229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103856950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ed8c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ed84f0>]}


============================== 15:05:27.863267 | 1f057074-d02d-4d2e-bcba-3d696485c452 ==============================
[0m15:05:27.863267 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:05:27.863632 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'quiet': 'False', 'debug': 'False', 'static_parser': 'True', 'no_print': 'None', 'invocation_command': 'dbt run -m business_address_timeline', 'empty': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'printer_width': '80', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure'}
[0m15:05:27.863917 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:05:27.864130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e1d660>]}
[0m15:05:28.226007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fc1180>]}
[0m15:05:28.270199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eb02b0>]}
[0m15:05:28.271087 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:05:28.358130 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:05:28.435771 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:05:28.436177 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/business_address_timeline.sql
[0m15:05:28.622080 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m15:05:28.630752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cfda80>]}
[0m15:05:28.676111 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:05:28.677692 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:05:28.691513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7b940>]}
[0m15:05:28.691857 [info ] [MainThread]: Found 15 models, 5 sources, 434 macros
[0m15:05:28.692073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7a200>]}
[0m15:05:28.692853 [info ] [MainThread]: 
[0m15:05:28.693060 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:05:28.693229 [info ] [MainThread]: 
[0m15:05:28.693516 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:05:28.693965 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:05:28.737532 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:05:28.737849 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:05:28.738025 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:28.866163 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.128 seconds
[0m15:05:28.867003 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:05:28.870048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:05:28.873787 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:05:28.874080 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:05:28.874252 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:05:28.928902 [debug] [ThreadPool]: SQL status: BEGIN in 0.055 seconds
[0m15:05:28.929228 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:05:28.929428 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:05:28.989537 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.060 seconds
[0m15:05:28.990542 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:05:28.992677 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:05:28.996952 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:28.997227 [debug] [MainThread]: On master: BEGIN
[0m15:05:28.997402 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:05:29.063119 [debug] [MainThread]: SQL status: BEGIN in 0.066 seconds
[0m15:05:29.063527 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:29.063891 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:05:29.524796 [debug] [MainThread]: SQL status: SELECT 2 in 0.460 seconds
[0m15:05:29.529490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7a050>]}
[0m15:05:29.530419 [debug] [MainThread]: On master: ROLLBACK
[0m15:05:29.532057 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:29.532282 [debug] [MainThread]: On master: BEGIN
[0m15:05:29.533698 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:05:29.534336 [debug] [MainThread]: On master: COMMIT
[0m15:05:29.534827 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:29.535298 [debug] [MainThread]: On master: COMMIT
[0m15:05:29.536356 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:05:29.536858 [debug] [MainThread]: On master: Close
[0m15:05:29.540628 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_timeline
[0m15:05:29.541031 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_timeline ..... [RUN]
[0m15:05:29.541461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_timeline)
[0m15:05:29.541685 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_timeline
[0m15:05:29.547027 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_timeline"
[0m15:05:29.547689 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_timeline
[0m15:05:29.569701 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_timeline"
[0m15:05:29.570406 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m15:05:29.570645 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: BEGIN
[0m15:05:29.570850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:05:29.619246 [debug] [Thread-1 (]: SQL status: BEGIN in 0.048 seconds
[0m15:05:29.619594 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m15:05:29.619885 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        full_property_address as business_address,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        full_property_address as business_address,
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        full_property_address as business_address,
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        full_property_address as business_address,
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, business_address, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, business_address, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, business_address, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, business_address, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    business_name, business_address, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, business_address, event_date
  );
  
[0m15:05:32.609349 [debug] [Thread-1 (]: SQL status: SELECT 56080 in 2.989 seconds
[0m15:05:32.619457 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m15:05:32.619782 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */
alter table "highstreet"."analytics_analytics"."business_address_timeline__dbt_tmp" rename to "business_address_timeline"
[0m15:05:32.623382 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:05:32.631287 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: COMMIT
[0m15:05:32.631604 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m15:05:32.631816 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: COMMIT
[0m15:05:32.640423 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m15:05:32.643862 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_timeline__dbt_backup"
[0m15:05:32.646090 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m15:05:32.646311 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_timeline__dbt_backup" cascade
[0m15:05:32.648303 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:05:32.649867 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: Close
[0m15:05:32.651085 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f057074-d02d-4d2e-bcba-3d696485c452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b881c0>]}
[0m15:05:32.651524 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_timeline  [[32mSELECT 56080[0m in 3.11s]
[0m15:05:32.651908 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_timeline
[0m15:05:32.652627 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:32.652834 [debug] [MainThread]: On master: BEGIN
[0m15:05:32.652999 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:05:32.709016 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m15:05:32.709371 [debug] [MainThread]: On master: COMMIT
[0m15:05:32.709569 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:32.709746 [debug] [MainThread]: On master: COMMIT
[0m15:05:32.710703 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:05:32.710892 [debug] [MainThread]: On master: Close
[0m15:05:32.711237 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:05:32.711547 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_timeline' was properly closed.
[0m15:05:32.711760 [info ] [MainThread]: 
[0m15:05:32.711968 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.02 seconds (4.02s).
[0m15:05:32.712353 [debug] [MainThread]: Command end result
[0m15:05:32.727575 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:05:32.728848 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:05:32.732914 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:05:32.733140 [info ] [MainThread]: 
[0m15:05:32.733392 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:05:32.733575 [info ] [MainThread]: 
[0m15:05:32.733763 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:05:32.734114 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:05:32.750878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.942942, "process_in_blocks": "0", "process_kernel_time": 0.263785, "process_mem_max_rss": "139280384", "process_out_blocks": "0", "process_user_time": 1.411525}
[0m15:05:32.751356 [debug] [MainThread]: Command `dbt run` succeeded at 15:05:32.751301 after 4.94 seconds
[0m15:05:32.751826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103856950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053c9270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e6abc0>]}
[0m15:05:32.752110 [debug] [MainThread]: Flushing usage events
[0m15:05:33.185244 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:24:26.762429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107082950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cc4d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cc4640>]}


============================== 15:24:26.766389 | a095458b-ab55-40cb-99fd-28180657b58d ==============================
[0m15:24:26.766389 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:24:26.766885 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'printer_width': '80', 'no_print': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_colors': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'debug': 'False', 'invocation_command': 'dbt run -m business_address_tenures', 'write_json': 'True', 'empty': 'False', 'warn_error': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'static_parser': 'True'}
[0m15:24:26.767218 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:24:26.767522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c0ba00>]}
[0m15:24:26.941471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073c0d90>]}
[0m15:24:26.986450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c9dd20>]}
[0m15:24:26.987474 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:24:27.055019 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:24:27.138292 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:24:27.138722 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m15:24:27.332324 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m15:24:27.341340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d91930>]}
[0m15:24:27.390854 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:24:27.392707 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:24:27.406400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fa39a0>]}
[0m15:24:27.406797 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m15:24:27.407010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fa3b20>]}
[0m15:24:27.407831 [info ] [MainThread]: 
[0m15:24:27.408037 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:24:27.408204 [info ] [MainThread]: 
[0m15:24:27.408484 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:24:27.408937 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:24:27.441978 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:24:27.442310 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:24:27.442484 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:24:27.556649 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.114 seconds
[0m15:24:27.557587 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:24:27.560865 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:24:27.564495 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:24:27.564741 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:24:27.564936 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:27.617550 [debug] [ThreadPool]: SQL status: BEGIN in 0.053 seconds
[0m15:24:27.617897 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:24:27.618089 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:24:27.695165 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.077 seconds
[0m15:24:27.696138 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:24:27.699904 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:24:27.704360 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:27.704652 [debug] [MainThread]: On master: BEGIN
[0m15:24:27.704834 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:24:27.753877 [debug] [MainThread]: SQL status: BEGIN in 0.049 seconds
[0m15:24:27.754216 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:27.754464 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:24:28.225870 [debug] [MainThread]: SQL status: SELECT 2 in 0.471 seconds
[0m15:24:28.226971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cf9720>]}
[0m15:24:28.227259 [debug] [MainThread]: On master: ROLLBACK
[0m15:24:28.228990 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:28.229196 [debug] [MainThread]: On master: BEGIN
[0m15:24:28.230632 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:24:28.230826 [debug] [MainThread]: On master: COMMIT
[0m15:24:28.230991 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:28.231151 [debug] [MainThread]: On master: COMMIT
[0m15:24:28.231957 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:24:28.232139 [debug] [MainThread]: On master: Close
[0m15:24:28.233794 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m15:24:28.234232 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m15:24:28.234715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m15:24:28.235034 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m15:24:28.239783 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m15:24:28.240319 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m15:24:28.262153 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m15:24:28.262842 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:28.263067 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m15:24:28.263263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:24:28.315194 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m15:24:28.315541 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:28.315761 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

business_tenures as (
    select 
        business_name,
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_timeline
    group by 1
)

select 
    business_name,
    business_address,
    tenure_start_date,
    tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_tenures
  );
  
[0m15:24:28.331090 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "business_timeline.business_address" must appear in the GROUP BY clause or be used in an aggregate function
LINE 21:         business_address,
                 ^

[0m15:24:28.331455 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: ROLLBACK
[0m15:24:28.332644 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m15:24:28.337125 [debug] [Thread-1 (]: Database Error in model business_address_tenures (models/2_int/business_address_tenures.sql)
  column "business_timeline.business_address" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 21:         business_address,
                   ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_address_tenures.sql
[0m15:24:28.338528 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a095458b-ab55-40cb-99fd-28180657b58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ed7280>]}
[0m15:24:28.339075 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics_analytics.business_address_tenures  [[31mERROR[0m in 0.10s]
[0m15:24:28.339455 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m15:24:28.339802 [debug] [Thread-7 (]: Marking all children of 'model.highstreet_tenure.business_address_tenures' to be skipped because of status 'error'.  Reason: Database Error in model business_address_tenures (models/2_int/business_address_tenures.sql)
  column "business_timeline.business_address" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 21:         business_address,
                   ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_address_tenures.sql.
[0m15:24:28.340842 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:28.341064 [debug] [MainThread]: On master: BEGIN
[0m15:24:28.341240 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:24:28.396977 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m15:24:28.397319 [debug] [MainThread]: On master: COMMIT
[0m15:24:28.397501 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:28.397662 [debug] [MainThread]: On master: COMMIT
[0m15:24:28.398602 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:24:28.398790 [debug] [MainThread]: On master: Close
[0m15:24:28.399043 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:24:28.399230 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m15:24:28.399417 [info ] [MainThread]: 
[0m15:24:28.399601 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.99 seconds (0.99s).
[0m15:24:28.400181 [debug] [MainThread]: Command end result
[0m15:24:28.414214 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:24:28.415273 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:24:28.419048 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:24:28.419317 [info ] [MainThread]: 
[0m15:24:28.419641 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:24:28.419871 [info ] [MainThread]: 
[0m15:24:28.420099 [error] [MainThread]: [31mFailure in model business_address_tenures (models/2_int/business_address_tenures.sql)[0m
[0m15:24:28.420314 [error] [MainThread]:   Database Error in model business_address_tenures (models/2_int/business_address_tenures.sql)
  column "business_timeline.business_address" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 21:         business_address,
                   ^
  compiled code at target/run/highstreet_tenure/models/2_int/business_address_tenures.sql
[0m15:24:28.420484 [info ] [MainThread]: 
[0m15:24:28.420674 [info ] [MainThread]:   compiled code at target/compiled/highstreet_tenure/models/2_int/business_address_tenures.sql
[0m15:24:28.420834 [info ] [MainThread]: 
[0m15:24:28.421018 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:24:28.421314 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:24:28.423969 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7157778, "process_in_blocks": "0", "process_kernel_time": 0.225073, "process_mem_max_rss": "141672448", "process_out_blocks": "0", "process_user_time": 1.395352}
[0m15:24:28.424314 [debug] [MainThread]: Command `dbt run` failed at 15:24:28.424262 after 1.72 seconds
[0m15:24:28.424571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107082950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114145ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114144df0>]}
[0m15:24:28.424821 [debug] [MainThread]: Flushing usage events
[0m15:24:28.879809 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:24:57.359750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108082950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc0d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc0640>]}


============================== 15:24:57.362784 | 4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41 ==============================
[0m15:24:57.362784 [info ] [MainThread]: Running with dbt=1.10.11
[0m15:24:57.363137 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'write_json': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'introspect': 'True', 'debug': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'empty': 'False', 'invocation_command': 'dbt run -m business_address_tenures', 'printer_width': '80', 'fail_fast': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'log_format': 'default'}
[0m15:24:57.363447 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m15:24:57.363662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c0ba00>]}
[0m15:24:57.494889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108500d90>]}
[0m15:24:57.536196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c95d20>]}
[0m15:24:57.537267 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m15:24:57.603789 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m15:24:57.679578 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:24:57.679999 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m15:24:57.866831 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m15:24:57.874975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c52a740>]}
[0m15:24:57.920859 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:24:57.922306 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:24:57.933988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3a34f0>]}
[0m15:24:57.934333 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m15:24:57.934598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3b4760>]}
[0m15:24:57.935477 [info ] [MainThread]: 
[0m15:24:57.935697 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:24:57.935871 [info ] [MainThread]: 
[0m15:24:57.936180 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:24:57.936643 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m15:24:57.969901 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m15:24:57.970240 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m15:24:57.970421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:24:58.093541 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.123 seconds
[0m15:24:58.094928 [debug] [ThreadPool]: On list_highstreet: Close
[0m15:24:58.098933 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m15:24:58.103056 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:24:58.103351 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m15:24:58.103540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:58.158602 [debug] [ThreadPool]: SQL status: BEGIN in 0.055 seconds
[0m15:24:58.158951 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m15:24:58.159152 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m15:24:58.223093 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.064 seconds
[0m15:24:58.224094 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m15:24:58.226268 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m15:24:58.230347 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:58.230564 [debug] [MainThread]: On master: BEGIN
[0m15:24:58.230746 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:24:58.279273 [debug] [MainThread]: SQL status: BEGIN in 0.048 seconds
[0m15:24:58.279622 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:58.279865 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:24:58.735139 [debug] [MainThread]: SQL status: SELECT 2 in 0.455 seconds
[0m15:24:58.739147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c7b070>]}
[0m15:24:58.740322 [debug] [MainThread]: On master: ROLLBACK
[0m15:24:58.742357 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:58.742578 [debug] [MainThread]: On master: BEGIN
[0m15:24:58.744218 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:24:58.744954 [debug] [MainThread]: On master: COMMIT
[0m15:24:58.745541 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:58.746066 [debug] [MainThread]: On master: COMMIT
[0m15:24:58.747132 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:24:58.747636 [debug] [MainThread]: On master: Close
[0m15:24:58.751180 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m15:24:58.751641 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m15:24:58.752020 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m15:24:58.752259 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m15:24:58.757118 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m15:24:58.757737 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m15:24:58.782786 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m15:24:58.783559 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:58.783798 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m15:24:58.784013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:24:58.835751 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m15:24:58.836138 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:58.836377 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

business_address_tenures as (
    select 
        business_name,
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m15:24:59.317453 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.481 seconds
[0m15:24:59.325542 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:59.325860 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m15:24:59.329029 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m15:24:59.339531 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m15:24:59.339848 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:59.340054 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m15:24:59.352202 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m15:24:59.357698 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m15:24:59.362574 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m15:24:59.363056 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m15:24:59.365153 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m15:24:59.366735 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m15:24:59.368082 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a0d4cd2-a769-4fdc-9f55-0a7db9b2fd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d8b490>]}
[0m15:24:59.368561 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 11450[0m in 0.62s]
[0m15:24:59.369033 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m15:24:59.369868 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:59.370116 [debug] [MainThread]: On master: BEGIN
[0m15:24:59.370275 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:24:59.424561 [debug] [MainThread]: SQL status: BEGIN in 0.054 seconds
[0m15:24:59.424938 [debug] [MainThread]: On master: COMMIT
[0m15:24:59.425138 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:59.425308 [debug] [MainThread]: On master: COMMIT
[0m15:24:59.426253 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:24:59.426580 [debug] [MainThread]: On master: Close
[0m15:24:59.426934 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:24:59.427167 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m15:24:59.427381 [info ] [MainThread]: 
[0m15:24:59.427711 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.49 seconds (1.49s).
[0m15:24:59.428141 [debug] [MainThread]: Command end result
[0m15:24:59.442833 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m15:24:59.444324 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m15:24:59.448427 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m15:24:59.448686 [info ] [MainThread]: 
[0m15:24:59.448930 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:24:59.449116 [info ] [MainThread]: 
[0m15:24:59.449308 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:24:59.449662 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:24:59.452159 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1419852, "process_in_blocks": "0", "process_kernel_time": 0.201125, "process_mem_max_rss": "140967936", "process_out_blocks": "0", "process_user_time": 1.39537}
[0m15:24:59.452546 [debug] [MainThread]: Command `dbt run` succeeded at 15:24:59.452496 after 2.14 seconds
[0m15:24:59.452806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108082950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c95d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5ece80>]}
[0m15:24:59.453042 [debug] [MainThread]: Flushing usage events
[0m15:24:59.846665 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:40:38.859275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10337e9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049fcc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049fc550>]}


============================== 16:40:38.862978 | 61b01543-fed2-4176-85ee-a05ddbadbd9a ==============================
[0m16:40:38.862978 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:40:38.863427 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'static_parser': 'True', 'use_colors': 'True', 'target_path': 'None', 'fail_fast': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'invocation_command': 'dbt run -m business_address_tenures', 'use_experimental_parser': 'False', 'quiet': 'False', 'no_print': 'None'}
[0m16:40:38.863763 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:40:38.863991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103dec730>]}
[0m16:40:39.036615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e21fc0>]}
[0m16:40:39.083733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103626740>]}
[0m16:40:39.084664 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:40:39.151430 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:40:39.231527 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:40:39.231996 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m16:40:39.428325 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m16:40:39.436978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10582e080>]}
[0m16:40:39.482004 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:40:39.483832 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:40:39.498122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10568e200>]}
[0m16:40:39.498490 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m16:40:39.498705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f532b0>]}
[0m16:40:39.499504 [info ] [MainThread]: 
[0m16:40:39.499713 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:40:39.499878 [info ] [MainThread]: 
[0m16:40:39.500167 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:40:39.500651 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:40:39.534130 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:40:39.534435 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:40:39.534607 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:40:39.658695 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.124 seconds
[0m16:40:39.659597 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:40:39.662922 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:40:39.666536 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:40:39.666865 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:40:39.667065 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:40:39.724029 [debug] [ThreadPool]: SQL status: BEGIN in 0.057 seconds
[0m16:40:39.724374 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:40:39.724583 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:40:39.789538 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.065 seconds
[0m16:40:39.790551 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:40:39.793741 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:40:39.797932 [debug] [MainThread]: Using postgres connection "master"
[0m16:40:39.798165 [debug] [MainThread]: On master: BEGIN
[0m16:40:39.798337 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:40:39.850935 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m16:40:39.851363 [debug] [MainThread]: Using postgres connection "master"
[0m16:40:39.851741 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:40:40.342778 [debug] [MainThread]: SQL status: SELECT 2 in 0.491 seconds
[0m16:40:40.344013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b70d0>]}
[0m16:40:40.344420 [debug] [MainThread]: On master: ROLLBACK
[0m16:40:40.346335 [debug] [MainThread]: Using postgres connection "master"
[0m16:40:40.346657 [debug] [MainThread]: On master: BEGIN
[0m16:40:40.348534 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:40:40.348782 [debug] [MainThread]: On master: COMMIT
[0m16:40:40.348963 [debug] [MainThread]: Using postgres connection "master"
[0m16:40:40.349125 [debug] [MainThread]: On master: COMMIT
[0m16:40:40.350094 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:40:40.350397 [debug] [MainThread]: On master: Close
[0m16:40:40.353100 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m16:40:40.353603 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m16:40:40.353919 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m16:40:40.354140 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m16:40:40.358905 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.359471 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m16:40:40.382002 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.382725 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.382982 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m16:40:40.383198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:40:40.433823 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m16:40:40.434218 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.434462 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

business_address_tenures as (
    select 
        business_name,
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case when tenure_end_date = tenure_start_date then NULL else tenure_end_date end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m16:40:40.912339 [debug] [Thread-1 (]: SQL status: SELECT 11450 in 0.478 seconds
[0m16:40:40.918393 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.918718 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m16:40:40.921860 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:40:40.923904 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.924154 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m16:40:40.925935 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:40:40.934443 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m16:40:40.934702 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.934917 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m16:40:40.946562 [debug] [Thread-1 (]: SQL status: COMMIT in 0.011 seconds
[0m16:40:40.950066 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m16:40:40.952363 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:40:40.952646 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m16:40:40.967069 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:40:40.968823 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m16:40:40.970120 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61b01543-fed2-4176-85ee-a05ddbadbd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b70d0>]}
[0m16:40:40.970586 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 11450[0m in 0.62s]
[0m16:40:40.970936 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m16:40:40.971635 [debug] [MainThread]: Using postgres connection "master"
[0m16:40:40.971841 [debug] [MainThread]: On master: BEGIN
[0m16:40:40.972006 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:40:41.028710 [debug] [MainThread]: SQL status: BEGIN in 0.057 seconds
[0m16:40:41.029065 [debug] [MainThread]: On master: COMMIT
[0m16:40:41.029257 [debug] [MainThread]: Using postgres connection "master"
[0m16:40:41.029424 [debug] [MainThread]: On master: COMMIT
[0m16:40:41.030396 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:40:41.030754 [debug] [MainThread]: On master: Close
[0m16:40:41.031103 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:40:41.031297 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m16:40:41.031497 [info ] [MainThread]: 
[0m16:40:41.031700 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.53 seconds (1.53s).
[0m16:40:41.032092 [debug] [MainThread]: Command end result
[0m16:40:41.048726 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:40:41.049910 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:40:41.053521 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:40:41.053732 [info ] [MainThread]: 
[0m16:40:41.053972 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:40:41.054155 [info ] [MainThread]: 
[0m16:40:41.054345 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:40:41.054654 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:40:41.063852 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.2625368, "process_in_blocks": "0", "process_kernel_time": 0.241287, "process_mem_max_rss": "141115392", "process_out_blocks": "0", "process_user_time": 1.430934}
[0m16:40:41.064350 [debug] [MainThread]: Command `dbt run` succeeded at 16:40:41.064295 after 2.26 seconds
[0m16:40:41.064598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10337e9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1021bdc00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f29660>]}
[0m16:40:41.064826 [debug] [MainThread]: Flushing usage events
[0m16:40:41.505079 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:53:22.079939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105632980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cb0dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cb06a0>]}


============================== 16:53:22.083133 | 12f782a2-c9fc-4f9c-acc4-8fdd681b802a ==============================
[0m16:53:22.083133 [info ] [MainThread]: Running with dbt=1.10.11
[0m16:53:22.083501 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'log_format': 'default', 'printer_width': '80', 'debug': 'False', 'quiet': 'False', 'target_path': 'None', 'version_check': 'True', 'warn_error': 'None', 'no_print': 'None', 'fail_fast': 'False', 'log_cache_events': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'use_colors': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'introspect': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run -m business_address_tenures'}
[0m16:53:22.083833 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m16:53:22.084044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bf9630>]}
[0m16:53:22.257437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c43b50>]}
[0m16:53:22.301856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd53c0>]}
[0m16:53:22.302763 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m16:53:22.370183 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m16:53:22.449000 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:53:22.449465 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m16:53:22.645675 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m16:53:22.654066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b5d0c0>]}
[0m16:53:22.699924 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:53:22.701578 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:53:22.714063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c412d0>]}
[0m16:53:22.714384 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m16:53:22.714590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aa3130>]}
[0m16:53:22.715369 [info ] [MainThread]: 
[0m16:53:22.715575 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:53:22.715742 [info ] [MainThread]: 
[0m16:53:22.716018 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:53:22.716461 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m16:53:22.749056 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m16:53:22.749366 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m16:53:22.749539 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:53:22.880975 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.131 seconds
[0m16:53:22.881859 [debug] [ThreadPool]: On list_highstreet: Close
[0m16:53:22.885088 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m16:53:22.888690 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:53:22.888964 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m16:53:22.889131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:53:22.959722 [debug] [ThreadPool]: SQL status: BEGIN in 0.071 seconds
[0m16:53:22.960078 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m16:53:22.960328 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m16:53:23.034517 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.074 seconds
[0m16:53:23.035601 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m16:53:23.037635 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m16:53:23.041952 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:23.042183 [debug] [MainThread]: On master: BEGIN
[0m16:53:23.042350 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:53:23.118084 [debug] [MainThread]: SQL status: BEGIN in 0.076 seconds
[0m16:53:23.118467 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:23.118732 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:53:23.643422 [debug] [MainThread]: SQL status: SELECT 2 in 0.519 seconds
[0m16:53:23.646283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c6b0a0>]}
[0m16:53:23.647040 [debug] [MainThread]: On master: ROLLBACK
[0m16:53:23.648985 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:23.649285 [debug] [MainThread]: On master: BEGIN
[0m16:53:23.651620 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:53:23.651896 [debug] [MainThread]: On master: COMMIT
[0m16:53:23.652087 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:23.652259 [debug] [MainThread]: On master: COMMIT
[0m16:53:23.653306 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:53:23.653617 [debug] [MainThread]: On master: Close
[0m16:53:23.655638 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m16:53:23.656120 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m16:53:23.656428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m16:53:23.656643 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m16:53:23.661363 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m16:53:23.661811 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m16:53:23.684193 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m16:53:23.684837 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:53:23.685074 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m16:53:23.685280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:53:23.738113 [debug] [Thread-1 (]: SQL status: BEGIN in 0.053 seconds
[0m16:53:23.738484 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:53:23.738746 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- replace "&" with "and"
                            business_name,
                            '&', 'and', 'gi'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\s+', ' ', 'g'
                )
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m16:53:25.314282 [debug] [Thread-1 (]: SQL status: SELECT 9930 in 1.575 seconds
[0m16:53:25.322358 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:53:25.322729 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m16:53:25.325757 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m16:53:25.327727 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:53:25.327984 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m16:53:25.329771 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:53:25.340475 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m16:53:25.340972 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:53:25.341270 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m16:53:25.351448 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m16:53:25.354970 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m16:53:25.358258 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m16:53:25.358625 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m16:53:25.372584 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m16:53:25.374201 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m16:53:25.375442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12f782a2-c9fc-4f9c-acc4-8fdd681b802a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c11a80>]}
[0m16:53:25.375882 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9930[0m in 1.72s]
[0m16:53:25.376238 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m16:53:25.376959 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:25.377153 [debug] [MainThread]: On master: BEGIN
[0m16:53:25.377319 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:53:25.428147 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m16:53:25.428485 [debug] [MainThread]: On master: COMMIT
[0m16:53:25.428670 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:25.428836 [debug] [MainThread]: On master: COMMIT
[0m16:53:25.429687 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:53:25.429861 [debug] [MainThread]: On master: Close
[0m16:53:25.430118 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:53:25.430286 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m16:53:25.430463 [info ] [MainThread]: 
[0m16:53:25.430704 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.71 seconds (2.71s).
[0m16:53:25.431123 [debug] [MainThread]: Command end result
[0m16:53:25.445648 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m16:53:25.446758 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m16:53:25.450683 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m16:53:25.450987 [info ] [MainThread]: 
[0m16:53:25.451246 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:53:25.451431 [info ] [MainThread]: 
[0m16:53:25.451626 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:53:25.451984 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:53:25.454251 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4320407, "process_in_blocks": "0", "process_kernel_time": 0.222583, "process_mem_max_rss": "142442496", "process_out_blocks": "0", "process_user_time": 1.427966}
[0m16:53:25.454658 [debug] [MainThread]: Command `dbt run` succeeded at 16:53:25.454605 after 3.43 seconds
[0m16:53:25.454923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105632980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd7520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c83670>]}
[0m16:53:25.455173 [debug] [MainThread]: Flushing usage events
[0m16:53:26.024691 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:08:48.531930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b96980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073c4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073c46a0>]}


============================== 17:08:48.535257 | eb89e16e-779e-4e19-a919-3cdfa11bb454 ==============================
[0m17:08:48.535257 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:08:48.535667 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'empty': 'False', 'invocation_command': 'dbt run -m business_address_tenures', 'introspect': 'True', 'static_parser': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'fail_fast': 'False', 'write_json': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'partial_parse': 'True', 'debug': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_format': 'default', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'no_print': 'None', 'version_check': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:08:48.535990 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:08:48.536208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107309630>]}
[0m17:08:48.862791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107357b50>]}
[0m17:08:48.904613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e53c0>]}
[0m17:08:48.905369 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:08:48.970688 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:08:49.059715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:08:49.060162 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:08:49.252285 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m17:08:49.260835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110458e80>]}
[0m17:08:49.306834 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:08:49.308576 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:08:49.322463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105412d0>]}
[0m17:08:49.322827 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:08:49.323038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103a3130>]}
[0m17:08:49.323839 [info ] [MainThread]: 
[0m17:08:49.324052 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:08:49.324220 [info ] [MainThread]: 
[0m17:08:49.324509 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:08:49.324965 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:08:49.358739 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:08:49.359071 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:08:49.359258 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:49.487905 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.129 seconds
[0m17:08:49.488751 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:08:49.491878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:08:49.495359 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:08:49.495604 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:08:49.495785 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:49.557119 [debug] [ThreadPool]: SQL status: BEGIN in 0.061 seconds
[0m17:08:49.557488 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:08:49.557693 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:08:49.626076 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.068 seconds
[0m17:08:49.627054 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:08:49.630077 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:08:49.634220 [debug] [MainThread]: Using postgres connection "master"
[0m17:08:49.634494 [debug] [MainThread]: On master: BEGIN
[0m17:08:49.634658 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:08:49.699700 [debug] [MainThread]: SQL status: BEGIN in 0.065 seconds
[0m17:08:49.700084 [debug] [MainThread]: Using postgres connection "master"
[0m17:08:49.700332 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:08:50.188311 [debug] [MainThread]: SQL status: SELECT 2 in 0.486 seconds
[0m17:08:50.191183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10737b0a0>]}
[0m17:08:50.191852 [debug] [MainThread]: On master: ROLLBACK
[0m17:08:50.193569 [debug] [MainThread]: Using postgres connection "master"
[0m17:08:50.194272 [debug] [MainThread]: On master: BEGIN
[0m17:08:50.196782 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m17:08:50.197474 [debug] [MainThread]: On master: COMMIT
[0m17:08:50.198155 [debug] [MainThread]: Using postgres connection "master"
[0m17:08:50.198749 [debug] [MainThread]: On master: COMMIT
[0m17:08:50.200040 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:08:50.200362 [debug] [MainThread]: On master: Close
[0m17:08:50.203559 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:08:50.205171 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:08:50.205996 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:08:50.206264 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:08:50.217954 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:08:50.218739 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:08:50.246491 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:08:50.247169 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:08:50.247405 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:08:50.247608 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:08:50.311834 [debug] [Thread-1 (]: SQL status: BEGIN in 0.064 seconds
[0m17:08:50.312232 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:08:50.312506 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            trim(
                regexp_replace(                   -- remove "ta " from beginning
                    regexp_replace(               -- collapse multiple spaces
                        regexp_replace(           -- remove non-alphanumeric (keep space)
                            regexp_replace(       -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '[^a-zA-Z0-9 ]', '', 'g'
                        ),
                        '\s+', ' ', 'g'
                    ),
                    '^ta ', '', 'g'
                )
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:08:52.058759 [debug] [Thread-1 (]: SQL status: SELECT 9930 in 1.746 seconds
[0m17:08:52.067873 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:08:52.068228 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:08:52.072461 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:08:52.074657 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:08:52.074931 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:08:52.076959 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:08:52.086211 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:08:52.086609 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:08:52.086838 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:08:52.099256 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m17:08:52.102915 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:08:52.105171 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:08:52.105405 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:08:52.121430 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.016 seconds
[0m17:08:52.123013 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:08:52.124284 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb89e16e-779e-4e19-a919-3cdfa11bb454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110515a80>]}
[0m17:08:52.124735 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9930[0m in 1.92s]
[0m17:08:52.125126 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:08:52.125854 [debug] [MainThread]: Using postgres connection "master"
[0m17:08:52.126049 [debug] [MainThread]: On master: BEGIN
[0m17:08:52.126212 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:08:52.184215 [debug] [MainThread]: SQL status: BEGIN in 0.058 seconds
[0m17:08:52.184563 [debug] [MainThread]: On master: COMMIT
[0m17:08:52.184745 [debug] [MainThread]: Using postgres connection "master"
[0m17:08:52.184905 [debug] [MainThread]: On master: COMMIT
[0m17:08:52.185736 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:08:52.186060 [debug] [MainThread]: On master: Close
[0m17:08:52.186369 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:08:52.186535 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:08:52.186707 [info ] [MainThread]: 
[0m17:08:52.186887 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.86 seconds (2.86s).
[0m17:08:52.187242 [debug] [MainThread]: Command end result
[0m17:08:52.202305 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:08:52.203456 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:08:52.207609 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:08:52.207920 [info ] [MainThread]: 
[0m17:08:52.208250 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:08:52.208479 [info ] [MainThread]: 
[0m17:08:52.208736 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:08:52.209107 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:08:52.211592 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7326503, "process_in_blocks": "0", "process_kernel_time": 0.231092, "process_mem_max_rss": "137232384", "process_out_blocks": "0", "process_user_time": 1.459151}
[0m17:08:52.211970 [debug] [MainThread]: Command `dbt run` succeeded at 17:08:52.211916 after 3.73 seconds
[0m17:08:52.212237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b96980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e7520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105835e0>]}
[0m17:08:52.212485 [debug] [MainThread]: Flushing usage events
[0m17:08:52.662248 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:10:57.826386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105582980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107640dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076406a0>]}


============================== 17:10:57.829446 | 8805a21c-ca91-4b19-9b93-53afe6d6026b ==============================
[0m17:10:57.829446 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:10:57.829786 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'use_colors': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'introspect': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run -m business_address_tenures', 'quiet': 'False', 'empty': 'False', 'no_print': 'None', 'log_format': 'default', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'warn_error': 'None', 'cache_selected_only': 'False', 'partial_parse': 'True', 'version_check': 'True', 'debug': 'False'}
[0m17:10:57.830086 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:10:57.830300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107589630>]}
[0m17:10:58.003796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075d3b50>]}
[0m17:10:58.055857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078e53c0>]}
[0m17:10:58.056848 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:10:58.129241 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:10:58.206849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:10:58.207293 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:10:58.406047 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m17:10:58.414987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120660dc0>]}
[0m17:10:58.461760 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:10:58.463549 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:10:58.477718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1219412d0>]}
[0m17:10:58.478126 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:10:58.478359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1205ab130>]}
[0m17:10:58.479215 [info ] [MainThread]: 
[0m17:10:58.479451 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:10:58.479627 [info ] [MainThread]: 
[0m17:10:58.479915 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:10:58.480405 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:10:58.514459 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:10:58.514781 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:10:58.514961 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:58.636694 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.122 seconds
[0m17:10:58.637627 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:10:58.641069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:10:58.644636 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:10:58.644891 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:10:58.645066 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:10:58.697407 [debug] [ThreadPool]: SQL status: BEGIN in 0.052 seconds
[0m17:10:58.697741 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:10:58.697943 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:10:58.769751 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.072 seconds
[0m17:10:58.770820 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:10:58.775325 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:10:58.779755 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:58.780030 [debug] [MainThread]: On master: BEGIN
[0m17:10:58.780204 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:10:58.832990 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m17:10:58.837390 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:58.838734 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:10:59.314855 [debug] [MainThread]: SQL status: SELECT 2 in 0.475 seconds
[0m17:10:59.318908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075fb0a0>]}
[0m17:10:59.319833 [debug] [MainThread]: On master: ROLLBACK
[0m17:10:59.322225 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:59.322825 [debug] [MainThread]: On master: BEGIN
[0m17:10:59.324602 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:10:59.325092 [debug] [MainThread]: On master: COMMIT
[0m17:10:59.325561 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:59.326016 [debug] [MainThread]: On master: COMMIT
[0m17:10:59.327310 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:10:59.327788 [debug] [MainThread]: On master: Close
[0m17:10:59.331199 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:10:59.332287 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:10:59.332719 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:10:59.332960 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:10:59.338039 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:10:59.338685 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:10:59.365614 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:10:59.366442 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:10:59.366767 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:10:59.367051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:10:59.417394 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m17:10:59.417783 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:10:59.418064 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- remove "ta " from beginning
                            regexp_replace(       -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '^ta ', '', 'g'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\s+', ' ', 'g'
                )
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:11:01.179247 [debug] [Thread-1 (]: SQL status: SELECT 9930 in 1.761 seconds
[0m17:11:01.188020 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:11:01.188325 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:11:01.191442 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:11:01.193436 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:11:01.193725 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:11:01.196248 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:11:01.206491 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:11:01.206887 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:11:01.207106 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:11:01.220032 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m17:11:01.223938 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:11:01.226269 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:11:01.226511 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:11:01.238810 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m17:11:01.240515 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:11:01.241777 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8805a21c-ca91-4b19-9b93-53afe6d6026b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121915a80>]}
[0m17:11:01.242263 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9930[0m in 1.91s]
[0m17:11:01.242643 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:11:01.243425 [debug] [MainThread]: Using postgres connection "master"
[0m17:11:01.243628 [debug] [MainThread]: On master: BEGIN
[0m17:11:01.243793 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:11:01.297914 [debug] [MainThread]: SQL status: BEGIN in 0.054 seconds
[0m17:11:01.298263 [debug] [MainThread]: On master: COMMIT
[0m17:11:01.298472 [debug] [MainThread]: Using postgres connection "master"
[0m17:11:01.298650 [debug] [MainThread]: On master: COMMIT
[0m17:11:01.299570 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:11:01.299797 [debug] [MainThread]: On master: Close
[0m17:11:01.300073 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:11:01.300251 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:11:01.300440 [info ] [MainThread]: 
[0m17:11:01.300633 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.82 seconds (2.82s).
[0m17:11:01.301045 [debug] [MainThread]: Command end result
[0m17:11:01.316029 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:11:01.317629 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:11:01.322466 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:11:01.322747 [info ] [MainThread]: 
[0m17:11:01.323012 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:11:01.323195 [info ] [MainThread]: 
[0m17:11:01.323398 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:11:01.323735 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:11:01.325883 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5517008, "process_in_blocks": "0", "process_kernel_time": 0.239202, "process_mem_max_rss": "139362304", "process_out_blocks": "0", "process_user_time": 1.482375}
[0m17:11:01.326216 [debug] [MainThread]: Command `dbt run` succeeded at 17:11:01.326169 after 3.55 seconds
[0m17:11:01.326464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105582980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078e7520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1219814b0>]}
[0m17:11:01.326710 [debug] [MainThread]: Flushing usage events
[0m17:11:01.767002 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:12:25.682144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132c0c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132c0550>]}


============================== 17:12:25.685198 | 9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5 ==============================
[0m17:12:25.685198 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:12:25.685579 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'version_check': 'True', 'write_json': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'static_parser': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'use_colors': 'True', 'no_print': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run -m business_address_tenures', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'target_path': 'None', 'printer_width': '80'}
[0m17:12:25.685877 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:12:25.686097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111630730>]}
[0m17:12:25.853729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113881fc0>]}
[0m17:12:25.898729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11056a740>]}
[0m17:12:25.899602 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:12:25.964550 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:12:26.048960 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:12:26.049534 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:12:26.243442 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m17:12:26.251793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114542080>]}
[0m17:12:26.298382 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:12:26.300164 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:12:26.313787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143a2200>]}
[0m17:12:26.314159 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:12:26.314366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fb32b0>]}
[0m17:12:26.315156 [info ] [MainThread]: 
[0m17:12:26.315362 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:12:26.315526 [info ] [MainThread]: 
[0m17:12:26.315813 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:12:26.316252 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:12:26.349669 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:12:26.349997 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:12:26.350170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:12:26.472834 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.123 seconds
[0m17:12:26.473672 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:12:26.477161 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:12:26.480627 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:12:26.480847 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:12:26.481019 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:12:26.533432 [debug] [ThreadPool]: SQL status: BEGIN in 0.052 seconds
[0m17:12:26.533771 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:12:26.533967 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:12:26.599494 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.065 seconds
[0m17:12:26.600545 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:12:26.604882 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:12:26.609073 [debug] [MainThread]: Using postgres connection "master"
[0m17:12:26.609302 [debug] [MainThread]: On master: BEGIN
[0m17:12:26.609466 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:12:26.666006 [debug] [MainThread]: SQL status: BEGIN in 0.056 seconds
[0m17:12:26.666339 [debug] [MainThread]: Using postgres connection "master"
[0m17:12:26.666579 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:12:27.137103 [debug] [MainThread]: SQL status: SELECT 2 in 0.470 seconds
[0m17:12:27.138214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11327b0d0>]}
[0m17:12:27.139220 [debug] [MainThread]: On master: ROLLBACK
[0m17:12:27.143121 [debug] [MainThread]: Using postgres connection "master"
[0m17:12:27.143436 [debug] [MainThread]: On master: BEGIN
[0m17:12:27.144977 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:12:27.145175 [debug] [MainThread]: On master: COMMIT
[0m17:12:27.145347 [debug] [MainThread]: Using postgres connection "master"
[0m17:12:27.145597 [debug] [MainThread]: On master: COMMIT
[0m17:12:27.146452 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:12:27.146659 [debug] [MainThread]: On master: Close
[0m17:12:27.148327 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:12:27.148749 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:12:27.149029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:12:27.149242 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:12:27.154107 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:12:27.154969 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:12:27.177550 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:12:27.178597 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:12:27.178845 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:12:27.179050 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:12:27.229093 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m17:12:27.229528 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:12:27.229833 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- remove "ta " from beginning
                            regexp_replace(       -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '^ta ', '', 'gi'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\s+', ' ', 'g'
                )
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:12:28.900954 [debug] [Thread-1 (]: SQL status: SELECT 9930 in 1.670 seconds
[0m17:12:28.910143 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:12:28.910454 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:12:28.913564 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:12:28.915355 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:12:28.915589 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:12:28.917154 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:12:28.925397 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:12:28.925647 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:12:28.925845 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:12:28.938093 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m17:12:28.941550 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:12:28.943803 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:12:28.944047 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:12:28.955692 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:12:28.957179 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:12:28.958395 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ea96e13-6c80-4dd4-aaad-49d9c9c6a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114581b40>]}
[0m17:12:28.958805 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9930[0m in 1.81s]
[0m17:12:28.959139 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:12:28.959829 [debug] [MainThread]: Using postgres connection "master"
[0m17:12:28.960036 [debug] [MainThread]: On master: BEGIN
[0m17:12:28.960204 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:12:29.013693 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m17:12:29.014065 [debug] [MainThread]: On master: COMMIT
[0m17:12:29.014246 [debug] [MainThread]: Using postgres connection "master"
[0m17:12:29.014406 [debug] [MainThread]: On master: COMMIT
[0m17:12:29.015634 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:12:29.015999 [debug] [MainThread]: On master: Close
[0m17:12:29.016351 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:12:29.016564 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:12:29.016768 [info ] [MainThread]: 
[0m17:12:29.016987 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.70 seconds (2.70s).
[0m17:12:29.017508 [debug] [MainThread]: Command end result
[0m17:12:29.031973 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:12:29.033090 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:12:29.037334 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:12:29.037628 [info ] [MainThread]: 
[0m17:12:29.037891 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:12:29.038169 [info ] [MainThread]: 
[0m17:12:29.038412 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:12:29.038728 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:12:29.041167 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4123337, "process_in_blocks": "0", "process_kernel_time": 0.219806, "process_mem_max_rss": "140886016", "process_out_blocks": "0", "process_user_time": 1.391859}
[0m17:12:29.041528 [debug] [MainThread]: Command `dbt run` succeeded at 17:12:29.041480 after 3.41 seconds
[0m17:12:29.041759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101829b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e95c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f89660>]}
[0m17:12:29.041993 [debug] [MainThread]: Flushing usage events
[0m17:12:29.605017 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:16:04.377631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a40d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a40610>]}


============================== 17:16:04.380927 | bcab3a3e-d9b4-4624-8989-ed6a119f8d61 ==============================
[0m17:16:04.380927 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:16:04.381288 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'target_path': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'no_print': 'None', 'write_json': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'invocation_command': 'dbt run -m business_address_tenures', 'cache_selected_only': 'False', 'debug': 'False', 'fail_fast': 'False', 'empty': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'warn_error': 'None', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m17:16:04.381595 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:16:04.381799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10998eb30>]}
[0m17:16:04.548225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099d3e80>]}
[0m17:16:04.592109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10998feb0>]}
[0m17:16:04.593075 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:16:04.659527 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:16:04.739391 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:16:04.739871 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:16:04.935284 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m17:16:04.943795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab41fc0>]}
[0m17:16:04.989858 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:16:04.991351 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:16:05.004905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9b8760>]}
[0m17:16:05.005281 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:16:05.005588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9b86d0>]}
[0m17:16:05.006616 [info ] [MainThread]: 
[0m17:16:05.006856 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:16:05.007042 [info ] [MainThread]: 
[0m17:16:05.007390 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:16:05.007922 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:16:05.043198 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:16:05.043500 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:16:05.043672 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:16:05.196593 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.153 seconds
[0m17:16:05.197470 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:16:05.200831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:16:05.204352 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:16:05.204594 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:16:05.204765 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:16:05.262552 [debug] [ThreadPool]: SQL status: BEGIN in 0.058 seconds
[0m17:16:05.262903 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:16:05.263108 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:16:05.336529 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.073 seconds
[0m17:16:05.337540 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:16:05.342485 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:16:05.346731 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:05.346978 [debug] [MainThread]: On master: BEGIN
[0m17:16:05.347150 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:16:05.398395 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m17:16:05.398733 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:05.398974 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:16:05.882455 [debug] [MainThread]: SQL status: SELECT 2 in 0.483 seconds
[0m17:16:05.885473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab40a30>]}
[0m17:16:05.886361 [debug] [MainThread]: On master: ROLLBACK
[0m17:16:05.888360 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:05.888995 [debug] [MainThread]: On master: BEGIN
[0m17:16:05.891742 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m17:16:05.894140 [debug] [MainThread]: On master: COMMIT
[0m17:16:05.894880 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:05.895500 [debug] [MainThread]: On master: COMMIT
[0m17:16:05.897050 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:16:05.897385 [debug] [MainThread]: On master: Close
[0m17:16:05.899474 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:16:05.899985 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:16:05.900303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:16:05.900522 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:16:05.905492 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:16:05.906160 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:16:05.927916 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:16:05.928763 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:16:05.929149 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:16:05.929627 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:16:05.979568 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m17:16:05.979946 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:16:05.980218 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            regexp_replace(                       -- remove optional leading "ta "
                trim(
                    regexp_replace(               -- collapse multiple spaces
                        regexp_replace(           -- replace non-alphanumeric with space
                            regexp_replace(       -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '[^a-zA-Z0-9 ]', ' ', 'g'
                        ),
                        '\\s+', ' ', 'g'
                    )
                ),
                '^(?:ta)\\s+', '', 'i'
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:16:07.282290 [debug] [Thread-1 (]: SQL status: SELECT 9948 in 1.301 seconds
[0m17:16:07.291888 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:16:07.292226 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:16:07.295804 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:16:07.297594 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:16:07.297825 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:16:07.299599 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:16:07.307972 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:16:07.308215 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:16:07.308414 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:16:07.315379 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m17:16:07.318806 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:16:07.321009 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:16:07.321234 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:16:07.334681 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.013 seconds
[0m17:16:07.336227 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:16:07.337485 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcab3a3e-d9b4-4624-8989-ed6a119f8d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9a3d30>]}
[0m17:16:07.337946 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9948[0m in 1.44s]
[0m17:16:07.338482 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:16:07.339257 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:07.339453 [debug] [MainThread]: On master: BEGIN
[0m17:16:07.339611 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:16:07.392273 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m17:16:07.392625 [debug] [MainThread]: On master: COMMIT
[0m17:16:07.392808 [debug] [MainThread]: Using postgres connection "master"
[0m17:16:07.392973 [debug] [MainThread]: On master: COMMIT
[0m17:16:07.394192 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:16:07.394570 [debug] [MainThread]: On master: Close
[0m17:16:07.394936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:16:07.395174 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:16:07.395398 [info ] [MainThread]: 
[0m17:16:07.395586 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.39 seconds (2.39s).
[0m17:16:07.395953 [debug] [MainThread]: Command end result
[0m17:16:07.410089 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:16:07.411301 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:16:07.415331 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:16:07.415607 [info ] [MainThread]: 
[0m17:16:07.415860 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:16:07.416044 [info ] [MainThread]: 
[0m17:16:07.416237 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:16:07.416576 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:16:07.418911 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.100429, "process_in_blocks": "0", "process_kernel_time": 0.223488, "process_mem_max_rss": "140738560", "process_out_blocks": "0", "process_user_time": 1.413962}
[0m17:16:07.419276 [debug] [MainThread]: Command `dbt run` succeeded at 17:16:07.419222 after 3.10 seconds
[0m17:16:07.419522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079828f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105359ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a676fe0>]}
[0m17:16:07.419759 [debug] [MainThread]: Flushing usage events
[0m17:16:07.905206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:17:31.505785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bda8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10925cd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10925c610>]}


============================== 17:17:31.508726 | a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b ==============================
[0m17:17:31.508726 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:17:31.509072 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'empty': 'False', 'write_json': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'printer_width': '80', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'cache_selected_only': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'version_check': 'True', 'fail_fast': 'False', 'introspect': 'True', 'no_print': 'None', 'static_parser': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error': 'None', 'invocation_command': 'dbt run -m business_address_tenures', 'target_path': 'None'}
[0m17:17:31.509361 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:17:31.509568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091a5630>]}
[0m17:17:31.676636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091ebe80>]}
[0m17:17:31.718606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091a7eb0>]}
[0m17:17:31.719380 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:17:31.783376 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:17:31.859874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:17:31.860312 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:17:32.093296 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m17:17:32.101724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a089fc0>]}
[0m17:17:32.149579 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:17:32.151354 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:17:32.164903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109efc760>]}
[0m17:17:32.165259 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:17:32.165469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109efc6d0>]}
[0m17:17:32.166285 [info ] [MainThread]: 
[0m17:17:32.166492 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:17:32.166657 [info ] [MainThread]: 
[0m17:17:32.166930 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:17:32.167455 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:17:32.200416 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:17:32.200724 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:17:32.200908 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:17:32.349626 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.149 seconds
[0m17:17:32.350496 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:17:32.353781 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:17:32.357290 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:17:32.357529 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:17:32.357697 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:17:32.425684 [debug] [ThreadPool]: SQL status: BEGIN in 0.068 seconds
[0m17:17:32.426056 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:17:32.426268 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:17:32.503026 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.076 seconds
[0m17:17:32.506101 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:17:32.508833 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:17:32.515595 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:32.515839 [debug] [MainThread]: On master: BEGIN
[0m17:17:32.516007 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:17:32.591542 [debug] [MainThread]: SQL status: BEGIN in 0.075 seconds
[0m17:17:32.592820 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:32.593639 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:17:33.066612 [debug] [MainThread]: SQL status: SELECT 2 in 0.472 seconds
[0m17:17:33.067835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a088a30>]}
[0m17:17:33.068149 [debug] [MainThread]: On master: ROLLBACK
[0m17:17:33.070012 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:33.070312 [debug] [MainThread]: On master: BEGIN
[0m17:17:33.072332 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m17:17:33.072620 [debug] [MainThread]: On master: COMMIT
[0m17:17:33.072819 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:33.072993 [debug] [MainThread]: On master: COMMIT
[0m17:17:33.073928 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:17:33.074166 [debug] [MainThread]: On master: Close
[0m17:17:33.076217 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:17:33.076789 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:17:33.077144 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:17:33.077375 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:17:33.082319 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:17:33.082835 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:17:33.105737 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:17:33.106341 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:17:33.106566 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:17:33.106759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:17:33.158147 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m17:17:33.158522 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:17:33.158790 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- remove "ta " from beginning
                            regexp_replace(       -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '^ta ', '', 'g'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\s+', ' ', 'g'
                )
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:17:34.803148 [debug] [Thread-1 (]: SQL status: SELECT 9930 in 1.644 seconds
[0m17:17:34.810838 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:17:34.811127 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:17:34.814970 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:17:34.816684 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:17:34.816900 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:17:34.820405 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:17:34.833080 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:17:34.833405 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:17:34.833605 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:17:34.845114 [debug] [Thread-1 (]: SQL status: COMMIT in 0.011 seconds
[0m17:17:34.848866 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:17:34.851214 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:17:34.851442 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:17:34.862653 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:17:34.864290 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:17:34.865546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8c8103d-6fc9-4d53-b5b4-3b441ba5b65b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eebd30>]}
[0m17:17:34.866002 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9930[0m in 1.79s]
[0m17:17:34.866402 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:17:34.867161 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:34.867405 [debug] [MainThread]: On master: BEGIN
[0m17:17:34.867568 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:17:34.918150 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m17:17:34.918521 [debug] [MainThread]: On master: COMMIT
[0m17:17:34.918714 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:34.918883 [debug] [MainThread]: On master: COMMIT
[0m17:17:34.919738 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:17:34.919960 [debug] [MainThread]: On master: Close
[0m17:17:34.920234 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:17:34.920418 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:17:34.920605 [info ] [MainThread]: 
[0m17:17:34.920796 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.75 seconds (2.75s).
[0m17:17:34.921187 [debug] [MainThread]: Command end result
[0m17:17:34.936644 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:17:34.938431 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:17:34.942706 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:17:34.943030 [info ] [MainThread]: 
[0m17:17:34.943390 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:17:34.943606 [info ] [MainThread]: 
[0m17:17:34.943923 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:17:34.944562 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:17:34.947776 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4897451, "process_in_blocks": "0", "process_kernel_time": 0.21013, "process_mem_max_rss": "141524992", "process_out_blocks": "0", "process_user_time": 1.408377}
[0m17:17:34.948275 [debug] [MainThread]: Command `dbt run` succeeded at 17:17:34.948221 after 3.49 seconds
[0m17:17:34.948598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bda8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a21ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d8efe0>]}
[0m17:17:34.948853 [debug] [MainThread]: Flushing usage events
[0m17:17:35.463068 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:18:09.173919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e28f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107940d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107940610>]}


============================== 17:18:09.177086 | c87fc866-f747-4cc8-8f65-9c6dd1e95233 ==============================
[0m17:18:09.177086 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:18:09.177459 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'static_parser': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run -m business_address_tenures', 'partial_parse': 'True', 'empty': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'introspect': 'True', 'log_format': 'default', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'write_json': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False'}
[0m17:18:09.177778 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:18:09.178004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10788d630>]}
[0m17:18:09.343691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078d3e80>]}
[0m17:18:09.386205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10788feb0>]}
[0m17:18:09.386971 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:18:09.451860 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:18:09.531034 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:18:09.531366 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:18:09.535161 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.staging
- models.highstreet_tenure.marts
[0m17:18:09.554187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11893c5e0>]}
[0m17:18:09.634978 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:18:09.636694 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:18:09.650429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188a20e0>]}
[0m17:18:09.650779 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:18:09.650988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11895f190>]}
[0m17:18:09.651790 [info ] [MainThread]: 
[0m17:18:09.651998 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:18:09.652165 [info ] [MainThread]: 
[0m17:18:09.652439 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:18:09.652875 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:18:09.687200 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:18:09.687524 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:18:09.687701 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:18:09.855370 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.168 seconds
[0m17:18:09.856343 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:18:09.859765 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:18:09.863260 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:18:09.863477 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:18:09.863645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:18:09.917458 [debug] [ThreadPool]: SQL status: BEGIN in 0.054 seconds
[0m17:18:09.917813 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:18:09.918011 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:18:09.994532 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.076 seconds
[0m17:18:09.995537 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:18:09.997194 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:18:10.001741 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:10.002023 [debug] [MainThread]: On master: BEGIN
[0m17:18:10.002203 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:18:10.056136 [debug] [MainThread]: SQL status: BEGIN in 0.054 seconds
[0m17:18:10.056477 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:10.056722 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:18:10.526120 [debug] [MainThread]: SQL status: SELECT 2 in 0.469 seconds
[0m17:18:10.529075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188b9900>]}
[0m17:18:10.529740 [debug] [MainThread]: On master: ROLLBACK
[0m17:18:10.531286 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:10.531516 [debug] [MainThread]: On master: BEGIN
[0m17:18:10.533083 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:18:10.533282 [debug] [MainThread]: On master: COMMIT
[0m17:18:10.533460 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:10.533633 [debug] [MainThread]: On master: COMMIT
[0m17:18:10.534484 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:18:10.534794 [debug] [MainThread]: On master: Close
[0m17:18:10.537354 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:18:10.537852 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:18:10.538193 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:18:10.538432 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:18:10.543235 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:18:10.543850 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:18:10.565948 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:18:10.566648 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:18:10.566993 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:18:10.567303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:18:10.617815 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m17:18:10.618234 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:18:10.618517 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- remove "ta " from beginning
                            regexp_replace(       -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '^ta ', '', 'g'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\s+', ' ', 'g'
                )
            )
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:18:12.286455 [debug] [Thread-1 (]: SQL status: SELECT 9930 in 1.667 seconds
[0m17:18:12.298511 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:18:12.299203 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:18:12.303394 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:18:12.305452 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:18:12.305716 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:18:12.307787 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:18:12.316501 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:18:12.316778 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:18:12.316994 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:18:12.326556 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m17:18:12.329953 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:18:12.332180 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:18:12.332440 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:18:12.345374 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.013 seconds
[0m17:18:12.347166 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:18:12.348795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c87fc866-f747-4cc8-8f65-9c6dd1e95233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188a1de0>]}
[0m17:18:12.349301 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9930[0m in 1.81s]
[0m17:18:12.349662 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:18:12.350401 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:12.350582 [debug] [MainThread]: On master: BEGIN
[0m17:18:12.350740 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:18:12.402367 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m17:18:12.402751 [debug] [MainThread]: On master: COMMIT
[0m17:18:12.402962 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:12.403133 [debug] [MainThread]: On master: COMMIT
[0m17:18:12.404122 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:18:12.404359 [debug] [MainThread]: On master: Close
[0m17:18:12.404651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:18:12.404831 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:18:12.405027 [info ] [MainThread]: 
[0m17:18:12.405219 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.75 seconds (2.75s).
[0m17:18:12.405655 [debug] [MainThread]: Command end result
[0m17:18:12.419647 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:18:12.420758 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:18:12.425139 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:18:12.425430 [info ] [MainThread]: 
[0m17:18:12.425802 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:18:12.426037 [info ] [MainThread]: 
[0m17:18:12.426401 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:18:12.426808 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:18:12.429209 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3064616, "process_in_blocks": "0", "process_kernel_time": 0.215985, "process_mem_max_rss": "137478144", "process_out_blocks": "0", "process_user_time": 1.255147}
[0m17:18:12.429535 [debug] [MainThread]: Command `dbt run` succeeded at 17:18:12.429487 after 3.31 seconds
[0m17:18:12.429775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e28f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104930940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bd6c80>]}
[0m17:18:12.430011 [debug] [MainThread]: Flushing usage events
[0m17:18:12.828019 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:21:21.248382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a6e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bc4ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bc4580>]}


============================== 17:21:21.251518 | f9dcdb0e-61fe-4f88-81fa-80f121d69ff6 ==============================
[0m17:21:21.251518 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:21:21.251876 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'fail_fast': 'False', 'empty': 'False', 'invocation_command': 'dbt run -m business_address_tenures', 'log_cache_events': 'False', 'static_parser': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'quiet': 'False', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'debug': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'printer_width': '80', 'warn_error': 'None', 'indirect_selection': 'eager', 'introspect': 'True', 'use_colors': 'True', 'log_format': 'default', 'partial_parse': 'True', 'version_check': 'True', 'use_experimental_parser': 'False'}
[0m17:21:21.252188 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:21:21.252411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b0d600>]}
[0m17:21:21.422877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c8fdf0>]}
[0m17:21:21.467055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b0e350>]}
[0m17:21:21.468072 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:21:21.535074 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:21:21.614615 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:21:21.615108 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:21:21.809060 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m17:21:21.817773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b441f90>]}
[0m17:21:21.863847 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:21:21.865327 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:21:21.879010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2b5b70>]}
[0m17:21:21.879400 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:21:21.879605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2b6fe0>]}
[0m17:21:21.880414 [info ] [MainThread]: 
[0m17:21:21.880624 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:21:21.880798 [info ] [MainThread]: 
[0m17:21:21.881097 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:21:21.881557 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:21:21.914102 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:21:21.914433 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:21:21.914614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:21:22.080352 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.166 seconds
[0m17:21:22.081376 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:21:22.084550 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:21:22.088376 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:21:22.088679 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:21:22.088868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:21:22.143495 [debug] [ThreadPool]: SQL status: BEGIN in 0.055 seconds
[0m17:21:22.143863 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:21:22.144081 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:21:22.206853 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.063 seconds
[0m17:21:22.207883 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:21:22.211215 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:21:22.215796 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:22.216081 [debug] [MainThread]: On master: BEGIN
[0m17:21:22.216259 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:21:22.273743 [debug] [MainThread]: SQL status: BEGIN in 0.057 seconds
[0m17:21:22.274089 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:22.274335 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:21:22.743475 [debug] [MainThread]: SQL status: SELECT 2 in 0.469 seconds
[0m17:21:22.744553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4407f0>]}
[0m17:21:22.744840 [debug] [MainThread]: On master: ROLLBACK
[0m17:21:22.746606 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:22.746792 [debug] [MainThread]: On master: BEGIN
[0m17:21:22.748177 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m17:21:22.748472 [debug] [MainThread]: On master: COMMIT
[0m17:21:22.748655 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:22.748822 [debug] [MainThread]: On master: COMMIT
[0m17:21:22.749602 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:21:22.749833 [debug] [MainThread]: On master: Close
[0m17:21:22.752296 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:21:22.752715 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:21:22.753008 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:21:22.753222 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:21:22.757876 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:21:22.758324 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:21:22.783229 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:21:22.784051 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:21:22.784329 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:21:22.784541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:21:22.835605 [debug] [Thread-1 (]: SQL status: BEGIN in 0.051 seconds
[0m17:21:22.835960 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:21:22.836217 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline"
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        regexp_replace(
            lower(
                trim(
                    regexp_replace(                   -- collapse multiple spaces
                        regexp_replace(               -- remove non-alphanumeric (keep space)
                            regexp_replace(           -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '[^a-zA-Z0-9 ]', '', 'g'
                        ),
                        '\s+', ' ', 'g'
                    )
                )
            ),
            '^ta ', '', 'g'
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:21:24.542617 [debug] [Thread-1 (]: SQL status: SELECT 9429 in 1.706 seconds
[0m17:21:24.548891 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:21:24.549506 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:21:24.552838 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m17:21:24.554893 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:21:24.555147 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:21:24.557006 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:21:24.565591 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:21:24.565883 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:21:24.566098 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:21:24.579678 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m17:21:24.583533 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:21:24.585823 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:21:24.586058 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:21:24.597531 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.011 seconds
[0m17:21:24.599233 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:21:24.600563 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9dcdb0e-61fe-4f88-81fa-80f121d69ff6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4407f0>]}
[0m17:21:24.601057 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 9429[0m in 1.85s]
[0m17:21:24.601417 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:21:24.602161 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:24.602374 [debug] [MainThread]: On master: BEGIN
[0m17:21:24.602542 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:21:24.655930 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m17:21:24.656287 [debug] [MainThread]: On master: COMMIT
[0m17:21:24.656475 [debug] [MainThread]: Using postgres connection "master"
[0m17:21:24.656641 [debug] [MainThread]: On master: COMMIT
[0m17:21:24.657367 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:21:24.657543 [debug] [MainThread]: On master: Close
[0m17:21:24.657787 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:21:24.657952 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:21:24.658139 [info ] [MainThread]: 
[0m17:21:24.658322 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.78 seconds (2.78s).
[0m17:21:24.658698 [debug] [MainThread]: Command end result
[0m17:21:24.672861 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:21:24.674222 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:21:24.678367 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:21:24.678653 [info ] [MainThread]: 
[0m17:21:24.678914 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:21:24.679098 [info ] [MainThread]: 
[0m17:21:24.679300 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:21:24.679632 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:21:24.681956 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4861188, "process_in_blocks": "0", "process_kernel_time": 0.237119, "process_mem_max_rss": "139591680", "process_out_blocks": "0", "process_user_time": 1.440077}
[0m17:21:24.682283 [debug] [MainThread]: Command `dbt run` succeeded at 17:21:24.682236 after 3.49 seconds
[0m17:21:24.682536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a6e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b0e350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b411540>]}
[0m17:21:24.682779 [debug] [MainThread]: Flushing usage events
[0m17:21:25.173438 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:22:44.115531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107406950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84640>]}


============================== 17:22:44.118793 | 8d6c1cad-874e-431f-87fa-a10a53232644 ==============================
[0m17:22:44.118793 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:22:44.119206 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'introspect': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'quiet': 'False', 'version_check': 'True', 'debug': 'False', 'empty': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'write_json': 'True', 'no_print': 'None', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default', 'partial_parse': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run -m business_address_tenures', 'static_parser': 'True'}
[0m17:22:44.119551 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m17:22:44.119934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089cfa00>]}
[0m17:22:44.289837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107744d90>]}
[0m17:22:44.334041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a55d20>]}
[0m17:22:44.334974 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:22:44.400823 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:22:44.482114 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:22:44.482607 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:22:44.680827 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m17:22:44.689183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10979e740>]}
[0m17:22:44.735489 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:22:44.737652 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:22:44.751490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097174f0>]}
[0m17:22:44.751898 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:22:44.752112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972c760>]}
[0m17:22:44.752927 [info ] [MainThread]: 
[0m17:22:44.753131 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:22:44.753299 [info ] [MainThread]: 
[0m17:22:44.753587 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:22:44.754054 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m17:22:44.787209 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m17:22:44.787574 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m17:22:44.787752 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:22:44.924315 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.136 seconds
[0m17:22:44.925546 [debug] [ThreadPool]: On list_highstreet: Close
[0m17:22:44.929411 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m17:22:44.933357 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:22:44.933623 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:22:44.933793 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:22:44.997021 [debug] [ThreadPool]: SQL status: BEGIN in 0.063 seconds
[0m17:22:44.997362 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:22:44.997566 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:22:45.083362 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.086 seconds
[0m17:22:45.084447 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:22:45.087868 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:22:45.092637 [debug] [MainThread]: Using postgres connection "master"
[0m17:22:45.092954 [debug] [MainThread]: On master: BEGIN
[0m17:22:45.093147 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:22:45.144613 [debug] [MainThread]: SQL status: BEGIN in 0.051 seconds
[0m17:22:45.144961 [debug] [MainThread]: Using postgres connection "master"
[0m17:22:45.145200 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:22:45.623420 [debug] [MainThread]: SQL status: SELECT 2 in 0.478 seconds
[0m17:22:45.624594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a3f070>]}
[0m17:22:45.624951 [debug] [MainThread]: On master: ROLLBACK
[0m17:22:45.626768 [debug] [MainThread]: Using postgres connection "master"
[0m17:22:45.627091 [debug] [MainThread]: On master: BEGIN
[0m17:22:45.628910 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m17:22:45.629222 [debug] [MainThread]: On master: COMMIT
[0m17:22:45.629423 [debug] [MainThread]: Using postgres connection "master"
[0m17:22:45.629628 [debug] [MainThread]: On master: COMMIT
[0m17:22:45.630644 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:22:45.630885 [debug] [MainThread]: On master: Close
[0m17:22:45.633356 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:22:45.633763 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.business_address_tenures ...... [RUN]
[0m17:22:45.634038 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.business_address_tenures)
[0m17:22:45.634245 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:22:45.639146 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:22:45.640002 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:22:45.662883 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m17:22:45.663941 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:22:45.664301 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m17:22:45.664518 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:45.716535 [debug] [Thread-1 (]: SQL status: BEGIN in 0.052 seconds
[0m17:22:45.716910 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:22:45.717173 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline" where lower(business_name) not like '%ratepayer%'
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        -- raw name
        business_name,
        
        -- normalised name
        regexp_replace(
            lower(
                trim(
                    regexp_replace(                   -- collapse multiple spaces
                        regexp_replace(               -- remove non-alphanumeric (keep space)
                            regexp_replace(           -- replace "&" with "and"
                                business_name,
                                '&', 'and', 'gi'
                            ),
                            '[^a-zA-Z0-9 ]', '', 'g'
                        ),
                        '\s+', ' ', 'g'
                    )
                )
            ),
            '^ta ', '', 'g'
        ) as business_name_norm
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name_norm as business_name,       -- use the normalised version
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m17:22:47.502721 [debug] [Thread-1 (]: SQL status: SELECT 7616 in 1.785 seconds
[0m17:22:47.508300 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:22:47.508570 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m17:22:47.513210 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m17:22:47.515265 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:22:47.515588 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m17:22:47.517936 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m17:22:47.530245 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:22:47.530755 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:22:47.531121 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m17:22:47.546555 [debug] [Thread-1 (]: SQL status: COMMIT in 0.015 seconds
[0m17:22:47.550614 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m17:22:47.554886 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m17:22:47.555313 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m17:22:47.569409 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m17:22:47.571241 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m17:22:47.572622 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d6c1cad-874e-431f-87fa-a10a53232644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098f7c40>]}
[0m17:22:47.573172 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.business_address_tenures . [[32mSELECT 7616[0m in 1.94s]
[0m17:22:47.573574 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:22:47.574311 [debug] [MainThread]: Using postgres connection "master"
[0m17:22:47.574500 [debug] [MainThread]: On master: BEGIN
[0m17:22:47.574665 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:22:47.626568 [debug] [MainThread]: SQL status: BEGIN in 0.052 seconds
[0m17:22:47.626942 [debug] [MainThread]: On master: COMMIT
[0m17:22:47.627130 [debug] [MainThread]: Using postgres connection "master"
[0m17:22:47.627295 [debug] [MainThread]: On master: COMMIT
[0m17:22:47.628400 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m17:22:47.628721 [debug] [MainThread]: On master: Close
[0m17:22:47.629120 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:22:47.629321 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:22:47.629565 [info ] [MainThread]: 
[0m17:22:47.629947 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.88 seconds (2.88s).
[0m17:22:47.630338 [debug] [MainThread]: Command end result
[0m17:22:47.646274 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:22:47.647725 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:22:47.651740 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:22:47.652047 [info ] [MainThread]: 
[0m17:22:47.652394 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:22:47.652591 [info ] [MainThread]: 
[0m17:22:47.652783 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:22:47.653094 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:22:47.655479 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5955515, "process_in_blocks": "0", "process_kernel_time": 0.235561, "process_mem_max_rss": "141262848", "process_out_blocks": "0", "process_user_time": 1.454928}
[0m17:22:47.655883 [debug] [MainThread]: Command `dbt run` succeeded at 17:22:47.655829 after 3.60 seconds
[0m17:22:47.656143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107406950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a55d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109860e80>]}
[0m17:22:47.656377 [debug] [MainThread]: Flushing usage events
[0m17:22:48.115436 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:34:31.994592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106882950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110abfcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110abd630>]}


============================== 17:34:31.998097 | 32518913-2510-4a6b-aa9b-e243a5a4c9f3 ==============================
[0m17:34:31.998097 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:34:31.998493 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'invocation_command': 'dbt docs generate', 'use_colors': 'True', 'empty': 'None', 'warn_error': 'None', 'printer_width': '80', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'static_parser': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'version_check': 'True', 'no_print': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_cache_events': 'False'}
[0m17:34:32.163200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '32518913-2510-4a6b-aa9b-e243a5a4c9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ce7400>]}
[0m17:34:32.206023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '32518913-2510-4a6b-aa9b-e243a5a4c9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8ea70>]}
[0m17:34:32.206893 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m17:34:32.272430 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m17:34:32.355550 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:34:32.356031 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m17:34:32.356273 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_tenures.sql
[0m17:34:32.549101 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m17:34:32.557775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '32518913-2510-4a6b-aa9b-e243a5a4c9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a1dbd0>]}
[0m17:34:32.573482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '32518913-2510-4a6b-aa9b-e243a5a4c9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11188da50>]}
[0m17:34:32.573869 [info ] [MainThread]: Found 16 models, 5 sources, 434 macros
[0m17:34:32.574084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '32518913-2510-4a6b-aa9b-e243a5a4c9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118132e0>]}
[0m17:34:32.575253 [info ] [MainThread]: 
[0m17:34:32.575476 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:34:32.575646 [info ] [MainThread]: 
[0m17:34:32.575930 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:34:32.578669 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet_analytics_analytics'
[0m17:34:32.611449 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:34:32.611778 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m17:34:32.611960 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:34:32.733025 [debug] [ThreadPool]: SQL status: BEGIN in 0.121 seconds
[0m17:34:32.733424 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m17:34:32.733650 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m17:34:32.810139 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.076 seconds
[0m17:34:32.811184 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m17:34:32.814294 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m17:34:32.818600 [debug] [MainThread]: Using postgres connection "master"
[0m17:34:32.818878 [debug] [MainThread]: On master: BEGIN
[0m17:34:32.819048 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:34:32.874267 [debug] [MainThread]: SQL status: BEGIN in 0.055 seconds
[0m17:34:32.874653 [debug] [MainThread]: Using postgres connection "master"
[0m17:34:32.874899 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:34:33.353088 [debug] [MainThread]: SQL status: SELECT 2 in 0.478 seconds
[0m17:34:33.354179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '32518913-2510-4a6b-aa9b-e243a5a4c9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049e9720>]}
[0m17:34:33.354448 [debug] [MainThread]: On master: ROLLBACK
[0m17:34:33.356033 [debug] [MainThread]: On master: Close
[0m17:34:33.358092 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m17:34:33.358434 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m17:34:33.358766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m17:34:33.359122 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m17:34:33.359374 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m17:34:33.359594 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m17:34:33.364404 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m17:34:33.366160 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m17:34:33.367513 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m17:34:33.367824 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m17:34:33.368360 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m17:34:33.368732 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m17:34:33.369276 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m17:34:33.369596 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:34:33.369934 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m17:34:33.370175 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m17:34:33.370441 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m17:34:33.370825 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m17:34:33.371079 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m17:34:33.371315 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_accounts_relief)
[0m17:34:33.371555 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_new_businesses)
[0m17:34:33.371776 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m17:34:33.374527 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m17:34:33.374838 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m17:34:33.375079 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m17:34:33.376960 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m17:34:33.378960 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m17:34:33.380736 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m17:34:33.381045 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m17:34:33.381433 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m17:34:33.381960 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m17:34:33.382164 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m17:34:33.382346 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m17:34:33.382681 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m17:34:33.383123 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m17:34:33.383479 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m17:34:33.383956 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_address_timeline
[0m17:34:33.384158 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_addresses
[0m17:34:33.384375 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_timeline
[0m17:34:33.384559 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.businesses
[0m17:34:33.384758 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_address_timeline)
[0m17:34:33.384970 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.business_addresses)
[0m17:34:33.385172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.business_timeline)
[0m17:34:33.385369 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.businesses)
[0m17:34:33.385648 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_address_timeline
[0m17:34:33.385846 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m17:34:33.386047 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_timeline
[0m17:34:33.386245 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.businesses
[0m17:34:33.388416 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_timeline"
[0m17:34:33.390646 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m17:34:33.392752 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_timeline"
[0m17:34:33.394795 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m17:34:33.395757 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.business_addresses
[0m17:34:33.396049 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.businesses
[0m17:34:33.396283 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_address_timeline
[0m17:34:33.396656 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_addresses
[0m17:34:33.396833 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_timeline
[0m17:34:33.397162 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.businesses
[0m17:34:33.397487 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_address_timeline
[0m17:34:33.397722 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.properties
[0m17:34:33.398031 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_timeline
[0m17:34:33.398321 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.addresses_with_most_tenants
[0m17:34:33.398631 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.properties)
[0m17:34:33.398843 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m17:34:33.399155 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_tenures
[0m17:34:33.399359 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses_with_most_tenants)
[0m17:34:33.399577 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.properties
[0m17:34:33.399787 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_address_timeline, now model.highstreet_tenure.business_address_tenures)
[0m17:34:33.400078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_timeline, now model.highstreet_tenure.business_tenures)
[0m17:34:33.400362 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.addresses_with_most_tenants
[0m17:34:33.403352 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m17:34:33.403605 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m17:34:33.403821 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_tenures
[0m17:34:33.405209 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m17:34:33.406831 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m17:34:33.408316 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_tenures"
[0m17:34:33.408638 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.properties
[0m17:34:33.409331 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.properties
[0m17:34:33.409626 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.addresses_with_most_tenants
[0m17:34:33.410010 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_tenures
[0m17:34:33.410228 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m17:34:33.410459 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.business_with_full_timeline
[0m17:34:33.410950 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.addresses_with_most_tenants
[0m17:34:33.411310 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_tenures
[0m17:34:33.411655 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m17:34:33.411899 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.business_with_full_timeline)
[0m17:34:33.412135 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.addresses
[0m17:34:33.412441 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.business_with_full_timeline
[0m17:34:33.412664 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.addresses_with_most_tenants, now model.highstreet_tenure.addresses)
[0m17:34:33.414280 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.business_with_full_timeline"
[0m17:34:33.414522 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.addresses
[0m17:34:33.416132 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m17:34:33.416426 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.business_with_full_timeline
[0m17:34:33.416785 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.business_with_full_timeline
[0m17:34:33.417020 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.addresses
[0m17:34:33.417368 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.addresses
[0m17:34:33.417906 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:34:33.418108 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_tenures' was properly closed.
[0m17:34:33.418282 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m17:34:33.418440 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m17:34:33.418598 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_with_full_timeline' was properly closed.
[0m17:34:33.419834 [debug] [MainThread]: Command end result
[0m17:34:33.465351 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:34:33.466748 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:34:33.471156 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m17:34:33.473764 [debug] [MainThread]: Acquiring new postgres connection 'generate_catalog'
[0m17:34:33.473952 [info ] [MainThread]: Building catalog
[0m17:34:33.480360 [debug] [ThreadPool]: Acquiring new postgres connection 'highstreet.information_schema'
[0m17:34:33.484803 [debug] [ThreadPool]: Using postgres connection "highstreet.information_schema"
[0m17:34:33.485060 [debug] [ThreadPool]: On highstreet.information_schema: BEGIN
[0m17:34:33.485232 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:34:33.540822 [debug] [ThreadPool]: SQL status: BEGIN in 0.056 seconds
[0m17:34:33.541150 [debug] [ThreadPool]: Using postgres connection "highstreet.information_schema"
[0m17:34:33.541452 [debug] [ThreadPool]: On highstreet.information_schema: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "highstreet.information_schema"} */

    
    

    select
        'highstreet' as table_database,
        sch.nspname as table_schema,
        tbl.relname as table_name,
        case tbl.relkind
            when 'v' then 'VIEW'
            when 'm' then 'MATERIALIZED VIEW'
            else 'BASE TABLE'
        end as table_type,
        tbl_desc.description as table_comment,
        col.attname as column_name,
        col.attnum as column_index,
        pg_catalog.format_type(col.atttypid, col.atttypmod) as column_type,
        col_desc.description as column_comment,
        pg_get_userbyid(tbl.relowner) as table_owner

    from pg_catalog.pg_namespace sch
    join pg_catalog.pg_class tbl on tbl.relnamespace = sch.oid
    join pg_catalog.pg_attribute col on col.attrelid = tbl.oid
    left outer join pg_catalog.pg_description tbl_desc on (tbl_desc.objoid = tbl.oid and tbl_desc.objsubid = 0)
    left outer join pg_catalog.pg_description col_desc on (col_desc.objoid = tbl.oid and col_desc.objsubid = col.attnum)
    where ((upper(sch.nspname) = upper('public') and
           upper(tbl.relname) = upper('filename_mapping')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('business_timeline')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('business_tenures')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('businesses')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('stg_accounts_closed')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('date_spine')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('business_address_timeline')) or (upper(sch.nspname) = upper('public') and
           upper(tbl.relname) = upper('accounts_relief')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('business_addresses')) or (upper(sch.nspname) = upper('public') and
           upper(tbl.relname) = upper('accounts_closed')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('stg_accounts_no_relief')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('business_address_tenures')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('stg_new_businesses')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('stg_filemap')) or (upper(sch.nspname) = upper('public') and
           upper(tbl.relname) = upper('new_businesses')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('addresses_with_most_tenants')) or (upper(sch.nspname) = upper('public') and
           upper(tbl.relname) = upper('accounts_no_relief')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('addresses')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('stg_accounts_relief')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('properties')) or (upper(sch.nspname) = upper('analytics_analytics') and
           upper(tbl.relname) = upper('business_with_full_timeline')))
      and not pg_is_other_temp_schema(sch.oid) -- not a temporary schema belonging to another session
      and tbl.relpersistence in ('p', 'u') -- [p]ermanent table or [u]nlogged table. Exclude [t]emporary tables
      and tbl.relkind in ('r', 'v', 'f', 'p', 'm') -- o[r]dinary table, [v]iew, [f]oreign table, [p]artitioned table, [m]aterialized view. Other values are [i]ndex, [S]equence, [c]omposite type, [t]OAST table
      and col.attnum > 0 -- negative numbers are used for system columns such as oid
      and not col.attisdropped -- column as not been dropped

    order by
        sch.nspname,
        tbl.relname,
        col.attnum
[0m17:34:33.639702 [debug] [ThreadPool]: SQL status: SELECT 121 in 0.098 seconds
[0m17:34:33.643124 [debug] [ThreadPool]: On highstreet.information_schema: ROLLBACK
[0m17:34:33.644620 [debug] [ThreadPool]: On highstreet.information_schema: Close
[0m17:34:33.654433 [debug] [MainThread]: Wrote artifact CatalogArtifact to /Users/samydoreau/data-j/highstreet-tenure/target/catalog.json
[0m17:34:33.668047 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m17:34:33.669033 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m17:34:33.669230 [info ] [MainThread]: Catalog written to /Users/samydoreau/data-j/highstreet-tenure/target/catalog.json
[0m17:34:33.671656 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 1.7284592, "process_in_blocks": "0", "process_kernel_time": 0.228791, "process_mem_max_rss": "142917632", "process_out_blocks": "0", "process_user_time": 1.402935}
[0m17:34:33.672047 [debug] [MainThread]: Command `dbt docs generate` succeeded at 17:34:33.671997 after 1.73 seconds
[0m17:34:33.672255 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m17:34:33.672416 [debug] [MainThread]: Connection 'highstreet.information_schema' was properly closed.
[0m17:34:33.672610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106882950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ce7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118837c0>]}
[0m17:34:33.672830 [debug] [MainThread]: Flushing usage events
[0m17:34:34.137509 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:34:38.441704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107182950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10923bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092392d0>]}


============================== 17:34:38.444948 | 03793a5d-004c-4062-b7e4-b29514f6cb4c ==============================
[0m17:34:38.444948 [info ] [MainThread]: Running with dbt=1.10.11
[0m17:34:38.445374 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'write_json': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'static_parser': 'True', 'empty': 'None', 'use_experimental_parser': 'False', 'debug': 'False', 'partial_parse': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'log_format': 'default', 'invocation_command': 'dbt docs serve', 'use_colors': 'True', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'version_check': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'quiet': 'False', 'introspect': 'True', 'no_print': 'None'}
[0m17:34:38.630451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '03793a5d-004c-4062-b7e4-b29514f6cb4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bc0040>]}
[0m17:34:38.673715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '03793a5d-004c-4062-b7e4-b29514f6cb4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090697b0>]}
[0m18:33:48.521396 [error] [MainThread]: Encountered an error:

[0m18:33:48.532271 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/cli/requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/cli/requires.py", line 272, in wrapper
    return func(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/cli/requires.py", line 303, in wrapper
    return func(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/cli/requires.py", line 350, in wrapper
    return func(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/cli/main.py", line 307, in docs_serve
    results = task.run()
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/socketserver.py", line 232, in serve_forever
    ready = selector.select(poll_interval)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/selectors.py", line 416, in select
    fd_event_list = self._selector.poll(timeout)
KeyboardInterrupt

[0m18:33:48.551071 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 3550.1743, "process_in_blocks": "0", "process_kernel_time": 0.402258, "process_mem_max_rss": "113672192", "process_out_blocks": "0", "process_user_time": 1.361719}
[0m18:33:48.552550 [debug] [MainThread]: Command `dbt docs serve` failed at 18:33:48.552464 after 3550.18 seconds
[0m18:33:48.553160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107182950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e70820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e70b20>]}
[0m18:33:48.553595 [debug] [MainThread]: Flushing usage events
[0m18:33:48.959454 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:33:54.334824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077394e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107738dc0>]}


============================== 18:33:54.337753 | 33250407-6ec4-4688-9a5f-b46aea75a773 ==============================
[0m18:33:54.337753 [info ] [MainThread]: Running with dbt=1.10.11
[0m18:33:54.338112 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_format': 'default', 'version_check': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'introspect': 'True', 'partial_parse': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/samydoreau/data-j/highstreet-tenure', 'use_colors': 'True', 'log_path': '/Users/samydoreau/data-j/highstreet-tenure/logs', 'target_path': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'empty': 'False', 'fail_fast': 'False'}
[0m18:33:54.495753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107809690>]}
[0m18:33:54.539614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a779d0>]}
[0m18:33:54.540559 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m18:33:54.629593 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m18:33:54.706168 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 1 files added, 2 files changed.
[0m18:33:54.706585 [debug] [MainThread]: Partial parsing: added file: highstreet_tenure://macros/normalize_business_name.sql
[0m18:33:54.706986 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/2_int/business_with_full_timeline.sql
[0m18:33:54.707157 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/2_int/business_tenures.sql
[0m18:33:54.707311 [debug] [MainThread]: Partial parsing: deleted file: highstreet_tenure://models/2_int/business_timeline.sql
[0m18:33:54.707525 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_addresses.sql
[0m18:33:54.707726 [debug] [MainThread]: Partial parsing: updated file: highstreet_tenure://models/2_int/business_address_timeline.sql
[0m18:33:54.904188 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.highstreet_tenure.marts
- models.highstreet_tenure.staging
[0m18:33:54.912441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118634130>]}
[0m18:33:54.957962 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m18:33:54.959480 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m18:33:54.972762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184b57b0>]}
[0m18:33:54.973149 [info ] [MainThread]: Found 13 models, 5 sources, 435 macros
[0m18:33:54.973495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184b7040>]}
[0m18:33:54.974962 [info ] [MainThread]: 
[0m18:33:54.975327 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:33:54.975548 [info ] [MainThread]: 
[0m18:33:54.975847 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:33:54.978601 [debug] [ThreadPool]: Acquiring new postgres connection 'list_highstreet'
[0m18:33:55.012472 [debug] [ThreadPool]: Using postgres connection "list_highstreet"
[0m18:33:55.012910 [debug] [ThreadPool]: On list_highstreet: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet"} */

    select distinct nspname from pg_namespace
  
[0m18:33:55.013119 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:33:55.247624 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.234 seconds
[0m18:33:55.248548 [debug] [ThreadPool]: On list_highstreet: Close
[0m18:33:55.249908 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_highstreet, now list_highstreet_analytics_analytics)
[0m18:33:55.253815 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m18:33:55.254099 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: BEGIN
[0m18:33:55.254282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:55.327448 [debug] [ThreadPool]: SQL status: BEGIN in 0.073 seconds
[0m18:33:55.327804 [debug] [ThreadPool]: Using postgres connection "list_highstreet_analytics_analytics"
[0m18:33:55.328016 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "list_highstreet_analytics_analytics"} */
select
      'highstreet' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics_analytics'
    union all
    select
      'highstreet' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics_analytics'
  
[0m18:33:55.405477 [debug] [ThreadPool]: SQL status: SELECT 17 in 0.077 seconds
[0m18:33:55.408276 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: ROLLBACK
[0m18:33:55.411725 [debug] [ThreadPool]: On list_highstreet_analytics_analytics: Close
[0m18:33:55.417470 [debug] [MainThread]: Using postgres connection "master"
[0m18:33:55.417750 [debug] [MainThread]: On master: BEGIN
[0m18:33:55.417935 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:33:55.485840 [debug] [MainThread]: SQL status: BEGIN in 0.068 seconds
[0m18:33:55.486214 [debug] [MainThread]: Using postgres connection "master"
[0m18:33:55.486459 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:33:55.944635 [debug] [MainThread]: SQL status: SELECT 2 in 0.458 seconds
[0m18:33:55.948165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11855f070>]}
[0m18:33:55.948990 [debug] [MainThread]: On master: ROLLBACK
[0m18:33:55.951062 [debug] [MainThread]: Using postgres connection "master"
[0m18:33:55.951375 [debug] [MainThread]: On master: BEGIN
[0m18:33:55.953150 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m18:33:55.953378 [debug] [MainThread]: On master: COMMIT
[0m18:33:55.953557 [debug] [MainThread]: Using postgres connection "master"
[0m18:33:55.953723 [debug] [MainThread]: On master: COMMIT
[0m18:33:55.954597 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m18:33:55.954783 [debug] [MainThread]: On master: Close
[0m18:33:55.956759 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.date_spine
[0m18:33:55.957653 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_filemap
[0m18:33:55.958056 [info ] [Thread-1 (]: 1 of 13 START sql table model analytics_analytics.date_spine ................... [RUN]
[0m18:33:55.958377 [info ] [Thread-2 (]: 2 of 13 START sql table model analytics_analytics.stg_filemap .................. [RUN]
[0m18:33:55.958721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_highstreet_analytics_analytics, now model.highstreet_tenure.date_spine)
[0m18:33:55.959026 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_filemap'
[0m18:33:55.959295 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.date_spine
[0m18:33:55.959579 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_filemap
[0m18:33:55.964433 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.date_spine"
[0m18:33:55.966193 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_filemap"
[0m18:33:55.966913 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_filemap
[0m18:33:55.973505 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.date_spine
[0m18:33:55.988399 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_filemap"
[0m18:33:55.990614 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.date_spine"
[0m18:33:55.991531 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m18:33:55.991775 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m18:33:55.992022 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: BEGIN
[0m18:33:55.992259 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: BEGIN
[0m18:33:55.992485 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:33:55.992696 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:56.046753 [debug] [Thread-2 (]: SQL status: BEGIN in 0.054 seconds
[0m18:33:56.047147 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m18:33:56.047392 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."filename_mapping"
),

extracted as (
    select
        id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'file_name' as file_name,
        data->>'table_name' as table_name,
        data->>'valid_from' as valid_from,
        data->>'valid_to' as valid_to
    from source
)

select * from extracted
  );
  
[0m18:33:56.047875 [debug] [Thread-1 (]: SQL status: BEGIN in 0.055 seconds
[0m18:33:56.048126 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m18:33:56.048349 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */

  
    

  create  table "highstreet"."analytics_analytics"."date_spine__dbt_tmp"
  
  
    as
  
  (
    

with date_spine as (
    select 
        ('1991-01-01'::date + interval '1 month' * (row_number() over (order by null) - 1))::date as date_month
    from generate_series(1, 432)  -- 432 months from Jan 1991 to Dec 2026
)

select 
    date_month,
    to_char(date_month, 'YYYYMM') as year_month_key,
    to_char(date_month, 'Mon-YYYY') as formatted_month_year,
    extract(year from date_month) as year,
    extract(month from date_month) as month,
    to_char(date_month, 'Month') as month_name,
    to_char(date_month, 'Mon') as month_abbr
from date_spine
order by date_month
  );
  
[0m18:33:56.111695 [debug] [Thread-2 (]: SQL status: SELECT 45 in 0.064 seconds
[0m18:33:56.118065 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m18:33:56.118367 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap" rename to "stg_filemap__dbt_backup"
[0m18:33:56.122954 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:33:56.124679 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m18:33:56.124907 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
alter table "highstreet"."analytics_analytics"."stg_filemap__dbt_tmp" rename to "stg_filemap"
[0m18:33:56.128231 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:56.136163 [debug] [Thread-1 (]: SQL status: SELECT 432 in 0.088 seconds
[0m18:33:56.136835 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m18:33:56.138670 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m18:33:56.138902 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m18:33:56.139117 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine" rename to "date_spine__dbt_backup"
[0m18:33:56.139322 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: COMMIT
[0m18:33:56.143125 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:33:56.144862 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m18:33:56.145080 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m18:33:56.145324 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
alter table "highstreet"."analytics_analytics"."date_spine__dbt_tmp" rename to "date_spine"
[0m18:33:56.148672 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_filemap__dbt_backup"
[0m18:33:56.150873 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_filemap"
[0m18:33:56.151107 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:33:56.151352 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_filemap"} */
drop table if exists "highstreet"."analytics_analytics"."stg_filemap__dbt_backup" cascade
[0m18:33:56.152069 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m18:33:56.152325 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m18:33:56.152519 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: COMMIT
[0m18:33:56.155899 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m18:33:56.157366 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."date_spine__dbt_backup"
[0m18:33:56.157753 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.date_spine"
[0m18:33:56.157999 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.date_spine"} */
drop table if exists "highstreet"."analytics_analytics"."date_spine__dbt_backup" cascade
[0m18:33:56.170560 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.018 seconds
[0m18:33:56.172115 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_filemap: Close
[0m18:33:56.172353 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m18:33:56.174062 [debug] [Thread-1 (]: On model.highstreet_tenure.date_spine: Close
[0m18:33:56.174778 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773f7c0>]}
[0m18:33:56.175008 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118585150>]}
[0m18:33:56.175425 [info ] [Thread-2 (]: 2 of 13 OK created sql table model analytics_analytics.stg_filemap ............. [[32mSELECT 45[0m in 0.21s]
[0m18:33:56.175834 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_filemap
[0m18:33:56.176102 [info ] [Thread-1 (]: 1 of 13 OK created sql table model analytics_analytics.date_spine .............. [[32mSELECT 432[0m in 0.22s]
[0m18:33:56.176494 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.stg_accounts_closed
[0m18:33:56.176733 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.stg_accounts_no_relief
[0m18:33:56.177024 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.date_spine
[0m18:33:56.177220 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.stg_accounts_relief
[0m18:33:56.177490 [info ] [Thread-4 (]: 3 of 13 START sql table model analytics_analytics.stg_accounts_closed .......... [RUN]
[0m18:33:56.177768 [info ] [Thread-3 (]: 4 of 13 START sql table model analytics_analytics.stg_accounts_no_relief ....... [RUN]
[0m18:33:56.178008 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.stg_new_businesses
[0m18:33:56.178280 [info ] [Thread-2 (]: 5 of 13 START sql table model analytics_analytics.stg_accounts_relief .......... [RUN]
[0m18:33:56.178599 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_closed'
[0m18:33:56.178870 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.highstreet_tenure.stg_accounts_no_relief'
[0m18:33:56.179129 [info ] [Thread-1 (]: 6 of 13 START sql table model analytics_analytics.stg_new_businesses ........... [RUN]
[0m18:33:56.179383 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_filemap, now model.highstreet_tenure.stg_accounts_relief)
[0m18:33:56.179611 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.stg_accounts_closed
[0m18:33:56.179806 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.stg_accounts_no_relief
[0m18:33:56.180010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.date_spine, now model.highstreet_tenure.stg_new_businesses)
[0m18:33:56.180201 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.stg_accounts_relief
[0m18:33:56.183209 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.185248 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:56.185508 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.stg_new_businesses
[0m18:33:56.187249 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:56.189242 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.189615 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.stg_accounts_closed
[0m18:33:56.189820 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.stg_accounts_no_relief
[0m18:33:56.192163 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.192521 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.stg_accounts_relief
[0m18:33:56.194639 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:56.194962 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.stg_new_businesses
[0m18:33:56.196921 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:56.199539 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.199805 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.200177 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:56.200528 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:56.200761 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: BEGIN
[0m18:33:56.201010 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: BEGIN
[0m18:33:56.201232 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: BEGIN
[0m18:33:56.201452 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.201657 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:33:56.201849 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:33:56.202040 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:33:56.202234 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: BEGIN
[0m18:33:56.202660 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:56.261752 [debug] [Thread-3 (]: SQL status: BEGIN in 0.060 seconds
[0m18:33:56.262145 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:56.262394 [debug] [Thread-2 (]: SQL status: BEGIN in 0.060 seconds
[0m18:33:56.263158 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_no_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_no_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'billing_period' as billing_period,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        (data->>'a_c_summary_current_liability')::numeric as a_c_summary_current_liability,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m18:33:56.263500 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:56.263733 [debug] [Thread-1 (]: SQL status: BEGIN in 0.061 seconds
[0m18:33:56.264031 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_relief"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_with_relief'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_relief_type' as current_relief_type,
        data->>'full_property_address' as full_property_address,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        data->>'current_relief_award_start_date' as current_relief_award_start_date,
        data->>'current_relief_type_description' as current_relief_type_description,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_relief_award_perc_awarded')::numeric as current_relief_award_perc_awarded,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m18:33:56.264297 [debug] [Thread-4 (]: SQL status: BEGIN in 0.063 seconds
[0m18:33:56.264496 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.264730 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.264971 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."new_businesses"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'new_businesses'
),

extracted as (
    select
        source.id,
        source_file,
        loaded_at,
        -- Extract fields from the JSON data column
        data->>'current_analysis_code_description' as current_analysis_code_description,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'full_property_address' as full_property_address,
        data->>'liable_responsibility_start_date' as liable_responsibility_start_date,
        (data->>'current_rateable_value')::numeric as current_rateable_value,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m18:33:56.265241 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */

  
    

  create  table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp"
  
  
    as
  
  (
    

with source as (
    select * from "highstreet"."public"."accounts_closed"
),

filemap as (
    select file_name, valid_from, valid_to from "highstreet"."analytics_analytics"."stg_filemap"
    where table_name = 'accounts_closed'
),

extracted as (
    select
        source.id,
        source.source_file,
        source.loaded_at,
        -- Extract fields from the JSON data column
        data->>'account_start_date' as account_start_date,
        data->>'account_end_date' as account_end_date,
        (data->>'outstanding_debt')::numeric as outstanding_debt,
        data->>'full_property_address' as full_property_address,
        data->>'primary_liable_party_name' as primary_liable_party_name,
        data->>'property_reference_number' as property_reference_number,
        filemap.valid_from as valid_from,
        filemap.valid_to as valid_to
    from source
    left join filemap on source.source_file = filemap.file_name
)

select * from extracted
  );
  
[0m18:33:56.403888 [debug] [Thread-1 (]: SQL status: SELECT 1307 in 0.138 seconds
[0m18:33:56.406342 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.406655 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses" rename to "stg_new_businesses__dbt_backup"
[0m18:33:56.411569 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m18:33:56.413260 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.413484 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
alter table "highstreet"."analytics_analytics"."stg_new_businesses__dbt_tmp" rename to "stg_new_businesses"
[0m18:33:56.415299 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:33:56.416331 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m18:33:56.416614 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.416818 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: COMMIT
[0m18:33:56.434484 [debug] [Thread-4 (]: SQL status: SELECT 2683 in 0.169 seconds
[0m18:33:56.438296 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.438597 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed" rename to "stg_accounts_closed__dbt_backup"
[0m18:33:56.441813 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:56.443860 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.444118 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_tmp" rename to "stg_accounts_closed"
[0m18:33:56.445735 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:33:56.446528 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m18:33:56.446754 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.446946 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: COMMIT
[0m18:33:56.454892 [debug] [Thread-1 (]: SQL status: COMMIT in 0.037 seconds
[0m18:33:56.459121 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup"
[0m18:33:56.459584 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.stg_new_businesses"
[0m18:33:56.459856 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_new_businesses"} */
drop table if exists "highstreet"."analytics_analytics"."stg_new_businesses__dbt_backup" cascade
[0m18:33:56.471090 [debug] [Thread-4 (]: SQL status: COMMIT in 0.024 seconds
[0m18:33:56.475461 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup"
[0m18:33:56.475852 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_closed"
[0m18:33:56.476065 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_closed"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_closed__dbt_backup" cascade
[0m18:33:56.491016 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.031 seconds
[0m18:33:56.494762 [debug] [Thread-1 (]: On model.highstreet_tenure.stg_new_businesses: Close
[0m18:33:56.495613 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118585150>]}
[0m18:33:56.496164 [info ] [Thread-1 (]: 6 of 13 OK created sql table model analytics_analytics.stg_new_businesses ...... [[32mSELECT 1307[0m in 0.32s]
[0m18:33:56.496521 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.stg_new_businesses
[0m18:33:56.514584 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.038 seconds
[0m18:33:56.515711 [debug] [Thread-4 (]: On model.highstreet_tenure.stg_accounts_closed: Close
[0m18:33:56.516158 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d847e20>]}
[0m18:33:56.516591 [info ] [Thread-4 (]: 3 of 13 OK created sql table model analytics_analytics.stg_accounts_closed ..... [[32mSELECT 2683[0m in 0.34s]
[0m18:33:56.517168 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.stg_accounts_closed
[0m18:33:57.159877 [debug] [Thread-3 (]: SQL status: SELECT 27009 in 0.895 seconds
[0m18:33:57.164699 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:57.165022 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief" rename to "stg_accounts_no_relief__dbt_backup"
[0m18:33:57.176174 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.011 seconds
[0m18:33:57.179316 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:57.179622 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_tmp" rename to "stg_accounts_no_relief"
[0m18:33:57.181625 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:33:57.182392 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m18:33:57.182624 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:57.182823 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: COMMIT
[0m18:33:57.191293 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:33:57.193970 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup"
[0m18:33:57.194388 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_no_relief"
[0m18:33:57.194610 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_no_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_no_relief__dbt_backup" cascade
[0m18:33:57.235189 [debug] [Thread-2 (]: SQL status: SELECT 28209 in 0.970 seconds
[0m18:33:57.239728 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:57.240016 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief" rename to "stg_accounts_relief__dbt_backup"
[0m18:33:57.243438 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:57.245483 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:57.245760 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
alter table "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_tmp" rename to "stg_accounts_relief"
[0m18:33:57.247672 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:33:57.248550 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m18:33:57.248820 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:57.249026 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: COMMIT
[0m18:33:57.254085 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m18:33:57.255694 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup"
[0m18:33:57.256064 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.stg_accounts_relief"
[0m18:33:57.256289 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.stg_accounts_relief"} */
drop table if exists "highstreet"."analytics_analytics"."stg_accounts_relief__dbt_backup" cascade
[0m18:33:57.277767 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.083 seconds
[0m18:33:57.280311 [debug] [Thread-3 (]: On model.highstreet_tenure.stg_accounts_no_relief: Close
[0m18:33:57.280814 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d813f10>]}
[0m18:33:57.281273 [info ] [Thread-3 (]: 4 of 13 OK created sql table model analytics_analytics.stg_accounts_no_relief .. [[32mSELECT 27009[0m in 1.10s]
[0m18:33:57.281681 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.stg_accounts_no_relief
[0m18:33:57.315045 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.058 seconds
[0m18:33:57.316071 [debug] [Thread-2 (]: On model.highstreet_tenure.stg_accounts_relief: Close
[0m18:33:57.316494 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d863fd0>]}
[0m18:33:57.316903 [info ] [Thread-2 (]: 5 of 13 OK created sql table model analytics_analytics.stg_accounts_relief ..... [[32mSELECT 28209[0m in 1.14s]
[0m18:33:57.317239 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.stg_accounts_relief
[0m18:33:57.317743 [debug] [Thread-1 (]: Began running node model.highstreet_tenure.business_address_timeline
[0m18:33:57.318083 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_addresses
[0m18:33:57.318373 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.businesses
[0m18:33:57.318870 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.properties
[0m18:33:57.318667 [info ] [Thread-1 (]: 7 of 13 START sql table model analytics_analytics.business_address_timeline .... [RUN]
[0m18:33:57.319278 [info ] [Thread-4 (]: 8 of 13 START sql table model analytics_analytics.business_addresses ........... [RUN]
[0m18:33:57.319585 [info ] [Thread-3 (]: 9 of 13 START sql table model analytics_analytics.businesses ................... [RUN]
[0m18:33:57.319835 [info ] [Thread-2 (]: 10 of 13 START sql table model analytics_analytics.properties .................. [RUN]
[0m18:33:57.320192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_new_businesses, now model.highstreet_tenure.business_address_timeline)
[0m18:33:57.320435 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_closed, now model.highstreet_tenure.business_addresses)
[0m18:33:57.320659 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_no_relief, now model.highstreet_tenure.businesses)
[0m18:33:57.320881 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.stg_accounts_relief, now model.highstreet_tenure.properties)
[0m18:33:57.321095 [debug] [Thread-1 (]: Began compiling node model.highstreet_tenure.business_address_timeline
[0m18:33:57.321298 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_addresses
[0m18:33:57.321497 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.businesses
[0m18:33:57.321694 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.properties
[0m18:33:57.325246 [debug] [Thread-1 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_timeline"
[0m18:33:57.327725 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_addresses"
[0m18:33:57.329763 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.businesses"
[0m18:33:57.331582 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.properties"
[0m18:33:57.332311 [debug] [Thread-1 (]: Began executing node model.highstreet_tenure.business_address_timeline
[0m18:33:57.332604 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_addresses
[0m18:33:57.334579 [debug] [Thread-1 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_timeline"
[0m18:33:57.334840 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.businesses
[0m18:33:57.336718 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_addresses"
[0m18:33:57.336965 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.properties
[0m18:33:57.339235 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.businesses"
[0m18:33:57.342436 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.properties"
[0m18:33:57.342748 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m18:33:57.343227 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m18:33:57.343575 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m18:33:57.343847 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: BEGIN
[0m18:33:57.344176 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: BEGIN
[0m18:33:57.344432 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m18:33:57.344663 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: BEGIN
[0m18:33:57.344952 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:57.345201 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:33:57.345493 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: BEGIN
[0m18:33:57.345776 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:33:57.346230 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:33:57.411609 [debug] [Thread-2 (]: SQL status: BEGIN in 0.065 seconds
[0m18:33:57.411966 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m18:33:57.412231 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */

  
    

  create  table "highstreet"."analytics_analytics"."properties__dbt_tmp"
  
  
    as
  
  (
    

with properties_new as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_new_businesses"

),

properties_accounts_no_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

properties_accounts_relief as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

properties_accounts_closed as (
    select distinct full_property_address as property_address, property_reference_number as property_id from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_properties as (

    select * from properties_new
    union 
    select * from properties_accounts_no_relief
    union 
    select * from properties_accounts_relief
    union 
    select * from properties_accounts_closed
)

select distinct property_id, property_address from combined_properties
  );
  
[0m18:33:57.415088 [debug] [Thread-1 (]: SQL status: BEGIN in 0.070 seconds
[0m18:33:57.415917 [debug] [Thread-3 (]: SQL status: BEGIN in 0.070 seconds
[0m18:33:57.416259 [debug] [Thread-4 (]: SQL status: BEGIN in 0.071 seconds
[0m18:33:57.416590 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m18:33:57.416843 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m18:33:57.417090 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m18:33:57.417440 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_timeline__dbt_tmp"
  
  
    as
  
  (
    

with account_ends as (
    select distinct
        primary_liable_party_name as business_name,
        full_property_address as business_address,
        account_start_date,
        account_end_date,
        account_end_date as event_date,
        'account_end' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_closed"
),

accounts_new as (
    select distinct
        primary_liable_party_name as business_name, 
        full_property_address as business_address,
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        liable_responsibility_start_date as event_date,
        'account_start' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_new_businesses"
),

accounts_no_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        full_property_address as business_address,
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, -- Event date derived from file metadata (filename)
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_no_relief"
),

accounts_relief_active as (
    select distinct
        primary_liable_party_name as business_name, 
        full_property_address as business_address,
        liable_responsibility_start_date as account_start_date,
        NULL as account_end_date,
        valid_to as event_date, 
        'account_active' as event_type,
        property_reference_number as property_id,
        source_file as source_file_name
    from "highstreet"."analytics_analytics"."stg_accounts_relief"
),

combined_accounts as (
    select distinct business_name, business_address, event_date, event_type, source_file_name from account_ends
    union 
    select distinct business_name, business_address, event_date, event_type, source_file_name from accounts_new
    union all
    select distinct business_name, business_address, event_date, event_type, source_file_name from accounts_no_relief_active
    union all
    select distinct business_name, business_address, event_date, event_type, source_file_name from accounts_relief_active
)

select 
    
    regexp_replace(
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- replace "&" with "and"
                            business_name,
                            '&', 'and', 'gi'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\\s+', ' ', 'g'
                )
            )
        ),
        '^ta ', '', 'g'
    )
 as business_name,
    business_address, event_date, event_type, source_file_name,
    concat('https://www.stalbans.gov.uk/sites/default/files/attachments/', source_file_name) as source_file_url,
    to_char(event_date::date, 'YYYYMM')::int as year_month_key 
from combined_accounts order by business_name, business_address, event_date
  );
  
[0m18:33:57.417786 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */

  
    

  create  table "highstreet"."analytics_analytics"."businesses__dbt_tmp"
  
  
    as
  
  (
    

with businesses_new as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

businesses_accounts_closed as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

businesses_accounts_no_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

businesses_accounts_relief as (
    select distinct primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),


combined_businesses as (

    select business_name from businesses_new
    union 
    select business_name from businesses_accounts_closed
    union 
    select business_name from businesses_accounts_no_relief
    union 
    select business_name from businesses_accounts_relief

)

select distinct business_name from combined_businesses
  );
  
[0m18:33:57.418111 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp"
  
  
    as
  
  (
    

with business_addresses_new as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_new_businesses"

),

business_addresses_accounts_no_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_no_relief"

),

business_addresses_accounts_relief as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_relief"

),

business_addresses_accounts_closed as (
    select distinct full_property_address as business_address, primary_liable_party_name as business_name from "highstreet"."analytics_analytics"."stg_accounts_closed"

),

combined_business_addresses as (

    select * from business_addresses_new
    union 
    select * from business_addresses_accounts_no_relief
    union 
    select * from business_addresses_accounts_relief
    union 
    select * from business_addresses_accounts_closed
)

select distinct 
     
    regexp_replace(
        lower(
            trim(
                regexp_replace(                   -- collapse multiple spaces
                    regexp_replace(               -- remove non-alphanumeric (keep space)
                        regexp_replace(           -- replace "&" with "and"
                            business_name,
                            '&', 'and', 'gi'
                        ),
                        '[^a-zA-Z0-9 ]', '', 'g'
                    ),
                    '\\s+', ' ', 'g'
                )
            )
        ),
        '^ta ', '', 'g'
    )
 as business_name,
    business_address,
    split_part(business_address, ',', -1) as postcode
from combined_business_addresses
-- where lower(business_address) like '%st peters street%' 
-- or lower(business_address) like '%market place%'
-- or lower(business_address) like '%french row%'
-- or lower(business_address) like '%checker st%'
-- or lower(business_address) like '%george st%'
-- or lower(business_address) like '%holywell hill%'
-- or lower(business_address) like '%london r%'
-- or lower(business_address) like '%victoria st%'
-- or lower(business_address) like '%hatfield r%'
  );
  
[0m18:33:57.744239 [debug] [Thread-3 (]: SQL status: SELECT 6223 in 0.326 seconds
[0m18:33:57.746527 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m18:33:57.746775 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses" rename to "businesses__dbt_backup"
[0m18:33:57.750130 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:57.751852 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m18:33:57.752088 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
alter table "highstreet"."analytics_analytics"."businesses__dbt_tmp" rename to "businesses"
[0m18:33:57.753672 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:33:57.754597 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m18:33:57.754827 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m18:33:57.755019 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: COMMIT
[0m18:33:57.762855 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:33:57.764435 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."businesses__dbt_backup"
[0m18:33:57.764787 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.businesses"
[0m18:33:57.765000 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.businesses"} */
drop table if exists "highstreet"."analytics_analytics"."businesses__dbt_backup" cascade
[0m18:33:57.782990 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.018 seconds
[0m18:33:57.783928 [debug] [Thread-3 (]: On model.highstreet_tenure.businesses: Close
[0m18:33:57.784325 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d8f6710>]}
[0m18:33:57.784709 [info ] [Thread-3 (]: 9 of 13 OK created sql table model analytics_analytics.businesses .............. [[32mSELECT 6223[0m in 0.46s]
[0m18:33:57.785081 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.businesses
[0m18:33:57.815853 [debug] [Thread-2 (]: SQL status: SELECT 9083 in 0.403 seconds
[0m18:33:57.818078 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m18:33:57.818327 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties" rename to "properties__dbt_backup"
[0m18:33:57.822470 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:33:57.824292 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m18:33:57.824511 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
alter table "highstreet"."analytics_analytics"."properties__dbt_tmp" rename to "properties"
[0m18:33:57.826158 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:33:57.827008 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m18:33:57.827238 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m18:33:57.827424 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: COMMIT
[0m18:33:57.834145 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m18:33:57.835715 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."properties__dbt_backup"
[0m18:33:57.836933 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.properties"
[0m18:33:57.837141 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.properties"} */
drop table if exists "highstreet"."analytics_analytics"."properties__dbt_backup" cascade
[0m18:33:57.855594 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.018 seconds
[0m18:33:57.856585 [debug] [Thread-2 (]: On model.highstreet_tenure.properties: Close
[0m18:33:57.856981 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118df9ed0>]}
[0m18:33:57.857363 [info ] [Thread-2 (]: 10 of 13 OK created sql table model analytics_analytics.properties ............. [[32mSELECT 9083[0m in 0.54s]
[0m18:33:57.857680 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.properties
[0m18:33:57.858031 [debug] [Thread-3 (]: Began running node model.highstreet_tenure.addresses
[0m18:33:57.858334 [info ] [Thread-3 (]: 11 of 13 START sql table model analytics_analytics.addresses ................... [RUN]
[0m18:33:57.858602 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.businesses, now model.highstreet_tenure.addresses)
[0m18:33:57.858810 [debug] [Thread-3 (]: Began compiling node model.highstreet_tenure.addresses
[0m18:33:57.860600 [debug] [Thread-3 (]: Writing injected SQL for node "model.highstreet_tenure.addresses"
[0m18:33:57.861081 [debug] [Thread-3 (]: Began executing node model.highstreet_tenure.addresses
[0m18:33:57.863178 [debug] [Thread-3 (]: Writing runtime sql for node "model.highstreet_tenure.addresses"
[0m18:33:57.863745 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m18:33:57.864097 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: BEGIN
[0m18:33:57.864308 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:33:57.915577 [debug] [Thread-3 (]: SQL status: BEGIN in 0.051 seconds
[0m18:33:57.915964 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m18:33:57.916193 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */

  
    

  create  table "highstreet"."analytics_analytics"."addresses__dbt_tmp"
  
  
    as
  
  (
    

with properties as (
    select * from "highstreet"."analytics_analytics"."properties"
)

select distinct property_address from properties
  );
  
[0m18:33:58.024773 [debug] [Thread-3 (]: SQL status: SELECT 4945 in 0.108 seconds
[0m18:33:58.027432 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m18:33:58.027808 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses" rename to "addresses__dbt_backup"
[0m18:33:58.031109 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:58.033243 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m18:33:58.033563 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
alter table "highstreet"."analytics_analytics"."addresses__dbt_tmp" rename to "addresses"
[0m18:33:58.035097 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:33:58.035910 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m18:33:58.036135 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m18:33:58.036321 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: COMMIT
[0m18:33:58.048330 [debug] [Thread-3 (]: SQL status: COMMIT in 0.012 seconds
[0m18:33:58.050335 [debug] [Thread-3 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses__dbt_backup"
[0m18:33:58.050633 [debug] [Thread-4 (]: SQL status: SELECT 9440 in 0.632 seconds
[0m18:33:58.051071 [debug] [Thread-3 (]: Using postgres connection "model.highstreet_tenure.addresses"
[0m18:33:58.053022 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m18:33:58.053295 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses"} */
drop table if exists "highstreet"."analytics_analytics"."addresses__dbt_backup" cascade
[0m18:33:58.053538 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses" rename to "business_addresses__dbt_backup"
[0m18:33:58.056858 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:58.060402 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m18:33:58.060761 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
alter table "highstreet"."analytics_analytics"."business_addresses__dbt_tmp" rename to "business_addresses"
[0m18:33:58.064678 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:33:58.065817 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m18:33:58.066104 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m18:33:58.066321 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: COMMIT
[0m18:33:58.070362 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m18:33:58.110939 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.057 seconds
[0m18:33:58.112100 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_addresses__dbt_backup"
[0m18:33:58.112971 [debug] [Thread-3 (]: On model.highstreet_tenure.addresses: Close
[0m18:33:58.113293 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_addresses"
[0m18:33:58.113556 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_addresses"} */
drop table if exists "highstreet"."analytics_analytics"."business_addresses__dbt_backup" cascade
[0m18:33:58.113974 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d982b00>]}
[0m18:33:58.114450 [info ] [Thread-3 (]: 11 of 13 OK created sql table model analytics_analytics.addresses .............. [[32mSELECT 4945[0m in 0.26s]
[0m18:33:58.114820 [debug] [Thread-3 (]: Finished running node model.highstreet_tenure.addresses
[0m18:33:58.133531 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.019 seconds
[0m18:33:58.134478 [debug] [Thread-4 (]: On model.highstreet_tenure.business_addresses: Close
[0m18:33:58.134847 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d9801f0>]}
[0m18:33:58.135233 [info ] [Thread-4 (]: 8 of 13 OK created sql table model analytics_analytics.business_addresses ...... [[32mSELECT 9440[0m in 0.81s]
[0m18:33:58.135551 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_addresses
[0m18:33:58.135880 [debug] [Thread-2 (]: Began running node model.highstreet_tenure.addresses_with_most_tenants
[0m18:33:58.136138 [info ] [Thread-2 (]: 12 of 13 START sql view model analytics_analytics.addresses_with_most_tenants .. [RUN]
[0m18:33:58.136437 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.properties, now model.highstreet_tenure.addresses_with_most_tenants)
[0m18:33:58.136685 [debug] [Thread-2 (]: Began compiling node model.highstreet_tenure.addresses_with_most_tenants
[0m18:33:58.138424 [debug] [Thread-2 (]: Writing injected SQL for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.138891 [debug] [Thread-2 (]: Began executing node model.highstreet_tenure.addresses_with_most_tenants
[0m18:33:58.150012 [debug] [Thread-2 (]: Writing runtime sql for node "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.150889 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.151203 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: BEGIN
[0m18:33:58.151416 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:33:58.199812 [debug] [Thread-2 (]: SQL status: BEGIN in 0.048 seconds
[0m18:33:58.200201 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.200448 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */

  create view "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_tmp"
    
    
  as (
    with business_addresses as (
    select * from "highstreet"."analytics_analytics"."business_addresses"
)

select 
    business_address,
    postcode,
    left(postcode, 4) as postcode_three_letter,
    count(distinct business_name) as tenant_count
from business_addresses
group by 1, 2
  );
[0m18:33:58.238685 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.038 seconds
[0m18:33:58.240654 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.241118 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
alter table "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_tmp" rename to "addresses_with_most_tenants"
[0m18:33:58.244878 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:33:58.245657 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: COMMIT
[0m18:33:58.245881 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.246071 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: COMMIT
[0m18:33:58.248997 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m18:33:58.250453 [debug] [Thread-2 (]: Applying DROP to: "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_backup"
[0m18:33:58.251847 [debug] [Thread-2 (]: Using postgres connection "model.highstreet_tenure.addresses_with_most_tenants"
[0m18:33:58.252092 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.addresses_with_most_tenants"} */
drop view if exists "highstreet"."analytics_analytics"."addresses_with_most_tenants__dbt_backup" cascade
[0m18:33:58.253719 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m18:33:58.254492 [debug] [Thread-2 (]: On model.highstreet_tenure.addresses_with_most_tenants: Close
[0m18:33:58.254859 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ddd420>]}
[0m18:33:58.255235 [info ] [Thread-2 (]: 12 of 13 OK created sql view model analytics_analytics.addresses_with_most_tenants  [[32mCREATE VIEW[0m in 0.12s]
[0m18:33:58.255559 [debug] [Thread-2 (]: Finished running node model.highstreet_tenure.addresses_with_most_tenants
[0m18:34:00.879044 [debug] [Thread-1 (]: SQL status: SELECT 56080 in 3.460 seconds
[0m18:34:00.884135 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m18:34:00.884504 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */
alter table "highstreet"."analytics_analytics"."business_address_timeline" rename to "business_address_timeline__dbt_backup"
[0m18:34:00.888822 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:34:00.892016 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m18:34:00.892341 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */
alter table "highstreet"."analytics_analytics"."business_address_timeline__dbt_tmp" rename to "business_address_timeline"
[0m18:34:00.897464 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m18:34:00.898478 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: COMMIT
[0m18:34:00.898739 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m18:34:00.898961 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: COMMIT
[0m18:34:00.930937 [debug] [Thread-1 (]: SQL status: COMMIT in 0.031 seconds
[0m18:34:00.935648 [debug] [Thread-1 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_timeline__dbt_backup"
[0m18:34:00.936106 [debug] [Thread-1 (]: Using postgres connection "model.highstreet_tenure.business_address_timeline"
[0m18:34:00.936338 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_timeline"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_timeline__dbt_backup" cascade
[0m18:34:00.970933 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.034 seconds
[0m18:34:00.971955 [debug] [Thread-1 (]: On model.highstreet_tenure.business_address_timeline: Close
[0m18:34:00.972353 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d863c40>]}
[0m18:34:00.972759 [info ] [Thread-1 (]: 7 of 13 OK created sql table model analytics_analytics.business_address_timeline  [[32mSELECT 56080[0m in 3.65s]
[0m18:34:00.973185 [debug] [Thread-1 (]: Finished running node model.highstreet_tenure.business_address_timeline
[0m18:34:00.973744 [debug] [Thread-4 (]: Began running node model.highstreet_tenure.business_address_tenures
[0m18:34:00.974289 [info ] [Thread-4 (]: 13 of 13 START sql table model analytics_analytics.business_address_tenures .... [RUN]
[0m18:34:00.974651 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.highstreet_tenure.business_addresses, now model.highstreet_tenure.business_address_tenures)
[0m18:34:00.974877 [debug] [Thread-4 (]: Began compiling node model.highstreet_tenure.business_address_tenures
[0m18:34:00.976758 [debug] [Thread-4 (]: Writing injected SQL for node "model.highstreet_tenure.business_address_tenures"
[0m18:34:00.977199 [debug] [Thread-4 (]: Began executing node model.highstreet_tenure.business_address_tenures
[0m18:34:00.979264 [debug] [Thread-4 (]: Writing runtime sql for node "model.highstreet_tenure.business_address_tenures"
[0m18:34:00.980081 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m18:34:00.980386 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: BEGIN
[0m18:34:00.980681 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:34:01.037021 [debug] [Thread-4 (]: SQL status: BEGIN in 0.056 seconds
[0m18:34:01.037409 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m18:34:01.037646 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */

  
    

  create  table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp"
  
  
    as
  
  (
    

with business_address_timeline as (
    select * from "highstreet"."analytics_analytics"."business_address_timeline" where lower(business_name) not like '%ratepayer%'
),

-- Normalise names
business_address_timeline_normalised as (
    select
        business_address,
        event_date,
        business_name
       
    from business_address_timeline
),

business_address_tenures as (
    select 
        business_name,       
        business_address,
        min(event_date) as tenure_start_date,
        max(event_date) as tenure_end_date
    from business_address_timeline_normalised
    group by 1,2
)

select 
    business_name,
    business_address,
    tenure_start_date,
    case 
        when tenure_end_date = tenure_start_date then null 
        else tenure_end_date 
    end as tenure_end_date,
    round((tenure_end_date::date - tenure_start_date::date)/365.25,1) as tenure_duration_years
from business_address_tenures
  );
  
[0m18:34:01.650277 [debug] [Thread-4 (]: SQL status: SELECT 7627 in 0.612 seconds
[0m18:34:01.656003 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m18:34:01.656367 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures" rename to "business_address_tenures__dbt_backup"
[0m18:34:01.659412 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:34:01.662004 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m18:34:01.662289 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
alter table "highstreet"."analytics_analytics"."business_address_tenures__dbt_tmp" rename to "business_address_tenures"
[0m18:34:01.664132 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:34:01.665010 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m18:34:01.665273 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m18:34:01.665484 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: COMMIT
[0m18:34:01.682516 [debug] [Thread-4 (]: SQL status: COMMIT in 0.017 seconds
[0m18:34:01.687206 [debug] [Thread-4 (]: Applying DROP to: "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup"
[0m18:34:01.687720 [debug] [Thread-4 (]: Using postgres connection "model.highstreet_tenure.business_address_tenures"
[0m18:34:01.687962 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "highstreet_local", "target_name": "dev", "node_id": "model.highstreet_tenure.business_address_tenures"} */
drop table if exists "highstreet"."analytics_analytics"."business_address_tenures__dbt_backup" cascade
[0m18:34:01.699686 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m18:34:01.702172 [debug] [Thread-4 (]: On model.highstreet_tenure.business_address_tenures: Close
[0m18:34:01.703488 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33250407-6ec4-4688-9a5f-b46aea75a773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ddc760>]}
[0m18:34:01.704540 [info ] [Thread-4 (]: 13 of 13 OK created sql table model analytics_analytics.business_address_tenures  [[32mSELECT 7627[0m in 0.73s]
[0m18:34:01.705431 [debug] [Thread-4 (]: Finished running node model.highstreet_tenure.business_address_tenures
[0m18:34:01.706383 [debug] [MainThread]: Using postgres connection "master"
[0m18:34:01.706666 [debug] [MainThread]: On master: BEGIN
[0m18:34:01.706836 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:34:01.760035 [debug] [MainThread]: SQL status: BEGIN in 0.053 seconds
[0m18:34:01.761286 [debug] [MainThread]: On master: COMMIT
[0m18:34:01.761946 [debug] [MainThread]: Using postgres connection "master"
[0m18:34:01.762605 [debug] [MainThread]: On master: COMMIT
[0m18:34:01.763764 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m18:34:01.764020 [debug] [MainThread]: On master: Close
[0m18:34:01.764295 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:34:01.764470 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_timeline' was properly closed.
[0m18:34:01.764623 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses_with_most_tenants' was properly closed.
[0m18:34:01.764766 [debug] [MainThread]: Connection 'model.highstreet_tenure.business_address_tenures' was properly closed.
[0m18:34:01.764903 [debug] [MainThread]: Connection 'model.highstreet_tenure.addresses' was properly closed.
[0m18:34:01.765128 [info ] [MainThread]: 
[0m18:34:01.765317 [info ] [MainThread]: Finished running 12 table models, 1 view model in 0 hours 0 minutes and 6.79 seconds (6.79s).
[0m18:34:01.766400 [debug] [MainThread]: Command end result
[0m18:34:01.780996 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/samydoreau/data-j/highstreet-tenure/target/manifest.json
[0m18:34:01.782175 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/samydoreau/data-j/highstreet-tenure/target/semantic_manifest.json
[0m18:34:01.786741 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/samydoreau/data-j/highstreet-tenure/target/run_results.json
[0m18:34:01.787035 [info ] [MainThread]: 
[0m18:34:01.787314 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:34:01.787538 [info ] [MainThread]: 
[0m18:34:01.787795 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m18:34:01.790175 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.507335, "process_in_blocks": "0", "process_kernel_time": 0.253621, "process_mem_max_rss": "140902400", "process_out_blocks": "0", "process_user_time": 1.769557}
[0m18:34:01.790531 [debug] [MainThread]: Command `dbt run` succeeded at 18:34:01.790482 after 7.51 seconds
[0m18:34:01.790765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553e8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d897eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d896080>]}
[0m18:34:01.790988 [debug] [MainThread]: Flushing usage events
[0m18:34:02.263919 [debug] [MainThread]: An error was encountered while trying to flush usage events
